/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AlfrescoApiService, LogService } from '@alfresco/adf-core';
import { Injectable } from '@angular/core';
import { Observable, from, throwError } from 'rxjs';
import { ParameterValueModel } from '../../diagram/models/report/parameterValue.model';
import { ReportParametersModel } from '../../diagram/models/report/reportParameters.model';
import { BarChart } from '../../diagram/models/chart/barChart.model';
import { DetailsTableChart } from '../../diagram/models/chart/detailsTableChart.model';
import { HeatMapChart } from '../../diagram/models/chart/heatMapChart.model';
import { MultiBarChart } from '../../diagram/models/chart/multiBarChart.model';
import { PieChart } from '../../diagram/models/chart/pieChart.model';
import { TableChart } from '../../diagram/models/chart/tableChart.model';
import { map, catchError } from 'rxjs/operators';
var AnalyticsService = /** @class */ (function () {
    function AnalyticsService(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
    }
    /**
     * Retrieve all the Deployed app
     */
    /**
     * Retrieve all the Deployed app
     * @param {?} appId
     * @return {?}
     */
    AnalyticsService.prototype.getReportList = /**
     * Retrieve all the Deployed app
     * @param {?} appId
     * @return {?}
     */
    function (appId) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getReportList())
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var reports = [];
            res.forEach((/**
             * @param {?} report
             * @return {?}
             */
            function (report) {
                /** @type {?} */
                var reportModel = new ReportParametersModel(report);
                if (_this.isReportValid(appId, report)) {
                    reports.push(reportModel);
                }
            }));
            return reports;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * Retrieve Report by name
     * @param reportName - string - The name of report
     */
    /**
     * Retrieve Report by name
     * @param {?} reportName - string - The name of report
     * @return {?}
     */
    AnalyticsService.prototype.getReportByName = /**
     * Retrieve Report by name
     * @param {?} reportName - string - The name of report
     * @return {?}
     */
    function (reportName) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getReportList())
            .pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            return response.find((/**
             * @param {?} report
             * @return {?}
             */
            function (report) { return report.name === reportName; }));
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @private
     * @param {?} appId
     * @param {?} report
     * @return {?}
     */
    AnalyticsService.prototype.isReportValid = /**
     * @private
     * @param {?} appId
     * @param {?} report
     * @return {?}
     */
    function (appId, report) {
        /** @type {?} */
        var isValid = true;
        if (appId && appId !== 0 && report.name.includes('Process definition overview')) {
            isValid = false;
        }
        return isValid;
    };
    /**
     * @param {?} reportId
     * @return {?}
     */
    AnalyticsService.prototype.getReportParams = /**
     * @param {?} reportId
     * @return {?}
     */
    function (reportId) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getReportParams(reportId))
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return new ReportParametersModel(res);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} type
     * @param {?} appId
     * @param {?=} reportId
     * @param {?=} processDefinitionId
     * @return {?}
     */
    AnalyticsService.prototype.getParamValuesByType = /**
     * @param {?} type
     * @param {?} appId
     * @param {?=} reportId
     * @param {?=} processDefinitionId
     * @return {?}
     */
    function (type, appId, reportId, processDefinitionId) {
        if (type === 'status') {
            return this.getProcessStatusValues();
        }
        else if (type === 'processDefinition') {
            if (appId === null || appId === undefined) {
                return this.getProcessDefinitionsValuesNoApp();
            }
            else {
                return this.getProcessDefinitionsValues(appId);
            }
        }
        else if (type === 'dateInterval') {
            return this.getDateIntervalValues();
        }
        else if (type === 'task' && reportId && processDefinitionId) {
            return this.getTasksByProcessDefinitionId(reportId, processDefinitionId);
        }
        else {
            return new Observable((/**
             * @param {?} observer
             * @return {?}
             */
            function (observer) {
                observer.next(null);
                observer.complete();
            }));
        }
    };
    /**
     * @return {?}
     */
    AnalyticsService.prototype.getProcessStatusValues = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'All', name: 'All' }));
        paramOptions.push(new ParameterValueModel({ id: 'Active', name: 'Active' }));
        paramOptions.push(new ParameterValueModel({ id: 'Complete', name: 'Complete' }));
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            observer.next(paramOptions);
            observer.complete();
        }));
    };
    /**
     * @return {?}
     */
    AnalyticsService.prototype.getDateIntervalValues = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'byHour', name: 'By hour' }));
        paramOptions.push(new ParameterValueModel({ id: 'byDay', name: 'By day' }));
        paramOptions.push(new ParameterValueModel({ id: 'byWeek', name: 'By week' }));
        paramOptions.push(new ParameterValueModel({ id: 'byMonth', name: 'By month' }));
        paramOptions.push(new ParameterValueModel({ id: 'byYear', name: 'By year' }));
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            observer.next(paramOptions);
            observer.complete();
        }));
    };
    /**
     * @return {?}
     */
    AnalyticsService.prototype.getMetricValues = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var paramOptions = [];
        paramOptions.push(new ParameterValueModel({ id: 'totalCount', name: 'Number of times a step is executed' }));
        paramOptions.push(new ParameterValueModel({ id: 'totalTime', name: 'Total time spent in a process step' }));
        paramOptions.push(new ParameterValueModel({ id: 'avgTime', name: 'Average time spent in a process step' }));
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            observer.next(paramOptions);
            observer.complete();
        }));
    };
    /**
     * @return {?}
     */
    AnalyticsService.prototype.getProcessDefinitionsValuesNoApp = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getProcessDefinitions())
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var paramOptions = [];
            res.forEach((/**
             * @param {?} opt
             * @return {?}
             */
            function (opt) {
                paramOptions.push(new ParameterValueModel(opt));
            }));
            return paramOptions;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} appId
     * @return {?}
     */
    AnalyticsService.prototype.getProcessDefinitionsValues = /**
     * @param {?} appId
     * @return {?}
     */
    function (appId) {
        var _this = this;
        /** @type {?} */
        var options = { 'appDefinitionId': appId };
        return from(this.apiService.getInstance().activiti.processDefinitionsApi.getProcessDefinitions(options))
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var paramOptions = [];
            res.data.forEach((/**
             * @param {?} opt
             * @return {?}
             */
            function (opt) {
                paramOptions.push(new ParameterValueModel(opt));
            }));
            return paramOptions;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @param {?} processDefinitionId
     * @return {?}
     */
    AnalyticsService.prototype.getTasksByProcessDefinitionId = /**
     * @param {?} reportId
     * @param {?} processDefinitionId
     * @return {?}
     */
    function (reportId, processDefinitionId) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getTasksByProcessDefinitionId(reportId, processDefinitionId))
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var paramOptions = [];
            res.forEach((/**
             * @param {?} opt
             * @return {?}
             */
            function (opt) {
                paramOptions.push(new ParameterValueModel({ id: opt, name: opt }));
            }));
            return paramOptions;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    AnalyticsService.prototype.getReportsByParams = /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    function (reportId, paramsQuery) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.getReportsByParams(reportId, paramsQuery))
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var elements = [];
            res.elements.forEach((/**
             * @param {?} chartData
             * @return {?}
             */
            function (chartData) {
                if (chartData.type === 'pieChart') {
                    elements.push(new PieChart(chartData));
                }
                else if (chartData.type === 'table') {
                    elements.push(new TableChart(chartData));
                }
                else if (chartData.type === 'processDefinitionHeatMap') {
                    elements.push(new HeatMapChart(chartData));
                }
                else if (chartData.type === 'masterDetailTable') {
                    elements.push(new DetailsTableChart(chartData));
                }
                else if (chartData.type === 'barChart') {
                    elements.push(new BarChart(chartData));
                }
                else if (chartData.type === 'multiBarChart') {
                    elements.push(new MultiBarChart(chartData));
                }
            }));
            return elements;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @return {?}
     */
    AnalyticsService.prototype.createDefaultReports = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.createDefaultReports())
            .pipe(map(this.toJson), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @param {?} name
     * @return {?}
     */
    AnalyticsService.prototype.updateReport = /**
     * @param {?} reportId
     * @param {?} name
     * @return {?}
     */
    function (reportId, name) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.updateReport(reportId, name))
            .pipe(map((/**
         * @return {?}
         */
        function () { return _this.logService.info('upload'); })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    AnalyticsService.prototype.exportReportToCsv = /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    function (reportId, paramsQuery) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.exportToCsv(reportId, paramsQuery))
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.logService.info('export');
            return res;
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    AnalyticsService.prototype.saveReport = /**
     * @param {?} reportId
     * @param {?} paramsQuery
     * @return {?}
     */
    function (reportId, paramsQuery) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.saveReport(reportId, paramsQuery))
            .pipe(map((/**
         * @return {?}
         */
        function () {
            _this.logService.info('save');
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @param {?} reportId
     * @return {?}
     */
    AnalyticsService.prototype.deleteReport = /**
     * @param {?} reportId
     * @return {?}
     */
    function (reportId) {
        var _this = this;
        return from(this.apiService.getInstance().activiti.reportApi.deleteReport(reportId))
            .pipe(map((/**
         * @return {?}
         */
        function () {
            _this.logService.info('delete');
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.handleError(err); })));
    };
    /**
     * @private
     * @param {?} error
     * @return {?}
     */
    AnalyticsService.prototype.handleError = /**
     * @private
     * @param {?} error
     * @return {?}
     */
    function (error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    };
    /**
     * @param {?} res
     * @return {?}
     */
    AnalyticsService.prototype.toJson = /**
     * @param {?} res
     * @return {?}
     */
    function (res) {
        return res || {};
    };
    AnalyticsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AnalyticsService.ctorParameters = function () { return [
        { type: AlfrescoApiService },
        { type: LogService }
    ]; };
    return AnalyticsService;
}());
export { AnalyticsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AnalyticsService.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    AnalyticsService.prototype.logService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiYW5hbHl0aWNzLXByb2Nlc3Mvc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBQzNGLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUVyRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUN2RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQy9FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDekUsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRDtJQUdJLDBCQUFvQixVQUE4QixFQUM5QixVQUFzQjtRQUR0QixlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QixlQUFVLEdBQVYsVUFBVSxDQUFZO0lBQzFDLENBQUM7SUFFRDs7T0FFRzs7Ozs7O0lBQ0gsd0NBQWE7Ozs7O0lBQWIsVUFBYyxLQUFhO1FB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QUMvRSxJQUFJLENBQ0QsR0FBRzs7O1FBQUM7WUFDQSxLQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNuQyxDQUFDLEVBQUMsRUFDRixVQUFVOzs7O1FBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFyQixDQUFxQixFQUFDLENBQzdDLENBQUM7SUFDVixDQUFDOzs7Ozs7SUFFTyxzQ0FBVzs7Ozs7SUFBbkIsVUFBb0IsS0FBZTtRQUMvQixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixPQUFPLFVBQVUsQ0FBQyxLQUFLLElBQUksY0FBYyxDQUFDLENBQUM7SUFDL0MsQ0FBQzs7Ozs7SUFFRCxpQ0FBTTs7OztJQUFOLFVBQU8sR0FBUTtRQUNYLE9BQU8sR0FBRyxJQUFJLEVBQUUsQ0FBQztJQUNyQixDQUFDOztnQkFyUEosVUFBVTs7OztnQkFmRixrQkFBa0I7Z0JBQUUsVUFBVTs7SUFxUXZDLHVCQUFDO0NBQUEsQUF0UEQsSUFzUEM7U0FyUFksZ0JBQWdCOzs7Ozs7SUFFYixzQ0FBc0M7Ozs7O0lBQ3RDLHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUGFyYW1ldGVyVmFsdWVNb2RlbCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL3JlcG9ydC9wYXJhbWV0ZXJWYWx1ZS5tb2RlbCc7XG5pbXBvcnQgeyBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9yZXBvcnQvcmVwb3J0UGFyYW1ldGVycy5tb2RlbCc7XG5pbXBvcnQgeyBCYXJDaGFydCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL2NoYXJ0L2JhckNoYXJ0Lm1vZGVsJztcbmltcG9ydCB7IENoYXJ0IH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvY2hhcnQvY2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgRGV0YWlsc1RhYmxlQ2hhcnQgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9jaGFydC9kZXRhaWxzVGFibGVDaGFydC5tb2RlbCc7XG5pbXBvcnQgeyBIZWF0TWFwQ2hhcnQgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9jaGFydC9oZWF0TWFwQ2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgTXVsdGlCYXJDaGFydCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL2NoYXJ0L211bHRpQmFyQ2hhcnQubW9kZWwnO1xuaW1wb3J0IHsgUGllQ2hhcnQgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9jaGFydC9waWVDaGFydC5tb2RlbCc7XG5pbXBvcnQgeyBUYWJsZUNoYXJ0IH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvY2hhcnQvdGFibGVDaGFydC5tb2RlbCc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBbmFseXRpY3NTZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSkge1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGFsbCB0aGUgRGVwbG95ZWQgYXBwXG4gICAgICovXG4gICAgZ2V0UmVwb3J0TGlzdChhcHBJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmdldFJlcG9ydExpc3QoKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVwb3J0czogUmVwb3J0UGFyYW1ldGVyc01vZGVsW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHJlcG9ydDogUmVwb3J0UGFyYW1ldGVyc01vZGVsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXBvcnRNb2RlbCA9IG5ldyBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwocmVwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUmVwb3J0VmFsaWQoYXBwSWQsIHJlcG9ydCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRzLnB1c2gocmVwb3J0TW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcG9ydHM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIFJlcG9ydCBieSBuYW1lXG4gICAgICogQHBhcmFtIHJlcG9ydE5hbWUgLSBzdHJpbmcgLSBUaGUgbmFtZSBvZiByZXBvcnRcbiAgICAgKi9cbiAgICBnZXRSZXBvcnRCeU5hbWUocmVwb3J0TmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmdldFJlcG9ydExpc3QoKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZmluZCgocmVwb3J0KSA9PiByZXBvcnQubmFtZSA9PT0gcmVwb3J0TmFtZSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNSZXBvcnRWYWxpZChhcHBJZDogbnVtYmVyLCByZXBvcnQ6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbCkge1xuICAgICAgICBsZXQgaXNWYWxpZDogYm9vbGVhbiA9IHRydWU7XG4gICAgICAgIGlmIChhcHBJZCAmJiBhcHBJZCAhPT0gMCAmJiByZXBvcnQubmFtZS5pbmNsdWRlcygnUHJvY2VzcyBkZWZpbml0aW9uIG92ZXJ2aWV3JykpIHtcbiAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNWYWxpZDtcbiAgICB9XG5cbiAgICBnZXRSZXBvcnRQYXJhbXMocmVwb3J0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS5nZXRSZXBvcnRQYXJhbXMocmVwb3J0SWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlcG9ydFBhcmFtZXRlcnNNb2RlbChyZXMpO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQYXJhbVZhbHVlc0J5VHlwZSh0eXBlOiBzdHJpbmcsIGFwcElkOiBudW1iZXIsIHJlcG9ydElkPzogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkPzogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0eXBlID09PSAnc3RhdHVzJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc1N0YXR1c1ZhbHVlcygpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdwcm9jZXNzRGVmaW5pdGlvbicpIHtcbiAgICAgICAgICAgIGlmIChhcHBJZCA9PT0gbnVsbCB8fCBhcHBJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzTm9BcHAoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzKGFwcElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZGF0ZUludGVydmFsJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0ZUludGVydmFsVmFsdWVzKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3Rhc2snICYmIHJlcG9ydElkICYmIHByb2Nlc3NEZWZpbml0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRhc2tzQnlQcm9jZXNzRGVmaW5pdGlvbklkKHJlcG9ydElkLCBwcm9jZXNzRGVmaW5pdGlvbklkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KG51bGwpO1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFByb2Nlc3NTdGF0dXNWYWx1ZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgcGFyYW1PcHRpb25zOiBQYXJhbWV0ZXJWYWx1ZU1vZGVsW10gPSBbXTtcblxuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnQWxsJywgbmFtZTogJ0FsbCcgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnQWN0aXZlJywgbmFtZTogJ0FjdGl2ZScgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnQ29tcGxldGUnLCBuYW1lOiAnQ29tcGxldGUnIH0pKTtcblxuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KHBhcmFtT3B0aW9ucyk7XG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXREYXRlSW50ZXJ2YWxWYWx1ZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgcGFyYW1PcHRpb25zOiBQYXJhbWV0ZXJWYWx1ZU1vZGVsW10gPSBbXTtcblxuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnYnlIb3VyJywgbmFtZTogJ0J5IGhvdXInIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ2J5RGF5JywgbmFtZTogJ0J5IGRheScgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAnYnlXZWVrJywgbmFtZTogJ0J5IHdlZWsnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ2J5TW9udGgnLCBuYW1lOiAnQnkgbW9udGgnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ2J5WWVhcicsIG5hbWU6ICdCeSB5ZWFyJyB9KSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChwYXJhbU9wdGlvbnMpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0TWV0cmljVmFsdWVzKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IHBhcmFtT3B0aW9uczogUGFyYW1ldGVyVmFsdWVNb2RlbFtdID0gW107XG5cbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ3RvdGFsQ291bnQnLCBuYW1lOiAnTnVtYmVyIG9mIHRpbWVzIGEgc3RlcCBpcyBleGVjdXRlZCcgfSkpO1xuICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiAndG90YWxUaW1lJywgbmFtZTogJ1RvdGFsIHRpbWUgc3BlbnQgaW4gYSBwcm9jZXNzIHN0ZXAnIH0pKTtcbiAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwoeyBpZDogJ2F2Z1RpbWUnLCBuYW1lOiAnQXZlcmFnZSB0aW1lIHNwZW50IGluIGEgcHJvY2VzcyBzdGVwJyB9KSk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChwYXJhbU9wdGlvbnMpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0UHJvY2Vzc0RlZmluaXRpb25zVmFsdWVzTm9BcHAoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmdldFByb2Nlc3NEZWZpbml0aW9ucygpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbU9wdGlvbnM6IFBhcmFtZXRlclZhbHVlTW9kZWxbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgob3B0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbChvcHQpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJhbU9wdGlvbnM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFByb2Nlc3NEZWZpbml0aW9uc1ZhbHVlcyhhcHBJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsgJ2FwcERlZmluaXRpb25JZCc6IGFwcElkIH07XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnByb2Nlc3NEZWZpbml0aW9uc0FwaS5nZXRQcm9jZXNzRGVmaW5pdGlvbnMob3B0aW9ucykpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtT3B0aW9uczogUGFyYW1ldGVyVmFsdWVNb2RlbFtdID0gW107XG4gICAgICAgICAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goKG9wdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcHRpb25zLnB1c2gobmV3IFBhcmFtZXRlclZhbHVlTW9kZWwob3B0KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1PcHRpb25zO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRUYXNrc0J5UHJvY2Vzc0RlZmluaXRpb25JZChyZXBvcnRJZDogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuZ2V0VGFza3NCeVByb2Nlc3NEZWZpbml0aW9uSWQocmVwb3J0SWQsIHByb2Nlc3NEZWZpbml0aW9uSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbU9wdGlvbnM6IFBhcmFtZXRlclZhbHVlTW9kZWxbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgob3B0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbU9wdGlvbnMucHVzaChuZXcgUGFyYW1ldGVyVmFsdWVNb2RlbCh7IGlkOiBvcHQsIG5hbWU6IG9wdCB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1PcHRpb25zO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRSZXBvcnRzQnlQYXJhbXMocmVwb3J0SWQ6IG51bWJlciwgcGFyYW1zUXVlcnk6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLmFjdGl2aXRpLnJlcG9ydEFwaS5nZXRSZXBvcnRzQnlQYXJhbXMocmVwb3J0SWQsIHBhcmFtc1F1ZXJ5KSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudHM6IENoYXJ0W10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVsZW1lbnRzLmZvckVhY2goKGNoYXJ0RGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXJ0RGF0YS50eXBlID09PSAncGllQ2hhcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgUGllQ2hhcnQoY2hhcnREYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJ0RGF0YS50eXBlID09PSAndGFibGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgVGFibGVDaGFydChjaGFydERhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhcnREYXRhLnR5cGUgPT09ICdwcm9jZXNzRGVmaW5pdGlvbkhlYXRNYXAnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgSGVhdE1hcENoYXJ0KGNoYXJ0RGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFydERhdGEudHlwZSA9PT0gJ21hc3RlckRldGFpbFRhYmxlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2gobmV3IERldGFpbHNUYWJsZUNoYXJ0KGNoYXJ0RGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFydERhdGEudHlwZSA9PT0gJ2JhckNoYXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2gobmV3IEJhckNoYXJ0KGNoYXJ0RGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFydERhdGEudHlwZSA9PT0gJ211bHRpQmFyQ2hhcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaChuZXcgTXVsdGlCYXJDaGFydChjaGFydERhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjcmVhdGVEZWZhdWx0UmVwb3J0cygpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkuY3JlYXRlRGVmYXVsdFJlcG9ydHMoKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLnRvSnNvbiksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHVwZGF0ZVJlcG9ydChyZXBvcnRJZDogbnVtYmVyLCBuYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5hY3Rpdml0aS5yZXBvcnRBcGkudXBkYXRlUmVwb3J0KHJlcG9ydElkLCBuYW1lKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgoKSA9PiB0aGlzLmxvZ1NlcnZpY2UuaW5mbygndXBsb2FkJykpLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBleHBvcnRSZXBvcnRUb0NzdihyZXBvcnRJZDogc3RyaW5nLCBwYXJhbXNRdWVyeTogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmV4cG9ydFRvQ3N2KHJlcG9ydElkLCBwYXJhbXNRdWVyeSkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKCdleHBvcnQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgc2F2ZVJlcG9ydChyZXBvcnRJZDogc3RyaW5nLCBwYXJhbXNRdWVyeTogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLnNhdmVSZXBvcnQocmVwb3J0SWQsIHBhcmFtc1F1ZXJ5KSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKCdzYXZlJyk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIGRlbGV0ZVJlcG9ydChyZXBvcnRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkuYWN0aXZpdGkucmVwb3J0QXBpLmRlbGV0ZVJlcG9ydChyZXBvcnRJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuaW5mbygnZGVsZXRlJyk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRXJyb3IoZXJyb3I6IFJlc3BvbnNlKSB7XG4gICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yIHx8ICdTZXJ2ZXIgZXJyb3InKTtcbiAgICB9XG5cbiAgICB0b0pzb24ocmVzOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHJlcyB8fCB7fTtcbiAgICB9XG59XG4iXX0=