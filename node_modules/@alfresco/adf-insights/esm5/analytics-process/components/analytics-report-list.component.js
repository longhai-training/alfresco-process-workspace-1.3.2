/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { Observable } from 'rxjs';
import { AnalyticsService } from '../services/analytics.service';
import { share } from 'rxjs/operators';
var AnalyticsReportListComponent = /** @class */ (function () {
    function AnalyticsReportListComponent(analyticsService) {
        var _this = this;
        this.analyticsService = analyticsService;
        this.layoutType = AnalyticsReportListComponent.LAYOUT_LIST;
        this.selectFirst = false;
        this.reportClick = new EventEmitter();
        this.success = new EventEmitter();
        this.error = new EventEmitter();
        this.reports = [];
        this.report$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) { return _this.reportObserver = observer; }))
            .pipe(share());
    }
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initObserver();
        this.getReportList(this.appId);
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.initObserver = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.report$.subscribe((/**
         * @param {?} report
         * @return {?}
         */
        function (report) {
            _this.reports.push(report);
        }));
    };
    /**
     * Reload the component
     */
    /**
     * Reload the component
     * @param {?=} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.reload = /**
     * Reload the component
     * @param {?=} reportId
     * @return {?}
     */
    function (reportId) {
        this.reset();
        this.getReportList(this.appId, reportId);
    };
    /**
     * Get the report list
     */
    /**
     * Get the report list
     * @param {?} appId
     * @param {?=} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.getReportList = /**
     * Get the report list
     * @param {?} appId
     * @param {?=} reportId
     * @return {?}
     */
    function (appId, reportId) {
        var _this = this;
        this.analyticsService.getReportList(appId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (res && res.length === 0) {
                _this.createDefaultReports();
            }
            else {
                res.forEach((/**
                 * @param {?} report
                 * @return {?}
                 */
                function (report) {
                    _this.reportObserver.next(report);
                }));
                if (reportId) {
                    _this.selectReportByReportId(reportId);
                }
                if (_this.selectFirst) {
                    _this.selectFirstReport();
                }
                _this.success.emit(res);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this.error.emit(err);
        }));
    };
    /**
     * Create the default reports and return the report list
     */
    /**
     * Create the default reports and return the report list
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.createDefaultReports = /**
     * Create the default reports and return the report list
     * @return {?}
     */
    function () {
        var _this = this;
        this.analyticsService.createDefaultReports().subscribe((/**
         * @return {?}
         */
        function () {
            _this.analyticsService.getReportList(_this.appId).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                response.forEach((/**
                 * @param {?} report
                 * @return {?}
                 */
                function (report) {
                    _this.reportObserver.next(report);
                }));
                _this.success.emit(response);
            }));
        }));
    };
    /**
     * Check if the report list is empty
     */
    /**
     * Check if the report list is empty
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isReportsEmpty = /**
     * Check if the report list is empty
     * @return {?}
     */
    function () {
        return this.reports === undefined || (this.reports && this.reports.length === 0);
    };
    /**
     * Reset the list
     */
    /**
     * Reset the list
     * @private
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.reset = /**
     * Reset the list
     * @private
     * @return {?}
     */
    function () {
        if (!this.isReportsEmpty()) {
            this.reports = [];
        }
    };
    /**
     * Select the current report
     * @param report
     */
    /**
     * Select the current report
     * @param {?} report
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectReport = /**
     * Select the current report
     * @param {?} report
     * @return {?}
     */
    function (report) {
        this.currentReport = report;
        this.reportClick.emit(report);
    };
    /**
     * @param {?} reportId
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectReportByReportId = /**
     * @param {?} reportId
     * @return {?}
     */
    function (reportId) {
        /** @type {?} */
        var reportFound = this.reports.find((/**
         * @param {?} report
         * @return {?}
         */
        function (report) { return report.id === reportId; }));
        if (reportFound) {
            this.currentReport = reportFound;
            this.reportClick.emit(reportFound);
        }
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.selectFirstReport = /**
     * @return {?}
     */
    function () {
        this.selectReport(this.reports[0]);
        this.selectFirst = false;
    };
    /**
     * @param {?} report
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isSelected = /**
     * @param {?} report
     * @return {?}
     */
    function (report) {
        return this.currentReport === report ? true : false;
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isList = /**
     * @return {?}
     */
    function () {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_LIST;
    };
    /**
     * @return {?}
     */
    AnalyticsReportListComponent.prototype.isGrid = /**
     * @return {?}
     */
    function () {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_GRID;
    };
    AnalyticsReportListComponent.LAYOUT_LIST = 'LIST';
    AnalyticsReportListComponent.LAYOUT_GRID = 'GRID';
    AnalyticsReportListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-analytics-report-list',
                    template: "<div class=\"adf-analytics-report-list menu-container\">\n    <mat-nav-list *ngIf=\"isList()\">\n        <mat-list-item\n            class=\"adf-activiti-filters__entry\"\n            (click)=\"selectReport(report)\"\n            *ngFor=\"let report of reports; let idx = index\"\n            [class.adf-active]=\"currentReport === report\">\n            <span [attr.id]=\"'report-list-' + idx\" class=\"adf-activiti-filters__label\">\n                <mat-icon mat-list-icon\n                    [attr.data-automation-id]=\"report.name + '_filter'\"\n                    class=\"adf-activiti-filters__entry-icon\">assignment</mat-icon>\n                <span class=\"adf-text\">{{report.name}}</span>\n            </span>\n        </mat-list-item>\n    </mat-nav-list>\n    <div class=\"adf-report-card-grids\" *ngIf=\"isGrid()\">\n        <mat-card (click)=\"selectReport(report)\" class=\"adf-report-card\" *ngFor=\"let report of reports;\">\n            <div class=\"adf-report-card-logo logo\">\n                <mat-icon class=\"adf-report-card-logo-icon\">equalizer</mat-icon>\n            </div>\n            <div mat-card-title class=\"adf-report-card-title\">\n                <h1 class=\"adf-application-title\">{{report.name}}</h1>\n            </div>\n            <div mat-card-content class=\"adf-report-card-content\">\n                <p>{{report.description}}</p>\n            </div>\n            <div mat-card-actions class=\"adf-report-card-actions\">\n                <mat-icon class=\"adf-report-card-actions-icon\" *ngIf=\"isSelected(report)\">done</mat-icon>\n            </div>\n        </mat-card>\n    </div>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AnalyticsReportListComponent.ctorParameters = function () { return [
        { type: AnalyticsService }
    ]; };
    AnalyticsReportListComponent.propDecorators = {
        layoutType: [{ type: Input }],
        appId: [{ type: Input }],
        selectFirst: [{ type: Input }],
        reportClick: [{ type: Output }],
        success: [{ type: Output }],
        error: [{ type: Output }]
    };
    return AnalyticsReportListComponent;
}());
export { AnalyticsReportListComponent };
if (false) {
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_LIST;
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_GRID;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.layoutType;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.appId;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.selectFirst;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reportClick;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.success;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.error;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.reportObserver;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.report$;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.currentReport;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reports;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.analyticsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLXJlcG9ydC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtaW5zaWdodHMvIiwic291cmNlcyI6WyJhbmFseXRpY3MtcHJvY2Vzcy9jb21wb25lbnRzL2FuYWx5dGljcy1yZXBvcnQtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQUUsVUFBVSxFQUFZLE1BQU0sTUFBTSxDQUFDO0FBRTVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2QztJQW9DSSxzQ0FBb0IsZ0JBQWtDO1FBQXRELGlCQUdDO1FBSG1CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUF4QnRELGVBQVUsR0FBVyw0QkFBNEIsQ0FBQyxXQUFXLENBQUM7UUFNOUQsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHN0IsZ0JBQVcsR0FBd0MsSUFBSSxZQUFZLEVBQXlCLENBQUM7UUFHN0YsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFHN0IsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFPM0IsWUFBTyxHQUE0QixFQUFFLENBQUM7UUFHbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFVBQVU7Ozs7UUFBd0IsVUFBQyxRQUFRLElBQUssT0FBQSxLQUFJLENBQUMsY0FBYyxHQUFHLFFBQVEsRUFBOUIsQ0FBOEIsRUFBQzthQUM3RixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUN2QixDQUFDOzs7O0lBRUQsK0NBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLFlB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O29CQUVyRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7aUJBQ3hDOzs7O2dCQVJRLGdCQUFnQjs7OzZCQWNwQixLQUFLO3dCQUdMLEtBQUs7OEJBR0wsS0FBSzs4QkFHTCxNQUFNOzBCQUdOLE1BQU07d0JBR04sTUFBTTs7SUFpSVgsbUNBQUM7Q0FBQSxBQTNKRCxJQTJKQztTQXJKWSw0QkFBNEI7OztJQUVyQyx5Q0FBMkM7O0lBQzNDLHlDQUEyQzs7SUFFM0Msa0RBQzhEOztJQUU5RCw2Q0FDYzs7SUFFZCxtREFDNkI7O0lBRTdCLG1EQUM2Rjs7SUFFN0YsK0NBQzZCOztJQUU3Qiw2Q0FDMkI7Ozs7O0lBRTNCLHNEQUFzQzs7SUFDdEMsK0NBQXlCOztJQUV6QixxREFBbUI7O0lBRW5CLCtDQUFzQzs7Ozs7SUFFMUIsd0RBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIE9ic2VydmVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwgfSBmcm9tICcuLi8uLi9kaWFncmFtL21vZGVscy9yZXBvcnQvcmVwb3J0UGFyYW1ldGVycy5tb2RlbCc7XG5pbXBvcnQgeyBBbmFseXRpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYW5hbHl0aWNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgc2hhcmUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWFuYWx5dGljcy1yZXBvcnQtbGlzdCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2FuYWx5dGljcy1yZXBvcnQtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vYW5hbHl0aWNzLXJlcG9ydC1saXN0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBBbmFseXRpY3NSZXBvcnRMaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIHB1YmxpYyBzdGF0aWMgTEFZT1VUX0xJU1Q6IHN0cmluZyA9ICdMSVNUJztcbiAgICBwdWJsaWMgc3RhdGljIExBWU9VVF9HUklEOiBzdHJpbmcgPSAnR1JJRCc7XG5cbiAgICBASW5wdXQoKVxuICAgIGxheW91dFR5cGU6IHN0cmluZyA9IEFuYWx5dGljc1JlcG9ydExpc3RDb21wb25lbnQuTEFZT1VUX0xJU1Q7XG5cbiAgICBASW5wdXQoKVxuICAgIGFwcElkOiBudW1iZXI7XG5cbiAgICBASW5wdXQoKVxuICAgIHNlbGVjdEZpcnN0OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBAT3V0cHV0KClcbiAgICByZXBvcnRDbGljazogRXZlbnRFbWl0dGVyPFJlcG9ydFBhcmFtZXRlcnNNb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyPFJlcG9ydFBhcmFtZXRlcnNNb2RlbD4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIHByaXZhdGUgcmVwb3J0T2JzZXJ2ZXI6IE9ic2VydmVyPGFueT47XG4gICAgcmVwb3J0JDogT2JzZXJ2YWJsZTxhbnk+O1xuXG4gICAgY3VycmVudFJlcG9ydDogYW55O1xuXG4gICAgcmVwb3J0czogUmVwb3J0UGFyYW1ldGVyc01vZGVsW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYW5hbHl0aWNzU2VydmljZTogQW5hbHl0aWNzU2VydmljZSkge1xuICAgICAgICB0aGlzLnJlcG9ydCQgPSBuZXcgT2JzZXJ2YWJsZTxSZXBvcnRQYXJhbWV0ZXJzTW9kZWw+KChvYnNlcnZlcikgPT4gdGhpcy5yZXBvcnRPYnNlcnZlciA9IG9ic2VydmVyKVxuICAgICAgICAgICAgLnBpcGUoc2hhcmUoKSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdE9ic2VydmVyKCk7XG5cbiAgICAgICAgdGhpcy5nZXRSZXBvcnRMaXN0KHRoaXMuYXBwSWQpO1xuICAgIH1cblxuICAgIGluaXRPYnNlcnZlcigpIHtcbiAgICAgICAgdGhpcy5yZXBvcnQkLnN1YnNjcmliZSgocmVwb3J0OiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cy5wdXNoKHJlcG9ydCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbG9hZCB0aGUgY29tcG9uZW50XG4gICAgICovXG4gICAgcmVsb2FkKHJlcG9ydElkPykge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIHRoaXMuZ2V0UmVwb3J0TGlzdCh0aGlzLmFwcElkLCByZXBvcnRJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSByZXBvcnQgbGlzdFxuICAgICAqL1xuICAgIGdldFJlcG9ydExpc3QoYXBwSWQ6IG51bWJlciwgcmVwb3J0SWQ/OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldFJlcG9ydExpc3QoYXBwSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdFJlcG9ydHMoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgocmVwb3J0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydE9ic2VydmVyLm5leHQocmVwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXBvcnRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSZXBvcnRCeVJlcG9ydElkKHJlcG9ydElkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RGaXJzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RGaXJzdFJlcG9ydCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KHJlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgZGVmYXVsdCByZXBvcnRzIGFuZCByZXR1cm4gdGhlIHJlcG9ydCBsaXN0XG4gICAgICovXG4gICAgY3JlYXRlRGVmYXVsdFJlcG9ydHMoKSB7XG4gICAgICAgIHRoaXMuYW5hbHl0aWNzU2VydmljZS5jcmVhdGVEZWZhdWx0UmVwb3J0cygpLnN1YnNjcmliZShcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuYWx5dGljc1NlcnZpY2UuZ2V0UmVwb3J0TGlzdCh0aGlzLmFwcElkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChyZXNwb25zZTogUmVwb3J0UGFyYW1ldGVyc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goKHJlcG9ydCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVwb3J0T2JzZXJ2ZXIubmV4dChyZXBvcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Y2Nlc3MuZW1pdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSByZXBvcnQgbGlzdCBpcyBlbXB0eVxuICAgICAqL1xuICAgIGlzUmVwb3J0c0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXBvcnRzID09PSB1bmRlZmluZWQgfHwgKHRoaXMucmVwb3J0cyAmJiB0aGlzLnJlcG9ydHMubGVuZ3RoID09PSAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgbGlzdFxuICAgICAqL1xuICAgIHByaXZhdGUgcmVzZXQoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1JlcG9ydHNFbXB0eSgpKSB7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydHMgPSBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCB0aGUgY3VycmVudCByZXBvcnRcbiAgICAgKiBAcGFyYW0gcmVwb3J0XG4gICAgICovXG4gICAgcHVibGljIHNlbGVjdFJlcG9ydChyZXBvcnQ6IGFueSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRSZXBvcnQgPSByZXBvcnQ7XG4gICAgICAgIHRoaXMucmVwb3J0Q2xpY2suZW1pdChyZXBvcnQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZWxlY3RSZXBvcnRCeVJlcG9ydElkKHJlcG9ydElkKSB7XG4gICAgICAgIGNvbnN0IHJlcG9ydEZvdW5kID0gdGhpcy5yZXBvcnRzLmZpbmQoKHJlcG9ydCkgPT4gcmVwb3J0LmlkID09PSByZXBvcnRJZCk7XG4gICAgICAgIGlmIChyZXBvcnRGb3VuZCkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVwb3J0ID0gcmVwb3J0Rm91bmQ7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydENsaWNrLmVtaXQocmVwb3J0Rm91bmQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZWN0Rmlyc3RSZXBvcnQoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0UmVwb3J0KHRoaXMucmVwb3J0c1swXSk7XG4gICAgICAgIHRoaXMuc2VsZWN0Rmlyc3QgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpc1NlbGVjdGVkKHJlcG9ydDogYW55KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRSZXBvcnQgPT09IHJlcG9ydCA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc0xpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxheW91dFR5cGUgPT09IEFuYWx5dGljc1JlcG9ydExpc3RDb21wb25lbnQuTEFZT1VUX0xJU1Q7XG4gICAgfVxuXG4gICAgaXNHcmlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXlvdXRUeXBlID09PSBBbmFseXRpY3NSZXBvcnRMaXN0Q29tcG9uZW50LkxBWU9VVF9HUklEO1xuICAgIH1cbn1cbiJdfQ==