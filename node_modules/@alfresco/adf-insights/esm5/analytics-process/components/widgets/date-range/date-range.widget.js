/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* tslint:disable:no-input-rename  */
import { MOMENT_DATE_FORMATS, MomentDateAdapter, UserPreferencesService, UserPreferenceValues } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { DateAdapter, MAT_DATE_FORMATS } from '@angular/material';
import moment from 'moment-es6';
var ɵ0 = MOMENT_DATE_FORMATS;
var DateRangeWidgetComponent = /** @class */ (function () {
    function DateRangeWidgetComponent(dateAdapter, userPreferencesService) {
        this.dateAdapter = dateAdapter;
        this.userPreferencesService = userPreferencesService;
        this.FORMAT_DATE_ACTIVITI = 'YYYY-MM-DD';
        this.SHOW_FORMAT = 'DD/MM/YYYY';
        this.dateRangeChanged = new EventEmitter();
        this.startDatePicker = moment();
        this.endDatePicker = moment();
    }
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.userPreferencesService.select(UserPreferenceValues.Locale).subscribe((/**
         * @param {?} locale
         * @return {?}
         */
        function (locale) {
            _this.dateAdapter.setLocale(locale);
        }));
        /** @type {?} */
        var momentDateAdapter = (/** @type {?} */ (this.dateAdapter));
        momentDateAdapter.overrideDisplayFormat = this.SHOW_FORMAT;
        if (this.field) {
            if (this.field.value && this.field.value.startDate) {
                this.startDatePicker = moment(this.field.value.startDate, this.FORMAT_DATE_ACTIVITI);
            }
            if (this.field.value && this.field.value.endDate) {
                this.endDatePicker = moment(this.field.value.endDate, this.FORMAT_DATE_ACTIVITI);
            }
        }
        /** @type {?} */
        var startDateControl = new FormControl(this.startDatePicker);
        startDateControl.setValidators(Validators.required);
        this.dateRange.addControl('startDate', startDateControl);
        /** @type {?} */
        var endDateControl = new FormControl(this.endDatePicker);
        endDateControl.setValidators(Validators.required);
        this.dateRange.addControl('endDate', endDateControl);
        this.dateRange.setValidators(this.dateCheck);
        this.dateRange.valueChanges.subscribe((/**
         * @return {?}
         */
        function () { return _this.onGroupValueChanged(); }));
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.onGroupValueChanged = /**
     * @return {?}
     */
    function () {
        if (this.dateRange.valid) {
            /** @type {?} */
            var dateStart = this.convertToMomentDateWithTime(this.dateRange.controls.startDate.value);
            /** @type {?} */
            var endStart = this.convertToMomentDateWithTime(this.dateRange.controls.endDate.value);
            this.dateRangeChanged.emit({ startDate: dateStart, endDate: endStart });
        }
    };
    /**
     * @param {?} date
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.convertToMomentDateWithTime = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        return moment(date, this.FORMAT_DATE_ACTIVITI, true).format(this.FORMAT_DATE_ACTIVITI) + 'T00:00:00.000Z';
    };
    /**
     * @param {?} formControl
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.dateCheck = /**
     * @param {?} formControl
     * @return {?}
     */
    function (formControl) {
        /** @type {?} */
        var startDate = moment(formControl.get('startDate').value);
        /** @type {?} */
        var endDate = moment(formControl.get('endDate').value);
        /** @type {?} */
        var isAfterCheck = startDate.isAfter(endDate);
        return isAfterCheck ? { 'greaterThan': true } : null;
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.isStartDateGreaterThanEndDate = /**
     * @return {?}
     */
    function () {
        return this.dateRange && this.dateRange.errors && this.dateRange.errors.greaterThan;
    };
    /**
     * @return {?}
     */
    DateRangeWidgetComponent.prototype.isStartDateEmpty = /**
     * @return {?}
     */
    function () {
        return this.dateRange && this.dateRange.controls.startDate && !this.dateRange.controls.startDate.valid;
    };
    DateRangeWidgetComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-date-range-widget',
                    template: "<label for=\"adf-dateRange\" >{{field.nameKey | translate}}</label><br>\n<div id=\"adf-dateRange\" [formGroup]=\"dateRange\">\n    <small *ngIf=\"isStartDateGreaterThanEndDate()\" class=\"adf-date-range-analytics-text-danger\">\n       {{'DATE-WIDGET.MESSAGES.START-LESS-THAN-END-DATE' | translate}}\n    </small>\n    <small *ngIf=\"isStartDateEmpty()\" class=\"adf-date-range-analytics-text-danger\">\n       {{'DATE-WIDGET.MESSAGES.START-DATE-REQUIRED' | translate}}\n    </small>\n\n            <mat-grid-list cols=\"2\" rowHeight=\"80px\">\n                <mat-grid-tile>\n                    <mat-form-field>\n                        <input\n                            matInput\n                            [min]=\"minDate\"\n                            [max]=\"maxDate\"\n                            formControlName=\"startDate\"\n                            [matDatepicker]=\"startDate\"\n                            [value]=\"startDatePicker\"\n                            (keydown)=\"true\"\n                            (dateChange)=\"onGroupValueChanged()\"\n                            placeholder=\"{{'DATE-WIDGET.START-DATE' | translate}}\"\n                            id=\"startDate_id\"\n                            required>\n                        <mat-datepicker-toggle matSuffix [for]=\"startDate\" ></mat-datepicker-toggle>\n                    </mat-form-field>\n                    <mat-datepicker\n                        #startDate\n                        [touchUi]=\"true\">\n                    </mat-datepicker>\n                </mat-grid-tile>\n                <mat-grid-tile>\n                    <mat-form-field>\n                        <input\n                            matInput\n                            [min]=\"minDate\"\n                            [max]=\"maxDate\"\n                            formControlName=\"endDate\"\n                            [matDatepicker]=\"endDate\"\n                            [value]=\"endDatePicker\"\n                            (keydown)=\"true\"\n                            (dateChange)=\"onGroupValueChanged()\"\n                            placeholder=\"{{'DATE-WIDGET.END-DATE' | translate}}\"\n                            id=\"endDate_id\"\n                            required>\n                        <mat-datepicker-toggle matSuffix [for]=\"endDate\" ></mat-datepicker-toggle>\n                    </mat-form-field>\n                    <mat-datepicker\n                        #endDate\n                        [touchUi]=\"true\">\n                    </mat-datepicker>\n                </mat-grid-tile>\n            </mat-grid-list>\n</div>\n",
                    providers: [
                        { provide: DateAdapter, useClass: MomentDateAdapter },
                        { provide: MAT_DATE_FORMATS, useValue: ɵ0 }
                    ],
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    DateRangeWidgetComponent.ctorParameters = function () { return [
        { type: DateAdapter },
        { type: UserPreferencesService }
    ]; };
    DateRangeWidgetComponent.propDecorators = {
        dateRange: [{ type: Input, args: ['group',] }],
        field: [{ type: Input }],
        dateRangeChanged: [{ type: Output }]
    };
    return DateRangeWidgetComponent;
}());
export { DateRangeWidgetComponent };
if (false) {
    /** @type {?} */
    DateRangeWidgetComponent.prototype.FORMAT_DATE_ACTIVITI;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.SHOW_FORMAT;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.dateRange;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.field;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.dateRangeChanged;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.minDate;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.maxDate;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.startDatePicker;
    /** @type {?} */
    DateRangeWidgetComponent.prototype.endDatePicker;
    /**
     * @type {?}
     * @private
     */
    DateRangeWidgetComponent.prototype.dateAdapter;
    /**
     * @type {?}
     * @private
     */
    DateRangeWidgetComponent.prototype.userPreferencesService;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS53aWRnZXQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiYW5hbHl0aWNzLXByb2Nlc3MvY29tcG9uZW50cy93aWRnZXRzL2RhdGUtcmFuZ2UvZGF0ZS1yYW5nZS53aWRnZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxzQkFBc0IsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFILE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFtQixXQUFXLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRSxPQUFPLE1BQU0sTUFBTSxZQUFZLENBQUM7U0FRYyxtQkFBbUI7QUFMakU7SUE0Qkksa0NBQ1ksV0FBZ0MsRUFDaEMsc0JBQThDO1FBRDlDLGdCQUFXLEdBQVgsV0FBVyxDQUFxQjtRQUNoQywyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBbkJuRCx5QkFBb0IsR0FBVyxZQUFZLENBQUM7UUFDNUMsZ0JBQVcsR0FBVyxZQUFZLENBQUM7UUFTMUMscUJBQWdCLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFJOUQsb0JBQWUsR0FBVyxNQUFNLEVBQUUsQ0FBQztRQUNuQyxrQkFBYSxHQUFXLE1BQU0sRUFBRSxDQUFDO0lBS2pDLENBQUM7Ozs7SUFFRCwyQ0FBUTs7O0lBQVI7UUFBQSxpQkE0QkM7UUEzQkcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMs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Q25DLGlEQUFpQzs7Ozs7SUFHN0IsK0NBQXdDOzs7OztJQUN4QywwREFBc0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKiB0c2xpbnQ6ZGlzYWJsZTpuby1pbnB1dC1yZW5hbWUgICovXG5cbmltcG9ydCB7IE1PTUVOVF9EQVRFX0ZPUk1BVFMsIE1vbWVudERhdGVBZGFwdGVyLCBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlLCBVc2VyUHJlZmVyZW5jZVZhbHVlcyB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRGF0ZUFkYXB0ZXIsIE1BVF9EQVRFX0ZPUk1BVFMgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC1lczYnO1xuaW1wb3J0IHsgTW9tZW50IH0gZnJvbSAnbW9tZW50JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtZGF0ZS1yYW5nZS13aWRnZXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXJhbmdlLndpZGdldC5odG1sJyxcbiAgICBwcm92aWRlcnM6IFtcbiAgICAgICAge3Byb3ZpZGU6IERhdGVBZGFwdGVyLCB1c2VDbGFzczogTW9tZW50RGF0ZUFkYXB0ZXJ9LFxuICAgICAgICB7cHJvdmlkZTogTUFUX0RBVEVfRk9STUFUUywgdXNlVmFsdWU6IE1PTUVOVF9EQVRFX0ZPUk1BVFN9XSxcbiAgICBzdHlsZVVybHM6IFsnLi9kYXRlLXJhbmdlLndpZGdldC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VXaWRnZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgcHVibGljIEZPUk1BVF9EQVRFX0FDVElWSVRJOiBzdHJpbmcgPSAnWVlZWS1NTS1ERCc7XG4gICAgcHVibGljIFNIT1dfRk9STUFUOiBzdHJpbmcgPSAnREQvTU0vWVlZWSc7XG5cbiAgICBASW5wdXQoJ2dyb3VwJylcbiAgICBwdWJsaWMgZGF0ZVJhbmdlOiBGb3JtR3JvdXA7XG5cbiAgICBASW5wdXQoKVxuICAgIGZpZWxkOiBhbnk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBkYXRlUmFuZ2VDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgbWluRGF0ZTogTW9tZW50O1xuICAgIG1heERhdGU6IE1vbWVudDtcbiAgICBzdGFydERhdGVQaWNrZXI6IE1vbWVudCA9IG1vbWVudCgpO1xuICAgIGVuZERhdGVQaWNrZXI6IE1vbWVudCA9IG1vbWVudCgpO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyPE1vbWVudD4sXG4gICAgICAgIHByaXZhdGUgdXNlclByZWZlcmVuY2VzU2VydmljZTogVXNlclByZWZlcmVuY2VzU2VydmljZSkge1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnVzZXJQcmVmZXJlbmNlc1NlcnZpY2Uuc2VsZWN0KFVzZXJQcmVmZXJlbmNlVmFsdWVzLkxvY2FsZSkuc3Vic2NyaWJlKChsb2NhbGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0ZUFkYXB0ZXIuc2V0TG9jYWxlKGxvY2FsZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG1vbWVudERhdGVBZGFwdGVyID0gPE1vbWVudERhdGVBZGFwdGVyPiB0aGlzLmRhdGVBZGFwdGVyO1xuICAgICAgICBtb21lbnREYXRlQWRhcHRlci5vdmVycmlkZURpc3BsYXlGb3JtYXQgPSB0aGlzLlNIT1dfRk9STUFUO1xuXG4gICAgICAgIGlmICh0aGlzLmZpZWxkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5maWVsZC52YWx1ZSAmJiB0aGlzLmZpZWxkLnZhbHVlLnN0YXJ0RGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnREYXRlUGlja2VyID0gbW9tZW50KHRoaXMuZmllbGQudmFsdWUuc3RhcnREYXRlLCB0aGlzLkZPUk1BVF9EQVRFX0FDVElWSVRJKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuZmllbGQudmFsdWUgJiYgdGhpcy5maWVsZC52YWx1ZS5lbmREYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmREYXRlUGlja2VyID0gbW9tZW50KHRoaXMuZmllbGQudmFsdWUuZW5kRGF0ZSwgdGhpcy5GT1JNQVRfREFURV9BQ1RJVklUSSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdGFydERhdGVDb250cm9sID0gbmV3IEZvcm1Db250cm9sKHRoaXMuc3RhcnREYXRlUGlja2VyKTtcbiAgICAgICAgc3RhcnREYXRlQ29udHJvbC5zZXRWYWxpZGF0b3JzKFZhbGlkYXRvcnMucmVxdWlyZWQpO1xuICAgICAgICB0aGlzLmRhdGVSYW5nZS5hZGRDb250cm9sKCdzdGFydERhdGUnLCBzdGFydERhdGVDb250cm9sKTtcblxuICAgICAgICBjb25zdCBlbmREYXRlQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbCh0aGlzLmVuZERhdGVQaWNrZXIpO1xuICAgICAgICBlbmREYXRlQ29udHJvbC5zZXRWYWxpZGF0b3JzKFZhbGlkYXRvcnMucmVxdWlyZWQpO1xuICAgICAgICB0aGlzLmRhdGVSYW5nZS5hZGRDb250cm9sKCdlbmREYXRlJywgZW5kRGF0ZUNvbnRyb2wpO1xuXG4gICAgICAgIHRoaXMuZGF0ZVJhbmdlLnNldFZhbGlkYXRvcnModGhpcy5kYXRlQ2hlY2spO1xuICAgICAgICB0aGlzLmRhdGVSYW5nZS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHRoaXMub25Hcm91cFZhbHVlQ2hhbmdlZCgpKTtcbiAgICB9XG5cbiAgICBvbkdyb3VwVmFsdWVDaGFuZ2VkKCkge1xuICAgICAgICBpZiAodGhpcy5kYXRlUmFuZ2UudmFsaWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGVTdGFydCA9IHRoaXMuY29udmVydFRvTW9tZW50RGF0ZVdpdGhUaW1lKHRoaXMuZGF0ZVJhbmdlLmNvbnRyb2xzLnN0YXJ0RGF0ZS52YWx1ZSk7XG4gICAgICAgICAgICBjb25zdCBlbmRTdGFydCA9IHRoaXMuY29udmVydFRvTW9tZW50RGF0ZVdpdGhUaW1lKHRoaXMuZGF0ZVJhbmdlLmNvbnRyb2xzLmVuZERhdGUudmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5kYXRlUmFuZ2VDaGFuZ2VkLmVtaXQoe3N0YXJ0RGF0ZTogZGF0ZVN0YXJ0LCBlbmREYXRlOiBlbmRTdGFydH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29udmVydFRvTW9tZW50RGF0ZVdpdGhUaW1lKGRhdGU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUsIHRoaXMuRk9STUFUX0RBVEVfQUNUSVZJVEksIHRydWUpLmZvcm1hdCh0aGlzLkZPUk1BVF9EQVRFX0FDVElWSVRJKSArICdUMDA6MDA6MDAuMDAwWic7XG4gICAgfVxuXG4gICAgZGF0ZUNoZWNrKGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2wpIHtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gbW9tZW50KGZvcm1Db250cm9sLmdldCgnc3RhcnREYXRlJykudmFsdWUpO1xuICAgICAgICBjb25zdCBlbmREYXRlID0gbW9tZW50KGZvcm1Db250cm9sLmdldCgnZW5kRGF0ZScpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgaXNBZnRlckNoZWNrID0gc3RhcnREYXRlLmlzQWZ0ZXIoZW5kRGF0ZSk7XG4gICAgICAgIHJldHVybiBpc0FmdGVyQ2hlY2sgPyB7J2dyZWF0ZXJUaGFuJzogdHJ1ZX0gOiBudWxsO1xuICAgIH1cblxuICAgIGlzU3RhcnREYXRlR3JlYXRlclRoYW5FbmREYXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRlUmFuZ2UgJiYgdGhpcy5kYXRlUmFuZ2UuZXJyb3JzICYmIHRoaXMuZGF0ZVJhbmdlLmVycm9ycy5ncmVhdGVyVGhhbjtcbiAgICB9XG5cbiAgICBpc1N0YXJ0RGF0ZUVtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRlUmFuZ2UgJiYgdGhpcy5kYXRlUmFuZ2UuY29udHJvbHMuc3RhcnREYXRlICYmICF0aGlzLmRhdGVSYW5nZS5jb250cm9scy5zdGFydERhdGUudmFsaWQ7XG4gICAgfVxufVxuIl19