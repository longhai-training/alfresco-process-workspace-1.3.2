/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Anchor } from './anchor';
/* tslint:disable */
var /* tslint:disable */
Polyline = /** @class */ (function () {
    function Polyline(uuid, points, strokeWidth, paper) {
        this.id = null;
        this.points = [];
        this.path = [];
        this.anchors = [];
        this.strokeWidth = 1;
        this.radius = 1;
        this.showDetails = false;
        this.paper = null;
        this.element = null;
        this.isDefaultConditionAvailable = false;
        this.closePath = false;
        /* Array on coordinates:
         * points: [{x: 410, y: 110}, 1
         *			{x: 570, y: 110}, 1 2
         *			{x: 620, y: 240},   2 3
         *			{x: 750, y: 270},     3 4
         *			{x: 650, y: 370}];      4
         */
        this.points = points;
        /*
         * path for graph
         * [['M', x1, y1], ['L', x2, y2], ['C', ax, ay, bx, by, x3, y3], ['L', x3, y3]]
         */
        this.path = [];
        this.anchors = [];
        if (strokeWidth) {
            this.strokeWidth = strokeWidth;
        }
        this.paper = paper;
        this.closePath = false;
        this.init();
    }
    /**
     * @return {?}
     */
    Polyline.prototype.init = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var linesCount = this.getLinesCount();
        if (linesCount < 1) {
            return;
        }
        this.normalizeCoordinates();
        // create anchors
        this.pushAnchor(Anchor.ANCHOR_TYPE.first, this.getLine(0).x1, this.getLine(0).y1);
        for (var i = 1; i < linesCount; i++) {
            /** @type {?} */
            var line1 = this.getLine(i - 1);
            this.pushAnchor(Anchor.ANCHOR_TYPE.main, line1.x2, line1.y2);
        }
        this.pushAnchor(Anchor.ANCHOR_TYPE.last, this.getLine(linesCount - 1).x2, this.getLine(linesCount - 1).y2);
        this.rebuildPath();
    };
    /**
     * @return {?}
     */
    Polyline.prototype.normalizeCoordinates = /**
     * @return {?}
     */
    function () {
        for (var i = 0; i < this.points.length; i++) {
            this.points[i].x = parseFloat(this.points[i].x);
            this.points[i].y = parseFloat(this.points[i].y);
        }
    };
    /**
     * @return {?}
     */
    Polyline.prototype.getLinesCount = /**
     * @return {?}
     */
    function () {
        return this.points.length - 1;
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype._getLine = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        if (this.points.length > i && this.points[i]) {
            return { x1: this.points[i].x, y1: this.points[i].y, x2: this.points[i + 1].x, y2: this.points[i + 1].y };
        }
        else {
            return undefined;
        }
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype.getLine = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        /** @type {?} */
        var line = this._getLine(i);
        if (line !== undefined) {
            line.angle = this.getLineAngle(i);
        }
        return line;
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype.getLineAngle = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        /** @type {?} */
        var line = this._getLine(i);
        return Math.atan2(line.y2 - line.y1, line.x2 - line.x1);
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype.getLineLengthX = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        /** @type {?} */
        var line = this.getLine(i);
        return (line.x2 - line.x1);
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype.getLineLengthY = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        /** @type {?} */
        var line = this.getLine(i);
        return (line.y2 - line.y1);
    };
    /**
     * @param {?} i
     * @return {?}
     */
    Polyline.prototype.getLineLength = /**
     * @param {?} i
     * @return {?}
     */
    function (i) {
        return Math.sqrt(Math.pow(this.getLineLengthX(i), 2) + Math.pow(this.getLineLengthY(i), 2));
    };
    /**
     * @return {?}
     */
    Polyline.prototype.getAnchors = /**
     * @return {?}
     */
    function () {
        return this.anchors;
    };
    /**
     * @param {?=} type
     * @return {?}
     */
    Polyline.prototype.getAnchorsCount = /**
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        if (type === void 0) { type = null; }
        if (!type) {
            return this.anchors.length;
        }
        else {
            /** @type {?} */
            var count = 0;
            for (var i = 0; i < this.getAnchorsCount(null); i++) {
                /** @type {?} */
                var anchor = this.anchors[i];
                if (anchor.getType() === type) {
                    count++;
                }
            }
            return count;
        }
    };
    /**
     * @param {?} type
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    Polyline.prototype.pushAnchor = /**
     * @param {?} type
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (type, x, y) {
        /** @type {?} */
        var index;
        if (type === Anchor.ANCHOR_TYPE.first) {
            index = 0;
        }
        else if (type === Anchor.ANCHOR_TYPE.last) {
            index = this.getAnchorsCount();
        }
        else if (!index) {
            index = this.anchors.length;
        }
        else {
            for (var i = 0; i < this.getAnchorsCount(); i++) {
                /** @type {?} */
                var anchor = this.anchors[i];
                if (anchor.index > index) {
                    anchor.index++;
                    anchor.typeIndex++;
                }
            }
        }
        /** @type {?} */
        var anchor = new Anchor(this.id, Anchor.ANCHOR_TYPE.main, x, y);
        this.anchors.push(anchor);
    };
    /**
     * @param {?} position
     * @return {?}
     */
    Polyline.prototype.getAnchor = /**
     * @param {?} position
     * @return {?}
     */
    function (position) {
        return this.anchors[position];
    };
    /**
     * @param {?} type
     * @param {?} position
     * @return {?}
     */
    Polyline.prototype.getAnchorByType = /**
     * @param {?} type
     * @param {?} position
     * @return {?}
     */
    function (type, position) {
        if (type === Anchor.ANCHOR_TYPE.first) {
            return this.anchors[0];
        }
        if (type === Anchor.ANCHOR_TYPE.last) {
            return this.anchors[this.getAnchorsCount() - 1];
        }
        for (var i = 0; i < this.getAnchorsCount(); i++) {
            /** @type {?} */
            var anchor = this.anchors[i];
            if (anchor.type === type) {
                if (position === anchor.position) {
                    return anchor;
                }
            }
        }
        return null;
    };
    /**
     * @param {?} position
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    Polyline.prototype.addNewPoint = /**
     * @param {?} position
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (position, x, y) {
        //
        for (var i = 0; i < this.getLinesCount(); i++) {
            /** @type {?} */
            var line = this.getLine(i);
            if (x > line.x1 && x < line.x2 && y > line.y1 && y < line.y2) {
                this.points.splice(i + 1, 0, { x: x, y: y });
                break;
            }
        }
        this.rebuildPath();
    };
    /**
     * @return {?}
     */
    Polyline.prototype.rebuildPath = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var path = [];
        for (var i = 0; i < this.getAnchorsCount(); i++) {
            /** @type {?} */
            var anchor = this.getAnchor(i);
            /** @type {?} */
            var pathType = '';
            if (i === 0) {
                pathType = 'M';
            }
            else {
                pathType = 'L';
            }
            // TODO: save previous points and calculate new path just if points are updated, and then save currents values as previous
            /** @type {?} */
            var targetX = anchor.x;
            /** @type {?} */
            var targetY = anchor.y;
            if (i > 0 && i < this.getAnchorsCount() - 1) {
                // get new x,y
                /** @type {?} */
                var cx = anchor.x;
                /** @type {?} */
                var cy = anchor.y;
                // pivot point of prev line
                /** @type {?} */
                var AO = this.getLineLength(i - 1);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                this.isDefaultConditionAvailable = (this.isDefaultConditionAvailable || (i === 1 && AO > 10));
                /** @type {?} */
                var ED = this.getLineLengthY(i - 1) * this.radius / AO;
                /** @type {?} */
                var OD = this.getLineLengthX(i - 1) * this.radius / AO;
                targetX = anchor.x - OD;
                targetY = anchor.y - ED;
                if (AO < 2 * this.radius && i > 1) {
                    targetX = anchor.x - this.getLineLengthX(i - 1) / 2;
                    targetY = anchor.y - this.getLineLengthY(i - 1) / 2;
                }
                // pivot point of next line
                /** @type {?} */
                var AO = this.getLineLength(i);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                /** @type {?} */
                var ED = this.getLineLengthY(i) * this.radius / AO;
                /** @type {?} */
                var OD = this.getLineLengthX(i) * this.radius / AO;
                /** @type {?} */
                var nextSrcX = anchor.x + OD;
                /** @type {?} */
                var nextSrcY = anchor.y + ED;
                if (AO < 2 * this.radius && i < this.getAnchorsCount() - 2) {
                    nextSrcX = anchor.x + this.getLineLengthX(i) / 2;
                    nextSrcY = anchor.y + this.getLineLengthY(i) / 2;
                    ;
                }
                /** @type {?} */
                var dx0 = (cx - targetX) / 3;
                /** @type {?} */
                var dy0 = (cy - targetY) / 3;
                /** @type {?} */
                var ax = cx - dx0;
                /** @type {?} */
                var ay = cy - dy0;
                /** @type {?} */
                var dx1 = (cx - nextSrcX) / 3;
                /** @type {?} */
                var dy1 = (cy - nextSrcY) / 3;
                /** @type {?} */
                var bx = cx - dx1;
                /** @type {?} */
                var by = cy - dy1;
                /** @type {?} */
                var zx = nextSrcX;
                /** @type {?} */
                var zy = nextSrcY;
            }
            else if (i === 1 && this.getAnchorsCount() === 2) {
                /** @type {?} */
                var AO = this.getLineLength(i - 1);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                this.isDefaultConditionAvailable = (this.isDefaultConditionAvailable || (i === 1 && AO > 10));
            }
            // anti smoothing
            if (this.strokeWidth % 2 === 1) {
                targetX += 0.5;
                targetY += 0.5;
            }
            path.push([pathType, targetX, targetY]);
            if (i > 0 && i < this.getAnchorsCount() - 1) {
                path.push(['C', ax, ay, bx, by, zx, zy]);
            }
        }
        if (this.closePath) {
            path.push(['Z']);
        }
        this.path = path;
    };
    /**
     * @param {?} transformation
     * @return {?}
     */
    Polyline.prototype.transform = /**
     * @param {?} transformation
     * @return {?}
     */
    function (transformation) {
        this.element.transform(transformation);
    };
    /**
     * @param {?} attrs
     * @return {?}
     */
    Polyline.prototype.function = /**
     * @param {?} attrs
     * @return {?}
     */
    function (attrs) {
        this.element.attr(attrs);
    };
    return Polyline;
}());
/* tslint:disable */
export { Polyline };
if (false) {
    /** @type {?} */
    Polyline.prototype.id;
    /** @type {?} */
    Polyline.prototype.points;
    /** @type {?} */
    Polyline.prototype.path;
    /** @type {?} */
    Polyline.prototype.anchors;
    /** @type {?} */
    Polyline.prototype.strokeWidth;
    /** @type {?} */
    Polyline.prototype.radius;
    /** @type {?} */
    Polyline.prototype.showDetails;
    /** @type {?} */
    Polyline.prototype.paper;
    /** @type {?} */
    Polyline.prototype.element;
    /** @type {?} */
    Polyline.prototype.isDefaultConditionAvailable;
    /** @type {?} */
    Polyline.prototype.closePath;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWxpbmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiZGlhZ3JhbS9jb21wb25lbnRzL3JhcGhhZWwvcG9seWxpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQzs7QUFHbEM7O0lBY0ksa0JBQVksSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsS0FBSztRQVo1QyxPQUFFLEdBQVEsSUFBSSxDQUFDO1FBQ2YsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUNqQixTQUFJLEdBQVEsRUFBRSxDQUFDO1FBQ2YsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixnQkFBVyxHQUFRLENBQUMsQ0FBQztRQUNyQixXQUFNLEdBQVEsQ0FBQyxDQUFDO1FBQ2hCLGdCQUFXLEdBQVEsS0FBSyxDQUFDO1FBQ3pCLFVBQUssR0FBUSxJQUFJLENBQUM7UUFDbEIsWUFBTyxHQUFRLElBQUksQ0FBQztRQUNwQixnQ0FBMkIsR0FBUSxLQUFLLENBQUM7UUFDekMsY0FBUyxHQUFRLEtBQUssQ0FBQztRQUduQjs7Ozs7O1dBTUc7UUFDSCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQjs7O1dBR0c7UUFDSCxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUVmLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBRWxCLElBQUksV0FBVyxFQUFFO1lBQ2IsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7U0FDbEM7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUVuQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUV2QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7OztJQUVELHVCQUFJOzs7SUFBSjs7WUFDUSxVQUFVLEdB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Uzs7OztJQUFULFVBQVUsY0FBYztRQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUMzQyxDQUFDOzs7OztJQUVELDJCQUFROzs7O0lBQVIsVUFBUyxLQUFLO1FBQ1YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVMLGVBQUM7QUFBRCxDQUFDLEFBalNELElBaVNDOzs7OztJQS9SRyxzQkFBZTs7SUFDZiwwQkFBaUI7O0lBQ2pCLHdCQUFlOztJQUNmLDJCQUFrQjs7SUFDbEIsK0JBQXFCOztJQUNyQiwwQkFBZ0I7O0lBQ2hCLCtCQUF5Qjs7SUFDekIseUJBQWtCOztJQUNsQiwyQkFBb0I7O0lBQ3BCLCtDQUF5Qzs7SUFDekMsNkJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQW5jaG9yIH0gZnJvbSAnLi9hbmNob3InO1xuXG4vKiB0c2xpbnQ6ZGlzYWJsZSAqL1xuZXhwb3J0IGNsYXNzIFBvbHlsaW5lIHtcblxuICAgIGlkOiBhbnkgPSBudWxsO1xuICAgIHBvaW50czogYW55ID0gW107XG4gICAgcGF0aDogYW55ID0gW107XG4gICAgYW5jaG9yczogYW55ID0gW107XG4gICAgc3Ryb2tlV2lkdGg6IGFueSA9IDE7XG4gICAgcmFkaXVzOiBhbnkgPSAxO1xuICAgIHNob3dEZXRhaWxzOiBhbnkgPSBmYWxzZTtcbiAgICBwYXBlcjogYW55ID0gbnVsbDtcbiAgICBlbGVtZW50OiBhbnkgPSBudWxsO1xuICAgIGlzRGVmYXVsdENvbmRpdGlvbkF2YWlsYWJsZTogYW55ID0gZmFsc2U7XG4gICAgY2xvc2VQYXRoOiBhbnkgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHV1aWQsIHBvaW50cywgc3Ryb2tlV2lkdGgsIHBhcGVyKSB7XG4gICAgICAgIC8qIEFycmF5IG9uIGNvb3JkaW5hdGVzOlxuICAgICAgICAgKiBwb2ludHM6IFt7eDogNDEwLCB5OiAxMTB9LCAxXG4gICAgICAgICAqXHRcdFx0e3g6IDU3MCwgeTogMTEwfSwgMSAyXG4gICAgICAgICAqXHRcdFx0e3g6IDYyMCwgeTogMjQwfSwgICAyIDNcbiAgICAgICAgICpcdFx0XHR7eDogNzUwLCB5OiAyNzB9LCAgICAgMyA0XG4gICAgICAgICAqXHRcdFx0e3g6IDY1MCwgeTogMzcwfV07ICAgICAgNFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb2ludHMgPSBwb2ludHM7XG4gICAgICAgIC8qXG4gICAgICAgICAqIHBhdGggZm9yIGdyYXBoXG4gICAgICAgICAqIFtbJ00nLCB4MSwgeTFdLCBbJ0wnLCB4MiwgeTJdLCBbJ0MnLCBheCwgYXksIGJ4LCBieSwgeDMsIHkzXSwgWydMJywgeDMsIHkzXV1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGF0aCA9IFtdO1xuXG4gICAgICAgIHRoaXMuYW5jaG9ycyA9IFtdO1xuXG4gICAgICAgIGlmIChzdHJva2VXaWR0aCkge1xuICAgICAgICAgICAgdGhpcy5zdHJva2VXaWR0aCA9IHN0cm9rZVdpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wYXBlciA9IHBhcGVyO1xuXG4gICAgICAgIHRoaXMuY2xvc2VQYXRoID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgaW5pdCgpIHtcbiAgICAgICAgdmFyIGxpbmVzQ291bnQgPSB0aGlzLmdldExpbmVzQ291bnQoKTtcbiAgICAgICAgaWYgKGxpbmVzQ291bnQgPCAxKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5vcm1hbGl6ZUNvb3JkaW5hdGVzKCk7XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuY2hvcnNcblxuICAgICAgICB0aGlzLnB1c2hBbmNob3IoQW5jaG9yLkFOQ0hPUl9UWVBFLmZpcnN0LCB0aGlzLmdldExpbmUoMCkueDEsIHRoaXMuZ2V0TGluZSgwKS55MSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBsaW5lc0NvdW50OyBpKyspIHtcbiAgICAgICAgICAgIHZhciBsaW5lMSA9IHRoaXMuZ2V0TGluZShpIC0gMSk7XG4gICAgICAgICAgICB0aGlzLnB1c2hBbmNob3IoQW5jaG9yLkFOQ0hPUl9UWVBFLm1haW4sIGxpbmUxLngyLCBsaW5lMS55Mik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnB1c2hBbmNob3IoQW5jaG9yLkFOQ0hPUl9UWVBFLmxhc3QsIHRoaXMuZ2V0TGluZShsaW5lc0NvdW50IC0gMSkueDIsIHRoaXMuZ2V0TGluZShsaW5lc0NvdW50IC0gMSkueTIpO1xuXG4gICAgICAgIHRoaXMucmVidWlsZFBhdGgoKTtcbiAgICB9XG5cbiAgICBub3JtYWxpemVDb29yZGluYXRlcygpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5wb2ludHNbaV0ueCA9IHBhcnNlRmxvYXQodGhpcy5wb2ludHNbaV0ueCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50c1tpXS55ID0gcGFyc2VGbG9hdCh0aGlzLnBvaW50c1tpXS55KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldExpbmVzQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvaW50cy5sZW5ndGggLSAxO1xuICAgIH1cblxuICAgIF9nZXRMaW5lKGkpIHtcbiAgICAgICAgaWYgKHRoaXMucG9pbnRzLmxlbmd0aCA+IGkgJiYgdGhpcy5wb2ludHNbaV0pIHtcbiAgICAgICAgICAgIHJldHVybiB7eDE6IHRoaXMucG9pbnRzW2ldLngsIHkxOiB0aGlzLnBvaW50c1tpXS55LCB4MjogdGhpcy5wb2ludHNbaSArIDFdLngsIHkyOiB0aGlzLnBvaW50c1tpICsgMV0ueX07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0TGluZShpKSB7XG4gICAgICAgIHZhciBsaW5lOiBhbnkgPSB0aGlzLl9nZXRMaW5lKGkpO1xuICAgICAgICBpZiAobGluZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBsaW5lLmFuZ2xlID0gdGhpcy5nZXRMaW5lQW5nbGUoaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfVxuXG4gICAgZ2V0TGluZUFuZ2xlKGkpIHtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLl9nZXRMaW5lKGkpO1xuICAgICAgICByZXR1cm4gTWF0aC5hdGFuMihsaW5lLnkyIC0gbGluZS55MSwgbGluZS54MiAtIGxpbmUueDEpO1xuICAgIH1cblxuICAgIGdldExpbmVMZW5ndGhYKGkpIHtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmdldExpbmUoaSk7XG4gICAgICAgIHJldHVybiAobGluZS54MiAtIGxpbmUueDEpO1xuICAgIH1cblxuICAgIGdldExpbmVMZW5ndGhZKGkpIHtcbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmdldExpbmUoaSk7XG4gICAgICAgIHJldHVybiAobGluZS55MiAtIGxpbmUueTEpO1xuICAgIH1cblxuICAgIGdldExpbmVMZW5ndGgoaSkge1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHRoaXMuZ2V0TGluZUxlbmd0aFgoaSksIDIpICsgTWF0aC5wb3codGhpcy5nZXRMaW5lTGVuZ3RoWShpKSwgMikpO1xuICAgIH1cblxuICAgIGdldEFuY2hvcnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFuY2hvcnM7XG4gICAgfVxuXG4gICAgZ2V0QW5jaG9yc0NvdW50KHR5cGU6IGFueSA9IG51bGwpIHtcbiAgICAgICAgaWYgKCF0eXBlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmNob3JzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0QW5jaG9yc0NvdW50KG51bGwpOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9yID0gdGhpcy5hbmNob3JzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChhbmNob3IuZ2V0VHlwZSgpID09PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVzaEFuY2hvcih0eXBlLCB4LCB5KSB7XG4gICAgICAgIHZhciBpbmRleDtcbiAgICAgICAgaWYgKHR5cGUgPT09IEFuY2hvci5BTkNIT1JfVFlQRS5maXJzdCkge1xuICAgICAgICAgICAgaW5kZXggPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEFuY2hvci5BTkNIT1JfVFlQRS5sYXN0KSB7XG4gICAgICAgICAgICBpbmRleCA9IHRoaXMuZ2V0QW5jaG9yc0NvdW50KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWluZGV4KSB7XG4gICAgICAgICAgICBpbmRleCA9IHRoaXMuYW5jaG9ycy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0QW5jaG9yc0NvdW50KCk7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBhbmNob3IgPSB0aGlzLmFuY2hvcnNbaV07XG4gICAgICAgICAgICAgICAgaWYgKGFuY2hvci5pbmRleCA+IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGFuY2hvci5pbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICBhbmNob3IudHlwZUluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGFuY2hvcjogYW55ID0gbmV3IEFuY2hvcih0aGlzLmlkLCBBbmNob3IuQU5DSE9SX1RZUEUubWFpbiwgeCwgeSk7XG5cbiAgICAgICAgdGhpcy5hbmNob3JzLnB1c2goYW5jaG9yKTtcbiAgICB9XG5cbiAgICBnZXRBbmNob3IocG9zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9yc1twb3NpdGlvbl07XG4gICAgfVxuXG4gICAgZ2V0QW5jaG9yQnlUeXBlKHR5cGUsIHBvc2l0aW9uKSB7XG4gICAgICAgIGlmICh0eXBlID09PSBBbmNob3IuQU5DSE9SX1RZUEUuZmlyc3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuY2hvcnNbMF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUgPT09IEFuY2hvci5BTkNIT1JfVFlQRS5sYXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmNob3JzW3RoaXMuZ2V0QW5jaG9yc0NvdW50KCkgLSAxXTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0QW5jaG9yc0NvdW50KCk7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFuY2hvciA9IHRoaXMuYW5jaG9yc1tpXTtcbiAgICAgICAgICAgIGlmIChhbmNob3IudHlwZSA9PT0gdHlwZSkge1xuICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PT0gYW5jaG9yLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbmNob3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGFkZE5ld1BvaW50KHBvc2l0aW9uLCB4LCB5KSB7XG4gICAgICAgIC8vXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRMaW5lc0NvdW50KCk7IGkrKykge1xuICAgICAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmdldExpbmUoaSk7XG4gICAgICAgICAgICBpZiAoeCA+IGxpbmUueDEgJiYgeCA8IGxpbmUueDIgJiYgeSA+IGxpbmUueTEgJiYgeSA8IGxpbmUueTIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvaW50cy5zcGxpY2UoaSArIDEsIDAsIHt4OiB4LCB5OiB5fSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlYnVpbGRQYXRoKCk7XG4gICAgfVxuXG4gICAgcmVidWlsZFBhdGgoKSB7XG4gICAgICAgIHZhciBwYXRoID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhbmNob3IgPSB0aGlzLmdldEFuY2hvcihpKTtcblxuICAgICAgICAgICAgdmFyIHBhdGhUeXBlID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcGF0aFR5cGUgPSAnTSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhdGhUeXBlID0gJ0wnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVE9ETzogc2F2ZSBwcmV2aW91cyBwb2ludHMgYW5kIGNhbGN1bGF0ZSBuZXcgcGF0aCBqdXN0IGlmIHBvaW50cyBhcmUgdXBkYXRlZCwgYW5kIHRoZW4gc2F2ZSBjdXJyZW50cyB2YWx1ZXMgYXMgcHJldmlvdXNcblxuICAgICAgICAgICAgdmFyIHRhcmdldFggPSBhbmNob3IueCwgdGFyZ2V0WSA9IGFuY2hvci55O1xuICAgICAgICAgICAgaWYgKGkgPiAwICYmIGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpIC0gMSkge1xuICAgICAgICAgICAgICAgIC8vIGdldCBuZXcgeCx5XG4gICAgICAgICAgICAgICAgdmFyIGN4ID0gYW5jaG9yLngsIGN5ID0gYW5jaG9yLnk7XG5cbiAgICAgICAgICAgICAgICAvLyBwaXZvdCBwb2ludCBvZiBwcmV2IGxpbmVcbiAgICAgICAgICAgICAgICB2YXIgQU8gPSB0aGlzLmdldExpbmVMZW5ndGgoaSAtIDEpO1xuICAgICAgICAgICAgICAgIGlmIChBTyA8IHRoaXMucmFkaXVzKSB7XG4gICAgICAgICAgICAgICAgICAgIEFPID0gdGhpcy5yYWRpdXM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5pc0RlZmF1bHRDb25kaXRpb25BdmFpbGFibGUgPSAodGhpcy5pc0RlZmF1bHRDb25kaXRpb25BdmFpbGFibGUgfHwgKGkgPT09IDEgJiYgQU8gPiAxMCkpO1xuXG4gICAgICAgICAgICAgICAgdmFyIEVEID0gdGhpcy5nZXRMaW5lTGVuZ3RoWShpIC0gMSkgKiB0aGlzLnJhZGl1cyAvIEFPO1xuICAgICAgICAgICAgICAgIHZhciBPRCA9IHRoaXMuZ2V0TGluZUxlbmd0aFgoaSAtIDEpICogdGhpcy5yYWRpdXMgLyBBTztcbiAgICAgICAgICAgICAgICB0YXJnZXRYID0gYW5jaG9yLnggLSBPRDtcbiAgICAgICAgICAgICAgICB0YXJnZXRZID0gYW5jaG9yLnkgLSBFRDtcblxuICAgICAgICAgICAgICAgIGlmIChBTyA8IDIgKiB0aGlzLnJhZGl1cyAmJiBpID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRYID0gYW5jaG9yLnggLSB0aGlzLmdldExpbmVMZW5ndGhYKGkgLSAxKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFkgPSBhbmNob3IueSAtIHRoaXMuZ2V0TGluZUxlbmd0aFkoaSAtIDEpIC8gMjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBwaXZvdCBwb2ludCBvZiBuZXh0IGxpbmVcbiAgICAgICAgICAgICAgICB2YXIgQU8gPSB0aGlzLmdldExpbmVMZW5ndGgoaSk7XG4gICAgICAgICAgICAgICAgaWYgKEFPIDwgdGhpcy5yYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgQU8gPSB0aGlzLnJhZGl1cztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIEVEID0gdGhpcy5nZXRMaW5lTGVuZ3RoWShpKSAqIHRoaXMucmFkaXVzIC8gQU87XG4gICAgICAgICAgICAgICAgdmFyIE9EID0gdGhpcy5nZXRMaW5lTGVuZ3RoWChpKSAqIHRoaXMucmFkaXVzIC8gQU87XG4gICAgICAgICAgICAgICAgdmFyIG5leHRTcmNYID0gYW5jaG9yLnggKyBPRDtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFNyY1kgPSBhbmNob3IueSArIEVEO1xuXG4gICAgICAgICAgICAgICAgaWYgKEFPIDwgMiAqIHRoaXMucmFkaXVzICYmIGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpIC0gMikge1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3JjWCA9IGFuY2hvci54ICsgdGhpcy5nZXRMaW5lTGVuZ3RoWChpKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIG5leHRTcmNZID0gYW5jaG9yLnkgKyB0aGlzLmdldExpbmVMZW5ndGhZKGkpIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBkeDAgPSAoY3ggLSB0YXJnZXRYKSAvIDMsXG4gICAgICAgICAgICAgICAgICAgIGR5MCA9IChjeSAtIHRhcmdldFkpIC8gMyxcbiAgICAgICAgICAgICAgICAgICAgYXggPSBjeCAtIGR4MCxcbiAgICAgICAgICAgICAgICAgICAgYXkgPSBjeSAtIGR5MCxcblxuICAgICAgICAgICAgICAgICAgICBkeDEgPSAoY3ggLSBuZXh0U3JjWCkgLyAzLFxuICAgICAgICAgICAgICAgICAgICBkeTEgPSAoY3kgLSBuZXh0U3JjWSkgLyAzLFxuICAgICAgICAgICAgICAgICAgICBieCA9IGN4IC0gZHgxLFxuICAgICAgICAgICAgICAgICAgICBieSA9IGN5IC0gZHkxLFxuXG4gICAgICAgICAgICAgICAgICAgIHp4ID0gbmV4dFNyY1gsIHp5ID0gbmV4dFNyY1k7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMSAmJiB0aGlzLmdldEFuY2hvcnNDb3VudCgpID09PSAyKSB7XG4gICAgICAgICAgICAgICAgdmFyIEFPID0gdGhpcy5nZXRMaW5lTGVuZ3RoKGkgLSAxKTtcbiAgICAgICAgICAgICAgICBpZiAoQU8gPCB0aGlzLnJhZGl1cykge1xuICAgICAgICAgICAgICAgICAgICBBTyA9IHRoaXMucmFkaXVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmlzRGVmYXVsdENvbmRpdGlvbkF2YWlsYWJsZSA9ICh0aGlzLmlzRGVmYXVsdENvbmRpdGlvbkF2YWlsYWJsZSB8fCAoaSA9PT0gMSAmJiBBTyA+IDEwKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGFudGkgc21vb3RoaW5nXG4gICAgICAgICAgICBpZiAodGhpcy5zdHJva2VXaWR0aCAlIDIgPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRYICs9IDAuNTtcbiAgICAgICAgICAgICAgICB0YXJnZXRZICs9IDAuNTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGF0aC5wdXNoKFtwYXRoVHlwZSwgdGFyZ2V0WCwgdGFyZ2V0WV0pO1xuXG4gICAgICAgICAgICBpZiAoaSA+IDAgJiYgaSA8IHRoaXMuZ2V0QW5jaG9yc0NvdW50KCkgLSAxKSB7XG4gICAgICAgICAgICAgICAgcGF0aC5wdXNoKFsnQycsIGF4LCBheSwgYngsIGJ5LCB6eCwgenldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNsb3NlUGF0aCkge1xuICAgICAgICAgICAgcGF0aC5wdXNoKFsnWiddKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgfVxuXG4gICAgdHJhbnNmb3JtKHRyYW5zZm9ybWF0aW9uKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC50cmFuc2Zvcm0odHJhbnNmb3JtYXRpb24pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hdHRyKGF0dHJzKTtcbiAgICB9XG5cbn1cbiJdfQ==