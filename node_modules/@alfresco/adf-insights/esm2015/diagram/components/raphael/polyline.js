/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Anchor } from './anchor';
/* tslint:disable */
export class Polyline {
    /**
     * @param {?} uuid
     * @param {?} points
     * @param {?} strokeWidth
     * @param {?} paper
     */
    constructor(uuid, points, strokeWidth, paper) {
        this.id = null;
        this.points = [];
        this.path = [];
        this.anchors = [];
        this.strokeWidth = 1;
        this.radius = 1;
        this.showDetails = false;
        this.paper = null;
        this.element = null;
        this.isDefaultConditionAvailable = false;
        this.closePath = false;
        /* Array on coordinates:
         * points: [{x: 410, y: 110}, 1
         *			{x: 570, y: 110}, 1 2
         *			{x: 620, y: 240},   2 3
         *			{x: 750, y: 270},     3 4
         *			{x: 650, y: 370}];      4
         */
        this.points = points;
        /*
         * path for graph
         * [['M', x1, y1], ['L', x2, y2], ['C', ax, ay, bx, by, x3, y3], ['L', x3, y3]]
         */
        this.path = [];
        this.anchors = [];
        if (strokeWidth) {
            this.strokeWidth = strokeWidth;
        }
        this.paper = paper;
        this.closePath = false;
        this.init();
    }
    /**
     * @return {?}
     */
    init() {
        /** @type {?} */
        var linesCount = this.getLinesCount();
        if (linesCount < 1) {
            return;
        }
        this.normalizeCoordinates();
        // create anchors
        this.pushAnchor(Anchor.ANCHOR_TYPE.first, this.getLine(0).x1, this.getLine(0).y1);
        for (var i = 1; i < linesCount; i++) {
            /** @type {?} */
            var line1 = this.getLine(i - 1);
            this.pushAnchor(Anchor.ANCHOR_TYPE.main, line1.x2, line1.y2);
        }
        this.pushAnchor(Anchor.ANCHOR_TYPE.last, this.getLine(linesCount - 1).x2, this.getLine(linesCount - 1).y2);
        this.rebuildPath();
    }
    /**
     * @return {?}
     */
    normalizeCoordinates() {
        for (var i = 0; i < this.points.length; i++) {
            this.points[i].x = parseFloat(this.points[i].x);
            this.points[i].y = parseFloat(this.points[i].y);
        }
    }
    /**
     * @return {?}
     */
    getLinesCount() {
        return this.points.length - 1;
    }
    /**
     * @param {?} i
     * @return {?}
     */
    _getLine(i) {
        if (this.points.length > i && this.points[i]) {
            return { x1: this.points[i].x, y1: this.points[i].y, x2: this.points[i + 1].x, y2: this.points[i + 1].y };
        }
        else {
            return undefined;
        }
    }
    /**
     * @param {?} i
     * @return {?}
     */
    getLine(i) {
        /** @type {?} */
        var line = this._getLine(i);
        if (line !== undefined) {
            line.angle = this.getLineAngle(i);
        }
        return line;
    }
    /**
     * @param {?} i
     * @return {?}
     */
    getLineAngle(i) {
        /** @type {?} */
        var line = this._getLine(i);
        return Math.atan2(line.y2 - line.y1, line.x2 - line.x1);
    }
    /**
     * @param {?} i
     * @return {?}
     */
    getLineLengthX(i) {
        /** @type {?} */
        var line = this.getLine(i);
        return (line.x2 - line.x1);
    }
    /**
     * @param {?} i
     * @return {?}
     */
    getLineLengthY(i) {
        /** @type {?} */
        var line = this.getLine(i);
        return (line.y2 - line.y1);
    }
    /**
     * @param {?} i
     * @return {?}
     */
    getLineLength(i) {
        return Math.sqrt(Math.pow(this.getLineLengthX(i), 2) + Math.pow(this.getLineLengthY(i), 2));
    }
    /**
     * @return {?}
     */
    getAnchors() {
        return this.anchors;
    }
    /**
     * @param {?=} type
     * @return {?}
     */
    getAnchorsCount(type = null) {
        if (!type) {
            return this.anchors.length;
        }
        else {
            /** @type {?} */
            var count = 0;
            for (var i = 0; i < this.getAnchorsCount(null); i++) {
                /** @type {?} */
                var anchor = this.anchors[i];
                if (anchor.getType() === type) {
                    count++;
                }
            }
            return count;
        }
    }
    /**
     * @param {?} type
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    pushAnchor(type, x, y) {
        /** @type {?} */
        var index;
        if (type === Anchor.ANCHOR_TYPE.first) {
            index = 0;
        }
        else if (type === Anchor.ANCHOR_TYPE.last) {
            index = this.getAnchorsCount();
        }
        else if (!index) {
            index = this.anchors.length;
        }
        else {
            for (var i = 0; i < this.getAnchorsCount(); i++) {
                /** @type {?} */
                var anchor = this.anchors[i];
                if (anchor.index > index) {
                    anchor.index++;
                    anchor.typeIndex++;
                }
            }
        }
        /** @type {?} */
        var anchor = new Anchor(this.id, Anchor.ANCHOR_TYPE.main, x, y);
        this.anchors.push(anchor);
    }
    /**
     * @param {?} position
     * @return {?}
     */
    getAnchor(position) {
        return this.anchors[position];
    }
    /**
     * @param {?} type
     * @param {?} position
     * @return {?}
     */
    getAnchorByType(type, position) {
        if (type === Anchor.ANCHOR_TYPE.first) {
            return this.anchors[0];
        }
        if (type === Anchor.ANCHOR_TYPE.last) {
            return this.anchors[this.getAnchorsCount() - 1];
        }
        for (var i = 0; i < this.getAnchorsCount(); i++) {
            /** @type {?} */
            var anchor = this.anchors[i];
            if (anchor.type === type) {
                if (position === anchor.position) {
                    return anchor;
                }
            }
        }
        return null;
    }
    /**
     * @param {?} position
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    addNewPoint(position, x, y) {
        //
        for (var i = 0; i < this.getLinesCount(); i++) {
            /** @type {?} */
            var line = this.getLine(i);
            if (x > line.x1 && x < line.x2 && y > line.y1 && y < line.y2) {
                this.points.splice(i + 1, 0, { x: x, y: y });
                break;
            }
        }
        this.rebuildPath();
    }
    /**
     * @return {?}
     */
    rebuildPath() {
        /** @type {?} */
        var path = [];
        for (var i = 0; i < this.getAnchorsCount(); i++) {
            /** @type {?} */
            var anchor = this.getAnchor(i);
            /** @type {?} */
            var pathType = '';
            if (i === 0) {
                pathType = 'M';
            }
            else {
                pathType = 'L';
            }
            // TODO: save previous points and calculate new path just if points are updated, and then save currents values as previous
            /** @type {?} */
            var targetX = anchor.x;
            /** @type {?} */
            var targetY = anchor.y;
            if (i > 0 && i < this.getAnchorsCount() - 1) {
                // get new x,y
                /** @type {?} */
                var cx = anchor.x;
                /** @type {?} */
                var cy = anchor.y;
                // pivot point of prev line
                /** @type {?} */
                var AO = this.getLineLength(i - 1);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                this.isDefaultConditionAvailable = (this.isDefaultConditionAvailable || (i === 1 && AO > 10));
                /** @type {?} */
                var ED = this.getLineLengthY(i - 1) * this.radius / AO;
                /** @type {?} */
                var OD = this.getLineLengthX(i - 1) * this.radius / AO;
                targetX = anchor.x - OD;
                targetY = anchor.y - ED;
                if (AO < 2 * this.radius && i > 1) {
                    targetX = anchor.x - this.getLineLengthX(i - 1) / 2;
                    targetY = anchor.y - this.getLineLengthY(i - 1) / 2;
                }
                // pivot point of next line
                /** @type {?} */
                var AO = this.getLineLength(i);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                /** @type {?} */
                var ED = this.getLineLengthY(i) * this.radius / AO;
                /** @type {?} */
                var OD = this.getLineLengthX(i) * this.radius / AO;
                /** @type {?} */
                var nextSrcX = anchor.x + OD;
                /** @type {?} */
                var nextSrcY = anchor.y + ED;
                if (AO < 2 * this.radius && i < this.getAnchorsCount() - 2) {
                    nextSrcX = anchor.x + this.getLineLengthX(i) / 2;
                    nextSrcY = anchor.y + this.getLineLengthY(i) / 2;
                    ;
                }
                /** @type {?} */
                var dx0 = (cx - targetX) / 3;
                /** @type {?} */
                var dy0 = (cy - targetY) / 3;
                /** @type {?} */
                var ax = cx - dx0;
                /** @type {?} */
                var ay = cy - dy0;
                /** @type {?} */
                var dx1 = (cx - nextSrcX) / 3;
                /** @type {?} */
                var dy1 = (cy - nextSrcY) / 3;
                /** @type {?} */
                var bx = cx - dx1;
                /** @type {?} */
                var by = cy - dy1;
                /** @type {?} */
                var zx = nextSrcX;
                /** @type {?} */
                var zy = nextSrcY;
            }
            else if (i === 1 && this.getAnchorsCount() === 2) {
                /** @type {?} */
                var AO = this.getLineLength(i - 1);
                if (AO < this.radius) {
                    AO = this.radius;
                }
                this.isDefaultConditionAvailable = (this.isDefaultConditionAvailable || (i === 1 && AO > 10));
            }
            // anti smoothing
            if (this.strokeWidth % 2 === 1) {
                targetX += 0.5;
                targetY += 0.5;
            }
            path.push([pathType, targetX, targetY]);
            if (i > 0 && i < this.getAnchorsCount() - 1) {
                path.push(['C', ax, ay, bx, by, zx, zy]);
            }
        }
        if (this.closePath) {
            path.push(['Z']);
        }
        this.path = path;
    }
    /**
     * @param {?} transformation
     * @return {?}
     */
    transform(transformation) {
        this.element.transform(transformation);
    }
    /**
     * @param {?} attrs
     * @return {?}
     */
    function(attrs) {
        this.element.attr(attrs);
    }
}
if (false) {
    /** @type {?} */
    Polyline.prototype.id;
    /** @type {?} */
    Polyline.prototype.points;
    /** @type {?} */
    Polyline.prototype.path;
    /** @type {?} */
    Polyline.prototype.anchors;
    /** @type {?} */
    Polyline.prototype.strokeWidth;
    /** @type {?} */
    Polyline.prototype.radius;
    /** @type {?} */
    Polyline.prototype.showDetails;
    /** @type {?} */
    Polyline.prototype.paper;
    /** @type {?} */
    Polyline.prototype.element;
    /** @type {?} */
    Polyline.prototype.isDefaultConditionAvailable;
    /** @type {?} */
    Polyline.prototype.closePath;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWxpbmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiZGlhZ3JhbS9jb21wb25lbnRzL3JhcGhhZWwvcG9seWxpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQzs7QUFHbEMsTUFBTSxPQUFPLFFBQVE7Ozs7Ozs7SUFjakIsWUFBWSxJQUFJLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxLQUFLO1FBWjVDLE9BQUUsR0FBUSxJQUFJLENBQUM7UUFDZixXQUFNLEdBQVEsRUFBRSxDQUFDO1FBQ2pCLFNBQUksR0FBUSxFQUFFLENBQUM7UUFDZixZQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2xCLGdCQUFXLEdBQVEsQ0FBQyxDQUFDO1FBQ3JCLFdBQU0sR0FBUSxDQUFDLENBQUM7UUFDaEIsZ0JBQVcsR0FBUSxLQUFLLENBQUM7UUFDekIsVUFBSyxHQUFRLElBQUksQ0FBQztRQUNsQixZQUFPLEdBQVEsSUFBSSxDQUFDO1FBQ3BCLGdDQUEyQixHQUFRLEtBQUssQ0FBQztRQUN6QyxjQUFTLEdBQVEsS0FBSyxDQUFDO1FBR25COzs7Ozs7V0FNRztRQUNILElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCOzs7V0FHRztRQUNILElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWYsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFFbEIsSUFBSSxXQUFXLEVBQUU7WUFDYixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztTQUNsQztRQUVELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBRW5CLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBRXZCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoQixDQUFDOzs7O0lBRUQsSUFBSTs7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QUM7SUFDN0IsQ0FBQztDQUVKOzs7SUEvUkcsc0JBQWU7O0lBQ2YsMEJBQWlCOztJQUNqQix3QkFBZTs7SUFDZiwyQkFBa0I7O0lBQ2xCLCtCQUFxQjs7SUFDckIsMEJBQWdCOztJQUNoQiwrQkFBeUI7O0lBQ3pCLHlCQUFrQjs7SUFDbEIsMkJBQW9COztJQUNwQiwrQ0FBeUM7O0lBQ3pDLDZCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFuY2hvciB9IGZyb20gJy4vYW5jaG9yJztcblxuLyogdHNsaW50OmRpc2FibGUgKi9cbmV4cG9ydCBjbGFzcyBQb2x5bGluZSB7XG5cbiAgICBpZDogYW55ID0gbnVsbDtcbiAgICBwb2ludHM6IGFueSA9IFtdO1xuICAgIHBhdGg6IGFueSA9IFtdO1xuICAgIGFuY2hvcnM6IGFueSA9IFtdO1xuICAgIHN0cm9rZVdpZHRoOiBhbnkgPSAxO1xuICAgIHJhZGl1czogYW55ID0gMTtcbiAgICBzaG93RGV0YWlsczogYW55ID0gZmFsc2U7XG4gICAgcGFwZXI6IGFueSA9IG51bGw7XG4gICAgZWxlbWVudDogYW55ID0gbnVsbDtcbiAgICBpc0RlZmF1bHRDb25kaXRpb25BdmFpbGFibGU6IGFueSA9IGZhbHNlO1xuICAgIGNsb3NlUGF0aDogYW55ID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcih1dWlkLCBwb2ludHMsIHN0cm9rZVdpZHRoLCBwYXBlcikge1xuICAgICAgICAvKiBBcnJheSBvbiBjb29yZGluYXRlczpcbiAgICAgICAgICogcG9pbnRzOiBbe3g6IDQxMCwgeTogMTEwfSwgMVxuICAgICAgICAgKlx0XHRcdHt4OiA1NzAsIHk6IDExMH0sIDEgMlxuICAgICAgICAgKlx0XHRcdHt4OiA2MjAsIHk6IDI0MH0sICAgMiAzXG4gICAgICAgICAqXHRcdFx0e3g6IDc1MCwgeTogMjcwfSwgICAgIDMgNFxuICAgICAgICAgKlx0XHRcdHt4OiA2NTAsIHk6IDM3MH1dOyAgICAgIDRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzO1xuICAgICAgICAvKlxuICAgICAgICAgKiBwYXRoIGZvciBncmFwaFxuICAgICAgICAgKiBbWydNJywgeDEsIHkxXSwgWydMJywgeDIsIHkyXSwgWydDJywgYXgsIGF5LCBieCwgYnksIHgzLCB5M10sIFsnTCcsIHgzLCB5M11dXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhdGggPSBbXTtcblxuICAgICAgICB0aGlzLmFuY2hvcnMgPSBbXTtcblxuICAgICAgICBpZiAoc3Ryb2tlV2lkdGgpIHtcbiAgICAgICAgICAgIHRoaXMuc3Ryb2tlV2lkdGggPSBzdHJva2VXaWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGFwZXIgPSBwYXBlcjtcblxuICAgICAgICB0aGlzLmNsb3NlUGF0aCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHZhciBsaW5lc0NvdW50ID0gdGhpcy5nZXRMaW5lc0NvdW50KCk7XG4gICAgICAgIGlmIChsaW5lc0NvdW50IDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ub3JtYWxpemVDb29yZGluYXRlcygpO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBhbmNob3JzXG5cbiAgICAgICAgdGhpcy5wdXNoQW5jaG9yKEFuY2hvci5BTkNIT1JfVFlQRS5maXJzdCwgdGhpcy5nZXRMaW5lKDApLngxLCB0aGlzLmdldExpbmUoMCkueTEpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgbGluZXNDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbGluZTEgPSB0aGlzLmdldExpbmUoaSAtIDEpO1xuICAgICAgICAgICAgdGhpcy5wdXNoQW5jaG9yKEFuY2hvci5BTkNIT1JfVFlQRS5tYWluLCBsaW5lMS54MiwgbGluZTEueTIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wdXNoQW5jaG9yKEFuY2hvci5BTkNIT1JfVFlQRS5sYXN0LCB0aGlzLmdldExpbmUobGluZXNDb3VudCAtIDEpLngyLCB0aGlzLmdldExpbmUobGluZXNDb3VudCAtIDEpLnkyKTtcblxuICAgICAgICB0aGlzLnJlYnVpbGRQYXRoKCk7XG4gICAgfVxuXG4gICAgbm9ybWFsaXplQ29vcmRpbmF0ZXMoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMucG9pbnRzW2ldLnggPSBwYXJzZUZsb2F0KHRoaXMucG9pbnRzW2ldLngpO1xuICAgICAgICAgICAgdGhpcy5wb2ludHNbaV0ueSA9IHBhcnNlRmxvYXQodGhpcy5wb2ludHNbaV0ueSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRMaW5lc0NvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb2ludHMubGVuZ3RoIC0gMTtcbiAgICB9XG5cbiAgICBfZ2V0TGluZShpKSB7XG4gICAgICAgIGlmICh0aGlzLnBvaW50cy5sZW5ndGggPiBpICYmIHRoaXMucG9pbnRzW2ldKSB7XG4gICAgICAgICAgICByZXR1cm4ge3gxOiB0aGlzLnBvaW50c1tpXS54LCB5MTogdGhpcy5wb2ludHNbaV0ueSwgeDI6IHRoaXMucG9pbnRzW2kgKyAxXS54LCB5MjogdGhpcy5wb2ludHNbaSArIDFdLnl9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldExpbmUoaSkge1xuICAgICAgICB2YXIgbGluZTogYW55ID0gdGhpcy5fZ2V0TGluZShpKTtcbiAgICAgICAgaWYgKGxpbmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGluZS5hbmdsZSA9IHRoaXMuZ2V0TGluZUFuZ2xlKGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lO1xuICAgIH1cblxuICAgIGdldExpbmVBbmdsZShpKSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5fZ2V0TGluZShpKTtcbiAgICAgICAgcmV0dXJuIE1hdGguYXRhbjIobGluZS55MiAtIGxpbmUueTEsIGxpbmUueDIgLSBsaW5lLngxKTtcbiAgICB9XG5cbiAgICBnZXRMaW5lTGVuZ3RoWChpKSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRMaW5lKGkpO1xuICAgICAgICByZXR1cm4gKGxpbmUueDIgLSBsaW5lLngxKTtcbiAgICB9XG5cbiAgICBnZXRMaW5lTGVuZ3RoWShpKSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRMaW5lKGkpO1xuICAgICAgICByZXR1cm4gKGxpbmUueTIgLSBsaW5lLnkxKTtcbiAgICB9XG5cbiAgICBnZXRMaW5lTGVuZ3RoKGkpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLmdldExpbmVMZW5ndGhYKGkpLCAyKSArIE1hdGgucG93KHRoaXMuZ2V0TGluZUxlbmd0aFkoaSksIDIpKTtcbiAgICB9XG5cbiAgICBnZXRBbmNob3JzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hbmNob3JzO1xuICAgIH1cblxuICAgIGdldEFuY2hvcnNDb3VudCh0eXBlOiBhbnkgPSBudWxsKSB7XG4gICAgICAgIGlmICghdHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9ycy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudChudWxsKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFuY2hvciA9IHRoaXMuYW5jaG9yc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoYW5jaG9yLmdldFR5cGUoKSA9PT0gdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb3VudDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1c2hBbmNob3IodHlwZSwgeCwgeSkge1xuICAgICAgICB2YXIgaW5kZXg7XG4gICAgICAgIGlmICh0eXBlID09PSBBbmNob3IuQU5DSE9SX1RZUEUuZmlyc3QpIHtcbiAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBBbmNob3IuQU5DSE9SX1RZUEUubGFzdCkge1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLmdldEFuY2hvcnNDb3VudCgpO1xuICAgICAgICB9IGVsc2UgaWYgKCFpbmRleCkge1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLmFuY2hvcnMubGVuZ3RoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9yID0gdGhpcy5hbmNob3JzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChhbmNob3IuaW5kZXggPiBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBhbmNob3IuaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yLnR5cGVJbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhbmNob3I6IGFueSA9IG5ldyBBbmNob3IodGhpcy5pZCwgQW5jaG9yLkFOQ0hPUl9UWVBFLm1haW4sIHgsIHkpO1xuXG4gICAgICAgIHRoaXMuYW5jaG9ycy5wdXNoKGFuY2hvcik7XG4gICAgfVxuXG4gICAgZ2V0QW5jaG9yKHBvc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFuY2hvcnNbcG9zaXRpb25dO1xuICAgIH1cblxuICAgIGdldEFuY2hvckJ5VHlwZSh0eXBlLCBwb3NpdGlvbikge1xuICAgICAgICBpZiAodHlwZSA9PT0gQW5jaG9yLkFOQ0hPUl9UWVBFLmZpcnN0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmNob3JzWzBdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSBBbmNob3IuQU5DSE9SX1RZUEUubGFzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9yc1t0aGlzLmdldEFuY2hvcnNDb3VudCgpIC0gMV07XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBhbmNob3IgPSB0aGlzLmFuY2hvcnNbaV07XG4gICAgICAgICAgICBpZiAoYW5jaG9yLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPT09IGFuY2hvci5wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5jaG9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhZGROZXdQb2ludChwb3NpdGlvbiwgeCwgeSkge1xuICAgICAgICAvL1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0TGluZXNDb3VudCgpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRMaW5lKGkpO1xuICAgICAgICAgICAgaWYgKHggPiBsaW5lLngxICYmIHggPCBsaW5lLngyICYmIHkgPiBsaW5lLnkxICYmIHkgPCBsaW5lLnkyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb2ludHMuc3BsaWNlKGkgKyAxLCAwLCB7eDogeCwgeTogeX0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWJ1aWxkUGF0aCgpO1xuICAgIH1cblxuICAgIHJlYnVpbGRQYXRoKCkge1xuICAgICAgICB2YXIgcGF0aCA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRBbmNob3JzQ291bnQoKTsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYW5jaG9yID0gdGhpcy5nZXRBbmNob3IoaSk7XG5cbiAgICAgICAgICAgIHZhciBwYXRoVHlwZSA9ICcnO1xuXG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHBhdGhUeXBlID0gJ00nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXRoVHlwZSA9ICdMJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRPRE86IHNhdmUgcHJldmlvdXMgcG9pbnRzIGFuZCBjYWxjdWxhdGUgbmV3IHBhdGgganVzdCBpZiBwb2ludHMgYXJlIHVwZGF0ZWQsIGFuZCB0aGVuIHNhdmUgY3VycmVudHMgdmFsdWVzIGFzIHByZXZpb3VzXG5cbiAgICAgICAgICAgIHZhciB0YXJnZXRYID0gYW5jaG9yLngsIHRhcmdldFkgPSBhbmNob3IueTtcbiAgICAgICAgICAgIGlmIChpID4gMCAmJiBpIDwgdGhpcy5nZXRBbmNob3JzQ291bnQoKSAtIDEpIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgbmV3IHgseVxuICAgICAgICAgICAgICAgIHZhciBjeCA9IGFuY2hvci54LCBjeSA9IGFuY2hvci55O1xuXG4gICAgICAgICAgICAgICAgLy8gcGl2b3QgcG9pbnQgb2YgcHJldiBsaW5lXG4gICAgICAgICAgICAgICAgdmFyIEFPID0gdGhpcy5nZXRMaW5lTGVuZ3RoKGkgLSAxKTtcbiAgICAgICAgICAgICAgICBpZiAoQU8gPCB0aGlzLnJhZGl1cykge1xuICAgICAgICAgICAgICAgICAgICBBTyA9IHRoaXMucmFkaXVzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuaXNEZWZhdWx0Q29uZGl0aW9uQXZhaWxhYmxlID0gKHRoaXMuaXNEZWZhdWx0Q29uZGl0aW9uQXZhaWxhYmxlIHx8IChpID09PSAxICYmIEFPID4gMTApKTtcblxuICAgICAgICAgICAgICAgIHZhciBFRCA9IHRoaXMuZ2V0TGluZUxlbmd0aFkoaSAtIDEpICogdGhpcy5yYWRpdXMgLyBBTztcbiAgICAgICAgICAgICAgICB2YXIgT0QgPSB0aGlzLmdldExpbmVMZW5ndGhYKGkgLSAxKSAqIHRoaXMucmFkaXVzIC8gQU87XG4gICAgICAgICAgICAgICAgdGFyZ2V0WCA9IGFuY2hvci54IC0gT0Q7XG4gICAgICAgICAgICAgICAgdGFyZ2V0WSA9IGFuY2hvci55IC0gRUQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoQU8gPCAyICogdGhpcy5yYWRpdXMgJiYgaSA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WCA9IGFuY2hvci54IC0gdGhpcy5nZXRMaW5lTGVuZ3RoWChpIC0gMSkgLyAyO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRZID0gYW5jaG9yLnkgLSB0aGlzLmdldExpbmVMZW5ndGhZKGkgLSAxKSAvIDI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gcGl2b3QgcG9pbnQgb2YgbmV4dCBsaW5lXG4gICAgICAgICAgICAgICAgdmFyIEFPID0gdGhpcy5nZXRMaW5lTGVuZ3RoKGkpO1xuICAgICAgICAgICAgICAgIGlmIChBTyA8IHRoaXMucmFkaXVzKSB7XG4gICAgICAgICAgICAgICAgICAgIEFPID0gdGhpcy5yYWRpdXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBFRCA9IHRoaXMuZ2V0TGluZUxlbmd0aFkoaSkgKiB0aGlzLnJhZGl1cyAvIEFPO1xuICAgICAgICAgICAgICAgIHZhciBPRCA9IHRoaXMuZ2V0TGluZUxlbmd0aFgoaSkgKiB0aGlzLnJhZGl1cyAvIEFPO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0U3JjWCA9IGFuY2hvci54ICsgT0Q7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRTcmNZID0gYW5jaG9yLnkgKyBFRDtcblxuICAgICAgICAgICAgICAgIGlmIChBTyA8IDIgKiB0aGlzLnJhZGl1cyAmJiBpIDwgdGhpcy5nZXRBbmNob3JzQ291bnQoKSAtIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dFNyY1ggPSBhbmNob3IueCArIHRoaXMuZ2V0TGluZUxlbmd0aFgoaSkgLyAyO1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3JjWSA9IGFuY2hvci55ICsgdGhpcy5nZXRMaW5lTGVuZ3RoWShpKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZHgwID0gKGN4IC0gdGFyZ2V0WCkgLyAzLFxuICAgICAgICAgICAgICAgICAgICBkeTAgPSAoY3kgLSB0YXJnZXRZKSAvIDMsXG4gICAgICAgICAgICAgICAgICAgIGF4ID0gY3ggLSBkeDAsXG4gICAgICAgICAgICAgICAgICAgIGF5ID0gY3kgLSBkeTAsXG5cbiAgICAgICAgICAgICAgICAgICAgZHgxID0gKGN4IC0gbmV4dFNyY1gpIC8gMyxcbiAgICAgICAgICAgICAgICAgICAgZHkxID0gKGN5IC0gbmV4dFNyY1kpIC8gMyxcbiAgICAgICAgICAgICAgICAgICAgYnggPSBjeCAtIGR4MSxcbiAgICAgICAgICAgICAgICAgICAgYnkgPSBjeSAtIGR5MSxcblxuICAgICAgICAgICAgICAgICAgICB6eCA9IG5leHRTcmNYLCB6eSA9IG5leHRTcmNZO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IDEgJiYgdGhpcy5nZXRBbmNob3JzQ291bnQoKSA9PT0gMikge1xuICAgICAgICAgICAgICAgIHZhciBBTyA9IHRoaXMuZ2V0TGluZUxlbmd0aChpIC0gMSk7XG4gICAgICAgICAgICAgICAgaWYgKEFPIDwgdGhpcy5yYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgQU8gPSB0aGlzLnJhZGl1cztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5pc0RlZmF1bHRDb25kaXRpb25BdmFpbGFibGUgPSAodGhpcy5pc0RlZmF1bHRDb25kaXRpb25BdmFpbGFibGUgfHwgKGkgPT09IDEgJiYgQU8gPiAxMCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhbnRpIHNtb290aGluZ1xuICAgICAgICAgICAgaWYgKHRoaXMuc3Ryb2tlV2lkdGggJSAyID09PSAxKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0WCArPSAwLjU7XG4gICAgICAgICAgICAgICAgdGFyZ2V0WSArPSAwLjU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhdGgucHVzaChbcGF0aFR5cGUsIHRhcmdldFgsIHRhcmdldFldKTtcblxuICAgICAgICAgICAgaWYgKGkgPiAwICYmIGkgPCB0aGlzLmdldEFuY2hvcnNDb3VudCgpIC0gMSkge1xuICAgICAgICAgICAgICAgIHBhdGgucHVzaChbJ0MnLCBheCwgYXksIGJ4LCBieSwgengsIHp5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jbG9zZVBhdGgpIHtcbiAgICAgICAgICAgIHBhdGgucHVzaChbJ1onXSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIH1cblxuICAgIHRyYW5zZm9ybSh0cmFuc2Zvcm1hdGlvbikge1xuICAgICAgICB0aGlzLmVsZW1lbnQudHJhbnNmb3JtKHRyYW5zZm9ybWF0aW9uKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbihhdHRycykge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cihhdHRycyk7XG4gICAgfVxuXG59XG4iXX0=