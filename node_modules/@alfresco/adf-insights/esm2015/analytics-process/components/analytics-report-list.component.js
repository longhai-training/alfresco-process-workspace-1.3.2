/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { Observable } from 'rxjs';
import { AnalyticsService } from '../services/analytics.service';
import { share } from 'rxjs/operators';
export class AnalyticsReportListComponent {
    /**
     * @param {?} analyticsService
     */
    constructor(analyticsService) {
        this.analyticsService = analyticsService;
        this.layoutType = AnalyticsReportListComponent.LAYOUT_LIST;
        this.selectFirst = false;
        this.reportClick = new EventEmitter();
        this.success = new EventEmitter();
        this.error = new EventEmitter();
        this.reports = [];
        this.report$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => this.reportObserver = observer))
            .pipe(share());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initObserver();
        this.getReportList(this.appId);
    }
    /**
     * @return {?}
     */
    initObserver() {
        this.report$.subscribe((/**
         * @param {?} report
         * @return {?}
         */
        (report) => {
            this.reports.push(report);
        }));
    }
    /**
     * Reload the component
     * @param {?=} reportId
     * @return {?}
     */
    reload(reportId) {
        this.reset();
        this.getReportList(this.appId, reportId);
    }
    /**
     * Get the report list
     * @param {?} appId
     * @param {?=} reportId
     * @return {?}
     */
    getReportList(appId, reportId) {
        this.analyticsService.getReportList(appId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (res && res.length === 0) {
                this.createDefaultReports();
            }
            else {
                res.forEach((/**
                 * @param {?} report
                 * @return {?}
                 */
                (report) => {
                    this.reportObserver.next(report);
                }));
                if (reportId) {
                    this.selectReportByReportId(reportId);
                }
                if (this.selectFirst) {
                    this.selectFirstReport();
                }
                this.success.emit(res);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.error.emit(err);
        }));
    }
    /**
     * Create the default reports and return the report list
     * @return {?}
     */
    createDefaultReports() {
        this.analyticsService.createDefaultReports().subscribe((/**
         * @return {?}
         */
        () => {
            this.analyticsService.getReportList(this.appId).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                response.forEach((/**
                 * @param {?} report
                 * @return {?}
                 */
                (report) => {
                    this.reportObserver.next(report);
                }));
                this.success.emit(response);
            }));
        }));
    }
    /**
     * Check if the report list is empty
     * @return {?}
     */
    isReportsEmpty() {
        return this.reports === undefined || (this.reports && this.reports.length === 0);
    }
    /**
     * Reset the list
     * @private
     * @return {?}
     */
    reset() {
        if (!this.isReportsEmpty()) {
            this.reports = [];
        }
    }
    /**
     * Select the current report
     * @param {?} report
     * @return {?}
     */
    selectReport(report) {
        this.currentReport = report;
        this.reportClick.emit(report);
    }
    /**
     * @param {?} reportId
     * @return {?}
     */
    selectReportByReportId(reportId) {
        /** @type {?} */
        const reportFound = this.reports.find((/**
         * @param {?} report
         * @return {?}
         */
        (report) => report.id === reportId));
        if (reportFound) {
            this.currentReport = reportFound;
            this.reportClick.emit(reportFound);
        }
    }
    /**
     * @return {?}
     */
    selectFirstReport() {
        this.selectReport(this.reports[0]);
        this.selectFirst = false;
    }
    /**
     * @param {?} report
     * @return {?}
     */
    isSelected(report) {
        return this.currentReport === report ? true : false;
    }
    /**
     * @return {?}
     */
    isList() {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_LIST;
    }
    /**
     * @return {?}
     */
    isGrid() {
        return this.layoutType === AnalyticsReportListComponent.LAYOUT_GRID;
    }
}
AnalyticsReportListComponent.LAYOUT_LIST = 'LIST';
AnalyticsReportListComponent.LAYOUT_GRID = 'GRID';
AnalyticsReportListComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-analytics-report-list',
                template: "<div class=\"adf-analytics-report-list menu-container\">\n    <mat-nav-list *ngIf=\"isList()\">\n        <mat-list-item\n            class=\"adf-activiti-filters__entry\"\n            (click)=\"selectReport(report)\"\n            *ngFor=\"let report of reports; let idx = index\"\n            [class.adf-active]=\"currentReport === report\">\n            <span [attr.id]=\"'report-list-' + idx\" class=\"adf-activiti-filters__label\">\n                <mat-icon mat-list-icon\n                    [attr.data-automation-id]=\"report.name + '_filter'\"\n                    class=\"adf-activiti-filters__entry-icon\">assignment</mat-icon>\n                <span class=\"adf-text\">{{report.name}}</span>\n            </span>\n        </mat-list-item>\n    </mat-nav-list>\n    <div class=\"adf-report-card-grids\" *ngIf=\"isGrid()\">\n        <mat-card (click)=\"selectReport(report)\" class=\"adf-report-card\" *ngFor=\"let report of reports;\">\n            <div class=\"adf-report-card-logo logo\">\n                <mat-icon class=\"adf-report-card-logo-icon\">equalizer</mat-icon>\n            </div>\n            <div mat-card-title class=\"adf-report-card-title\">\n                <h1 class=\"adf-application-title\">{{report.name}}</h1>\n            </div>\n            <div mat-card-content class=\"adf-report-card-content\">\n                <p>{{report.description}}</p>\n            </div>\n            <div mat-card-actions class=\"adf-report-card-actions\">\n                <mat-icon class=\"adf-report-card-actions-icon\" *ngIf=\"isSelected(report)\">done</mat-icon>\n            </div>\n        </mat-card>\n    </div>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [""]
            }] }
];
/** @nocollapse */
AnalyticsReportListComponent.ctorParameters = () => [
    { type: AnalyticsService }
];
AnalyticsReportListComponent.propDecorators = {
    layoutType: [{ type: Input }],
    appId: [{ type: Input }],
    selectFirst: [{ type: Input }],
    reportClick: [{ type: Output }],
    success: [{ type: Output }],
    error: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_LIST;
    /** @type {?} */
    AnalyticsReportListComponent.LAYOUT_GRID;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.layoutType;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.appId;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.selectFirst;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reportClick;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.success;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.error;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.reportObserver;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.report$;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.currentReport;
    /** @type {?} */
    AnalyticsReportListComponent.prototype.reports;
    /**
     * @type {?}
     * @private
     */
    AnalyticsReportListComponent.prototype.analyticsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLXJlcG9ydC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtaW5zaWdodHMvIiwic291cmNlcyI6WyJhbmFseXRpY3MtcHJvY2Vzcy9jb21wb25lbnRzL2FuYWx5dGljcy1yZXBvcnQtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQUUsVUFBVSxFQUFZLE1BQU0sTUFBTSxDQUFDO0FBRTVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQVF2QyxNQUFNLE9BQU8sNEJBQTRCOzs7O0lBOEJyQyxZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQXhCdEQsZUFBVSxHQUFXLDRCQUE0QixDQUFDLFdBQVcsQ0FBQztRQU05RCxnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUc3QixnQkFBVyxHQUF3QyxJQUFJLFlBQVksRUFBeUIsQ0FBQztRQUc3RixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUc3QixVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQU8zQixZQUFPLEdBQTRCLEVBQUUsQ0FBQztRQUdsQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksVUFBVTs7OztRQUF3QixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLEVBQUM7YUFDN0YsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDdkIsQ0FBQzs7OztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsWUFBWSxFQUFF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O0lBRTNDLGtEQUM4RDs7SUFFOUQsNkNBQ2M7O0lBRWQsbURBQzZCOztJQUU3QixtREFDNkY7O0lBRTdGLCtDQUM2Qjs7SUFFN0IsNkNBQzJCOzs7OztJQUUzQixzREFBc0M7O0lBQ3RDLCtDQUF5Qjs7SUFFekIscURBQW1COztJQUVuQiwrQ0FBc0M7Ozs7O0lBRTFCLHdEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUmVwb3J0UGFyYW1ldGVyc01vZGVsIH0gZnJvbSAnLi4vLi4vZGlhZ3JhbS9tb2RlbHMvcmVwb3J0L3JlcG9ydFBhcmFtZXRlcnMubW9kZWwnO1xuaW1wb3J0IHsgQW5hbHl0aWNzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FuYWx5dGljcy5zZXJ2aWNlJztcbmltcG9ydCB7IHNoYXJlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1hbmFseXRpY3MtcmVwb3J0LWxpc3QnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9hbmFseXRpY3MtcmVwb3J0LWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2FuYWx5dGljcy1yZXBvcnQtbGlzdC5jb21wb25lbnQuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgQW5hbHl0aWNzUmVwb3J0TGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBwdWJsaWMgc3RhdGljIExBWU9VVF9MSVNUOiBzdHJpbmcgPSAnTElTVCc7XG4gICAgcHVibGljIHN0YXRpYyBMQVlPVVRfR1JJRDogc3RyaW5nID0gJ0dSSUQnO1xuXG4gICAgQElucHV0KClcbiAgICBsYXlvdXRUeXBlOiBzdHJpbmcgPSBBbmFseXRpY3NSZXBvcnRMaXN0Q29tcG9uZW50LkxBWU9VVF9MSVNUO1xuXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogbnVtYmVyO1xuXG4gICAgQElucHV0KClcbiAgICBzZWxlY3RGaXJzdDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQE91dHB1dCgpXG4gICAgcmVwb3J0Q2xpY2s6IEV2ZW50RW1pdHRlcjxSZXBvcnRQYXJhbWV0ZXJzTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxSZXBvcnRQYXJhbWV0ZXJzTW9kZWw+KCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBzdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBwcml2YXRlIHJlcG9ydE9ic2VydmVyOiBPYnNlcnZlcjxhbnk+O1xuICAgIHJlcG9ydCQ6IE9ic2VydmFibGU8YW55PjtcblxuICAgIGN1cnJlbnRSZXBvcnQ6IGFueTtcblxuICAgIHJlcG9ydHM6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbFtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5yZXBvcnQkID0gbmV3IE9ic2VydmFibGU8UmVwb3J0UGFyYW1ldGVyc01vZGVsPigob2JzZXJ2ZXIpID0+IHRoaXMucmVwb3J0T2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKHNoYXJlKCkpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmluaXRPYnNlcnZlcigpO1xuXG4gICAgICAgIHRoaXMuZ2V0UmVwb3J0TGlzdCh0aGlzLmFwcElkKTtcbiAgICB9XG5cbiAgICBpbml0T2JzZXJ2ZXIoKSB7XG4gICAgICAgIHRoaXMucmVwb3J0JC5zdWJzY3JpYmUoKHJlcG9ydDogUmVwb3J0UGFyYW1ldGVyc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydHMucHVzaChyZXBvcnQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWxvYWQgdGhlIGNvbXBvbmVudFxuICAgICAqL1xuICAgIHJlbG9hZChyZXBvcnRJZD8pIHtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICB0aGlzLmdldFJlcG9ydExpc3QodGhpcy5hcHBJZCwgcmVwb3J0SWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgcmVwb3J0IGxpc3RcbiAgICAgKi9cbiAgICBnZXRSZXBvcnRMaXN0KGFwcElkOiBudW1iZXIsIHJlcG9ydElkPzogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYW5hbHl0aWNzU2VydmljZS5nZXRSZXBvcnRMaXN0KGFwcElkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBSZXBvcnRQYXJhbWV0ZXJzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURlZmF1bHRSZXBvcnRzKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHJlcG9ydCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBvcnRPYnNlcnZlci5uZXh0KHJlcG9ydCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3J0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UmVwb3J0QnlSZXBvcnRJZChyZXBvcnRJZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0Rmlyc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Rmlyc3RSZXBvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Y2Nlc3MuZW1pdChyZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIGRlZmF1bHQgcmVwb3J0cyBhbmQgcmV0dXJuIHRoZSByZXBvcnQgbGlzdFxuICAgICAqL1xuICAgIGNyZWF0ZURlZmF1bHRSZXBvcnRzKCkge1xuICAgICAgICB0aGlzLmFuYWx5dGljc1NlcnZpY2UuY3JlYXRlRGVmYXVsdFJlcG9ydHMoKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldFJlcG9ydExpc3QodGhpcy5hcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAocmVzcG9uc2U6IFJlcG9ydFBhcmFtZXRlcnNNb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKChyZXBvcnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydE9ic2VydmVyLm5leHQocmVwb3J0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgcmVwb3J0IGxpc3QgaXMgZW1wdHlcbiAgICAgKi9cbiAgICBpc1JlcG9ydHNFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwb3J0cyA9PT0gdW5kZWZpbmVkIHx8ICh0aGlzLnJlcG9ydHMgJiYgdGhpcy5yZXBvcnRzLmxlbmd0aCA9PT0gMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIGxpc3RcbiAgICAgKi9cbiAgICBwcml2YXRlIHJlc2V0KCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNSZXBvcnRzRW1wdHkoKSkge1xuICAgICAgICAgICAgdGhpcy5yZXBvcnRzID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgdGhlIGN1cnJlbnQgcmVwb3J0XG4gICAgICogQHBhcmFtIHJlcG9ydFxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RSZXBvcnQocmVwb3J0OiBhbnkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50UmVwb3J0ID0gcmVwb3J0O1xuICAgICAgICB0aGlzLnJlcG9ydENsaWNrLmVtaXQocmVwb3J0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VsZWN0UmVwb3J0QnlSZXBvcnRJZChyZXBvcnRJZCkge1xuICAgICAgICBjb25zdCByZXBvcnRGb3VuZCA9IHRoaXMucmVwb3J0cy5maW5kKChyZXBvcnQpID0+IHJlcG9ydC5pZCA9PT0gcmVwb3J0SWQpO1xuICAgICAgICBpZiAocmVwb3J0Rm91bmQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlcG9ydCA9IHJlcG9ydEZvdW5kO1xuICAgICAgICAgICAgdGhpcy5yZXBvcnRDbGljay5lbWl0KHJlcG9ydEZvdW5kKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlbGVjdEZpcnN0UmVwb3J0KCkge1xuICAgICAgICB0aGlzLnNlbGVjdFJlcG9ydCh0aGlzLnJlcG9ydHNbMF0pO1xuICAgICAgICB0aGlzLnNlbGVjdEZpcnN0ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNTZWxlY3RlZChyZXBvcnQ6IGFueSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UmVwb3J0ID09PSByZXBvcnQgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgaXNMaXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXlvdXRUeXBlID09PSBBbmFseXRpY3NSZXBvcnRMaXN0Q29tcG9uZW50LkxBWU9VVF9MSVNUO1xuICAgIH1cblxuICAgIGlzR3JpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGF5b3V0VHlwZSA9PT0gQW5hbHl0aWNzUmVwb3J0TGlzdENvbXBvbmVudC5MQVlPVVRfR1JJRDtcbiAgICB9XG59XG4iXX0=