/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { ReportQuery } from '../../diagram/models/report/reportQuery.model';
import { AnalyticsService } from '../services/analytics.service';
export class AnalyticsGeneratorComponent {
    /**
     * @param {?} analyticsService
     */
    constructor(analyticsService) {
        this.analyticsService = analyticsService;
        this.reportParamQuery = undefined;
        this.success = new EventEmitter();
        this.error = new EventEmitter();
        this.showDetails = false;
        this.barChartOptions = {
            responsive: true,
            scales: {
                yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            stepSize: 1
                        }
                    }],
                xAxes: [{
                        ticks: {},
                        stacked: true
                    }]
            }
        };
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        if (this.reportId && this.reportParamQuery) {
            this.generateReport(this.reportId, this.reportParamQuery);
        }
        else {
            this.reset();
        }
    }
    /**
     * @param {?} reportId
     * @param {?} reportParamQuery
     * @return {?}
     */
    generateReport(reportId, reportParamQuery) {
        if (reportParamQuery === undefined || reportParamQuery === null) {
            reportParamQuery = {};
        }
        this.analyticsService.getReportsByParams(reportId, reportParamQuery).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            this.reports = res;
            if (this.reports) {
                this.selectFirstReport();
            }
            this.success.emit(res);
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.error.emit(err);
        }));
    }
    /**
     * @return {?}
     */
    reset() {
        if (this.reports) {
            this.reports = undefined;
        }
    }
    /**
     * @param {?} report
     * @return {?}
     */
    refresh(report) {
        /**
         * (My guess), for Angular to recognize the change in the dataset
         * it has to change the dataset variable directly,
         * so one way around it, is to clone the data, change it and then
         * assign it;
         * @type {?}
         */
        const clone = JSON.parse(JSON.stringify(report));
        report.datasets = clone.datasets;
    }
    /**
     * @return {?}
     */
    toggleDetailsTable() {
        this.showDetails = !this.showDetails;
    }
    /**
     * @return {?}
     */
    isShowDetails() {
        return this.showDetails;
    }
    /**
     * @param {?} position
     * @return {?}
     */
    isCurrent(position) {
        return position === this.currentChartPosition ? true : false;
    }
    /**
     * @param {?} position
     * @return {?}
     */
    selectCurrent(position) {
        this.currentChartPosition = position;
    }
    /**
     * @return {?}
     */
    selectFirstReport() {
        this.selectCurrent(0);
    }
}
AnalyticsGeneratorComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-analytics-generator',
                template: "<div *ngIf=\"reports\">\n    <div class=\"adf-report-icons\">\n        <button mat-icon-button\n                *ngFor=\"let report of reports; let idx = index\"\n                [matTooltip]=\"report.title\"\n                [color]=\"isCurrent(idx) ? 'primary' : null\"\n                (click)=\"selectCurrent(idx)\">\n            <mat-icon>{{report.icon}}</mat-icon>\n        </button>\n    </div>\n    <div class=\"adf-clear-both\"> </div>\n    <div *ngFor=\"let report of reports; let idx = index\">\n        <div [ngSwitch]=\"report.type\">\n            <div *ngSwitchCase=\"'pie'\">\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <div *ngIf=\"!report.hasData()\">{{'ANALYTICS.MESSAGES.NO-DATA-FOUND' | translate}}</div>\n                    <div *ngIf=\"report.hasData()\">\n                        <div *ngIf=\"report.hasZeroValues()\">{{'ANALYTICS.MESSAGES.ZERO-DATA-FOUND' | translate}}</div>\n                        <canvas baseChart *ngIf=\"!report.hasZeroValues()\" class=\"adf-chart\"\n                                [data]=\"report.data\"\n                                [labels]=\"report.labels\"\n                                [chartType]=\"report.type\">\n                        </canvas>\n                    </div>\n                </div>\n            </div>\n            <div *ngSwitchCase=\"'table'\" >\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <div *ngIf=\"!report.hasDatasets()\">{{'ANALYTICS.MESSAGES.NO-DATA-FOUND' | translate}}</div>\n                    <div [attr.id]=\"'chart-table-' + report.id\" *ngIf=\"report.hasDatasets()\">\n                        <table class=\"adf-table adf-table-responsive adf-table-condensed\" class=\"adf-partial-width\">\n                            <tr>\n                                <th *ngFor=\"let label of report.labels\">{{label | translate}}</th>\n                            </tr>\n                            <tr *ngFor=\"let rows of report.datasets\">\n                                <td *ngFor=\"let row of rows\">{{row | translate }}</td>\n                            </tr>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div *ngSwitchCase=\"'masterDetailTable'\" >\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <div *ngIf=\"!report.hasDatasets()\">{{'ANALYTICS.MESSAGES.NO-DATA-FOUND' | translate}}</div>\n                    <div [attr.id]=\"'chart-master-detail-table-' + report.id\" *ngIf=\"report.hasDatasets()\">\n                        <table class=\"adf-table adf-table-responsive adf-table-condensed adf-full-width\">\n                            <tr>\n                                <th *ngFor=\"let label of report.labels\">{{label | translate}}</th>\n                            </tr>\n                            <tr *ngFor=\"let rows of report.datasets\" class=\"adf-analytics-row__entry\">\n                                <td *ngFor=\"let row of rows\" (click)=\"toggleDetailsTable()\">{{row | translate }}</td>\n                            </tr>\n                        </table>\n                    </div>\n                    <div [attr.id]=\"'chart-master-detail-' + report.id\" *ngIf=\"isShowDetails()\">\n                        <table class=\"adf-table adf-table-responsive adf-table-condensed adf-full-width\">\n                            <tr>\n                                <th *ngFor=\"let label of report.detailsTable.labels\">{{label | translate}}</th>\n                            </tr>\n                            <tr *ngFor=\"let rows of report.detailsTable.datasets\">\n                                <td *ngFor=\"let row of rows\">{{row | translate }}</td>\n                            </tr>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div *ngSwitchCase=\"'bar'\">\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <div *ngIf=\"!report.hasDatasets()\">{{'ANALYTICS.MESSAGES.NO-DATA-FOUND' | translate}}</div>\n                    <canvas baseChart *ngIf=\"report.hasDatasets()\" class=\"adf-chart\"\n                            [datasets]=\"report.datasets\"\n                            [labels]=\"report.labels\"\n                            [options]=\"report.options\"\n                            [chartType]=\"report.type\">\n                    </canvas>\n                </div>\n            </div>\n            <div *ngSwitchCase=\"'multiBar'\">\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <div *ngIf=\"!report.hasDatasets()\">{{'ANALYTICS.MESSAGES.NO-DATA-FOUND' | translate}}</div>\n                    <div *ngIf=\"report.hasDatasets()\">\n                        <mat-checkbox\n                            color=\"primary\"\n                            [id]=\"'stacked-id'\"\n                            [checked]=\"report.options.scales.xAxes[0].stacked\"\n                            [(ngModel)]=\"report.options.scales.xAxes[0].stacked\"\n                            (change)=\"refresh(report)\">Stacked</mat-checkbox>\n\n                        <canvas baseChart class=\"adf-chart\"\n                                [datasets]=\"report.datasets\"\n                                [labels]=\"report.labels\"\n                                [options]=\"report.options\"\n                                [chartType]=\"'bar'\">\n                        </canvas>\n                    </div>\n                </div>\n            </div>\n            <div *ngSwitchCase=\"'HeatMap'\">\n                <div *ngIf=\"isCurrent(idx)\">\n                    <h4>{{report.title}}</h4>\n                    <analytics-report-heat-map [report]=\"report\"></analytics-report-heat-map>\n                </div>\n            </div>\n            <div *ngSwitchDefault>\n                <span>{{'ANALYTICS.MESSAGES.UNKNOWN-WIDGET-TYPE' | translate}}: {{report.type}}</span>\n            </div>\n        </div>\n    </div>\n</div>\n<br><br><br>\n<div *ngIf=\"!reports\">{{'ANALYTICS.MESSAGES.FILL-PARAMETER' | translate}}</div>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-chart{display:block;width:100%}.adf-analytics-row__entry{cursor:pointer}.adf-report-icons{margin:20px 0;float:left}.adf-full-width{width:100%}.adf-partial-width{width:80%;margin-left:20px}.adf-clear-both{clear:both}"]
            }] }
];
/** @nocollapse */
AnalyticsGeneratorComponent.ctorParameters = () => [
    { type: AnalyticsService }
];
AnalyticsGeneratorComponent.propDecorators = {
    reportId: [{ type: Input }],
    reportParamQuery: [{ type: Input }],
    success: [{ type: Output }],
    error: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.reportId;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.reportParamQuery;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.success;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.error;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.reports;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.showDetails;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.currentChartPosition;
    /** @type {?} */
    AnalyticsGeneratorComponent.prototype.barChartOptions;
    /**
     * @type {?}
     * @private
     */
    AnalyticsGeneratorComponent.prototype.analyticsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5hbHl0aWNzLWdlbmVyYXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWluc2lnaHRzLyIsInNvdXJjZXMiOlsiYW5hbHl0aWNzLXByb2Nlc3MvY29tcG9uZW50cy9hbmFseXRpY3MtZ2VuZXJhdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JHLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQUU1RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQVFqRSxNQUFNLE9BQU8sMkJBQTJCOzs7O0lBb0NwQyxZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQTlCdEQscUJBQWdCLEdBQWdCLFNBQVMsQ0FBQztRQUcxQyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUc3QixVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUkzQixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUd0QixvQkFBZSxHQUFRO1lBQzFCLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLE1BQU0sRUFBRTtnQkFDSixLQUFLLEVBQUUsQ0FBQzt3QkFDSixLQUFLLEVBQUU7NEJBQ0gsV0FBVyxFQUFFLElBQUk7NEJBQ2pCLFFBQVEsRUFBRSxDQUFDO3lCQUNkO3FCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7d0JBQ0osS0FBSyxFQUFFLEVBQ047d0JBQ0QsT0FBTyxFQUFFLElBQUk7cUJBQ2hCLENBQUM7YUFDTDtTQUNKLENBQUM7SUFHRixDQUFDOzs7O0lBRUQsV0FBVztRQUNQLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1NBQzdEO2FBQU07WUFDSCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDaEI7SUFDTCxDQUFDOzs7Ozs7SUFFTSxjQUFjLENBQUMsUUFBUSxFQUFFLGdCQUFnQjtRQUM1QyxJQUFJLGdCQUFnQixLQUFLLFNBQVMsSUFBSSxnQkFBZ0IsS0FBSyxJQUFJLEVBQUU7WUFDN0QsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLFNBQVM7Ozs7UUFDMUUsQ0FBQyxHQUFZLEVBQUUsRUFBRTtZQUNiLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1lBQ25CLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDZCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQzthQUM1QjtZQUNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLENBQUM7Ozs7UUFDRCxDQUFDLEdBQVEsRUFBRSxFQUFFO1lBQ1QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDekIsQ0FBQyxFQUNKLENBQUM7SUFDTixDQUFDOzs7O0lBRU0sS0FBSztRQUNSLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNkLElBQUksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDO1NBQzVCO0lBQ0wsQ0FBQzs7Ozs7SUFFTSxPQUFPLENBQUMsTUFBTTs7Ozs7Ozs7Y0FPWCxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hELE1BQU0sQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztJQUNyQyxDQUFDOzs7O0lBRUQsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDekMsQ0FBQzs7OztJQUVELGFBQWE7UUFDVCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDNUIsQ0FBQzs7Ozs7SUFFRCxTQUFTLENBQUMsUUFBZ0I7UUFDdEIsT0FBTyxRQUFRLEtBQUssSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNqRSxDQUFDOzs7OztJQUVELGFBQWEsQ0FBQyxRQUFnQjtRQUMxQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsUUFBUSxDQUFDO0lBQ3pDLENBQUM7Ozs7SUFFRCxpQkFBaUI7UUFDYixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLENBQUM7OztZQTFHSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHlCQUF5QjtnQkFDbkMseXRNQUFtRDtnQkFFbkQsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2FBQ3hDOzs7O1lBUFEsZ0JBQWdCOzs7dUJBVXBCLEtBQUs7K0JBR0wsS0FBSztzQkFHTCxNQUFNO29CQUdOLE1BQU07Ozs7SUFUUCwrQ0FDaUI7O0lBRWpCLHVEQUMwQzs7SUFFMUMsOENBQzZCOztJQUU3Qiw0Q0FDMkI7O0lBRTNCLDhDQUFpQjs7SUFFakIsa0RBQTZCOztJQUM3QiwyREFBNkI7O0lBRTdCLHNEQWVFOzs7OztJQUVVLHVEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXBvcnRRdWVyeSB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL3JlcG9ydC9yZXBvcnRRdWVyeS5tb2RlbCc7XG5pbXBvcnQgeyBDaGFydCB9IGZyb20gJy4uLy4uL2RpYWdyYW0vbW9kZWxzL2NoYXJ0L2NoYXJ0Lm1vZGVsJztcbmltcG9ydCB7IEFuYWx5dGljc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hbmFseXRpY3Muc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWFuYWx5dGljcy1nZW5lcmF0b3InLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9hbmFseXRpY3MtZ2VuZXJhdG9yLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9hbmFseXRpY3MtZ2VuZXJhdG9yLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBBbmFseXRpY3NHZW5lcmF0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gICAgQElucHV0KClcbiAgICByZXBvcnRJZDogbnVtYmVyO1xuXG4gICAgQElucHV0KClcbiAgICByZXBvcnRQYXJhbVF1ZXJ5OiBSZXBvcnRRdWVyeSA9IHVuZGVmaW5lZDtcblxuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIHJlcG9ydHM6IENoYXJ0W107XG5cbiAgICBzaG93RGV0YWlsczogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGN1cnJlbnRDaGFydFBvc2l0aW9uOiBudW1iZXI7XG5cbiAgICBwdWJsaWMgYmFyQ2hhcnRPcHRpb25zOiBhbnkgPSB7XG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgeUF4ZXM6IFt7XG4gICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAxXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICB4QXhlczogW3tcbiAgICAgICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3RhY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMucmVwb3J0SWQgJiYgdGhpcy5yZXBvcnRQYXJhbVF1ZXJ5KSB7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlUmVwb3J0KHRoaXMucmVwb3J0SWQsIHRoaXMucmVwb3J0UGFyYW1RdWVyeSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2VuZXJhdGVSZXBvcnQocmVwb3J0SWQsIHJlcG9ydFBhcmFtUXVlcnkpIHtcbiAgICAgICAgaWYgKHJlcG9ydFBhcmFtUXVlcnkgPT09IHVuZGVmaW5lZCB8fCByZXBvcnRQYXJhbVF1ZXJ5ID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXBvcnRQYXJhbVF1ZXJ5ID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldFJlcG9ydHNCeVBhcmFtcyhyZXBvcnRJZCwgcmVwb3J0UGFyYW1RdWVyeSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlczogQ2hhcnRbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVwb3J0cyA9IHJlcztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXBvcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Rmlyc3RSZXBvcnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQocmVzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlcG9ydHMpIHtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByZWZyZXNoKHJlcG9ydCk6IHZvaWQge1xuICAgICAgICAvKipcbiAgICAgICAgICogKE15IGd1ZXNzKSwgZm9yIEFuZ3VsYXIgdG8gcmVjb2duaXplIHRoZSBjaGFuZ2UgaW4gdGhlIGRhdGFzZXRcbiAgICAgICAgICogaXQgaGFzIHRvIGNoYW5nZSB0aGUgZGF0YXNldCB2YXJpYWJsZSBkaXJlY3RseSxcbiAgICAgICAgICogc28gb25lIHdheSBhcm91bmQgaXQsIGlzIHRvIGNsb25lIHRoZSBkYXRhLCBjaGFuZ2UgaXQgYW5kIHRoZW5cbiAgICAgICAgICogYXNzaWduIGl0O1xuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgY2xvbmUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcG9ydCkpO1xuICAgICAgICByZXBvcnQuZGF0YXNldHMgPSBjbG9uZS5kYXRhc2V0cztcbiAgICB9XG5cbiAgICB0b2dnbGVEZXRhaWxzVGFibGUoKSB7XG4gICAgICAgIHRoaXMuc2hvd0RldGFpbHMgPSAhdGhpcy5zaG93RGV0YWlscztcbiAgICB9XG5cbiAgICBpc1Nob3dEZXRhaWxzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93RGV0YWlscztcbiAgICB9XG5cbiAgICBpc0N1cnJlbnQocG9zaXRpb246IG51bWJlcikge1xuICAgICAgICByZXR1cm4gcG9zaXRpb24gPT09IHRoaXMuY3VycmVudENoYXJ0UG9zaXRpb24gPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgc2VsZWN0Q3VycmVudChwb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuY3VycmVudENoYXJ0UG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB9XG5cbiAgICBzZWxlY3RGaXJzdFJlcG9ydCgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RDdXJyZW50KDApO1xuICAgIH1cbn1cbiJdfQ==