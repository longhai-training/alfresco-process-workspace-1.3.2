/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var TasksService = /** @class */ (function () {
    function TasksService(api) {
        this.api = api;
    }
    /**
     * @param {?} taskName
     * @param {?} appName
     * @param {?=} options
     * @return {?}
     */
    TasksService.prototype.createStandaloneTask = /**
     * @param {?} taskName
     * @param {?} appName
     * @param {?=} options
     * @return {?}
     */
    function (taskName, appName, options) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/rb/v1/tasks';
                        method = 'POST';
                        queryParams = {};
                        postBody = tslib_1.__assign({ 'name': taskName, 'payloadType': 'CreateTaskPayload' }, options);
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.completeTask = /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    function (taskId, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/rb/v1/tasks/' + taskId + '/complete';
                        method = 'POST';
                        queryParams = {};
                        postBody = { 'payloadType': 'CompleteTaskPayload' };
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.claimTask = /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    function (taskId, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/rb/v1/tasks/' + taskId + '/claim';
                        method = 'POST';
                        queryParams = {};
                        postBody = {};
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.deleteTask = /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    function (taskId, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/rb/v1/tasks/' + taskId;
                        method = 'DELETE';
                        queryParams = {};
                        postBody = {};
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @param {?} taskName
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.createAndCompleteTask = /**
     * @param {?} taskName
     * @param {?} appName
     * @return {?}
     */
    function (taskName, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var task;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.createStandaloneTask(taskName, appName)];
                    case 1:
                        task = _a.sent();
                        return [4 /*yield*/, this.claimTask(task.entry.id, appName)];
                    case 2:
                        _a.sent();
                        return [4 /*yield*/, this.completeTask(task.entry.id, appName)];
                    case 3:
                        _a.sent();
                        return [2 /*return*/, task];
                }
            });
        });
    };
    /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.getTask = /**
     * @param {?} taskId
     * @param {?} appName
     * @return {?}
     */
    function (taskId, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/query/v1/tasks/' + taskId;
                        method = 'GET';
                        queryParams = {};
                        postBody = {};
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @param {?} taskName
     * @param {?} appName
     * @return {?}
     */
    TasksService.prototype.getTaskId = /**
     * @param {?} taskName
     * @param {?} appName
     * @return {?}
     */
    function (taskName, appName) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/query/v1/tasks';
                        method = 'GET';
                        queryParams = { name: taskName };
                        postBody = {};
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data.list.entries[0].entry.id];
                }
            });
        });
    };
    /**
     * @param {?} parentTaskId
     * @param {?} appName
     * @param {?} name
     * @return {?}
     */
    TasksService.prototype.createStandaloneSubtask = /**
     * @param {?} parentTaskId
     * @param {?} appName
     * @param {?} name
     * @return {?}
     */
    function (parentTaskId, appName, name) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var path, method, queryParams, postBody, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        path = '/' + appName + '/rb/v1/tasks';
                        method = 'POST';
                        queryParams = {};
                        postBody = { 'name': name, 'parentTaskId': parentTaskId, 'payloadType': 'CreateTaskPayload' };
                        return [4 /*yield*/, this.api.performBpmOperation(path, method, queryParams, postBody)];
                    case 1:
                        data = _a.sent();
                        return [2 /*return*/, data];
                }
            });
        });
    };
    return TasksService;
}());
export { TasksService };
if (false) {
    /** @type {?} */
    TasksService.prototype.api;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFza3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtdGVzdGluZy8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL2FjdGlvbnMvaWRlbnRpdHkvdGFza3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkE7SUFJSSxzQkFBWSxHQUFlO1FBQ3ZCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ25CLENBQUM7Ozs7Ozs7SUFFSywyQ0FBb0I7Ozs7OztJQUExQixVQUEyQixRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQVE7Ozs7Ozt3QkFDNUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxPQUFPLEdBQUcsY0FBYzt3QkFDckMsTUFBTSxHQUFHLE1BQU07d0JBRWYsV0FBVyxHQUFHLEVBQUU7d0JBQUUsUUFBUSxzQkFDNUIsTUFBTSxFQUFFLFFBQVEsRUFDaEIsYUFBYSxFQUFFLG1CQUFtQixJQUMvQixPQUFPLENBQ2I7d0JBRVkscUJBQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsRUFBQTs7d0JBQTlFLElBQUksR0FBRyxTQUF1RTt3QkFDcEYsc0JBQU8sSUFBSSxFQUFDOzs7O0tBQ2Y7Ozs7OztJQUVLLG1DQUFZOzs7OztJQUFsQixVQUFtQixNQUFNLEVBQUUsT0FBTzs7Ozs7O3dCQUN4QixJQUFJLEdBQUcsR0FBRyxHQUFHLE9BQU8sR0FBRyxlQUFlLEdBQUcsTUFBTSxHQUFHLFdBQVc7d0JBQzdELE1BQU0sR0FBRyxNQUFNO3dCQUVmLFdBQVcsR0FBRyxFQUFFO3dCQUFFLFFBQVEsR0FBRyxFQUFDLGFBQWEsRUFBRSxxQkFBcUIsRUFBQzt3QkFFNUQscUJBQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsRUFBQTs7d0JBQTlFLElBQUksR0FBRyxTQUF1RTt3QkFDcEYsc0JBQU8sSUFBSSxFQUFDOzs7O0tBQ2Y7Ozs7OztJQUVLLGdDQUFTOzs7OztJQUFmLFVBQWdCLE1BQU0sRUFBRSxPQUFPOzs7Ozs7d0JBQ3JCLElBQUksR0FBRyxHQUFHLEdBQUcsT0FBTyxHQUFHLGVBQWUsR0FBRyxNQUFNLEdBQUcsUUFBUTt3QkFDMUQsTUFBTSxHQUFHLE1BQU07d0JBRWYsV0FBVyxHQUFHLEVBQUU7d0JBQUUsUUFBUSxHQUFHLEVBQUU7d0JBRXhCLHFCQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLEVBQUE7O3dCQUE5RSxJQUFJLEdBQUcsU0FBdUU7d0JBQ3BGLHNCQUFPLElBQUksRUFBQzs7OztLQUNmOzs7Ozs7SUFFSyxpQ0FBVTs7Ozs7SUFBaEIsVUFBaUIsTUFBTSxFQUFFLE9BQU87Ozs7Ozt3QkFDdEIsSUFBSSxHQUFHLEdBQUcsR0FBRyxPQUFPLEdBQUcsZUFBZSxHQUFHLE1BQU07d0JBQy9DLE1BQU0sR0FBRyxRQUFRO3dCQUVqQixXQUFXLEdBQUcsRUFBRTt3QkFBRSxRQUFRLEdBQUcsRUFBRTt3QkFFeEIscUJBQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsRUFBQTs7d0JBQTlFLElBQUksR0FBRyxTQUF1RTt3QkFDcEYsc0JBQU8sSUFBSSxFQUFDOzs7O0tBQ2Y7Ozs7OztJQUVLLDRDQUFxQjs7Ozs7SUFBM0IsVUFBNkIsUUFBUSxFQUFFLE9BQU87Ozs7OzRCQUM3QixxQkFBTSxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxFQUFBOzt3QkFBekQsSUFBSSxHQUFHLFNBQWtEO3dCQUMvRCxxQkFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFBOzt3QkFBNUMsU0FBNEMsQ0FBQzt3QkFDN0MscUJBQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBQTs7d0JBQS9DLFNBQStDLENBQUM7d0JBQ2hELHNCQUFPLElBQUksRUFBQzs7OztLQUNmOzs7Ozs7SUFFSyw4QkFBTzs7Ozs7SUFBYixVQUFjLE1BQU0sRUFBRSxPQUFPOzs7Ozs7d0JBQ25CLElBQUksR0FBRyxHQUFHLEdBQUcsT0FBTyxHQUFHLGtCQUFrQixHQUFHLE1BQU07d0JBQ2xELE1BQU0sR0FBRyxLQUFLO3dCQUVkLFdBQVcsR0FBRyxFQUFFO3dCQUFFLFFBQVEsR0FBRyxFQUFFO3dCQUV4QixxQkFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxFQUFBOzt3QkFBOUUsSUFBSSxHQUFHLFNBQXVFO3dCQUNwRixzQkFBTyxJQUFJLEVBQUM7Ozs7S0FDZjs7Ozs7O0lBRUssZ0NBQVM7Ozs7O0lBQWYsVUFBZ0IsUUFBUSxFQUFFLE9BQU87Ozs7Ozt3QkFDdkIsSUFBSSxHQUFHLEdBQUcsR0FBRyxPQUFPLEdBQUcsaUJBQWlCO3dCQUN4QyxNQUFNLEdBQUcsS0FBSzt3QkFFZCxXQUFXLEdBQUcsRUFBQyxJQUFJLEVBQUUsUUFBUSxFQUFDO3dCQUFFLFFBQVEsR0FBRyxFQUFFO3dCQUV0QyxxQkFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxFQUFBOzt3QkFBOUUsSUFBSSxHQUFHLFNBQXVFO3dCQUNwRixzQkFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFDOzs7O0tBQ3hDOzs7Ozs7O0lBRUssOENBQXVCOzs7Ozs7SUFBN0IsVUFBOEIsWUFBWSxFQUFFLE9BQU8sRUFBRSxJQUFJOzs7Ozs7d0JBQy9DLElBQUksR0FBRyxHQUFHLEdBQUcsT0FBTyxHQUFHLGNBQWM7d0JBQ3JDLE1BQU0sR0FBRyxNQUFNO3dCQUVmLFdBQVcsR0FBRyxFQUFFO3dCQUFFLFFBQVEsR0FBRyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsbUJBQW1CLEVBQUM7d0JBRXRHLHFCQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLEVBQUE7O3dCQUE5RSxJQUFJLEdBQUcsU0FBdUU7d0JBQ3BGLHNCQUFPLElBQUksRUFBQzs7OztLQUNmO0lBRUwsbUJBQUM7QUFBRCxDQUFDLEFBekZELElBeUZDOzs7O0lBdkZHLDJCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFwaVNlcnZpY2UgfSBmcm9tICcuLi9hcGkuc2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBUYXNrc1NlcnZpY2Uge1xuXG4gICAgYXBpOiBBcGlTZXJ2aWNlO1xuXG4gICAgY29uc3RydWN0b3IoYXBpOiBBcGlTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuYXBpID0gYXBpO1xuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZVN0YW5kYWxvbmVUYXNrKHRhc2tOYW1lLCBhcHBOYW1lLCBvcHRpb25zPykge1xuICAgICAgICBjb25zdCBwYXRoID0gJy8nICsgYXBwTmFtZSArICcvcmIvdjEvdGFza3MnO1xuICAgICAgICBjb25zdCBtZXRob2QgPSAnUE9TVCc7XG5cbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7fSwgcG9zdEJvZHkgPSB7XG4gICAgICAgICAgICAnbmFtZSc6IHRhc2tOYW1lLFxuICAgICAgICAgICAgJ3BheWxvYWRUeXBlJzogJ0NyZWF0ZVRhc2tQYXlsb2FkJyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hcGkucGVyZm9ybUJwbU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIGFzeW5jIGNvbXBsZXRlVGFzayh0YXNrSWQsIGFwcE5hbWUpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9ICcvJyArIGFwcE5hbWUgKyAnL3JiL3YxL3Rhc2tzLycgKyB0YXNrSWQgKyAnL2NvbXBsZXRlJztcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ1BPU1QnO1xuXG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0ge30sIHBvc3RCb2R5ID0geydwYXlsb2FkVHlwZSc6ICdDb21wbGV0ZVRhc2tQYXlsb2FkJ307XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1CcG1PcGVyYXRpb24ocGF0aCwgbWV0aG9kLCBxdWVyeVBhcmFtcywgcG9zdEJvZHkpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBjbGFpbVRhc2sodGFza0lkLCBhcHBOYW1lKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSAnLycgKyBhcHBOYW1lICsgJy9yYi92MS90YXNrcy8nICsgdGFza0lkICsgJy9jbGFpbSc7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9ICdQT1NUJztcblxuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHt9LCBwb3N0Qm9keSA9IHt9O1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwaS5wZXJmb3JtQnBtT3BlcmF0aW9uKHBhdGgsIG1ldGhvZCwgcXVlcnlQYXJhbXMsIHBvc3RCb2R5KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgYXN5bmMgZGVsZXRlVGFzayh0YXNrSWQsIGFwcE5hbWUpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9ICcvJyArIGFwcE5hbWUgKyAnL3JiL3YxL3Rhc2tzLycgKyB0YXNrSWQ7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9ICdERUxFVEUnO1xuXG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0ge30sIHBvc3RCb2R5ID0ge307XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1CcG1PcGVyYXRpb24ocGF0aCwgbWV0aG9kLCBxdWVyeVBhcmFtcywgcG9zdEJvZHkpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGVBbmRDb21wbGV0ZVRhc2sgKHRhc2tOYW1lLCBhcHBOYW1lKSB7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBhd2FpdCB0aGlzLmNyZWF0ZVN0YW5kYWxvbmVUYXNrKHRhc2tOYW1lLCBhcHBOYW1lKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGFpbVRhc2sodGFzay5lbnRyeS5pZCwgYXBwTmFtZSk7XG4gICAgICAgIGF3YWl0IHRoaXMuY29tcGxldGVUYXNrKHRhc2suZW50cnkuaWQsIGFwcE5hbWUpO1xuICAgICAgICByZXR1cm4gdGFzaztcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUYXNrKHRhc2tJZCwgYXBwTmFtZSkge1xuICAgICAgICBjb25zdCBwYXRoID0gJy8nICsgYXBwTmFtZSArICcvcXVlcnkvdjEvdGFza3MvJyArIHRhc2tJZDtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ0dFVCc7XG5cbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7fSwgcG9zdEJvZHkgPSB7fTtcblxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hcGkucGVyZm9ybUJwbU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFRhc2tJZCh0YXNrTmFtZSwgYXBwTmFtZSkge1xuICAgICAgICBjb25zdCBwYXRoID0gJy8nICsgYXBwTmFtZSArICcvcXVlcnkvdjEvdGFza3MnO1xuICAgICAgICBjb25zdCBtZXRob2QgPSAnR0VUJztcblxuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHtuYW1lOiB0YXNrTmFtZX0sIHBvc3RCb2R5ID0ge307XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1CcG1PcGVyYXRpb24ocGF0aCwgbWV0aG9kLCBxdWVyeVBhcmFtcywgcG9zdEJvZHkpO1xuICAgICAgICByZXR1cm4gZGF0YS5saXN0LmVudHJpZXNbMF0uZW50cnkuaWQ7XG4gICAgfVxuXG4gICAgYXN5bmMgY3JlYXRlU3RhbmRhbG9uZVN1YnRhc2socGFyZW50VGFza0lkLCBhcHBOYW1lLCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSAnLycgKyBhcHBOYW1lICsgJy9yYi92MS90YXNrcyc7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9ICdQT1NUJztcblxuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHt9LCBwb3N0Qm9keSA9IHsnbmFtZSc6IG5hbWUsICdwYXJlbnRUYXNrSWQnOiBwYXJlbnRUYXNrSWQsICdwYXlsb2FkVHlwZSc6ICdDcmVhdGVUYXNrUGF5bG9hZCd9O1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwaS5wZXJmb3JtQnBtT3BlcmF0aW9uKHBhdGgsIG1ldGhvZCwgcXVlcnlQYXJhbXMsIHBvc3RCb2R5KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG59XG4iXX0=