/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { UserModel } from '../../models/user.model';
export class IdentityService {
    /**
     * @param {?} api
     */
    constructor(api) {
        this.api = api;
    }
    /**
     * @param {?=} user
     * @return {?}
     */
    createIdentityUser(user = new UserModel()) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.createUser(user);
            /** @type {?} */
            const userIdentity = yield this.getUserInfoByUsername(user.username);
            yield this.resetPassword(userIdentity.id, user.password);
            user.idIdentityService = userIdentity.id;
            return user;
        });
    }
    /**
     * @param {?} user
     * @return {?}
     */
    createIdentityUserAndSyncECMBPM(user) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (this.api.config.provider === 'ECM' || this.api.config.provider === 'ALL') {
                /** @type {?} */
                const createUser = (/** @type {?} */ ({
                    firstName: user.firstName,
                    lastName: user.lastName,
                    password: user.password,
                    email: user.email,
                    id: user.email
                }));
                yield this.api.apiService.core.peopleApi.addPerson(createUser);
            }
            if (this.api.config.provider === 'BPM' || this.api.config.provider === 'ALL') {
                yield this.api.apiService.activiti.adminUsersApi.createNewUser({
                    email: user.email,
                    firstName: user.firstName,
                    lastName: user.lastName,
                    password: user.password,
                    type: 'enterprise',
                    tenantId: 1,
                    company: null
                });
            }
            yield this.createIdentityUser(user);
        });
    }
    /**
     * @param {?} userId
     * @return {?}
     */
    deleteIdentityUser(userId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.deleteUser(userId);
        });
    }
    /**
     * @param {?} user
     * @return {?}
     */
    createUser(user) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = '/users';
            /** @type {?} */
            const method = 'POST';
            /** @type {?} */
            const queryParams = {};
            /** @type {?} */
            const postBody = {
                'username': user.username,
                'firstName': user.firstName,
                'lastName': user.lastName,
                'enabled': true,
                'email': user.email
            };
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data;
        });
    }
    /**
     * @param {?} userId
     * @return {?}
     */
    deleteUser(userId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = `/users/${userId}`;
            /** @type {?} */
            const method = 'DELETE';
            /** @type {?} */
            const queryParams = {};
            /** @type {?} */
            const postBody = {};
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data;
        });
    }
    /**
     * @param {?} username
     * @return {?}
     */
    getUserInfoByUsername(username) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = `/users`;
            /** @type {?} */
            const method = 'GET';
            /** @type {?} */
            const queryParams = { 'username': username };
            /** @type {?} */
            const postBody = {};
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data[0];
        });
    }
    /**
     * @param {?} id
     * @param {?} password
     * @return {?}
     */
    resetPassword(id, password) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = `/users/${id}/reset-password`;
            /** @type {?} */
            const method = 'PUT';
            /** @type {?} */
            const queryParams = {};
            /** @type {?} */
            const postBody = { 'type': 'password', 'value': password, 'temporary': false };
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data;
        });
    }
    /**
     * @param {?} userId
     * @param {?} roleId
     * @param {?} roleName
     * @return {?}
     */
    assignRole(userId, roleId, roleName) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = `/users/${userId}/role-mappings/realm`;
            /** @type {?} */
            const method = 'POST';
            /** @type {?} */
            const queryParams = {};
            /** @type {?} */
            const postBody = [{ 'id': roleId, 'name': roleName }];
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data;
        });
    }
    /**
     * @param {?} userId
     * @param {?} clientId
     * @param {?} roleId
     * @param {?} roleName
     * @return {?}
     */
    deleteClientRole(userId, clientId, roleId, roleName) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const path = `/users/${userId}/role-mappings/clients/${clientId}`;
            /** @type {?} */
            const method = 'DELETE';
            /** @type {?} */
            const queryParams = {};
            /** @type {?} */
            const postBody = [{
                    'id': roleId,
                    'name': roleName,
                    'composite': false,
                    'clientRole': true,
                    'containerId': clientId
                }];
            /** @type {?} */
            const data = yield this.api.performIdentityOperation(path, method, queryParams, postBody);
            return data;
        });
    }
}
if (false) {
    /** @type {?} */
    IdentityService.prototype.api;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpdHkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtdGVzdGluZy8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL2FjdGlvbnMvaWRlbnRpdHkvaWRlbnRpdHkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQkEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBR3BELE1BQU0sT0FBTyxlQUFlOzs7O0lBSXhCLFlBQVksR0FBZTtRQUN2QixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUNuQixDQUFDOzs7OztJQUVLLGtCQUFrQixDQUFDLE9BQWtCLElBQUksU0FBUyxFQUFFOztZQUN0RCxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7O2tCQUV0QixZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNwRSxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDekMsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztLQUFBOzs7OztJQUVLLCtCQUErQixDQUFDLElBQWU7O1lBQ2pELElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxLQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssS0FBSyxFQUFFOztzQkFDcEUsVUFBVSxHQUFxQixtQkFBbUI7b0JBQ3BELFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztvQkFDekIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO29CQUN2QixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7b0JBQ3ZC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Q3pGLE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7S0FBQTtDQUVKOzs7SUEvR0csOEJBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQXBpU2VydmljZSB9IGZyb20gJy4uL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJNb2RlbCB9IGZyb20gJy4uLy4uL21vZGVscy91c2VyLm1vZGVsJztcbmltcG9ydCB7IFBlcnNvbkJvZHlDcmVhdGUgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcblxuZXhwb3J0IGNsYXNzIElkZW50aXR5U2VydmljZSB7XG5cbiAgICBhcGk6IEFwaVNlcnZpY2U7XG5cbiAgICBjb25zdHJ1Y3RvcihhcGk6IEFwaVNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5hcGkgPSBhcGk7XG4gICAgfVxuXG4gICAgYXN5bmMgY3JlYXRlSWRlbnRpdHlVc2VyKHVzZXI6IFVzZXJNb2RlbCA9IG5ldyBVc2VyTW9kZWwoKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVVzZXIodXNlcik7XG5cbiAgICAgICAgY29uc3QgdXNlcklkZW50aXR5ID0gYXdhaXQgdGhpcy5nZXRVc2VySW5mb0J5VXNlcm5hbWUodXNlci51c2VybmFtZSk7XG4gICAgICAgIGF3YWl0IHRoaXMucmVzZXRQYXNzd29yZCh1c2VySWRlbnRpdHkuaWQsIHVzZXIucGFzc3dvcmQpO1xuICAgICAgICB1c2VyLmlkSWRlbnRpdHlTZXJ2aWNlID0gdXNlcklkZW50aXR5LmlkO1xuICAgICAgICByZXR1cm4gdXNlcjtcbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGVJZGVudGl0eVVzZXJBbmRTeW5jRUNNQlBNKHVzZXI6IFVzZXJNb2RlbCkge1xuICAgICAgICBpZiAodGhpcy5hcGkuY29uZmlnLnByb3ZpZGVyID09PSAnRUNNJyB8fCB0aGlzLmFwaS5jb25maWcucHJvdmlkZXIgPT09ICdBTEwnKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVVc2VyOiBQZXJzb25Cb2R5Q3JlYXRlID0gPFBlcnNvbkJvZHlDcmVhdGU+IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB1c2VyLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgICAgIGlkOiB1c2VyLmVtYWlsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hcGkuYXBpU2VydmljZS5jb3JlLnBlb3BsZUFwaS5hZGRQZXJzb24oY3JlYXRlVXNlcik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hcGkuY29uZmlnLnByb3ZpZGVyID09PSAnQlBNJyB8fCB0aGlzLmFwaS5jb25maWcucHJvdmlkZXIgPT09ICdBTEwnKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwaS5hcGlTZXJ2aWNlLmFjdGl2aXRpLmFkbWluVXNlcnNBcGkuY3JlYXRlTmV3VXNlcih7XG4gICAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdXNlci5sYXN0TmFtZSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogdXNlci5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnZW50ZXJwcmlzZScsXG4gICAgICAgICAgICAgICAgdGVuYW50SWQ6IDEsXG4gICAgICAgICAgICAgICAgY29tcGFueTogbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUlkZW50aXR5VXNlcih1c2VyKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVJZGVudGl0eVVzZXIodXNlcklkKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsZXRlVXNlcih1c2VySWQpO1xuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZVVzZXIodXNlcjogVXNlck1vZGVsKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSAnL3VzZXJzJztcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ1BPU1QnO1xuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHt9LCBwb3N0Qm9keSA9IHtcbiAgICAgICAgICAgICd1c2VybmFtZSc6IHVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgICAnZmlyc3ROYW1lJzogdXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgICAnbGFzdE5hbWUnOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgICAgICAgJ2VuYWJsZWQnOiB0cnVlLFxuICAgICAgICAgICAgJ2VtYWlsJzogdXNlci5lbWFpbFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hcGkucGVyZm9ybUlkZW50aXR5T3BlcmF0aW9uKHBhdGgsIG1ldGhvZCwgcXVlcnlQYXJhbXMsIHBvc3RCb2R5KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgYXN5bmMgZGVsZXRlVXNlcih1c2VySWQpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IGAvdXNlcnMvJHt1c2VySWR9YDtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ0RFTEVURSc7XG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0ge30sIHBvc3RCb2R5ID0ge307XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmFwaS5wZXJmb3JtSWRlbnRpdHlPcGVyYXRpb24ocGF0aCwgbWV0aG9kLCBxdWVyeVBhcmFtcywgcG9zdEJvZHkpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRVc2VySW5mb0J5VXNlcm5hbWUodXNlcm5hbWUpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IGAvdXNlcnNgO1xuICAgICAgICBjb25zdCBtZXRob2QgPSAnR0VUJztcbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7ICd1c2VybmFtZSc6IHVzZXJuYW1lIH0sIHBvc3RCb2R5ID0ge307XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1JZGVudGl0eU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhWzBdO1xuICAgIH1cblxuICAgIGFzeW5jIHJlc2V0UGFzc3dvcmQoaWQsIHBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBgL3VzZXJzLyR7aWR9L3Jlc2V0LXBhc3N3b3JkYDtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ1BVVCc7XG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0ge30sXG4gICAgICAgICAgICBwb3N0Qm9keSA9IHsgJ3R5cGUnOiAncGFzc3dvcmQnLCAndmFsdWUnOiBwYXNzd29yZCwgJ3RlbXBvcmFyeSc6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1JZGVudGl0eU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIGFzeW5jIGFzc2lnblJvbGUodXNlcklkLCByb2xlSWQsIHJvbGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBgL3VzZXJzLyR7dXNlcklkfS9yb2xlLW1hcHBpbmdzL3JlYWxtYDtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gJ1BPU1QnO1xuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHt9LFxuICAgICAgICAgICAgcG9zdEJvZHkgPSBbeyAnaWQnOiByb2xlSWQsICduYW1lJzogcm9sZU5hbWUgfV07XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1JZGVudGl0eU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbGV0ZUNsaWVudFJvbGUodXNlcklkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcsIHJvbGVJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBgL3VzZXJzLyR7dXNlcklkfS9yb2xlLW1hcHBpbmdzL2NsaWVudHMvJHtjbGllbnRJZH1gO1xuICAgICAgICBjb25zdCBtZXRob2QgPSAnREVMRVRFJywgcXVlcnlQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIHBvc3RCb2R5ID0gW3tcbiAgICAgICAgICAgICAgICAnaWQnOiByb2xlSWQsXG4gICAgICAgICAgICAgICAgJ25hbWUnOiByb2xlTmFtZSxcbiAgICAgICAgICAgICAgICAnY29tcG9zaXRlJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ2NsaWVudFJvbGUnOiB0cnVlLFxuICAgICAgICAgICAgICAgICdjb250YWluZXJJZCc6IGNsaWVudElkXG4gICAgICAgICAgICB9XTtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXBpLnBlcmZvcm1JZGVudGl0eU9wZXJhdGlvbihwYXRoLCBtZXRob2QsIHF1ZXJ5UGFyYW1zLCBwb3N0Qm9keSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxufVxuIl19