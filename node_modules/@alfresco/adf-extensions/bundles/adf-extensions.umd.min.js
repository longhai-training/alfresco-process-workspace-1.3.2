!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common/http"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("@alfresco/adf-extensions",["exports","@angular/common/http","@angular/core","rxjs"],e):e((t.alfresco=t.alfresco||{},t.alfresco["adf-extensions"]={}),t.ng.common.http,t.ng.core,t.rxjs)}(this,function(t,e,n,o){"use strict";var a=function(){return(a=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function r(e,s,a,c){return new(a||(a=Promise))(function(t,n){function o(t){try{i(c.next(t))}catch(e){n(e)}}function r(t){try{i(c["throw"](t))}catch(e){n(e)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(o,r)}i((c=c.apply(e,s||[])).next())})}function i(o,r){var i,s,a,t,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function n(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,s&&(a=2&t[0]?s["return"]:t[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,s=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(o,c)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(o=i.next()).done;)s.push(o.value)}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(r)throw r.error}}return s}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}
/*!
     * @license
     * Copyright 2019 Alfresco Software, Ltd.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var u={"default":"default",button:"button",separator:"separator",menu:"menu",custom:"custom"};function p(t,e){if(!t)return undefined;var n=e.split(".");e="";do{var o=t[e+=n.shift()];o===undefined||"object"!=typeof o&&n.length?n.length?e+=".":t=undefined:(t=o,e="")}while(n.length);return t}function f(t){return!t.disabled}function l(t,e){return(t.order===undefined?Number.MAX_SAFE_INTEGER:t.order)-(e.order===undefined?Number.MAX_SAFE_INTEGER:e.order)}function d(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n={};return t.forEach(function(e){Object.keys(e).forEach(function(t){t.startsWith("$")||(t in n&&Array.isArray(n[t])?n[t]=h(n[t],e[t]):t in n&&"object"==typeof n[t]?n[t]=d(n[t],e[t]):n[t]=e[t])})}),n}function h(t,e){var o=[],r={};return(t||[]).forEach(function(t){var e=t;e&&e.hasOwnProperty("id")?r[e.id]=e:o.push(e)}),(e||[]).forEach(function(t){var e=t;if(e&&e.hasOwnProperty("id")&&r[e.id]){var n=d(r[e.id],e);r[e.id]=n}else o.push(e)}),Object.keys(r).map(function(t){return r[t]}).concat(o)}var y=function(){function t(t){this.http=t}return t.prototype.load=function(t,i){var s=this;return new Promise(function(r){s.loadConfig(t,0).then(function(n){if(n){var o=n.config,t=sessionStorage.getItem("app.extension.config");if(t&&(o=JSON.parse(t)),o.$references&&0<o.$references.length){var e=o.$references.map(function(t,e){return s.loadConfig(i+"/"+t,e)});Promise.all(e).then(function(t){var e=t.filter(function(t){return t}).sort(l).map(function(t){return t.config});0<e.length&&(o=d.apply(void 0,c([o],e))),o=a({},o,s.getMetadata(n.config),{$references:e.map(function(t){return s.getMetadata(t)})}),r(o)})}else r(o)}})})},t.prototype.getMetadata=function(e){var n={};return Object.keys(e).filter(function(t){return t.startsWith("$")}).forEach(function(t){n[t]=e[t]}),n},t.prototype.loadConfig=function(t,n){var o=this;return new Promise(function(e){o.http.get(t).subscribe(function(t){e({order:n,config:t})},function(){e(null)})})},t.prototype.getElements=function(t,e,n){return void 0===n&&(n=[]),(p(t,e)||n||[]).filter(f).sort(l)},t.prototype.getContentActions=function(t,e){return this.getElements(t,e).map(this.setActionDefaults)},t.prototype.getRules=function(t){return t&&t.rules?t.rules:[]},t.prototype.getRoutes=function(t){return t&&t.routes||[]},t.prototype.getActions=function(t){return t&&t.actions||[]},t.prototype.getFeatures=function(t){return t&&t.features||[]},t.prototype.setActionDefaults=function(t){return t&&(t.type=t.type||u["default"],t.icon=t.icon||"extension"),t},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:e.HttpClient}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(e.HttpClient))},token:t,providedIn:"root"}),t}();
/*!
     * @license
     * Copyright 2019 Alfresco Software, Ltd.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function m(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return!(!t||0===t.length)&&t.every(function(t){var e=n.getEvaluator(t.value);return e?!e.apply(void 0,c([n],t.parameters||[])):(console.warn("evaluator not found: "+t.value),!1)})}function v(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return!(!t||0===t.length)&&t.every(function(t){var e=n.getEvaluator(t.value);return e?e.apply(void 0,c([n],t.parameters||[])):(console.warn("evaluator not found: "+t.value),!1)})}function g(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return!(!t||0===t.length)&&t.some(function(t){var e=n.getEvaluator(t.value);return e?e.apply(void 0,c([n],t.parameters||[])):(console.warn("evaluator not found: "+t.value),!1)})}var I=function(){function t(){this.components={}}return t.prototype.setComponents=function(t){t&&(this.components=Object.assign({},this.components,t))},t.prototype.getComponentById=function(t){return this.components[t]},t.prototype.hasComponentById=function(t){return!!this.getComponentById(t)},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),R=function(){function t(t){this.loader=t,this.context=null,this.rules=[],this.evaluators={}}return t.prototype.setup=function(t){this.rules=this.loader.getRules(t)},t.prototype.setEvaluators=function(t){t&&(this.evaluators=Object.assign({},this.evaluators,t))},t.prototype.getRuleById=function(e){return this.rules.find(function(t){return t.id===e})},t.prototype.getEvaluator=function(t){if(t&&t.startsWith("!")){var o=this.evaluators[t.substring(1)];return function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return!o.apply(void 0,c([t],e))}}return this.evaluators[t]},t.prototype.evaluateRule=function(t,e){var n,o=this.getRuleById(t);if(e=e||this.context,o){if(n=this.getEvaluator(o.type))return n.apply(void 0,c([e],o.parameters))}else if(n=this.getEvaluator(t))return n(e);return!1},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:y}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(y))},token:t,providedIn:"root"}),t}(),b=function(){function t(t,e,n){this.loader=t,this.componentRegister=e,this.ruleService=n,this.config=null,this.configPath="assets/app.extensions.json",this.pluginsPath="assets/plugins",this.routes=[],this.actions=[],this.features=[],this.authGuards={}}return t.prototype.load=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.loader.load(this.configPath,this.pluginsPath)];case 1:return e=t.sent(),this.setup(e),[2,e]}})})},t.prototype.setup=function(t){t?(this.config=t,this.setEvaluators({"core.every":v,"core.some":g,"core.not":m}),this.actions=this.loader.getActions(t),this.routes=this.loader.getRoutes(t),this.features=this.loader.getFeatures(t),this.ruleService.setup(t)):console.warn("Extension configuration not found")},t.prototype.getFeature=function(t){return(Array.isArray(t)?[t]:t.split(".")).reduce(function(t,e){return t&&t[e]},this.features)||[]},t.prototype.getElements=function(t,e){return void 0===e&&(e=[]),this.loader.getElements(this.config,t,e)},t.prototype.setEvaluators=function(t){this.ruleService.setEvaluators(t)},t.prototype.setAuthGuards=function(t){t&&(this.authGuards=Object.assign({},this.authGuards,t))},t.prototype.setComponents=function(t){this.componentRegister.setComponents(t)},t.prototype.getRouteById=function(e){return this.routes.find(function(t){return t.id===e})},t.prototype.getAuthGuards=function(t){var e=this;return(t||[]).map(function(t){return e.authGuards[t]}).filter(function(t){return t})},t.prototype.getActionById=function(e){return this.actions.find(function(t){return t.id===e})},t.prototype.getEvaluator=function(t){return this.ruleService.getEvaluator(t)},t.prototype.evaluateRule=function(t,e){return this.ruleService.evaluateRule(t,e)},t.prototype.getComponentById=function(t){return this.componentRegister.getComponentById(t)},t.prototype.getRuleById=function(t){return this.ruleService.getRuleById(t)},t.prototype.runExpression=function(t,e){var n=new RegExp(/\$\((.*\)?)\)/g).exec(t);if(n&&1<n.length){var o=n[1];return new Function("context","return "+o)(e)}return t},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:y},{type:I},{type:R}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(y),n.inject(I),n.inject(R))},token:t,providedIn:"root"}),t}(),C=function(){function t(t,e){this.extensions=t,this.componentFactoryResolver=e,this.loaded=!1}return t.prototype.ngOnChanges=function(t){this.loaded||(this.loadComponent(),this.loaded=!0),t.data&&(this.data=t.data.currentValue),this.updateInstance(),this.proxy("ngOnChanges",t)},t.prototype.loadComponent=function(){var t=this.extensions.getComponentById(this.id);if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t);e&&(this.content.clear(),this.componentRef=this.content.createComponent(e,0))}},t.prototype.ngOnDestroy=function(){this.componentCreated()&&(this.componentRef.destroy(),this.componentRef=null)},t.prototype.updateInstance=function(){this.componentCreated()&&(this.componentRef.instance.data=this.data)},t.prototype.proxy=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.componentCreated()&&this.lifecycleHookIsImplemented(t)&&this.componentRef.instance[t].apply(this.componentRef.instance,e)},t.prototype.componentCreated=function(){return!!this.componentRef&&!!this.componentRef.instance},t.prototype.lifecycleHookIsImplemented=function(t){return!!this.componentRef.instance[t]},t.decorators=[{type:n.Component,args:[{selector:"adf-dynamic-component",template:"<div #content></div>"}]}],t.ctorParameters=function(){return[{type:b},{type:n.ComponentFactoryResolver}]},t.propDecorators={content:[{type:n.ViewChild,args:["content",{read:n.ViewContainerRef}]}],id:[{type:n.Input}],data:[{type:n.Input}]},t}(),x=function(){function t(t,e){this.extensions=t,this.componentFactoryResolver=e}return t.prototype.ngOnInit=function(){var t=this.extensions.getComponentById(this.id);if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t);e&&(this.content.clear(),this.componentRef=this.content.createComponent(e,0),this.updateInstance())}},t.prototype.ngOnChanges=function(t){t.node&&this.updateInstance()},t.prototype.ngOnDestroy=function(){this.componentRef&&(this.componentRef.destroy(),this.componentRef=null)},t.prototype.updateInstance=function(){this.componentRef&&this.componentRef.instance&&(this.componentRef.instance.node=this.node)},t.decorators=[{type:n.Component,args:[{selector:"adf-dynamic-tab",template:"<div #content></div>"}]}],t.ctorParameters=function(){return[{type:b},{type:n.ComponentFactoryResolver}]},t.propDecorators={content:[{type:n.ViewChild,args:["content",{read:n.ViewContainerRef}]}],id:[{type:n.Input}],node:[{type:n.Input}]},t}(),w=function(){function t(t,e){this.extensions=t,this.componentFactoryResolver=e}return t.prototype.ngOnInit=function(){var t=this.extensions.getComponentById(this.id);if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t);e&&(this.content.clear(),this.componentRef=this.content.createComponent(e,0),this.updateInstance())}},t.prototype.ngOnChanges=function(t){t.node&&this.updateInstance()},t.prototype.ngOnDestroy=function(){this.componentRef&&(this.componentRef.destroy(),this.componentRef=null)},t.prototype.updateInstance=function(){this.componentRef&&this.componentRef.instance&&(this.componentRef.instance.context=this.context)},t.decorators=[{type:n.Component,args:[{selector:"adf-dynamic-column",template:"\n    <ng-container #content></ng-container>\n  ",encapsulation:n.ViewEncapsulation.None,changeDetection:n.ChangeDetectionStrategy.OnPush,host:{"class":"adf-dynamic-column"},styles:["\n      .adf-dynamic-column {\n        display: flex;\n        align-items: center;\n      }\n    "]}]}],t.ctorParameters=function(){return[{type:b},{type:n.ComponentFactoryResolver}]},t.propDecorators={content:[{type:n.ViewChild,args:["content",{read:n.ViewContainerRef}]}],id:[{type:n.Input}],context:[{type:n.Input}]},t}(),E=function(){function t(t,e){this.extensionService=t,this.componentFactoryResolver=e}return t.prototype.ngOnInit=function(){if(this.id){var t=this.extensionService.getComponentById(this.id);if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t);e&&(this.content.clear(),this.componentRef=this.content.createComponent(e,0),this.updateInstance())}}},t.prototype.ngOnChanges=function(){this.updateInstance()},t.prototype.ngOnDestroy=function(){this.componentRef&&(this.componentRef.destroy(),this.componentRef=null)},t.prototype.updateInstance=function(){if(this.componentRef&&this.componentRef.instance){var t=this.componentRef.instance;t.node=this.node,t.url=this.url,t.extension=this.extension}},t.decorators=[{type:n.Component,args:[{selector:"adf-preview-extension",template:"\n    <div #content></div>\n  "}]}],t.ctorParameters=function(){return[{type:b},{type:n.ComponentFactoryResolver}]},t.propDecorators={content:[{type:n.ViewChild,args:["content",{read:n.ViewContainerRef}]}],id:[{type:n.Input}],url:[{type:n.Input}],extension:[{type:n.Input}],node:[{type:n.Input}]},t}(),j=function(){function t(t){this.extensionService=t,this._references=new o.BehaviorSubject([]),this.references$=this._references.asObservable()}return t.prototype.load=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.extensionService.load()];case 1:return e=t.sent(),this.setup(e),[2]}})})},t.prototype.setup=function(t){if(t){var e=(t.$references||[]).filter(function(t){return"object"==typeof t}).map(function(t){return t});this._references.next(e)}},t.prototype.getDocumentListPreset=function(t){return this.extensionService.getElements("features.documentList."+t).filter(function(t){return!t.disabled})},t.prototype.getViewerExtensions=function(){var e=this;return this.extensionService.getElements("features.viewer.content").filter(function(t){return!e.isViewerExtensionDisabled(t)})},t.prototype.isViewerExtensionDisabled=function(t){if(t){if(t.disabled)return!0;if(t.rules&&t.rules.disabled)return this.extensionService.evaluateRule(t.rules.disabled)}return!1},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:b}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(b))},token:t,providedIn:"root"}),t}();
/*!
     * @license
     * Copyright 2019 Alfresco Software, Ltd.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function O(t){return function(){return t.load()}}var S=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:n.APP_INITIALIZER,useFactory:O,deps:[j],multi:!0}]}},t.forChild=function(){return{ngModule:t}},t.decorators=[{type:n.NgModule,args:[{declarations:[C,x,w,E],exports:[C,x,w,E]}]}],t}(),P=function D(){};t.ExtensionsModule=S,t.ContentActionType=u,t.getValue=p,t.filterEnabled=f,t.sortByOrder=l,t.reduceSeparators=function F(t,e,n,o){if(0===n&&o[n].type===u.separator)return t;if(0<n){if(o[n-1].type===u.separator&&e.type===u.separator)return t;if(n===o.length-1&&e.type===u.separator)return t}return t.concat(e)},t.reduceEmptyMenus=function A(t,e){return e.type===u.menu&&0===(e.children||[]).length?t:t.concat(e)},t.mergeObjects=d,t.mergeArrays=h,t.RuleRef=P,t.ExtensionLoaderService=y,t.ExtensionService=b,t.ComponentRegisterService=I,t.AppExtensionService=j,t.PreviewExtensionComponent=E,t.DynamicColumnComponent=w,t.DynamicExtensionComponent=C,t.DynamicTabComponent=x,t.ɵa=R,t.ɵb=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=adf-extensions.umd.min.js.map