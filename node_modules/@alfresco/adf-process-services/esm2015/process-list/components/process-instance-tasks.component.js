/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material';
import { Observable } from 'rxjs';
import { TaskDetailsEvent } from '../../task-list';
import { ProcessInstance } from '../models/process-instance.model';
import { ProcessService } from './../services/process.service';
import { share } from 'rxjs/operators';
export class ProcessInstanceTasksComponent {
    /**
     * @param {?} activitiProcess
     * @param {?} logService
     * @param {?} dialog
     */
    constructor(activitiProcess, logService, dialog) {
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.dialog = dialog;
        /**
         * Toggles whether to show a refresh button next to the list of tasks to allow
         * it to be updated from the server.
         */
        this.showRefreshButton = true;
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.activeTasks = [];
        this.completedTasks = [];
        /**
         * Emitted when a task is clicked.
         */
        this.taskClick = new EventEmitter();
        this.task$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => this.taskObserver = observer))
            .pipe(share());
        this.completedTask$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => this.completedTaskObserver = observer))
            .pipe(share());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.task$.subscribe((/**
         * @param {?} task
         * @return {?}
         */
        (task) => {
            this.activeTasks.push(task);
        }));
        this.completedTask$.subscribe((/**
         * @param {?} task
         * @return {?}
         */
        (task) => {
            this.completedTasks.push(task);
        }));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const processInstanceDetails = changes['processInstanceDetails'];
        if (processInstanceDetails && processInstanceDetails.currentValue) {
            this.load(processInstanceDetails.currentValue.id);
        }
    }
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    load(processInstanceId) {
        this.loadActive(processInstanceId);
        this.loadCompleted(processInstanceId);
    }
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    loadActive(processInstanceId) {
        this.activeTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, null).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                res.forEach((/**
                 * @param {?} task
                 * @return {?}
                 */
                (task) => {
                    this.taskObserver.next(task);
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.error.emit(err);
            }));
        }
        else {
            this.activeTasks = [];
        }
    }
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    loadCompleted(processInstanceId) {
        this.completedTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, 'completed').subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                res.forEach((/**
                 * @param {?} task
                 * @return {?}
                 */
                (task) => {
                    this.completedTaskObserver.next(task);
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                this.error.emit(err);
            }));
        }
        else {
            this.completedTasks = [];
        }
    }
    /**
     * @return {?}
     */
    hasStartFormDefined() {
        return this.processInstanceDetails && this.processInstanceDetails.startFormDefined === true;
    }
    /**
     * @param {?} user
     * @return {?}
     */
    getUserFullName(user) {
        if (user) {
            return (user.firstName && user.firstName !== 'null'
                ? user.firstName + ' ' : '') +
                user.lastName;
        }
        return 'Nobody';
    }
    /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    getFormatDate(value, format) {
        /** @type {?} */
        const datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error(`ProcessListInstanceTask: error parsing date ${value} to format ${format}`);
        }
    }
    /**
     * @param {?} $event
     * @param {?} task
     * @return {?}
     */
    clickTask($event, task) {
        /** @type {?} */
        const args = new TaskDetailsEvent(task);
        this.taskClick.emit(args);
    }
    /**
     * @return {?}
     */
    clickStartTask() {
        this.processId = this.processInstanceDetails.id;
        this.showStartDialog();
    }
    /**
     * @return {?}
     */
    showStartDialog() {
        this.dialog.open(this.startDialog, { height: '500px', width: '700px' });
    }
    /**
     * @return {?}
     */
    closeStartDialog() {
        this.dialog.closeAll();
    }
    /**
     * @return {?}
     */
    onRefreshClicked() {
        this.load(this.processInstanceDetails.id);
    }
    /**
     * @return {?}
     */
    onFormContentClick() {
        this.closeStartDialog();
    }
}
ProcessInstanceTasksComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-process-instance-tasks',
                template: "<div  *ngIf=\"showRefreshButton\" class=\"process-tasks-refresh\" >\n    <button mat-icon-button (click)=\"onRefreshClicked()\">\n        <mat-icon class=\"md-24\" aria-label=\"Refresh\">refresh</mat-icon>\n    </button>\n</div>\n\n<!-- ACTIVE FORM -->\n\n<mat-chip-list>\n    <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_ACTIVE'|translate }}</span>\n    <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{activeTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"activeTasks?.length > 0\" data-automation-id=\"active-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of activeTasks\" (click)=\"clickTask($event, task)\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user: getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n                </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<!-- START FORM -->\n\n<div *ngIf=\"activeTasks?.length === 0\" data-automation-id=\"active-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_ACTIVE' | translate }}\n</div>\n\n<div *ngIf=\"hasStartFormDefined()\">\n    <span class=\"adf-activiti-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</span>\n\n    <!--IF START TASK COMPLETED -->\n    <div class=\"menu-container\">\n        <mat-list>\n            <mat-list-item class=\"process-tasks__task-item\" (click)=\"clickStartTask()\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(processInstanceDetails.startedBy), created: getFormatDate(processInstanceDetails.started, 'mediumDate') } }}\n                </span>\n            </mat-list-item>\n        </mat-list>\n    </div>\n\n</div>\n\n<!-- COMPLETED FORM -->\n<mat-chip-list>\n        <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_COMPLETED'|translate }}</span>\n        <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{completedTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"completedTasks?.length > 0\" data-automation-id=\"completed-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of completedTasks\" (click)=\"clickTask($event, task)\">\n            <mat-icon mat-list-icon>assignment</mat-icon>\n            <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n            <span matLine>\n                {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n            </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<div *ngIf=\"completedTasks?.length === 0\" data-automation-id=\"completed-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_COMPLETED' | translate }}\n</div>\n\n<ng-template *ngIf=\"hasStartFormDefined()\" #startDialog>\n    <div id=\"adf-start-process-dialog\" class=\"adf-start-process-dialog\">\n        <h4 matDialogTitle>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h4>\n        <div mat-dialog-content class=\"adf-start-process-dialog-content\">\n            <adf-start-form [processId]=\"processId\"\n                                 [showRefreshButton]=\"false\" [readOnlyForm]=\"true\"\n                                 (formContentClicked)='onFormContentClick()'>\n            </adf-start-form>\n        </div>\n        <div mat-dialog-actions class=\"adf-start-process-dialog-actions\">\n            <button mat-button type=\"button\" (click)=\"closeStartDialog()\">{{ 'ADF_PROCESS_LIST.DETAILS.TASKS.TASK_CLOSE' | translate }}</button>\n        </div>\n    </div>\n</ng-template>\n",
                styles: [":host{width:100%}.activiti-label{font-weight:bolder;vertical-align:top}.adf-process-badge{pointer-events:none;outline:0}.adf-chip-label{position:relative;top:5px;margin-right:8px;font-weight:700}.menu-container{margin-bottom:32px}.activiti-label+.icon{position:relative;top:-2px}.task-details-dialog{position:fixed;top:50%;-webkit-transform:translate(0,-50%);transform:translate(0,-50%);width:40%}.process-tasks-refresh{float:right}.adf-start-process-dialog{width:100%;height:100%;display:flex;flex-direction:column}.adf-start-process-dialog-content{flex-grow:1}.adf-start-process-dialog-actions{display:flex;justify-content:flex-end}.no-results{margin-left:9px;font-size:14px;font-weight:400;letter-spacing:0;line-height:18px;color:rgba(0,0,0,.54);display:block;padding:12px}.process-tasks__task-item{cursor:pointer}"]
            }] }
];
/** @nocollapse */
ProcessInstanceTasksComponent.ctorParameters = () => [
    { type: ProcessService },
    { type: LogService },
    { type: MatDialog }
];
ProcessInstanceTasksComponent.propDecorators = {
    processInstanceDetails: [{ type: Input }],
    showRefreshButton: [{ type: Input }],
    error: [{ type: Output }],
    startDialog: [{ type: ViewChild, args: ['startDialog',] }],
    taskDetails: [{ type: ViewChild, args: ['taskDetails',] }],
    taskClick: [{ type: Output }]
};
if (false) {
    /**
     * (**required**) The ID of the process instance to display tasks for.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.processInstanceDetails;
    /**
     * Toggles whether to show a refresh button next to the list of tasks to allow
     * it to be updated from the server.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.showRefreshButton;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.error;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.activeTasks;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTasks;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.taskObserver;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.completedTaskObserver;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.task$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTask$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.message;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.processId;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.startDialog;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.taskDetails;
    /**
     * Emitted when a task is clicked.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.taskClick;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.activitiProcess;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLXByb2Nlc3Mtc2VydmljZXMvIiwic291cmNlcyI6WyJwcm9jZXNzLWxpc3QvY29tcG9uZW50cy9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEgsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxVQUFVLEVBQVksTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFvQixNQUFNLGlCQUFpQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT3ZDLE1BQU0sT0FBTyw2QkFBNkI7Ozs7OztJQXNDdEMsWUFBb0IsZUFBK0IsRUFDL0IsVUFBc0IsRUFDdEIsTUFBaUI7UUFGakIsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBQy9CLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsV0FBTSxHQUFOLE1BQU0sQ0FBVzs7Ozs7UUE5QnJDLHNCQUFpQixHQUFZLElBQUksQ0FBQzs7OztRQUlsQyxVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFFbkQsZ0JBQVcsR0FBdUIsRUFB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Y2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IExvZ1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgRGF0ZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IE9ic2VydmFibGUsIE9ic2VydmVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBUYXNrRGV0YWlsc0V2ZW50LCBUYXNrRGV0YWlsc01vZGVsIH0gZnJvbSAnLi4vLi4vdGFzay1saXN0JztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZSB9IGZyb20gJy4uL21vZGVscy9wcm9jZXNzLWluc3RhbmNlLm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9wcm9jZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgc2hhcmUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXByb2Nlc3MtaW5zdGFuY2UtdGFza3MnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQcm9jZXNzSW5zdGFuY2VUYXNrc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICAgIC8qKiAoKipyZXF1aXJlZCoqKSBUaGUgSUQgb2YgdGhlIHByb2Nlc3MgaW5zdGFuY2UgdG8gZGlzcGxheSB0YXNrcyBmb3IuICovXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzSW5zdGFuY2VEZXRhaWxzOiBQcm9jZXNzSW5zdGFuY2U7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRvIHNob3cgYSByZWZyZXNoIGJ1dHRvbiBuZXh0IHRvIHRoZSBsaXN0IG9mIHRhc2tzIHRvIGFsbG93XG4gICAgICogaXQgdG8gYmUgdXBkYXRlZCBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBzaG93UmVmcmVzaEJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIGFjdGl2ZVRhc2tzOiBUYXNrRGV0YWlsc01vZGVsW10gPSBbXTtcbiAgICBjb21wbGV0ZWRUYXNrczogVGFza0RldGFpbHNNb2RlbFtdID0gW107XG5cbiAgICBwcml2YXRlIHRhc2tPYnNlcnZlcjogT2JzZXJ2ZXI8VGFza0RldGFpbHNNb2RlbD47XG4gICAgcHJpdmF0ZSBjb21wbGV0ZWRUYXNrT2JzZXJ2ZXI6IE9ic2VydmVyPFRhc2tEZXRhaWxzTW9kZWw+O1xuXG4gICAgdGFzayQ6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD47XG4gICAgY29tcGxldGVkVGFzayQ6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD47XG5cbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgcHJvY2Vzc0lkOiBzdHJpbmc7XG5cbiAgICBAVmlld0NoaWxkKCdzdGFydERpYWxvZycpXG4gICAgc3RhcnREaWFsb2c6IGFueTtcblxuICAgIEBWaWV3Q2hpbGQoJ3Rhc2tEZXRhaWxzJylcbiAgICB0YXNrRGV0YWlsczogYW55O1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHRhc2sgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ2xpY2s6IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNFdmVudD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWN0aXZpdGlQcm9jZXNzOiBQcm9jZXNzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZykge1xuICAgICAgICB0aGlzLnRhc2skID0gbmV3IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4oKG9ic2VydmVyKSA9PiB0aGlzLnRhc2tPYnNlcnZlciA9IG9ic2VydmVyKVxuICAgICAgICAgICAgLnBpcGUoc2hhcmUoKSk7XG4gICAgICAgIHRoaXMuY29tcGxldGVkVGFzayQgPSBuZXcgT2JzZXJ2YWJsZTxUYXNrRGV0YWlsc01vZGVsPigob2JzZXJ2ZXIpID0+IHRoaXMuY29tcGxldGVkVGFza09ic2VydmVyID0gb2JzZXJ2ZXIpXG4gICAgICAgICAgICAucGlwZShzaGFyZSgpKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy50YXNrJC5zdWJzY3JpYmUoKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlVGFza3MucHVzaCh0YXNrKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29tcGxldGVkVGFzayQuc3Vic2NyaWJlKCh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2tzLnB1c2godGFzayk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgY29uc3QgcHJvY2Vzc0luc3RhbmNlRGV0YWlscyA9IGNoYW5nZXNbJ3Byb2Nlc3NJbnN0YW5jZURldGFpbHMnXTtcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgcHJvY2Vzc0luc3RhbmNlRGV0YWlscy5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmN1cnJlbnRWYWx1ZS5pZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5sb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICAgICAgdGhpcy5sb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICB9XG5cbiAgICBsb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgbnVsbCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgodGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrT2JzZXJ2ZXIubmV4dCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2tzID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgJ2NvbXBsZXRlZCcpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza09ic2VydmVyLm5leHQodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzU3RhcnRGb3JtRGVmaW5lZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscyAmJiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnRGb3JtRGVmaW5lZCA9PT0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXRVc2VyRnVsbE5hbWUodXNlcjogYW55KSB7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gKHVzZXIuZmlyc3ROYW1lICYmIHVzZXIuZmlyc3ROYW1lICE9PSAnbnVsbCdcbiAgICAgICAgICAgICAgICAgICAgPyB1c2VyLmZpcnN0TmFtZSArICcgJyA6ICcnKSArXG4gICAgICAgICAgICAgICAgdXNlci5sYXN0TmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ05vYm9keSc7XG4gICAgfVxuXG4gICAgZ2V0Rm9ybWF0RGF0ZSh2YWx1ZSwgZm9ybWF0OiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgZGF0ZVBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0ZVBpcGUudHJhbnNmb3JtKHZhbHVlLCBmb3JtYXQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihgUHJvY2Vzc0xpc3RJbnN0YW5jZVRhc2s6IGVycm9yIHBhcnNpbmcgZGF0ZSAke3ZhbHVlfSB0byBmb3JtYXQgJHtmb3JtYXR9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGlja1Rhc2soJGV2ZW50OiBhbnksIHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpIHtcbiAgICAgICAgY29uc3QgYXJncyA9IG5ldyBUYXNrRGV0YWlsc0V2ZW50KHRhc2spO1xuICAgICAgICB0aGlzLnRhc2tDbGljay5lbWl0KGFyZ3MpO1xuICAgIH1cblxuICAgIGNsaWNrU3RhcnRUYXNrKCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NJZCA9IHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5pZDtcbiAgICAgICAgdGhpcy5zaG93U3RhcnREaWFsb2coKTtcbiAgICB9XG5cbiAgICBzaG93U3RhcnREaWFsb2coKSB7XG4gICAgICAgIHRoaXMuZGlhbG9nLm9wZW4odGhpcy5zdGFydERpYWxvZywgeyBoZWlnaHQ6ICc1MDBweCcsIHdpZHRoOiAnNzAwcHgnIH0pO1xuICAgIH1cblxuICAgIGNsb3NlU3RhcnREaWFsb2coKSB7XG4gICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlQWxsKCk7XG4gICAgfVxuXG4gICAgb25SZWZyZXNoQ2xpY2tlZCgpIHtcbiAgICAgICAgdGhpcy5sb2FkKHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5pZCk7XG4gICAgfVxuXG4gICAgb25Gb3JtQ29udGVudENsaWNrKCkge1xuICAgICAgICB0aGlzLmNsb3NlU3RhcnREaWFsb2coKTtcbiAgICB9XG59XG4iXX0=