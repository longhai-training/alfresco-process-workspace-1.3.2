/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AppsProcessService } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FilterProcessRepresentationModel } from '../models/filter-process.model';
import { ProcessFilterService } from './../services/process-filter.service';
import { IconModel } from '../../app-list/icon.model';
export class ProcessFiltersComponent {
    /**
     * @param {?} processFilterService
     * @param {?} appsProcessService
     */
    constructor(processFilterService, appsProcessService) {
        this.processFilterService = processFilterService;
        this.appsProcessService = appsProcessService;
        /**
         * Emitted when the user selects a filter from the list.
         */
        this.filterClick = new EventEmitter();
        /**
         * Emitted when the list of filters has been successfully loaded from the server.
         */
        this.success = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        /**
         * Toggle to show or hide the filter's icon.
         */
        this.showIcon = true;
        /**
         * Emitted when a process filter is selected.
         */
        this.filterSelected = new EventEmitter();
        this.filters = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.iconsMDL = new IconModel();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const appId = changes['appId'];
        /** @type {?} */
        const appName = changes['appName'];
        /** @type {?} */
        const filter = changes['filterParam'];
        if (appId && (appId.currentValue || appId.currentValue === null)) {
            this.getFiltersByAppId(appId.currentValue);
        }
        else if (appName && appName.currentValue) {
            this.getFiltersByAppName(appName.currentValue);
        }
        else if (filter && filter.currentValue !== filter.previousValue) {
            this.selectProcessFilter(filter.currentValue);
        }
    }
    /**
     * Return the filter list filtered by appId
     * @param {?=} appId - optional
     * @return {?}
     */
    getFiltersByAppId(appId) {
        this.processFilterService.getProcessFilters(appId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (res.length === 0 && this.isFilterListEmpty()) {
                this.processFilterService.createDefaultFilters(appId).subscribe((/**
                 * @param {?} resDefault
                 * @return {?}
                 */
                (resDefault) => {
                    this.resetFilter();
                    this.filters = resDefault;
                    this.selectProcessFilter(this.filterParam);
                    this.success.emit(resDefault);
                }), (/**
                 * @param {?} errDefault
                 * @return {?}
                 */
                (errDefault) => {
                    this.error.emit(errDefault);
                }));
            }
            else {
                this.resetFilter();
                this.filters = res;
                this.selectProcessFilter(this.filterParam);
                this.success.emit(res);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.error.emit(err);
        }));
    }
    /**
     * Return the filter list filtered by appName
     * @param {?} appName
     * @return {?}
     */
    getFiltersByAppName(appName) {
        this.appsProcessService.getDeployedApplicationsByName(appName).subscribe((/**
         * @param {?} application
         * @return {?}
         */
        (application) => {
            this.getFiltersByAppId(application.id);
            this.selectProcessFilter(this.filterParam);
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.error.emit(err);
        }));
    }
    /**
     * Pass the selected filter as next
     * @param {?} filter
     * @return {?}
     */
    selectFilter(filter) {
        this.currentFilter = filter;
        this.filterClick.emit(filter);
    }
    /**
     * Select the first filter of a list if present
     * @param {?} filterParam
     * @return {?}
     */
    selectProcessFilter(filterParam) {
        if (filterParam) {
            this.filters.filter((/**
             * @param {?} processFilter
             * @param {?} index
             * @return {?}
             */
            (processFilter, index) => {
                if (filterParam.name && filterParam.name.toLowerCase() === processFilter.name.toLowerCase() ||
                    filterParam.id === processFilter.id ||
                    filterParam.index === index) {
                    this.currentFilter = processFilter;
                    this.filterSelected.emit(processFilter);
                }
            }));
        }
        if (this.isCurrentFilterEmpty()) {
            this.selectDefaultTaskFilter();
        }
    }
    /**
     * Select the Running filter
     * @return {?}
     */
    selectRunningFilter() {
        this.selectProcessFilter(this.processFilterService.getRunningFilterInstance(null));
    }
    /**
     * Select as default task filter the first in the list
     * @return {?}
     */
    selectDefaultTaskFilter() {
        if (!this.isFilterListEmpty()) {
            this.currentFilter = this.filters[0];
            this.filterSelected.emit(this.filters[0]);
        }
    }
    /**
     * Return the current task
     * @return {?}
     */
    getCurrentFilter() {
        return this.currentFilter;
    }
    /**
     * Check if the filter list is empty
     * @return {?}
     */
    isFilterListEmpty() {
        return this.filters === undefined || (this.filters && this.filters.length === 0);
    }
    /**
     * Reset the filters properties
     * @private
     * @return {?}
     */
    resetFilter() {
        this.filters = [];
        this.currentFilter = undefined;
    }
    /**
     * @private
     * @return {?}
     */
    isCurrentFilterEmpty() {
        return this.currentFilter === undefined || null;
    }
    /**
     * Return current filter icon
     * @param {?} icon
     * @return {?}
     */
    getFilterIcon(icon) {
        return this.iconsMDL.mapGlyphiconToMaterialDesignIcons(icon);
    }
}
ProcessFiltersComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-process-instance-filters',
                template: "<div class=\"menu-container\">\n    <mat-list class=\"adf-menu-list\">\n        <mat-list-item (click)=\"selectFilter(filter)\" *ngFor=\"let filter of filters\"\n                        class=\"adf-filters__entry\" [class.adf-active]=\"currentFilter === filter\">\n            <mat-icon *ngIf=\"showIcon\" matListIcon class=\"adf-filters__entry-icon\">{{getFilterIcon(filter.icon)}}</mat-icon>\n            <span matLine [attr.data-automation-id]=\"filter.name + '_filter'\">{{filter.name}}</span>\n        </mat-list-item>\n    </mat-list>\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
ProcessFiltersComponent.ctorParameters = () => [
    { type: ProcessFilterService },
    { type: AppsProcessService }
];
ProcessFiltersComponent.propDecorators = {
    filterParam: [{ type: Input }],
    filterClick: [{ type: Output }],
    success: [{ type: Output }],
    error: [{ type: Output }],
    appId: [{ type: Input }],
    appName: [{ type: Input }],
    showIcon: [{ type: Input }],
    filterSelected: [{ type: Output }]
};
if (false) {
    /**
     * The parameters to filter the task filter. If there is no match then the default one
     * (ie, the first filter in the list) is selected.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.filterParam;
    /**
     * Emitted when the user selects a filter from the list.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.filterClick;
    /**
     * Emitted when the list of filters has been successfully loaded from the server.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.success;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.error;
    /**
     * Display filters available to the current user for the application with the specified ID.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.appId;
    /**
     * Display filters available to the current user for the application with the specified name.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.appName;
    /**
     * Toggle to show or hide the filter's icon.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.showIcon;
    /**
     * Emitted when a process filter is selected.
     * @type {?}
     */
    ProcessFiltersComponent.prototype.filterSelected;
    /** @type {?} */
    ProcessFiltersComponent.prototype.filter$;
    /** @type {?} */
    ProcessFiltersComponent.prototype.currentFilter;
    /** @type {?} */
    ProcessFiltersComponent.prototype.filters;
    /**
     * @type {?}
     * @private
     */
    ProcessFiltersComponent.prototype.iconsMDL;
    /**
     * @type {?}
     * @private
     */
    ProcessFiltersComponent.prototype.processFilterService;
    /**
     * @type {?}
     * @private
     */
    ProcessFiltersComponent.prototype.appsProcessService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInByb2Nlc3MtbGlzdC9jb21wb25lbnRzL3Byb2Nlc3MtZmlsdGVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBR3pHLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQU90RCxNQUFNLE9BQU8sdUJBQXVCOzs7OztJQTRDaEMsWUFBb0Isb0JBQTBDLEVBQzFDLGtCQUFzQztRQUR0Qyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7Ozs7UUFuQzFELGdCQUFXLEdBQTBELElBQUksWUFBWSxFQUEyQyxDQUFDOzs7O1FBSWpJLFlBQU8sR0FBd0QsSUFBSSxZQUFZLEVBQXlDLENBQUM7Ozs7UUFJekgsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDOzs7O1FBWW5ELGFBQVEsR0FBWSxJQUFJLENBQUM7Ozs7UUFJekIsbUJBQWMsR0FBc0QsSUFBSSxZQUFZLEVBQXVDLENBQUM7UUFNNUgsWUFBTyxHQUErQyxFQUFFLENBQUM7SUFNekQsQ0FBQzs7OztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksU0FBUyxFQUFFLENBQUM7SUFDcEMsQ0FBQzs7Ozs7SUFFRCxX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Q0FBQztJQUM5QixDQUFDOzs7OztJQUtELGlCQUFpQjtRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sS0FBSyxTQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7Ozs7OztJQUtPLFdBQVc7UUFDZixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVPLG9CQUFvQjtRQUN4QixPQUFPLElBQUksQ0FBQyxhQUFhLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQztJQUNwRCxDQUFDOzs7Ozs7SUFLRCxhQUFhLENBQUMsSUFBSTtRQUNkLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQ0FBaUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRSxDQUFDOzs7WUFsTUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSw4QkFBOEI7Z0JBQ3hDLGtqQkFBK0M7O2FBRWxEOzs7O1lBUFEsb0JBQW9CO1lBTHBCLGtCQUFrQjs7OzBCQWtCdEIsS0FBSzswQkFJTCxNQUFNO3NCQUlOLE1BQU07b0JBSU4sTUFBTTtvQkFJTixLQUFLO3NCQUlMLEtBQUs7dUJBSUwsS0FBSzs2QkFJTCxNQUFNOzs7Ozs7OztJQTVCUCw4Q0FDOEM7Ozs7O0lBRzlDLDhDQUNpSTs7Ozs7SUFHakksMENBQ3lIOzs7OztJQUd6SCx3Q0FDbUQ7Ozs7O0lBR25ELHdDQUNjOzs7OztJQUdkLDBDQUNnQjs7Ozs7SUFHaEIsMkNBQ3lCOzs7OztJQUd6QixpREFDNEg7O0lBRTVILDBDQUF5RDs7SUFFekQsZ0RBQW1EOztJQUVuRCwwQ0FBeUQ7Ozs7O0lBRXpELDJDQUE0Qjs7Ozs7SUFFaEIsdURBQWtEOzs7OztJQUNsRCxxREFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBcHBzUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2VGaWx0ZXJSZXByZXNlbnRhdGlvbiwgVXNlclByb2Nlc3NJbnN0YW5jZUZpbHRlclJlcHJlc2VudGF0aW9uIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbCB9IGZyb20gJy4uL21vZGVscy9maWx0ZXItcHJvY2Vzcy5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzRmlsdGVyU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvcHJvY2Vzcy1maWx0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBJY29uTW9kZWwgfSBmcm9tICcuLi8uLi9hcHAtbGlzdC9pY29uLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtcHJvY2Vzcy1pbnN0YW5jZS1maWx0ZXJzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcHJvY2Vzcy1maWx0ZXJzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsncHJvY2Vzcy1maWx0ZXJzLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUHJvY2Vzc0ZpbHRlcnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgICAvKiogVGhlIHBhcmFtZXRlcnMgdG8gZmlsdGVyIHRoZSB0YXNrIGZpbHRlci4gSWYgdGhlcmUgaXMgbm8gbWF0Y2ggdGhlbiB0aGUgZGVmYXVsdCBvbmVcbiAgICAgKiAoaWUsIHRoZSBmaXJzdCBmaWx0ZXIgaW4gdGhlIGxpc3QpIGlzIHNlbGVjdGVkLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgZmlsdGVyUGFyYW06IEZpbHRlclByb2Nlc3NSZXByZXNlbnRhdGlvbk1vZGVsO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgdXNlciBzZWxlY3RzIGEgZmlsdGVyIGZyb20gdGhlIGxpc3QuICovXG4gICAgQE91dHB1dCgpXG4gICAgZmlsdGVyQ2xpY2s6IEV2ZW50RW1pdHRlcjxVc2VyUHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24+ID0gbmV3IEV2ZW50RW1pdHRlcjxVc2VyUHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBsaXN0IG9mIGZpbHRlcnMgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXIuICovXG4gICAgQE91dHB1dCgpXG4gICAgc3VjY2VzczogRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZUZpbHRlclJlcHJlc2VudGF0aW9uW10+ID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2VGaWx0ZXJSZXByZXNlbnRhdGlvbltdPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKiogRGlzcGxheSBmaWx0ZXJzIGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCB1c2VyIGZvciB0aGUgYXBwbGljYXRpb24gd2l0aCB0aGUgc3BlY2lmaWVkIElELiAqL1xuICAgIEBJbnB1dCgpXG4gICAgYXBwSWQ6IG51bWJlcjtcblxuICAgIC8qKiBEaXNwbGF5IGZpbHRlcnMgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IHVzZXIgZm9yIHRoZSBhcHBsaWNhdGlvbiB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4gKi9cbiAgICBASW5wdXQoKVxuICAgIGFwcE5hbWU6IHN0cmluZztcblxuICAgIC8qKiBUb2dnbGUgdG8gc2hvdyBvciBoaWRlIHRoZSBmaWx0ZXIncyBpY29uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0ljb246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHByb2Nlc3MgZmlsdGVyIGlzIHNlbGVjdGVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGZpbHRlclNlbGVjdGVkOiBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24+ID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2VGaWx0ZXJSZXByZXNlbnRhdGlvbj4oKTtcblxuICAgIGZpbHRlciQ6IE9ic2VydmFibGU8UHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24+O1xuXG4gICAgY3VycmVudEZpbHRlcjogUHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb247XG5cbiAgICBmaWx0ZXJzOiBVc2VyUHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24gW10gPSBbXTtcblxuICAgIHByaXZhdGUgaWNvbnNNREw6IEljb25Nb2RlbDtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcHJvY2Vzc0ZpbHRlclNlcnZpY2U6IFByb2Nlc3NGaWx0ZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwc1Byb2Nlc3NTZXJ2aWNlOiBBcHBzUHJvY2Vzc1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5pY29uc01ETCA9IG5ldyBJY29uTW9kZWwoKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IGFwcElkID0gY2hhbmdlc1snYXBwSWQnXTtcbiAgICAgICAgY29uc3QgYXBwTmFtZSA9IGNoYW5nZXNbJ2FwcE5hbWUnXTtcbiAgICAgICAgY29uc3QgZmlsdGVyID0gY2hhbmdlc1snZmlsdGVyUGFyYW0nXTtcblxuICAgICAgICBpZiAoYXBwSWQgJiYgKGFwcElkLmN1cnJlbnRWYWx1ZSB8fCBhcHBJZC5jdXJyZW50VmFsdWUgPT09IG51bGwpKSB7XG4gICAgICAgICAgICB0aGlzLmdldEZpbHRlcnNCeUFwcElkKGFwcElkLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXBwTmFtZSAmJiBhcHBOYW1lLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRGaWx0ZXJzQnlBcHBOYW1lKGFwcE5hbWUuY3VycmVudFZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXIgJiYgZmlsdGVyLmN1cnJlbnRWYWx1ZSAhPT0gZmlsdGVyLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0UHJvY2Vzc0ZpbHRlcihmaWx0ZXIuY3VycmVudFZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgZmlsdGVyIGxpc3QgZmlsdGVyZWQgYnkgYXBwSWRcbiAgICAgKiBAcGFyYW0gYXBwSWQgLSBvcHRpb25hbFxuICAgICAqL1xuICAgIGdldEZpbHRlcnNCeUFwcElkKGFwcElkPzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0ZpbHRlclNlcnZpY2UuZ2V0UHJvY2Vzc0ZpbHRlcnMoYXBwSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IFByb2Nlc3NJbnN0YW5jZUZpbHRlclJlcHJlc2VudGF0aW9uW10pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmlzRmlsdGVyTGlzdEVtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRmlsdGVyU2VydmljZS5jcmVhdGVEZWZhdWx0RmlsdGVycyhhcHBJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc0RlZmF1bHQ6IFByb2Nlc3NJbnN0YW5jZUZpbHRlclJlcHJlc2VudGF0aW9uW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0RmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzID0gcmVzRGVmYXVsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFByb2Nlc3NGaWx0ZXIodGhpcy5maWx0ZXJQYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQocmVzRGVmYXVsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKGVyckRlZmF1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnJEZWZhdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0RmlsdGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycyA9IHJlcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RQcm9jZXNzRmlsdGVyKHRoaXMuZmlsdGVyUGFyYW0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Y2Nlc3MuZW1pdChyZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdGhlIGZpbHRlciBsaXN0IGZpbHRlcmVkIGJ5IGFwcE5hbWVcbiAgICAgKiBAcGFyYW0gYXBwTmFtZVxuICAgICAqL1xuICAgIGdldEZpbHRlcnNCeUFwcE5hbWUoYXBwTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYXBwc1Byb2Nlc3NTZXJ2aWNlLmdldERlcGxveWVkQXBwbGljYXRpb25zQnlOYW1lKGFwcE5hbWUpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChhcHBsaWNhdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RmlsdGVyc0J5QXBwSWQoYXBwbGljYXRpb24uaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UHJvY2Vzc0ZpbHRlcih0aGlzLmZpbHRlclBhcmFtKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXNzIHRoZSBzZWxlY3RlZCBmaWx0ZXIgYXMgbmV4dFxuICAgICAqIEBwYXJhbSBmaWx0ZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgc2VsZWN0RmlsdGVyKGZpbHRlcjogUHJvY2Vzc0luc3RhbmNlRmlsdGVyUmVwcmVzZW50YXRpb24pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gZmlsdGVyO1xuICAgICAgICB0aGlzLmZpbHRlckNsaWNrLmVtaXQoZmlsdGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3QgdGhlIGZpcnN0IGZpbHRlciBvZiBhIGxpc3QgaWYgcHJlc2VudFxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RQcm9jZXNzRmlsdGVyKGZpbHRlclBhcmFtOiBGaWx0ZXJQcm9jZXNzUmVwcmVzZW50YXRpb25Nb2RlbCkge1xuICAgICAgICBpZiAoZmlsdGVyUGFyYW0pIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVycy5maWx0ZXIoKHByb2Nlc3NGaWx0ZXI6IFVzZXJQcm9jZXNzSW5zdGFuY2VGaWx0ZXJSZXByZXNlbnRhdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyUGFyYW0ubmFtZSAmJiBmaWx0ZXJQYXJhbS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IHByb2Nlc3NGaWx0ZXIubmFtZS50b0xvd2VyQ2FzZSgpIHx8XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclBhcmFtLmlkID09PSBwcm9jZXNzRmlsdGVyLmlkIHx8XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclBhcmFtLmluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWx0ZXIgPSBwcm9jZXNzRmlsdGVyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclNlbGVjdGVkLmVtaXQocHJvY2Vzc0ZpbHRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNDdXJyZW50RmlsdGVyRW1wdHkoKSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3REZWZhdWx0VGFza0ZpbHRlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VsZWN0IHRoZSBSdW5uaW5nIGZpbHRlclxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RSdW5uaW5nRmlsdGVyKCkge1xuICAgICAgICB0aGlzLnNlbGVjdFByb2Nlc3NGaWx0ZXIodGhpcy5wcm9jZXNzRmlsdGVyU2VydmljZS5nZXRSdW5uaW5nRmlsdGVySW5zdGFuY2UobnVsbCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCBhcyBkZWZhdWx0IHRhc2sgZmlsdGVyIHRoZSBmaXJzdCBpbiB0aGUgbGlzdFxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3REZWZhdWx0VGFza0ZpbHRlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRmlsdGVyTGlzdEVtcHR5KCkpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9IHRoaXMuZmlsdGVyc1swXTtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyU2VsZWN0ZWQuZW1pdCh0aGlzLmZpbHRlcnNbMF0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHRhc2tcbiAgICAgKi9cbiAgICBnZXRDdXJyZW50RmlsdGVyKCk6IFByb2Nlc3NJbnN0YW5jZUZpbHRlclJlcHJlc2VudGF0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbHRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgZmlsdGVyIGxpc3QgaXMgZW1wdHlcbiAgICAgKi9cbiAgICBpc0ZpbHRlckxpc3RFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVycyA9PT0gdW5kZWZpbmVkIHx8ICh0aGlzLmZpbHRlcnMgJiYgdGhpcy5maWx0ZXJzLmxlbmd0aCA9PT0gMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIGZpbHRlcnMgcHJvcGVydGllc1xuICAgICAqL1xuICAgIHByaXZhdGUgcmVzZXRGaWx0ZXIoKSB7XG4gICAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0N1cnJlbnRGaWx0ZXJFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbHRlciA9PT0gdW5kZWZpbmVkIHx8IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGN1cnJlbnQgZmlsdGVyIGljb25cbiAgICAgKi9cbiAgICBnZXRGaWx0ZXJJY29uKGljb24pOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5pY29uc01ETC5tYXBHbHlwaGljb25Ub01hdGVyaWFsRGVzaWduSWNvbnMoaWNvbik7XG4gICAgfVxufVxuIl19