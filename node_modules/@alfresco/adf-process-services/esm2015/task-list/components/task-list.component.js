/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { DataTableSchema, CustomEmptyContentTemplateDirective, CustomLoadingContentTemplateDirective } from '@alfresco/adf-core';
import { AppConfigService, PaginationComponent, UserPreferencesService, UserPreferenceValues } from '@alfresco/adf-core';
import { Component, ContentChild, EventEmitter, Input, Output } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { TaskQueryRequestRepresentationModel } from '../models/filter.model';
import { taskPresetsDefaultModel } from '../models/task-preset.model';
import { TaskListService } from './../services/tasklist.service';
import moment from 'moment-es6';
export class TaskListComponent extends DataTableSchema {
    /**
     * @param {?} taskListService
     * @param {?} appConfigService
     * @param {?} userPreferences
     */
    constructor(taskListService, appConfigService, userPreferences) {
        super(appConfigService, TaskListComponent.PRESET_KEY, taskPresetsDefaultModel);
        this.taskListService = taskListService;
        this.userPreferences = userPreferences;
        /**
         * Row selection mode. Can be none, `single` or `multiple`. For `multiple` mode,
         * you can use Cmd (macOS) or Ctrl (Win) modifier key to toggle selection for
         * multiple rows.
         */
        this.selectionMode = 'single'; // none|single|multiple
        // none|single|multiple
        /**
         * Toggles multiple row selection, renders checkboxes at the beginning of each row
         */
        this.multiselect = false;
        /**
         * Toggles default selection of the first row
         */
        this.selectFirstRow = true;
        /**
         * Emitted when a task in the list is clicked
         */
        this.rowClick = new EventEmitter();
        /**
         * Emitted when rows are selected/unselected
         */
        this.rowsSelected = new EventEmitter();
        /**
         * Emitted when the task list is loaded
         */
        this.success = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        /**
         * The page number of the tasks to fetch.
         */
        this.page = 0;
        /**
         * The number of tasks to fetch. Default value: 25.
         */
        this.size = PaginationComponent.DEFAULT_PAGINATION.maxItems;
        this.rows = [];
        this.isLoading = true;
        this.sorting = ['created', 'desc'];
        /**
         * Toggles custom data source mode.
         * When enabled the component reloads data from it's current source instead of the server side.
         * This allows generating and displaying custom data sets (i.e. filtered out content).
         *
         * \@memberOf TaskListComponent
         */
        this.hasCustomDataSource = false;
        this.userPreferences.select(UserPreferenceValues.PaginationSize).subscribe((/**
         * @param {?} pageSize
         * @return {?}
         */
        (pageSize) => {
            this.size = pageSize;
        }));
        this.pagination = new BehaviorSubject((/** @type {?} */ ({
            maxItems: this.size,
            skipCount: 0,
            totalItems: 0
        })));
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.createDatatableSchema();
        if (this.data && this.data.getColumns().length === 0) {
            this.data.setColumns(this.columns);
        }
        if (this.appId) {
            this.reload();
        }
    }
    /**
     * @param {?} rows
     * @return {?}
     */
    setCustomDataSource(rows) {
        if (rows) {
            this.rows = rows;
            this.hasCustomDataSource = true;
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.isPropertyChanged(changes)) {
            if (this.isSortChanged(changes)) {
                this.sorting = this.sort ? this.sort.split('-') : this.sorting;
            }
            this.reload();
        }
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    isSortChanged(changes) {
        /** @type {?} */
        const actualSort = changes['sort'];
        return actualSort && actualSort.currentValue && actualSort.currentValue !== actualSort.previousValue;
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    isPropertyChanged(changes) {
        /** @type {?} */
        let changed = true;
        /** @type {?} */
        const landingTaskId = changes['landingTaskId'];
        /** @type {?} */
        const page = changes['page'];
        /** @type {?} */
        const size = changes['size'];
        if (landingTaskId && landingTaskId.currentValue && this.isEqualToCurrentId(landingTaskId.currentValue)) {
            changed = false;
        }
        else if (page && page.currentValue !== page.previousValue) {
            changed = true;
        }
        else if (size && size.currentValue !== size.previousValue) {
            changed = true;
        }
        return changed;
    }
    /**
     * @return {?}
     */
    reload() {
        if (!this.hasCustomDataSource) {
            this.requestNode = this.createRequestNode();
            this.load(this.requestNode);
        }
        else {
            this.isLoading = false;
        }
    }
    /**
     * @private
     * @param {?} requestNode
     * @return {?}
     */
    load(requestNode) {
        this.isLoading = true;
        this.loadTasksByState().subscribe((/**
         * @param {?} tasks
         * @return {?}
         */
        (tasks) => {
            this.rows = this.optimizeTaskDetails(tasks.data);
            this.selectTask(this.landingTaskId);
            this.success.emit(tasks);
            this.isLoading = false;
            this.pagination.next({
                count: tasks.data.length,
                maxItems: this.size,
                skipCount: this.page * this.size,
                totalItems: tasks.total
            });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            this.error.emit(error);
            this.isLoading = false;
        }));
    }
    /**
     * @private
     * @return {?}
     */
    loadTasksByState() {
        return this.requestNode.state === 'all'
            ? this.taskListService.findAllTasksWithoutState(this.requestNode)
            : this.taskListService.findTasksByState(this.requestNode);
    }
    /**
     * Select the task given in input if present
     * @param {?} taskIdSelected
     * @return {?}
     */
    selectTask(taskIdSelected) {
        if (!this.isListEmpty()) {
            /** @type {?} */
            let dataRow = null;
            if (taskIdSelected) {
                dataRow = this.rows.find((/**
                 * @param {?} currentRow
                 * @return {?}
                 */
                (currentRow) => {
                    return currentRow['id'] === taskIdSelected;
                }));
            }
            if (!dataRow && this.selectFirstRow) {
                dataRow = this.rows[0];
            }
            if (dataRow) {
                dataRow.isSelected = true;
                this.currentInstanceId = dataRow['id'];
            }
        }
        else {
            this.currentInstanceId = null;
        }
    }
    /**
     * Return the current id
     * @return {?}
     */
    getCurrentId() {
        return this.currentInstanceId;
    }
    /**
     * Check if the taskId is the same of the selected task
     * @param {?} taskId
     * @return {?}
     */
    isEqualToCurrentId(taskId) {
        return this.currentInstanceId === taskId;
    }
    /**
     * Check if the list is empty
     * @return {?}
     */
    isListEmpty() {
        return !this.rows || this.rows.length === 0;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    onRowClick(item) {
        this.currentInstanceId = item.value.getValue('id');
        this.rowClick.emit(this.currentInstanceId);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onRowSelect(event) {
        this.selectedInstances = [...event.detail.selection];
        this.rowsSelected.emit(this.selectedInstances);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onRowUnselect(event) {
        this.selectedInstances = [...event.detail.selection];
        this.rowsSelected.emit(this.selectedInstances);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onRowKeyUp(event) {
        if (event.detail.keyboardEvent.key === 'Enter') {
            event.preventDefault();
            this.currentInstanceId = event.detail.row.getValue('id');
            this.rowClick.emit(this.currentInstanceId);
        }
    }
    /**
     * Optimize name field
     * @private
     * @param {?} instances
     * @return {?}
     */
    optimizeTaskDetails(instances) {
        instances = instances.map((/**
         * @param {?} task
         * @return {?}
         */
        (task) => {
            if (!task.name) {
                task.name = 'No name';
            }
            return task;
        }));
        return instances;
    }
    /**
     * @private
     * @return {?}
     */
    createRequestNode() {
        /** @type {?} */
        const requestNode = {
            appDefinitionId: this.appId,
            dueAfter: this.dueAfter ? moment(this.dueAfter).toDate() : null,
            dueBefore: this.dueBefore ? moment(this.dueBefore).toDate() : null,
            processInstanceId: this.processInstanceId,
            processDefinitionId: this.processDefinitionId,
            text: this.name,
            assignment: this.assignment,
            state: this.state,
            sort: this.sort,
            page: this.page,
            size: this.size,
            start: this.start,
            taskId: this.taskId,
            includeProcessInstance: this.includeProcessInstance
        };
        return new TaskQueryRequestRepresentationModel(requestNode);
    }
    /**
     * @param {?} params
     * @return {?}
     */
    updatePagination(params) {
        /** @type {?} */
        const needsReload = params.maxItems || params.skipCount;
        this.size = params.maxItems;
        this.page = this.currentPage(params.skipCount, params.maxItems);
        if (needsReload) {
            this.reload();
        }
    }
    /**
     * @param {?} skipCount
     * @param {?} maxItems
     * @return {?}
     */
    currentPage(skipCount, maxItems) {
        return (skipCount && maxItems) ? Math.floor(skipCount / maxItems) : 0;
    }
}
TaskListComponent.PRESET_KEY = 'adf-task-list.presets';
TaskListComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-tasklist',
                template: "<div *ngIf=\"!requestNode\">{{ 'ADF_TASK_LIST.FILTERS.MESSAGES.NONE' | translate }}</div>\n<ng-container *ngIf=\"requestNode\">\n        <adf-datatable\n            [data]=\"data\"\n            [rows]=\"rows\"\n            [columns]=\"columns\"\n            [sorting]=\"sorting\"\n            [loading]=\"isLoading\"\n            [multiselect]=\"multiselect\"\n            [selectionMode]=\"selectionMode\"\n            (row-select)=\"onRowSelect($event)\"\n            (row-unselect)=\"onRowUnselect($event)\"\n            (rowClick)=\"onRowClick($event)\"\n            (row-keyup)=\"onRowKeyUp($event)\">\n            <adf-loading-content-template>\n                <ng-template>\n                    <!--Add your custom loading template here-->\n                    <mat-progress-spinner\n                        *ngIf=\"!customLoadingContent\"\n                        class=\"adf-task-list-loading-margin\"\n                        [color]=\"'primary'\"\n                        [mode]=\"'indeterminate'\">\n                    </mat-progress-spinner>\n                    <ng-content select=\"adf-custom-loading-content-template\"></ng-content>\n                </ng-template>\n            </adf-loading-content-template>\n            <adf-no-content-template>\n                <ng-template>\n                    <adf-empty-content *ngIf=\"!customEmptyContent\"\n                        icon=\"assignment\"\n                        [title]=\"'ADF_TASK_LIST.LIST.MESSAGES.TITLE' | translate\"\n                        [subtitle]=\"'ADF_TASK_LIST.LIST.MESSAGES.SUBTITLE' | translate\">\n                    </adf-empty-content>\n                    <ng-content select=\"adf-custom-empty-content-template\"></ng-content>\n                </ng-template>\n            </adf-no-content-template>\n        </adf-datatable>\n</ng-container>\n",
                styles: [".adf-task-list-loading-margin{margin-left:calc((100% - 100px)/ 2);margin-right:calc((100% - 100px)/ 2)}"]
            }] }
];
/** @nocollapse */
TaskListComponent.ctorParameters = () => [
    { type: TaskListService },
    { type: AppConfigService },
    { type: UserPreferencesService }
];
TaskListComponent.propDecorators = {
    customEmptyContent: [{ type: ContentChild, args: [CustomEmptyContentTemplateDirective,] }],
    customLoadingContent: [{ type: ContentChild, args: [CustomLoadingContentTemplateDirective,] }],
    appId: [{ type: Input }],
    processInstanceId: [{ type: Input }],
    processDefinitionId: [{ type: Input }],
    state: [{ type: Input }],
    assignment: [{ type: Input }],
    sort: [{ type: Input }],
    name: [{ type: Input }],
    landingTaskId: [{ type: Input }],
    data: [{ type: Input }],
    selectionMode: [{ type: Input }],
    multiselect: [{ type: Input }],
    selectFirstRow: [{ type: Input }],
    taskId: [{ type: Input }],
    includeProcessInstance: [{ type: Input }],
    start: [{ type: Input }],
    rowClick: [{ type: Output }],
    rowsSelected: [{ type: Output }],
    success: [{ type: Output }],
    error: [{ type: Output }],
    page: [{ type: Input }],
    size: [{ type: Input }],
    dueAfter: [{ type: Input }],
    dueBefore: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TaskListComponent.PRESET_KEY;
    /** @type {?} */
    TaskListComponent.prototype.customEmptyContent;
    /** @type {?} */
    TaskListComponent.prototype.customLoadingContent;
    /** @type {?} */
    TaskListComponent.prototype.requestNode;
    /**
     * The id of the app.
     * @type {?}
     */
    TaskListComponent.prototype.appId;
    /**
     * The Instance Id of the process.
     * @type {?}
     */
    TaskListComponent.prototype.processInstanceId;
    /**
     * The Definition Id of the process.
     * @type {?}
     */
    TaskListComponent.prototype.processDefinitionId;
    /**
     * Current state of the process. Possible values are: `completed`, `active`.
     * @type {?}
     */
    TaskListComponent.prototype.state;
    /**
     * The assignment of the process. Possible values are: "assignee" (the current user
     * is the assignee), "candidate" (the current user is a task candidate, "group_x" (the task
     * is assigned to a group where the current user is a member,
     * no value (the current user is involved).
     * @type {?}
     */
    TaskListComponent.prototype.assignment;
    /**
     * Define the sort order of the tasks. Possible values are : `created-desc`,
     * `created-asc`, `due-desc`, `due-asc`
     * @type {?}
     */
    TaskListComponent.prototype.sort;
    /**
     * Name of the tasklist.
     * @type {?}
     */
    TaskListComponent.prototype.name;
    /**
     * Define which task id should be selected after reloading. If the task id doesn't
     * exist or nothing is passed then the first task will be selected.
     * @type {?}
     */
    TaskListComponent.prototype.landingTaskId;
    /**
     * Data source object that represents the number and the type of the columns that
     * you want to show.
     * @type {?}
     */
    TaskListComponent.prototype.data;
    /**
     * Row selection mode. Can be none, `single` or `multiple`. For `multiple` mode,
     * you can use Cmd (macOS) or Ctrl (Win) modifier key to toggle selection for
     * multiple rows.
     * @type {?}
     */
    TaskListComponent.prototype.selectionMode;
    /**
     * Toggles multiple row selection, renders checkboxes at the beginning of each row
     * @type {?}
     */
    TaskListComponent.prototype.multiselect;
    /**
     * Toggles default selection of the first row
     * @type {?}
     */
    TaskListComponent.prototype.selectFirstRow;
    /**
     * The id of a task
     * @type {?}
     */
    TaskListComponent.prototype.taskId;
    /**
     * Toggles inclusion of Process Instances
     * @type {?}
     */
    TaskListComponent.prototype.includeProcessInstance;
    /**
     * Starting point of the list within the full set of tasks.
     * @type {?}
     */
    TaskListComponent.prototype.start;
    /**
     * Emitted when a task in the list is clicked
     * @type {?}
     */
    TaskListComponent.prototype.rowClick;
    /**
     * Emitted when rows are selected/unselected
     * @type {?}
     */
    TaskListComponent.prototype.rowsSelected;
    /**
     * Emitted when the task list is loaded
     * @type {?}
     */
    TaskListComponent.prototype.success;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    TaskListComponent.prototype.error;
    /** @type {?} */
    TaskListComponent.prototype.currentInstanceId;
    /** @type {?} */
    TaskListComponent.prototype.selectedInstances;
    /** @type {?} */
    TaskListComponent.prototype.pagination;
    /**
     * The page number of the tasks to fetch.
     * @type {?}
     */
    TaskListComponent.prototype.page;
    /**
     * The number of tasks to fetch. Default value: 25.
     * @type {?}
     */
    TaskListComponent.prototype.size;
    /**
     * Filter the tasks. Display only tasks with `created_date` after `dueAfter`.
     * @type {?}
     */
    TaskListComponent.prototype.dueAfter;
    /**
     * Filter the tasks. Display only tasks with `created_date` before `dueBefore`.
     * @type {?}
     */
    TaskListComponent.prototype.dueBefore;
    /** @type {?} */
    TaskListComponent.prototype.rows;
    /** @type {?} */
    TaskListComponent.prototype.isLoading;
    /** @type {?} */
    TaskListComponent.prototype.sorting;
    /**
     * Toggles custom data source mode.
     * When enabled the component reloads data from it's current source instead of the server side.
     * This allows generating and displaying custom data sets (i.e. filtered out content).
     *
     * \@memberOf TaskListComponent
     * @type {?}
     */
    TaskListComponent.prototype.hasCustomDataSource;
    /**
     * @type {?}
     * @private
     */
    TaskListComponent.prototype.taskListService;
    /**
     * @type {?}
     * @private
     */
    TaskListComponent.prototype.userPreferences;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInRhc2stbGlzdC9jb21wb25lbnRzL3Rhc2stbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFrQyxlQUFlLEVBQUUsbUNBQW1DLEVBQUUscUNBQXFDLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNqSyxPQUFPLEVBQ0gsZ0JBQWdCLEVBQUUsbUJBQW1CLEVBQ3JDLHNCQUFzQixFQUFFLG9CQUFvQixFQUFtQixNQUFNLG9CQUFvQixDQUFDO0FBQzlGLE9BQU8sRUFDZSxTQUFTLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFDdkQsS0FBSyxFQUFhLE1BQU0sRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFbkUsT0FBTyxFQUFjLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsbUNBQW1DLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUU3RSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDakUsT0FBTyxNQUFNLE1BQU0sWUFBWSxDQUFDO0FBT2hDLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxlQUFlOzs7Ozs7SUF1SWxELFlBQW9CLGVBQWdDLEVBQ3hDLGdCQUFrQyxFQUMxQixlQUF1QztRQUN2RCxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUMsVUFBVSxFQUFFLHVCQUF1QixDQUFDLENBQUM7UUFIL0Qsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBRWhDLG9CQUFlLEdBQWYsZUFBZSxDQUF3Qjs7Ozs7O1FBekUzRCxrQkFBYSxHQUFXLFFBQVEsQ0FBQyxDQUFDLHVCQUF1Qjs7Ozs7UUFJekQsZ0JB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dXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERhdGFSb3dFdmVudCwgRGF0YVRhYmxlQWRhcHRlciwgRGF0YVRhYmxlU2NoZW1hLCBDdXN0b21FbXB0eUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSwgQ3VzdG9tTG9hZGluZ0NvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge1xuICAgIEFwcENvbmZpZ1NlcnZpY2UsIFBhZ2luYXRpb25Db21wb25lbnQsIFBhZ2luYXRlZENvbXBvbmVudCxcbiAgICBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlLCBVc2VyUHJlZmVyZW5jZVZhbHVlcywgUGFnaW5hdGlvbk1vZGVsIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7XG4gICAgQWZ0ZXJDb250ZW50SW5pdCwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBUYXNrUXVlcnlSZXF1ZXN0UmVwcmVzZW50YXRpb25Nb2RlbCB9IGZyb20gJy4uL21vZGVscy9maWx0ZXIubW9kZWwnO1xuaW1wb3J0IHsgVGFza0xpc3RNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWxpc3QubW9kZWwnO1xuaW1wb3J0IHsgdGFza1ByZXNldHNEZWZhdWx0TW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvdGFzay1wcmVzZXQubW9kZWwnO1xuaW1wb3J0IHsgVGFza0xpc3RTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy90YXNrbGlzdC5zZXJ2aWNlJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LWVzNic7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXRhc2tsaXN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGFzay1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi90YXNrLWxpc3QuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFRhc2tMaXN0Q29tcG9uZW50IGV4dGVuZHMgRGF0YVRhYmxlU2NoZW1hIGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlckNvbnRlbnRJbml0LCBQYWdpbmF0ZWRDb21wb25lbnQge1xuXG4gICAgc3RhdGljIFBSRVNFVF9LRVkgPSAnYWRmLXRhc2stbGlzdC5wcmVzZXRzJztcblxuICAgIEBDb250ZW50Q2hpbGQoQ3VzdG9tRW1wdHlDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUpXG4gICAgY3VzdG9tRW1wdHlDb250ZW50OiBDdXN0b21FbXB0eUNvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZTtcblxuICAgIEBDb250ZW50Q2hpbGQoQ3VzdG9tTG9hZGluZ0NvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZSlcbiAgICBjdXN0b21Mb2FkaW5nQ29udGVudDogQ3VzdG9tTG9hZGluZ0NvbnRlbnRUZW1wbGF0ZURpcmVjdGl2ZTtcblxuICAgIHJlcXVlc3ROb2RlOiBUYXNrUXVlcnlSZXF1ZXN0UmVwcmVzZW50YXRpb25Nb2RlbDtcblxuICAgIC8qKiBUaGUgaWQgb2YgdGhlIGFwcC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGFwcElkOiBudW1iZXI7XG5cbiAgICAvKiogVGhlIEluc3RhbmNlIElkIG9mIHRoZSBwcm9jZXNzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0luc3RhbmNlSWQ6IHN0cmluZztcblxuICAgIC8qKiBUaGUgRGVmaW5pdGlvbiBJZCBvZiB0aGUgcHJvY2Vzcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NEZWZpbml0aW9uSWQ6IHN0cmluZztcblxuICAgIC8qKiBDdXJyZW50IHN0YXRlIG9mIHRoZSBwcm9jZXNzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOiBgY29tcGxldGVkYCwgYGFjdGl2ZWAuICovXG4gICAgQElucHV0KClcbiAgICBzdGF0ZTogc3RyaW5nO1xuXG4gICAgLyoqIFRoZSBhc3NpZ25tZW50IG9mIHRoZSBwcm9jZXNzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOiBcImFzc2lnbmVlXCIgKHRoZSBjdXJyZW50IHVzZXJcbiAgICAgKiBpcyB0aGUgYXNzaWduZWUpLCBcImNhbmRpZGF0ZVwiICh0aGUgY3VycmVudCB1c2VyIGlzIGEgdGFzayBjYW5kaWRhdGUsIFwiZ3JvdXBfeFwiICh0aGUgdGFza1xuICAgICAqIGlzIGFzc2lnbmVkIHRvIGEgZ3JvdXAgd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBpcyBhIG1lbWJlcixcbiAgICAgKiBubyB2YWx1ZSAodGhlIGN1cnJlbnQgdXNlciBpcyBpbnZvbHZlZCkuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBhc3NpZ25tZW50OiBzdHJpbmc7XG5cbiAgICAvKiogRGVmaW5lIHRoZSBzb3J0IG9yZGVyIG9mIHRoZSB0YXNrcy4gUG9zc2libGUgdmFsdWVzIGFyZSA6IGBjcmVhdGVkLWRlc2NgLFxuICAgICAqIGBjcmVhdGVkLWFzY2AsIGBkdWUtZGVzY2AsIGBkdWUtYXNjYFxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc29ydDogc3RyaW5nO1xuXG4gICAgLyoqIE5hbWUgb2YgdGhlIHRhc2tsaXN0LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbmFtZTogc3RyaW5nO1xuXG4gICAgLyoqIERlZmluZSB3aGljaCB0YXNrIGlkIHNob3VsZCBiZSBzZWxlY3RlZCBhZnRlciByZWxvYWRpbmcuIElmIHRoZSB0YXNrIGlkIGRvZXNuJ3RcbiAgICAgKiBleGlzdCBvciBub3RoaW5nIGlzIHBhc3NlZCB0aGVuIHRoZSBmaXJzdCB0YXNrIHdpbGwgYmUgc2VsZWN0ZWQuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBsYW5kaW5nVGFza0lkOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBEYXRhIHNvdXJjZSBvYmplY3QgdGhhdCByZXByZXNlbnRzIHRoZSBudW1iZXIgYW5kIHRoZSB0eXBlIG9mIHRoZSBjb2x1bW5zIHRoYXRcbiAgICAgKiB5b3Ugd2FudCB0byBzaG93LlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGF0YTogRGF0YVRhYmxlQWRhcHRlcjtcblxuICAgIC8qKiBSb3cgc2VsZWN0aW9uIG1vZGUuIENhbiBiZSBub25lLCBgc2luZ2xlYCBvciBgbXVsdGlwbGVgLiBGb3IgYG11bHRpcGxlYCBtb2RlLFxuICAgICAqIHlvdSBjYW4gdXNlIENtZCAobWFjT1MpIG9yIEN0cmwgKFdpbikgbW9kaWZpZXIga2V5IHRvIHRvZ2dsZSBzZWxlY3Rpb24gZm9yXG4gICAgICogbXVsdGlwbGUgcm93cy5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNlbGVjdGlvbk1vZGU6IHN0cmluZyA9ICdzaW5nbGUnOyAvLyBub25lfHNpbmdsZXxtdWx0aXBsZVxuXG4gICAgLyoqIFRvZ2dsZXMgbXVsdGlwbGUgcm93IHNlbGVjdGlvbiwgcmVuZGVycyBjaGVja2JveGVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgZWFjaCByb3cgKi9cbiAgICBASW5wdXQoKVxuICAgIG11bHRpc2VsZWN0OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyBkZWZhdWx0IHNlbGVjdGlvbiBvZiB0aGUgZmlyc3Qgcm93ICovXG4gICAgQElucHV0KClcbiAgICBzZWxlY3RGaXJzdFJvdzogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVGhlIGlkIG9mIGEgdGFzayAqL1xuICAgIEBJbnB1dCgpXG4gICAgdGFza0lkOiBzdHJpbmc7XG5cbiAgICAvKiogVG9nZ2xlcyBpbmNsdXNpb24gb2YgUHJvY2VzcyBJbnN0YW5jZXMgKi9cbiAgICBASW5wdXQoKVxuICAgIGluY2x1ZGVQcm9jZXNzSW5zdGFuY2U6IGJvb2xlYW47XG5cbiAgICAvKiogU3RhcnRpbmcgcG9pbnQgb2YgdGhlIGxpc3Qgd2l0aGluIHRoZSBmdWxsIHNldCBvZiB0YXNrcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHN0YXJ0OiBudW1iZXI7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgdGFzayBpbiB0aGUgbGlzdCBpcyBjbGlja2VkICovXG4gICAgQE91dHB1dCgpXG4gICAgcm93Q2xpY2s6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHJvd3MgYXJlIHNlbGVjdGVkL3Vuc2VsZWN0ZWQgKi9cbiAgICBAT3V0cHV0KClcbiAgICByb3dzU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxhbnlbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueVtdPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgdGFzayBsaXN0IGlzIGxvYWRlZCAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIGN1cnJlbnRJbnN0YW5jZUlkOiBzdHJpbmc7XG4gICAgc2VsZWN0ZWRJbnN0YW5jZXM6IGFueVtdO1xuICAgIHBhZ2luYXRpb246IEJlaGF2aW9yU3ViamVjdDxQYWdpbmF0aW9uTW9kZWw+O1xuXG4gICAgLyoqIFRoZSBwYWdlIG51bWJlciBvZiB0aGUgdGFza3MgdG8gZmV0Y2guICovXG4gICAgQElucHV0KClcbiAgICBwYWdlOiBudW1iZXIgPSAwO1xuXG4gICAgLyoqIFRoZSBudW1iZXIgb2YgdGFza3MgdG8gZmV0Y2guIERlZmF1bHQgdmFsdWU6IDI1LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2l6ZTogbnVtYmVyID0gUGFnaW5hdGlvbkNvbXBvbmVudC5ERUZBVUxUX1BBR0lOQVRJT04ubWF4SXRlbXM7XG5cbiAgICAvKiogRmlsdGVyIHRoZSB0YXNrcy4gRGlzcGxheSBvbmx5IHRhc2tzIHdpdGggYGNyZWF0ZWRfZGF0ZWAgYWZ0ZXIgYGR1ZUFmdGVyYC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGR1ZUFmdGVyOiBzdHJpbmc7XG5cbiAgICAvKiogRmlsdGVyIHRoZSB0YXNrcy4gRGlzcGxheSBvbmx5IHRhc2tzIHdpdGggYGNyZWF0ZWRfZGF0ZWAgYmVmb3JlIGBkdWVCZWZvcmVgLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZHVlQmVmb3JlOiBzdHJpbmc7XG5cbiAgICByb3dzOiBhbnlbXSA9IFtdO1xuICAgIGlzTG9hZGluZzogYm9vbGVhbiA9IHRydWU7XG4gICAgc29ydGluZzogYW55W10gPSBbJ2NyZWF0ZWQnLCAnZGVzYyddO1xuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlcyBjdXN0b20gZGF0YSBzb3VyY2UgbW9kZS5cbiAgICAgKiBXaGVuIGVuYWJsZWQgdGhlIGNvbXBvbmVudCByZWxvYWRzIGRhdGEgZnJvbSBpdCdzIGN1cnJlbnQgc291cmNlIGluc3RlYWQgb2YgdGhlIHNlcnZlciBzaWRlLlxuICAgICAqIFRoaXMgYWxsb3dzIGdlbmVyYXRpbmcgYW5kIGRpc3BsYXlpbmcgY3VzdG9tIGRhdGEgc2V0cyAoaS5lLiBmaWx0ZXJlZCBvdXQgY29udGVudCkuXG4gICAgICpcbiAgICAgKiBAbWVtYmVyT2YgVGFza0xpc3RDb21wb25lbnRcbiAgICAgKi9cbiAgICBoYXNDdXN0b21EYXRhU291cmNlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRhc2tMaXN0U2VydmljZTogVGFza0xpc3RTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIGFwcENvbmZpZ1NlcnZpY2U6IEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2VyUHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoYXBwQ29uZmlnU2VydmljZSwgVGFza0xpc3RDb21wb25lbnQuUFJFU0VUX0tFWSwgdGFza1ByZXNldHNEZWZhdWx0TW9kZWwpO1xuICAgICAgICB0aGlzLnVzZXJQcmVmZXJlbmNlcy5zZWxlY3QoVXNlclByZWZlcmVuY2VWYWx1ZXMuUGFnaW5hdGlvblNpemUpLnN1YnNjcmliZSgocGFnZVNpemUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHBhZ2VTaXplO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnBhZ2luYXRpb24gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFBhZ2luYXRpb25Nb2RlbD4oPFBhZ2luYXRpb25Nb2RlbD4ge1xuICAgICAgICAgICAgbWF4SXRlbXM6IHRoaXMuc2l6ZSxcbiAgICAgICAgICAgIHNraXBDb3VudDogMCxcbiAgICAgICAgICAgIHRvdGFsSXRlbXM6IDBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgICAgICB0aGlzLmNyZWF0ZURhdGF0YWJsZVNjaGVtYSgpO1xuICAgICAgICBpZiAodGhpcy5kYXRhICYmIHRoaXMuZGF0YS5nZXRDb2x1bW5zKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuc2V0Q29sdW1ucyh0aGlzLmNvbHVtbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYXBwSWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRDdXN0b21EYXRhU291cmNlKHJvd3M6IGFueVtdKTogdm9pZCB7XG4gICAgICAgIGlmIChyb3dzKSB7XG4gICAgICAgICAgICB0aGlzLnJvd3MgPSByb3dzO1xuICAgICAgICAgICAgdGhpcy5oYXNDdXN0b21EYXRhU291cmNlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNQcm9wZXJ0eUNoYW5nZWQoY2hhbmdlcykpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU29ydENoYW5nZWQoY2hhbmdlcykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRpbmcgPSB0aGlzLnNvcnQgPyB0aGlzLnNvcnQuc3BsaXQoJy0nKSA6IHRoaXMuc29ydGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVsb2FkKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU29ydENoYW5nZWQoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBhY3R1YWxTb3J0ID0gY2hhbmdlc1snc29ydCddO1xuICAgICAgICByZXR1cm4gYWN0dWFsU29ydCAmJiBhY3R1YWxTb3J0LmN1cnJlbnRWYWx1ZSAmJiBhY3R1YWxTb3J0LmN1cnJlbnRWYWx1ZSAhPT0gYWN0dWFsU29ydC5wcmV2aW91c1ZhbHVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNQcm9wZXJ0eUNoYW5nZWQoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgY2hhbmdlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAgICAgY29uc3QgbGFuZGluZ1Rhc2tJZCA9IGNoYW5nZXNbJ2xhbmRpbmdUYXNrSWQnXTtcbiAgICAgICAgY29uc3QgcGFnZSA9IGNoYW5nZXNbJ3BhZ2UnXTtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IGNoYW5nZXNbJ3NpemUnXTtcbiAgICAgICAgaWYgKGxhbmRpbmdUYXNrSWQgJiYgbGFuZGluZ1Rhc2tJZC5jdXJyZW50VmFsdWUgJiYgdGhpcy5pc0VxdWFsVG9DdXJyZW50SWQobGFuZGluZ1Rhc2tJZC5jdXJyZW50VmFsdWUpKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAocGFnZSAmJiBwYWdlLmN1cnJlbnRWYWx1ZSAhPT0gcGFnZS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzaXplICYmIHNpemUuY3VycmVudFZhbHVlICE9PSBzaXplLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNoYW5nZWQ7XG4gICAgfVxuXG4gICAgcmVsb2FkKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuaGFzQ3VzdG9tRGF0YVNvdXJjZSkge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0Tm9kZSA9IHRoaXMuY3JlYXRlUmVxdWVzdE5vZGUoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZCh0aGlzLnJlcXVlc3ROb2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWQocmVxdWVzdE5vZGU6IFRhc2tRdWVyeVJlcXVlc3RSZXByZXNlbnRhdGlvbk1vZGVsKSB7XG4gICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkVGFza3NCeVN0YXRlKCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHRhc2tzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3dzID0gdGhpcy5vcHRpbWl6ZVRhc2tEZXRhaWxzKHRhc2tzLmRhdGEpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0VGFzayh0aGlzLmxhbmRpbmdUYXNrSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KHRhc2tzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbi5uZXh0KHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHRhc2tzLmRhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICBtYXhJdGVtczogdGhpcy5zaXplLFxuICAgICAgICAgICAgICAgICAgICBza2lwQ291bnQ6IHRoaXMucGFnZSAqIHRoaXMuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxJdGVtczogdGFza3MudG90YWxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZFRhc2tzQnlTdGF0ZSgpOiBPYnNlcnZhYmxlPFRhc2tMaXN0TW9kZWw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdE5vZGUuc3RhdGUgPT09ICdhbGwnXG4gICAgICAgICAgICA/IHRoaXMudGFza0xpc3RTZXJ2aWNlLmZpbmRBbGxUYXNrc1dpdGhvdXRTdGF0ZSh0aGlzLnJlcXVlc3ROb2RlKVxuICAgICAgICAgICAgOiB0aGlzLnRhc2tMaXN0U2VydmljZS5maW5kVGFza3NCeVN0YXRlKHRoaXMucmVxdWVzdE5vZGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCB0aGUgdGFzayBnaXZlbiBpbiBpbnB1dCBpZiBwcmVzZW50XG4gICAgICovXG4gICAgc2VsZWN0VGFzayh0YXNrSWRTZWxlY3RlZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5pc0xpc3RFbXB0eSgpKSB7XG4gICAgICAgICAgICBsZXQgZGF0YVJvdyA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGFza0lkU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhUm93ID0gdGhpcy5yb3dzLmZpbmQoKGN1cnJlbnRSb3c6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFJvd1snaWQnXSA9PT0gdGFza0lkU2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWRhdGFSb3cgJiYgdGhpcy5zZWxlY3RGaXJzdFJvdykge1xuICAgICAgICAgICAgICAgIGRhdGFSb3cgPSB0aGlzLnJvd3NbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YVJvdykge1xuICAgICAgICAgICAgICAgIGRhdGFSb3cuaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2VJZCA9IGRhdGFSb3dbJ2lkJ107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZUlkID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgY3VycmVudCBpZFxuICAgICAqL1xuICAgIGdldEN1cnJlbnRJZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW5zdGFuY2VJZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgdGFza0lkIGlzIHRoZSBzYW1lIG9mIHRoZSBzZWxlY3RlZCB0YXNrXG4gICAgICogQHBhcmFtIHRhc2tJZFxuICAgICAqL1xuICAgIGlzRXF1YWxUb0N1cnJlbnRJZCh0YXNrSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW5zdGFuY2VJZCA9PT0gdGFza0lkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBsaXN0IGlzIGVtcHR5XG4gICAgICovXG4gICAgaXNMaXN0RW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5yb3dzIHx8IHRoaXMucm93cy5sZW5ndGggPT09IDA7XG4gICAgfVxuXG4gICAgb25Sb3dDbGljayhpdGVtOiBEYXRhUm93RXZlbnQpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2VJZCA9IGl0ZW0udmFsdWUuZ2V0VmFsdWUoJ2lkJyk7XG4gICAgICAgIHRoaXMucm93Q2xpY2suZW1pdCh0aGlzLmN1cnJlbnRJbnN0YW5jZUlkKTtcbiAgICB9XG5cbiAgICBvblJvd1NlbGVjdChldmVudDogQ3VzdG9tRXZlbnQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluc3RhbmNlcyA9IFsuLi5ldmVudC5kZXRhaWwuc2VsZWN0aW9uXTtcbiAgICAgICAgdGhpcy5yb3dzU2VsZWN0ZWQuZW1pdCh0aGlzLnNlbGVjdGVkSW5zdGFuY2VzKTtcbiAgICB9XG5cbiAgICBvblJvd1Vuc2VsZWN0KGV2ZW50OiBDdXN0b21FdmVudCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSW5zdGFuY2VzID0gWy4uLmV2ZW50LmRldGFpbC5zZWxlY3Rpb25dO1xuICAgICAgICB0aGlzLnJvd3NTZWxlY3RlZC5lbWl0KHRoaXMuc2VsZWN0ZWRJbnN0YW5jZXMpO1xuICAgIH1cblxuICAgIG9uUm93S2V5VXAoZXZlbnQ6IEN1c3RvbUV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5kZXRhaWwua2V5Ym9hcmRFdmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZUlkID0gZXZlbnQuZGV0YWlsLnJvdy5nZXRWYWx1ZSgnaWQnKTtcbiAgICAgICAgICAgIHRoaXMucm93Q2xpY2suZW1pdCh0aGlzLmN1cnJlbnRJbnN0YW5jZUlkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wdGltaXplIG5hbWUgZmllbGRcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2VzXG4gICAgICovXG4gICAgcHJpdmF0ZSBvcHRpbWl6ZVRhc2tEZXRhaWxzKGluc3RhbmNlczogYW55W10pOiBhbnlbXSB7XG4gICAgICAgIGluc3RhbmNlcyA9IGluc3RhbmNlcy5tYXAoKHRhc2spID0+IHtcbiAgICAgICAgICAgIGlmICghdGFzay5uYW1lKSB7XG4gICAgICAgICAgICAgICAgdGFzay5uYW1lID0gJ05vIG5hbWUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRhc2s7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW5zdGFuY2VzO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlUmVxdWVzdE5vZGUoKSB7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdE5vZGUgPSB7XG4gICAgICAgICAgICBhcHBEZWZpbml0aW9uSWQ6IHRoaXMuYXBwSWQsXG4gICAgICAgICAgICBkdWVBZnRlcjogdGhpcy5kdWVBZnRlciA/IG1vbWVudCh0aGlzLmR1ZUFmdGVyKS50b0RhdGUoKSA6IG51bGwsXG4gICAgICAgICAgICBkdWVCZWZvcmU6IHRoaXMuZHVlQmVmb3JlID8gbW9tZW50KHRoaXMuZHVlQmVmb3JlKS50b0RhdGUoKSA6IG51bGwsXG4gICAgICAgICAgICBwcm9jZXNzSW5zdGFuY2VJZDogdGhpcy5wcm9jZXNzSW5zdGFuY2VJZCxcbiAgICAgICAgICAgIHByb2Nlc3NEZWZpbml0aW9uSWQ6IHRoaXMucHJvY2Vzc0RlZmluaXRpb25JZCxcbiAgICAgICAgICAgIHRleHQ6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIGFzc2lnbm1lbnQ6IHRoaXMuYXNzaWdubWVudCxcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgc29ydDogdGhpcy5zb3J0LFxuICAgICAgICAgICAgcGFnZTogdGhpcy5wYWdlLFxuICAgICAgICAgICAgc2l6ZTogdGhpcy5zaXplLFxuICAgICAgICAgICAgc3RhcnQ6IHRoaXMuc3RhcnQsXG4gICAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0lkLFxuICAgICAgICAgICAgaW5jbHVkZVByb2Nlc3NJbnN0YW5jZTogdGhpcy5pbmNsdWRlUHJvY2Vzc0luc3RhbmNlXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBuZXcgVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwocmVxdWVzdE5vZGUpO1xuICAgIH1cblxuICAgIHVwZGF0ZVBhZ2luYXRpb24ocGFyYW1zOiBQYWdpbmF0aW9uTW9kZWwpIHtcbiAgICAgICAgY29uc3QgbmVlZHNSZWxvYWQgPSBwYXJhbXMubWF4SXRlbXMgfHwgcGFyYW1zLnNraXBDb3VudDtcbiAgICAgICAgdGhpcy5zaXplID0gcGFyYW1zLm1heEl0ZW1zO1xuICAgICAgICB0aGlzLnBhZ2UgPSB0aGlzLmN1cnJlbnRQYWdlKHBhcmFtcy5za2lwQ291bnQsIHBhcmFtcy5tYXhJdGVtcyk7XG4gICAgICAgIGlmIChuZWVkc1JlbG9hZCkge1xuICAgICAgICAgICAgdGhpcy5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGN1cnJlbnRQYWdlKHNraXBDb3VudDogbnVtYmVyLCBtYXhJdGVtczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIChza2lwQ291bnQgJiYgbWF4SXRlbXMpID8gTWF0aC5mbG9vcihza2lwQ291bnQgLyBtYXhJdGVtcykgOiAwO1xuICAgIH1cbn1cbiJdfQ==