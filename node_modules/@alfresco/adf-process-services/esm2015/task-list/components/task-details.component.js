/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { PeopleProcessService, UserProcessModel } from '@alfresco/adf-core';
import { AuthenticationService, CardViewUpdateService, LogService, CommentsComponent } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material';
import { Observable } from 'rxjs';
import { TaskQueryRequestRepresentationModel } from '../models/filter.model';
import { TaskDetailsModel } from '../models/task-details.model';
import { TaskListService } from './../services/tasklist.service';
import { share } from 'rxjs/operators';
export class TaskDetailsComponent {
    /**
     * @param {?} taskListService
     * @param {?} authService
     * @param {?} peopleProcessService
     * @param {?} logService
     * @param {?} cardViewUpdateService
     * @param {?} dialog
     */
    constructor(taskListService, authService, peopleProcessService, logService, cardViewUpdateService, dialog) {
        this.taskListService = taskListService;
        this.authService = authService;
        this.peopleProcessService = peopleProcessService;
        this.logService = logService;
        this.cardViewUpdateService = cardViewUpdateService;
        this.dialog = dialog;
        /**
         * Toggles debug mode.
         */
        this.debugMode = false;
        /**
         * Automatically renders the next task when the current one is completed.
         */
        this.showNextTask = true;
        /**
         * Toggles task details Header component.
         */
        this.showHeader = true;
        /**
         * Toggles collapsed/expanded state of the Header component.
         */
        this.showHeaderContent = true;
        /**
         * Toggles `Involve People` feature for the Header component.
         */
        this.showInvolvePeople = true;
        /**
         * Toggles `Comments` feature for the Header component.
         */
        this.showComments = true;
        /**
         * Toggles `Checklist` feature for the Header component.
         */
        this.showChecklist = true;
        /**
         * Toggles rendering of the form title.
         */
        this.showFormTitle = false;
        /**
         * Toggles rendering of the `Complete` outcome button.
         */
        this.showFormCompleteButton = true;
        /**
         * Toggles rendering of the `Save` outcome button.
         */
        this.showFormSaveButton = true;
        /**
         * Toggles read-only state of the form. All form widgets render as read-only
         * if enabled.
         */
        this.readOnlyForm = false;
        /**
         * Toggles rendering of the `Refresh` button.
         */
        this.showFormRefreshButton = true;
        /**
         * Field validators for use with the form.
         */
        this.fieldValidators = [];
        /**
         * Emitted when the form is submitted with the `Save` or custom outcomes.
         */
        this.formSaved = new EventEmitter();
        /**
         * Emitted when the form is submitted with the `Complete` outcome.
         */
        this.formCompleted = new EventEmitter();
        /**
         * Emitted when the form field content is clicked.
         */
        this.formContentClicked = new EventEmitter();
        /**
         * Emitted when the form is loaded or reloaded.
         */
        this.formLoaded = new EventEmitter();
        /**
         * Emitted when a checklist task is created.
         */
        this.taskCreated = new EventEmitter();
        /**
         * Emitted when a checklist task is deleted.
         */
        this.taskDeleted = new EventEmitter();
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        /**
         * Emitted when any outcome is executed. Default behaviour can be prevented
         * via `event.preventDefault()`.
         */
        this.executeOutcome = new EventEmitter();
        /**
         * Emitted when a task is assigned.
         */
        this.assignTask = new EventEmitter();
        /**
         * Emitted when a task is claimed.
         */
        this.claimedTask = new EventEmitter();
        /**
         * Emitted when a task is unclaimed.
         */
        this.unClaimedTask = new EventEmitter();
        this.taskFormName = null;
        this.taskPeople = [];
        this.showAssignee = false;
        this.showAttachForm = false;
        this.internalReadOnlyForm = false;
        this.peopleSearch = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => this.peopleSearchObserver = observer))
            .pipe(share());
        this.authService.getBpmLoggedUser().subscribe((/**
         * @param {?} user
         * @return {?}
         */
        (user) => {
            this.currentLoggedUser = user;
        }));
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.taskId) {
            this.loadDetails(this.taskId);
        }
        this.cardViewUpdateService.itemUpdated$.subscribe(this.updateTaskDetails.bind(this));
        this.cardViewUpdateService.itemClicked$.subscribe(this.clickTaskDetails.bind(this));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const taskId = changes.taskId;
        this.showAssignee = false;
        if (taskId && !taskId.currentValue) {
            this.reset();
        }
        else if (taskId && taskId.currentValue) {
            this.loadDetails(taskId.currentValue);
        }
    }
    /**
     * @return {?}
     */
    isStandaloneTask() {
        return !(this.taskDetails && (!!this.taskDetails.processDefinitionId));
    }
    /**
     * @return {?}
     */
    isStandaloneTaskWithForm() {
        return this.isStandaloneTask() && this.hasFormKey();
    }
    /**
     * @return {?}
     */
    isStandaloneTaskWithoutForm() {
        return this.isStandaloneTask() && !this.hasFormKey();
    }
    /**
     * @return {?}
     */
    isFormComponentVisible() {
        return this.hasFormKey() && !this.isShowAttachForm();
    }
    /**
     * @return {?}
     */
    isTaskStandaloneComponentVisible() {
        return this.isStandaloneTaskWithoutForm() && !this.isShowAttachForm();
    }
    /**
     * @return {?}
     */
    isShowAttachForm() {
        return this.showAttachForm;
    }
    /**
     * Reset the task details
     * @private
     * @return {?}
     */
    reset() {
        this.taskDetails = null;
    }
    /**
     * Check if the task has a form
     * @return {?}
     */
    hasFormKey() {
        return (this.taskDetails && (!!this.taskDetails.formKey));
    }
    /**
     * @return {?}
     */
    isTaskActive() {
        return this.taskDetails && this.taskDetails.duration === null;
    }
    /**
     * Save a task detail and update it after a successful response
     *
     * @private
     * @param {?} updateNotification
     * @return {?}
     */
    updateTaskDetails(updateNotification) {
        this.taskListService.updateTask(this.taskId, updateNotification.changed)
            .subscribe((/**
         * @return {?}
         */
        () => {
            this.loadDetails(this.taskId);
        }));
    }
    /**
     * @private
     * @param {?} clickNotification
     * @return {?}
     */
    clickTaskDetails(clickNotification) {
        if (clickNotification.target.key === 'assignee') {
            this.showAssignee = true;
        }
        if (clickNotification.target.key === 'formName') {
            this.showAttachForm = true;
        }
    }
    /**
     * Load the activiti task details
     * @private
     * @param {?} taskId
     * @return {?}
     */
    loadDetails(taskId) {
        this.taskPeople = [];
        this.taskFormName = null;
        if (taskId) {
            this.taskListService.getTaskDetails(taskId).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                this.showAttachForm = false;
                this.taskDetails = res;
                if (this.taskDetails.name === 'null') {
                    this.taskDetails.name = 'No name';
                }
                /** @type {?} */
                const endDate = res.endDate;
                if (endDate && !isNaN(endDate.getTime())) {
                    this.internalReadOnlyForm = true;
                }
                else {
                    this.internalReadOnlyForm = this.readOnlyForm;
                }
                if (this.taskDetails && this.taskDetails.involvedPeople) {
                    this.taskDetails.involvedPeople.forEach((/**
                     * @param {?} user
                     * @return {?}
                     */
                    (user) => {
                        this.taskPeople.push(new UserProcessModel(user));
                    }));
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    isAssigned() {
        return !!this.taskDetails.assignee;
    }
    /**
     * @private
     * @return {?}
     */
    hasEmailAddress() {
        return this.taskDetails.assignee.email ? true : false;
    }
    /**
     * @return {?}
     */
    isAssignedToMe() {
        return this.isAssigned() && this.hasEmailAddress() ?
            this.isEmailEqual(this.taskDetails.assignee.email, this.currentLoggedUser.email) :
            this.isExternalIdEqual(this.taskDetails.assignee.externalId, this.currentLoggedUser.externalId);
    }
    /**
     * @private
     * @param {?} assigneeMail
     * @param {?} currentLoggedEmail
     * @return {?}
     */
    isEmailEqual(assigneeMail, currentLoggedEmail) {
        return assigneeMail.toLocaleLowerCase() === currentLoggedEmail.toLocaleLowerCase();
    }
    /**
     * @private
     * @param {?} assigneeExternalId
     * @param {?} currentUserExternalId
     * @return {?}
     */
    isExternalIdEqual(assigneeExternalId, currentUserExternalId) {
        return assigneeExternalId.toLocaleLowerCase() === currentUserExternalId.toLocaleLowerCase();
    }
    /**
     * @return {?}
     */
    isCompleteButtonEnabled() {
        return this.isAssignedToMe() || this.canInitiatorComplete();
    }
    /**
     * @return {?}
     */
    isCompleteButtonVisible() {
        return !this.hasFormKey() && this.isTaskActive() && this.isCompleteButtonEnabled();
    }
    /**
     * @return {?}
     */
    canInitiatorComplete() {
        return this.taskDetails.initiatorCanCompleteTask;
    }
    /**
     * @return {?}
     */
    isSaveButtonVisible() {
        return this.hasSaveButton() && (!this.canInitiatorComplete() || this.isAssignedToMe());
    }
    /**
     * @return {?}
     */
    hasSaveButton() {
        return this.showFormSaveButton;
    }
    /**
     * Retrieve the next open task
     * @private
     * @param {?} processInstanceId
     * @param {?} processDefinitionId
     * @return {?}
     */
    loadNextTask(processInstanceId, processDefinitionId) {
        /** @type {?} */
        const requestNode = new TaskQueryRequestRepresentationModel({
            processInstanceId: processInstanceId,
            processDefinitionId: processDefinitionId
        });
        this.taskListService.getTasks(requestNode).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            if (response && response.length > 0) {
                this.taskDetails = new TaskDetailsModel(response[0]);
            }
            else {
                this.reset();
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            this.error.emit(error);
        }));
    }
    /**
     * Complete button clicked
     * @return {?}
     */
    onComplete() {
        this.taskListService.completeTask(this.taskId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => this.onFormCompleted(null)));
    }
    /**
     * @return {?}
     */
    onShowAttachForm() {
        this.showAttachForm = true;
    }
    /**
     * @return {?}
     */
    onCancelAttachForm() {
        this.showAttachForm = false;
    }
    /**
     * @return {?}
     */
    onCompleteAttachForm() {
        this.showAttachForm = false;
        this.loadDetails(this.taskId);
    }
    /**
     * @param {?} content
     * @return {?}
     */
    onFormContentClick(content) {
        this.formContentClicked.emit(content);
    }
    /**
     * @param {?} form
     * @return {?}
     */
    onFormSaved(form) {
        this.formSaved.emit(form);
    }
    /**
     * @param {?} form
     * @return {?}
     */
    onFormCompleted(form) {
        this.formCompleted.emit(form);
        if (this.showNextTask && (this.taskDetails.processInstanceId || this.taskDetails.processDefinitionId)) {
            this.loadNextTask(this.taskDetails.processInstanceId, this.taskDetails.processDefinitionId);
        }
    }
    /**
     * @param {?} form
     * @return {?}
     */
    onFormLoaded(form) {
        this.taskFormName = (form && form.name ? form.name : null);
        this.formLoaded.emit(form);
    }
    /**
     * @param {?} task
     * @return {?}
     */
    onChecklistTaskCreated(task) {
        this.taskCreated.emit(task);
    }
    /**
     * @param {?} taskId
     * @return {?}
     */
    onChecklistTaskDeleted(taskId) {
        this.taskDeleted.emit(taskId);
    }
    /**
     * @param {?} error
     * @return {?}
     */
    onFormError(error) {
        this.errorDialogRef = this.dialog.open(this.errorDialog, { width: '500px' });
        this.error.emit(error);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onFormExecuteOutcome(event) {
        this.executeOutcome.emit(event);
    }
    /**
     * @return {?}
     */
    closeErrorDialog() {
        this.dialog.closeAll();
    }
    /**
     * @param {?} taskId
     * @return {?}
     */
    onClaimAction(taskId) {
        this.claimedTask.emit(taskId);
        this.loadDetails(taskId);
    }
    /**
     * @param {?} taskId
     * @return {?}
     */
    onUnclaimAction(taskId) {
        this.unClaimedTask.emit(taskId);
        this.loadDetails(taskId);
    }
    /**
     * @return {?}
     */
    isCompletedTask() {
        return this.taskDetails && this.taskDetails.endDate ? true : undefined;
    }
    /**
     * @param {?} searchedWord
     * @return {?}
     */
    searchUser(searchedWord) {
        this.peopleProcessService.getWorkflowUsers(null, searchedWord)
            .subscribe((/**
         * @param {?} users
         * @return {?}
         */
        (users) => {
            users = users.filter((/**
             * @param {?} user
             * @return {?}
             */
            (user) => user.id !== this.taskDetails.assignee.id));
            this.peopleSearchObserver.next(users);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => this.logService.error('Could not load users')));
    }
    /**
     * @return {?}
     */
    onCloseSearch() {
        this.showAssignee = false;
    }
    /**
     * @param {?} selectedUser
     * @return {?}
     */
    assignTaskToUser(selectedUser) {
        this.taskListService.assignTask(this.taskDetails.id, selectedUser).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            this.logService.info('Task Assigned to ' + selectedUser.email);
            this.assignTask.emit();
        }));
        this.showAssignee = false;
    }
    /**
     * @return {?}
     */
    getTaskHeaderViewClass() {
        if (this.showAssignee) {
            return 'assign-edit-view';
        }
        else {
            return 'default-view';
        }
    }
    /**
     * @return {?}
     */
    isReadOnlyComment() {
        return (this.taskDetails && this.taskDetails.isCompleted()) && (this.taskPeople && this.taskPeople.length === 0);
    }
}
TaskDetailsComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-task-details',
                template: "<div *ngIf=\"!taskDetails\" data-automation-id=\"adf-tasks-details--empty\">\n    <ng-template *ngIf=\"noTaskDetailsTemplateComponent\" ngFor [ngForOf]=\"[data]\"\n                 [ngForTemplate]=\"noTaskDetailsTemplateComponent\">\n        {{ 'ADF_TASK_LIST.DETAILS.MESSAGES.NONE' | translate }}\n    </ng-template>\n    <div *ngIf=\"!noTaskDetailsTemplateComponent\">\n        {{ 'ADF_TASK_LIST.DETAILS.MESSAGES.NONE' | translate }}\n    </div>\n</div>\n<div *ngIf=\"taskDetails\" class=\"adf-task-details\">\n\n    <div *ngIf=\"showHeader\" class=\"adf-task-details-header\">\n        <h2 class=\"adf-activiti-task-details__header\">\n            <span>{{taskDetails.name || 'No name'}}</span>\n        </h2>\n    </div>\n\n    <div class=\"adf-task-details-core\"\n        fxLayout=\"column\"\n        fxLayoutGap=\"8px\"\n        fxLayout.lt-lg=\"column\">\n\n        <div class=\"adf-task-details-core-form\">\n            <div *ngIf=\"isAssigned()\">\n                <adf-form *ngIf=\"isFormComponentVisible()\" #activitiForm\n                          [taskId]=\"taskDetails.id\"\n                          [showTitle]=\"showFormTitle\"\n                          [showRefreshButton]=\"showFormRefreshButton\"\n                          [showCompleteButton]=\"showFormCompleteButton\"\n                          [disableCompleteButton]=\"!isCompleteButtonEnabled()\"\n                          [showSaveButton]=\"isSaveButtonVisible()\"\n                          [readOnly]=\"internalReadOnlyForm\"\n                          [fieldValidators]=\"fieldValidators\"\n                          (formSaved)='onFormSaved($event)'\n                          (formCompleted)='onFormCompleted($event)'\n                          (formContentClicked)='onFormContentClick($event)'\n                          (formLoaded)='onFormLoaded($event)'\n                          (error)='onFormError($event)'\n                          (executeOutcome)='onFormExecuteOutcome($event)'>\n                </adf-form>\n                <adf-task-standalone *ngIf=\"isTaskStandaloneComponentVisible()\"\n                                     [taskName]=\"taskDetails.name\"\n                                     [taskId]=\"taskDetails.id\"\n                                     [isCompleted]=\"isCompletedTask()\"\n                                     [hasCompletePermission]=\"isCompleteButtonEnabled()\"\n                                     [hideCancelButton]=\"true\"\n                                     (complete)=\"onComplete()\"\n                                     (showAttachForm)=\"onShowAttachForm()\">\n                </adf-task-standalone>\n\n                <mat-card class=\"adf-message-card\" *ngIf=\"!isTaskStandaloneComponentVisible() && !isCompletedTask() && !isFormComponentVisible()\" >\n                    <mat-card-content>\n                        <div class=\"adf-no-form-message-container\">\n                            <div class=\"adf-no-form-message-list\">\n                                <div *ngIf=\"!isCompletedTask()\" class=\"adf-no-form-message\">\n                                    <span id=\"adf-no-form-message\">{{'ADF_TASK_LIST.STANDALONE_TASK.NO_FORM_MESSAGE' | translate}}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </mat-card-content>\n\n                    <mat-card-actions class=\"adf-no-form-mat-card-actions\">\n                        <div>\n                            <button mat-button id=\"adf-no-form-complete-button\" color=\"primary\" (click)=\"onComplete()\">{{ 'ADF_TASK_LIST.DETAILS.BUTTON.COMPLETE' | translate }}</button>\n                        </div>\n                    </mat-card-actions>\n\n                </mat-card>\n\n                <adf-attach-form *ngIf=\"isShowAttachForm()\"\n                                 [taskId]=\"taskDetails.id\"\n                                 [formKey]=\"taskDetails.formKey\"\n                                 (cancelAttachForm)=\"onCancelAttachForm()\"\n                                 (success)=\"onCompleteAttachForm()\">\n                </adf-attach-form>\n            </div>\n            <div *ngIf=\"!isAssigned()\" id=\"claim-message-id\">\n                {{ 'ADF_TASK_LIST.DETAILS.MESSAGES.CLAIM' | translate }}\n            </div>\n        </div>\n        <div class=\"adf-task-details-core-sidebar\">\n            <adf-info-drawer *ngIf=\"showHeaderContent\" title=\"{{ 'ADF_TASK_LIST.DETAILS.LABELS.INFO_DRAWER_TITLE' | translate }}\" id=\"adf-task-details-core-sidebar-drawer\" class=\"adf-task-details-core-sidebar-drawer\">\n                <adf-info-drawer-tab label=\"{{ 'ADF_TASK_LIST.DETAILS.LABELS.INFO_DRAWER_TAB_DETAILS_TITLE' | translate }}\">\n                    <div class=\"adf-assignment-container\" *ngIf=\"showAssignee\">\n                        <adf-people-search\n                            (searchPeople)=\"searchUser($event)\"\n                            (success)=\"assignTaskToUser($event)\"\n                            (closeSearch)=\"onCloseSearch()\"\n                            [results]=\"peopleSearch\">\n                            <ng-container adf-people-search-title>{{ 'ADF_TASK_LIST.DETAILS.LABELS.ADD_ASSIGNEE' | translate }}\n                            </ng-container>\n                            <ng-container adf-people-search-action-label>{{ 'ADF_TASK_LIST.PEOPLE.ADD_ASSIGNEE' | translate }}\n                            </ng-container>\n                        </adf-people-search>\n                    </div>\n                    <adf-task-header\n                        [class]=\"getTaskHeaderViewClass()\"\n                        [taskDetails]=\"taskDetails\"\n                        [formName]=\"taskFormName\"\n                        (claim)=\"onClaimAction($event)\"\n                        (unclaim)=\"onUnclaimAction($event)\">\n                    </adf-task-header>\n                    <adf-people *ngIf=\"showInvolvePeople\" #people\n                                [people]=\"taskPeople\"\n                                [readOnly]=\"internalReadOnlyForm\"\n                                [taskId]=\"taskDetails.id\">\n                    </adf-people>\n                </adf-info-drawer-tab>\n\n                <adf-info-drawer-tab label=\"{{ 'ADF_TASK_LIST.DETAILS.LABELS.INFO_DRAWER_TAB_ACTIVITY_TITLE' | translate }}\">\n                    <mat-card *ngIf=\"showComments\">\n                        <mat-card-content>\n                            <adf-comments #activitiComments\n                                          [readOnly]=\"isReadOnlyComment()\"\n                                          [taskId]=\"taskDetails.id\">\n                            </adf-comments>\n                        </mat-card-content>\n                    </mat-card>\n                </adf-info-drawer-tab>\n\n            </adf-info-drawer>\n\n            <div *ngIf=\"showHeaderContent\" class=\"adf-task-details-core-sidebar-checklist\">\n                <div *ngIf=\"showChecklist\">\n                    <adf-checklist #activitiChecklist\n                                   [readOnly]=\"internalReadOnlyForm\"\n                                   [taskId]=\"taskDetails.id\"\n                                   [assignee]=\"taskDetails?.assignee?.id\"\n                                   (checklistTaskCreated)=\"onChecklistTaskCreated($event)\"\n                                   (checklistTaskDeleted)=\"onChecklistTaskDeleted($event)\">\n                    </adf-checklist>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <ng-template #errorDialog>\n        <h3 matDialogTitle>{{'ADF_TASK_LIST.DETAILS.ERROR.TITLE'|translate}}</h3>\n        <mat-dialog-content>\n            <p>{{'ADF_TASK_LIST.DETAILS.ERROR.DESCRIPTION'|translate}}</p>\n        </mat-dialog-content>\n        <mat-dialog-actions>\n            <button mat-button type=\"button\" (click)=\"closeErrorDialog()\">{{'ADF_TASK_LIST.DETAILS.ERROR.CLOSE'|translate}}\n            </button>\n        </mat-dialog-actions>\n    </ng-template>\n\n</div>\n",
                styles: [":host{width:100%}.adf-error-dialog h3{margin:16px 0}.adf-activiti-task-details__header{align-self:flex-end;display:flex;font-size:24px;font-weight:300;line-height:normal;overflow:hidden;margin:8px 0 16px;cursor:pointer;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.adf-activiti-task-details__action-button{text-transform:uppercase}.adf-assignment-container{padding:10px 20px;width:auto}adf-task-header.adf-assign-edit-view ::ng-deep adf-card-view ::ng-deep .adf-property[data-automation-id=header-assignee]{display:none}.adf-task-details-header{display:flex;justify-content:space-between}.adf-task-details-header-toggle{position:relative;top:10px;margin-right:2px;height:23px;cursor:pointer;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.adf-task-details-toggle{position:relative}.adf-task-details-core{display:flex;justify-content:space-between}@media screen and (max-width:1279px){.adf-task-details-core-sidebar-drawer{margin-left:0}}.adf-task-details-core-sidebar-checklist{margin-top:30px;padding-left:20px;padding-right:20px}.adf-task-details-core-form{flex-grow:1}.adf-task-details-core-form ::ng-deep .adf-form-debug-container{display:flex;flex-direction:column;padding:20px 0}.adf-task-details-core-form ::ng-deep .adf-form-debug-container .mat-slide-toggle{margin-left:auto}.adf-task-details-core-form ::ng-deep .adf-form-debug-container .mat-slide-toggle+div{background-color:#000;padding:20px;clear:both;margin-top:30px;color:#fff}.adf-task-details-core-form ::ng-deep .mat-tab-label{flex-grow:1}"]
            }] }
];
/** @nocollapse */
TaskDetailsComponent.ctorParameters = () => [
    { type: TaskListService },
    { type: AuthenticationService },
    { type: PeopleProcessService },
    { type: LogService },
    { type: CardViewUpdateService },
    { type: MatDialog }
];
TaskDetailsComponent.propDecorators = {
    activitiComments: [{ type: ViewChild, args: ['activitiComments',] }],
    activitiChecklist: [{ type: ViewChild, args: ['activitiChecklist',] }],
    errorDialog: [{ type: ViewChild, args: ['errorDialog',] }],
    debugMode: [{ type: Input }],
    taskId: [{ type: Input }],
    showNextTask: [{ type: Input }],
    showHeader: [{ type: Input }],
    showHeaderContent: [{ type: Input }],
    showInvolvePeople: [{ type: Input }],
    showComments: [{ type: Input }],
    showChecklist: [{ type: Input }],
    showFormTitle: [{ type: Input }],
    showFormCompleteButton: [{ type: Input }],
    showFormSaveButton: [{ type: Input }],
    readOnlyForm: [{ type: Input }],
    showFormRefreshButton: [{ type: Input }],
    fieldValidators: [{ type: Input }],
    formSaved: [{ type: Output }],
    formCompleted: [{ type: Output }],
    formContentClicked: [{ type: Output }],
    formLoaded: [{ type: Output }],
    taskCreated: [{ type: Output }],
    taskDeleted: [{ type: Output }],
    error: [{ type: Output }],
    executeOutcome: [{ type: Output }],
    assignTask: [{ type: Output }],
    claimedTask: [{ type: Output }],
    unClaimedTask: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    TaskDetailsComponent.prototype.activitiComments;
    /** @type {?} */
    TaskDetailsComponent.prototype.activitiChecklist;
    /** @type {?} */
    TaskDetailsComponent.prototype.errorDialog;
    /**
     * Toggles debug mode.
     * @type {?}
     */
    TaskDetailsComponent.prototype.debugMode;
    /**
     * (**required**) The id of the task whose details we are asking for.
     * @type {?}
     */
    TaskDetailsComponent.prototype.taskId;
    /**
     * Automatically renders the next task when the current one is completed.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showNextTask;
    /**
     * Toggles task details Header component.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showHeader;
    /**
     * Toggles collapsed/expanded state of the Header component.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showHeaderContent;
    /**
     * Toggles `Involve People` feature for the Header component.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showInvolvePeople;
    /**
     * Toggles `Comments` feature for the Header component.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showComments;
    /**
     * Toggles `Checklist` feature for the Header component.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showChecklist;
    /**
     * Toggles rendering of the form title.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showFormTitle;
    /**
     * Toggles rendering of the `Complete` outcome button.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showFormCompleteButton;
    /**
     * Toggles rendering of the `Save` outcome button.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showFormSaveButton;
    /**
     * Toggles read-only state of the form. All form widgets render as read-only
     * if enabled.
     * @type {?}
     */
    TaskDetailsComponent.prototype.readOnlyForm;
    /**
     * Toggles rendering of the `Refresh` button.
     * @type {?}
     */
    TaskDetailsComponent.prototype.showFormRefreshButton;
    /**
     * Field validators for use with the form.
     * @type {?}
     */
    TaskDetailsComponent.prototype.fieldValidators;
    /**
     * Emitted when the form is submitted with the `Save` or custom outcomes.
     * @type {?}
     */
    TaskDetailsComponent.prototype.formSaved;
    /**
     * Emitted when the form is submitted with the `Complete` outcome.
     * @type {?}
     */
    TaskDetailsComponent.prototype.formCompleted;
    /**
     * Emitted when the form field content is clicked.
     * @type {?}
     */
    TaskDetailsComponent.prototype.formContentClicked;
    /**
     * Emitted when the form is loaded or reloaded.
     * @type {?}
     */
    TaskDetailsComponent.prototype.formLoaded;
    /**
     * Emitted when a checklist task is created.
     * @type {?}
     */
    TaskDetailsComponent.prototype.taskCreated;
    /**
     * Emitted when a checklist task is deleted.
     * @type {?}
     */
    TaskDetailsComponent.prototype.taskDeleted;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    TaskDetailsComponent.prototype.error;
    /**
     * Emitted when any outcome is executed. Default behaviour can be prevented
     * via `event.preventDefault()`.
     * @type {?}
     */
    TaskDetailsComponent.prototype.executeOutcome;
    /**
     * Emitted when a task is assigned.
     * @type {?}
     */
    TaskDetailsComponent.prototype.assignTask;
    /**
     * Emitted when a task is claimed.
     * @type {?}
     */
    TaskDetailsComponent.prototype.claimedTask;
    /**
     * Emitted when a task is unclaimed.
     * @type {?}
     */
    TaskDetailsComponent.prototype.unClaimedTask;
    /** @type {?} */
    TaskDetailsComponent.prototype.taskDetails;
    /** @type {?} */
    TaskDetailsComponent.prototype.taskFormName;
    /** @type {?} */
    TaskDetailsComponent.prototype.taskPeople;
    /** @type {?} */
    TaskDetailsComponent.prototype.noTaskDetailsTemplateComponent;
    /** @type {?} */
    TaskDetailsComponent.prototype.showAssignee;
    /** @type {?} */
    TaskDetailsComponent.prototype.showAttachForm;
    /** @type {?} */
    TaskDetailsComponent.prototype.internalReadOnlyForm;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.peopleSearchObserver;
    /** @type {?} */
    TaskDetailsComponent.prototype.errorDialogRef;
    /** @type {?} */
    TaskDetailsComponent.prototype.peopleSearch;
    /** @type {?} */
    TaskDetailsComponent.prototype.currentLoggedUser;
    /** @type {?} */
    TaskDetailsComponent.prototype.data;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.taskListService;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.authService;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.peopleProcessService;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.cardViewUpdateService;
    /**
     * @type {?}
     * @private
     */
    TaskDetailsComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInRhc2stbGlzdC9jb21wb25lbnRzL3Rhc2stZGV0YWlscy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDNUUsT0FBTyxFQUNILHFCQUFxQixFQUNyQixxQkFBcUIsRUFFckIsVUFBVSxFQUVWLGlCQUFpQixFQUNwQixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFDSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEVBRU4sV0FBVyxFQUNYLFNBQVMsRUFDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFnQixNQUFNLG1CQUFtQixDQUFDO0FBQzVELE9BQU8sRUFBRSxVQUFVLEVBQVksTUFBTSxNQUFNLENBQUM7QUFFNUMsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDN0UsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRWpFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU92QyxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7Ozs7SUFzSTdCLFlBQW9CLGVBQWdDLEVBQ2hDLFdBQWtDLEVBQ2xDLG9CQUEwQyxFQUMxQyxVQUFzQixFQUN0QixxQkFBNEMsRUFDNUMsTUFBaUI7UUFMakIsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLGdCQUFXLEdBQVgsV0FBVyxDQUF1QjtRQUNsQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFD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QzNELDhDQUFzRDs7SUFFdEQsNENBQTZDOztJQUU3QyxpREFBc0M7O0lBQ3RDLG9DQUFVOzs7OztJQUVFLCtDQUF3Qzs7Ozs7SUFDeEMsMkNBQTBDOzs7OztJQUMxQyxvREFBa0Q7Ozs7O0lBQ2xELDBDQUE4Qjs7Ozs7SUFDOUIscURBQW9EOzs7OztJQUNwRCxzQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBQZW9wbGVQcm9jZXNzU2VydmljZSwgVXNlclByb2Nlc3NNb2RlbCB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge1xuICAgIEF1dGhlbnRpY2F0aW9uU2VydmljZSxcbiAgICBDYXJkVmlld1VwZGF0ZVNlcnZpY2UsXG4gICAgQ2xpY2tOb3RpZmljYXRpb24sXG4gICAgTG9nU2VydmljZSxcbiAgICBVcGRhdGVOb3RpZmljYXRpb24sXG4gICAgQ29tbWVudHNDb21wb25lbnRcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7XG4gICAgQ29tcG9uZW50LFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT25Jbml0LFxuICAgIE91dHB1dCxcbiAgICBTaW1wbGVDaGFuZ2VzLFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdERpYWxvZywgTWF0RGlhbG9nUmVmIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IENvbnRlbnRMaW5rTW9kZWwsIEZvcm1GaWVsZFZhbGlkYXRvciwgRm9ybU1vZGVsLCBGb3JtT3V0Y29tZUV2ZW50IH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFRhc2tRdWVyeVJlcXVlc3RSZXByZXNlbnRhdGlvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2ZpbHRlci5tb2RlbCc7XG5pbXBvcnQgeyBUYXNrRGV0YWlsc01vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3Rhc2stZGV0YWlscy5tb2RlbCc7XG5pbXBvcnQgeyBUYXNrTGlzdFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL3Rhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclJlcHJlc2VudGF0aW9uIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBzaGFyZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtdGFzay1kZXRhaWxzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGFzay1kZXRhaWxzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi90YXNrLWRldGFpbHMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYXNrRGV0YWlsc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICAgIEBWaWV3Q2hpbGQoJ2FjdGl2aXRpQ29tbWVudHMnKVxuICAgIGFjdGl2aXRpQ29tbWVudHM6IENvbW1lbnRzQ29tcG9uZW50O1xuXG4gICAgQFZpZXdDaGlsZCgnYWN0aXZpdGlDaGVja2xpc3QnKVxuICAgIGFjdGl2aXRpQ2hlY2tsaXN0OiBhbnk7XG5cbiAgICBAVmlld0NoaWxkKCdlcnJvckRpYWxvZycpXG4gICAgZXJyb3JEaWFsb2c6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICAvKiogVG9nZ2xlcyBkZWJ1ZyBtb2RlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGVidWdNb2RlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogKCoqcmVxdWlyZWQqKikgVGhlIGlkIG9mIHRoZSB0YXNrIHdob3NlIGRldGFpbHMgd2UgYXJlIGFza2luZyBmb3IuICovXG4gICAgQElucHV0KClcbiAgICB0YXNrSWQ6IHN0cmluZztcblxuICAgIC8qKiBBdXRvbWF0aWNhbGx5IHJlbmRlcnMgdGhlIG5leHQgdGFzayB3aGVuIHRoZSBjdXJyZW50IG9uZSBpcyBjb21wbGV0ZWQuICovXG4gICAgQElucHV0KClcbiAgICBzaG93TmV4dFRhc2s6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZXMgdGFzayBkZXRhaWxzIEhlYWRlciBjb21wb25lbnQuICovXG4gICAgQElucHV0KClcbiAgICBzaG93SGVhZGVyOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIGNvbGxhcHNlZC9leHBhbmRlZCBzdGF0ZSBvZiB0aGUgSGVhZGVyIGNvbXBvbmVudC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dIZWFkZXJDb250ZW50OiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIGBJbnZvbHZlIFBlb3BsZWAgZmVhdHVyZSBmb3IgdGhlIEhlYWRlciBjb21wb25lbnQuICovXG4gICAgQElucHV0KClcbiAgICBzaG93SW52b2x2ZVBlb3BsZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlcyBgQ29tbWVudHNgIGZlYXR1cmUgZm9yIHRoZSBIZWFkZXIgY29tcG9uZW50LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0NvbW1lbnRzOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIGBDaGVja2xpc3RgIGZlYXR1cmUgZm9yIHRoZSBIZWFkZXIgY29tcG9uZW50LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0NoZWNrbGlzdDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlcyByZW5kZXJpbmcgb2YgdGhlIGZvcm0gdGl0bGUuICovXG4gICAgQElucHV0KClcbiAgICBzaG93Rm9ybVRpdGxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyByZW5kZXJpbmcgb2YgdGhlIGBDb21wbGV0ZWAgb3V0Y29tZSBidXR0b24uICovXG4gICAgQElucHV0KClcbiAgICBzaG93Rm9ybUNvbXBsZXRlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIHJlbmRlcmluZyBvZiB0aGUgYFNhdmVgIG91dGNvbWUgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0Zvcm1TYXZlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIHJlYWQtb25seSBzdGF0ZSBvZiB0aGUgZm9ybS4gQWxsIGZvcm0gd2lkZ2V0cyByZW5kZXIgYXMgcmVhZC1vbmx5XG4gICAgICogaWYgZW5hYmxlZC5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHJlYWRPbmx5Rm9ybTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgcmVuZGVyaW5nIG9mIHRoZSBgUmVmcmVzaGAgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0Zvcm1SZWZyZXNoQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBGaWVsZCB2YWxpZGF0b3JzIGZvciB1c2Ugd2l0aCB0aGUgZm9ybS4gKi9cbiAgICBASW5wdXQoKVxuICAgIGZpZWxkVmFsaWRhdG9yczogRm9ybUZpZWxkVmFsaWRhdG9yW10gPSBbXTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGZvcm0gaXMgc3VibWl0dGVkIHdpdGggdGhlIGBTYXZlYCBvciBjdXN0b20gb3V0Y29tZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZm9ybVNhdmVkOiBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgZm9ybSBpcyBzdWJtaXR0ZWQgd2l0aCB0aGUgYENvbXBsZXRlYCBvdXRjb21lLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1Db21wbGV0ZWQ6IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBmb3JtIGZpZWxkIGNvbnRlbnQgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBmb3JtQ29udGVudENsaWNrZWQ6IEV2ZW50RW1pdHRlcjxDb250ZW50TGlua01vZGVsPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q29udGVudExpbmtNb2RlbD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGZvcm0gaXMgbG9hZGVkIG9yIHJlbG9hZGVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1Mb2FkZWQ6IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtTW9kZWw+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgY2hlY2tsaXN0IHRhc2sgaXMgY3JlYXRlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ3JlYXRlZDogRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxUYXNrRGV0YWlsc01vZGVsPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIGNoZWNrbGlzdCB0YXNrIGlzIGRlbGV0ZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgdGFza0RlbGV0ZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYW55IG91dGNvbWUgaXMgZXhlY3V0ZWQuIERlZmF1bHQgYmVoYXZpb3VyIGNhbiBiZSBwcmV2ZW50ZWRcbiAgICAgKiB2aWEgYGV2ZW50LnByZXZlbnREZWZhdWx0KClgLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGV4ZWN1dGVPdXRjb21lOiBFdmVudEVtaXR0ZXI8Rm9ybU91dGNvbWVFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1PdXRjb21lRXZlbnQ+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgdGFzayBpcyBhc3NpZ25lZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBhc3NpZ25UYXNrOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgdGFzayBpcyBjbGFpbWVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGNsYWltZWRUYXNrOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHRhc2sgaXMgdW5jbGFpbWVkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHVuQ2xhaW1lZFRhc2s6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICB0YXNrRGV0YWlsczogVGFza0RldGFpbHNNb2RlbDtcbiAgICB0YXNrRm9ybU5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgICB0YXNrUGVvcGxlOiBVc2VyUHJvY2Vzc01vZGVsW10gPSBbXTtcblxuICAgIG5vVGFza0RldGFpbHNUZW1wbGF0ZUNvbXBvbmVudDogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIHNob3dBc3NpZ25lZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHNob3dBdHRhY2hGb3JtOiBib29sZWFuID0gZmFsc2U7XG4gICAgaW50ZXJuYWxSZWFkT25seUZvcm06IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByaXZhdGUgcGVvcGxlU2VhcmNoT2JzZXJ2ZXI6IE9ic2VydmVyPFVzZXJQcm9jZXNzTW9kZWxbXT47XG4gICAgcHVibGljIGVycm9yRGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8VGVtcGxhdGVSZWY8YW55Pj47XG5cbiAgICBwZW9wbGVTZWFyY2g6IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPjtcblxuICAgIGN1cnJlbnRMb2dnZWRVc2VyOiBVc2VyUmVwcmVzZW50YXRpb247XG4gICAgZGF0YTogYW55O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0YXNrTGlzdFNlcnZpY2U6IFRhc2tMaXN0U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoZW50aWNhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwZW9wbGVQcm9jZXNzU2VydmljZTogUGVvcGxlUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgY2FyZFZpZXdVcGRhdGVTZXJ2aWNlOiBDYXJkVmlld1VwZGF0ZVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZykge1xuXG4gICAgICAgIHRoaXMucGVvcGxlU2VhcmNoID0gbmV3IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPigob2JzZXJ2ZXIpID0+IHRoaXMucGVvcGxlU2VhcmNoT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKHNoYXJlKCkpO1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldEJwbUxvZ2dlZFVzZXIoKS5zdWJzY3JpYmUoKHVzZXI6IFVzZXJSZXByZXNlbnRhdGlvbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TG9nZ2VkVXNlciA9IHVzZXI7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBpZiAodGhpcy50YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZERldGFpbHModGhpcy50YXNrSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jYXJkVmlld1VwZGF0ZVNlcnZpY2UuaXRlbVVwZGF0ZWQkLnN1YnNjcmliZSh0aGlzLnVwZGF0ZVRhc2tEZXRhaWxzLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmNhcmRWaWV3VXBkYXRlU2VydmljZS5pdGVtQ2xpY2tlZCQuc3Vic2NyaWJlKHRoaXMuY2xpY2tUYXNrRGV0YWlscy5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHRhc2tJZCA9IGNoYW5nZXMudGFza0lkO1xuICAgICAgICB0aGlzLnNob3dBc3NpZ25lZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0YXNrSWQgJiYgIXRhc2tJZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0YXNrSWQgJiYgdGFza0lkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkRGV0YWlscyh0YXNrSWQuY3VycmVudFZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzU3RhbmRhbG9uZVRhc2soKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhKHRoaXMudGFza0RldGFpbHMgJiYgKCEhdGhpcy50YXNrRGV0YWlscy5wcm9jZXNzRGVmaW5pdGlvbklkKSk7XG4gICAgfVxuXG4gICAgaXNTdGFuZGFsb25lVGFza1dpdGhGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1N0YW5kYWxvbmVUYXNrKCkgJiYgdGhpcy5oYXNGb3JtS2V5KCk7XG4gICAgfVxuXG4gICAgaXNTdGFuZGFsb25lVGFza1dpdGhvdXRGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1N0YW5kYWxvbmVUYXNrKCkgJiYgIXRoaXMuaGFzRm9ybUtleSgpO1xuICAgIH1cblxuICAgIGlzRm9ybUNvbXBvbmVudFZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0Zvcm1LZXkoKSAmJiAhdGhpcy5pc1Nob3dBdHRhY2hGb3JtKCk7XG4gICAgfVxuXG4gICAgaXNUYXNrU3RhbmRhbG9uZUNvbXBvbmVudFZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU3RhbmRhbG9uZVRhc2tXaXRob3V0Rm9ybSgpICYmICF0aGlzLmlzU2hvd0F0dGFjaEZvcm0oKTtcbiAgICB9XG5cbiAgICBpc1Nob3dBdHRhY2hGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93QXR0YWNoRm9ybTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgdGFzayBkZXRhaWxzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZXNldCgpIHtcbiAgICAgICAgdGhpcy50YXNrRGV0YWlscyA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIHRhc2sgaGFzIGEgZm9ybVxuICAgICAqL1xuICAgIGhhc0Zvcm1LZXkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGhpcy50YXNrRGV0YWlscyAmJiAoISF0aGlzLnRhc2tEZXRhaWxzLmZvcm1LZXkpKTtcbiAgICB9XG5cbiAgICBpc1Rhc2tBY3RpdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzICYmIHRoaXMudGFza0RldGFpbHMuZHVyYXRpb24gPT09IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F2ZSBhIHRhc2sgZGV0YWlsIGFuZCB1cGRhdGUgaXQgYWZ0ZXIgYSBzdWNjZXNzZnVsIHJlc3BvbnNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXBkYXRlTm90aWZpY2F0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cGRhdGVUYXNrRGV0YWlscyh1cGRhdGVOb3RpZmljYXRpb246IFVwZGF0ZU5vdGlmaWNhdGlvbikge1xuICAgICAgICB0aGlzLnRhc2tMaXN0U2VydmljZS51cGRhdGVUYXNrKHRoaXMudGFza0lkLCB1cGRhdGVOb3RpZmljYXRpb24uY2hhbmdlZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRoaXMudGFza0lkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xpY2tUYXNrRGV0YWlscyhjbGlja05vdGlmaWNhdGlvbjogQ2xpY2tOb3RpZmljYXRpb24pIHtcbiAgICAgICAgaWYgKGNsaWNrTm90aWZpY2F0aW9uLnRhcmdldC5rZXkgPT09ICdhc3NpZ25lZScpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0Fzc2lnbmVlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpY2tOb3RpZmljYXRpb24udGFyZ2V0LmtleSA9PT0gJ2Zvcm1OYW1lJykge1xuICAgICAgICAgICAgdGhpcy5zaG93QXR0YWNoRm9ybSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSBhY3Rpdml0aSB0YXNrIGRldGFpbHNcbiAgICAgKiBAcGFyYW0gdGFza0lkXG4gICAgICovXG4gICAgcHJpdmF0ZSBsb2FkRGV0YWlscyh0YXNrSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnRhc2tQZW9wbGUgPSBbXTtcbiAgICAgICAgdGhpcy50YXNrRm9ybU5hbWUgPSBudWxsO1xuXG4gICAgICAgIGlmICh0YXNrSWQpIHtcbiAgICAgICAgICAgIHRoaXMudGFza0xpc3RTZXJ2aWNlLmdldFRhc2tEZXRhaWxzKHRhc2tJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93QXR0YWNoRm9ybSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tEZXRhaWxzID0gcmVzO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhc2tEZXRhaWxzLm5hbWUgPT09ICdudWxsJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrRGV0YWlscy5uYW1lID0gJ05vIG5hbWUnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kRGF0ZTogYW55ID0gcmVzLmVuZERhdGU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmREYXRlICYmICFpc05hTihlbmREYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxSZWFkT25seUZvcm0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcm5hbFJlYWRPbmx5Rm9ybSA9IHRoaXMucmVhZE9ubHlGb3JtO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGFza0RldGFpbHMgJiYgdGhpcy50YXNrRGV0YWlscy5pbnZvbHZlZFBlb3BsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrRGV0YWlscy5pbnZvbHZlZFBlb3BsZS5mb3JFYWNoKCh1c2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrUGVvcGxlLnB1c2gobmV3IFVzZXJQcm9jZXNzTW9kZWwodXNlcikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzQXNzaWduZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhIXRoaXMudGFza0RldGFpbHMuYXNzaWduZWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYXNFbWFpbEFkZHJlc3MoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlLmVtYWlsID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGlzQXNzaWduZWRUb01lKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmVkKCkgJiYgdGhpcy5oYXNFbWFpbEFkZHJlc3MoKSA/XG4gICAgICAgICAgICB0aGlzLmlzRW1haWxFcXVhbCh0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlLmVtYWlsLCB0aGlzLmN1cnJlbnRMb2dnZWRVc2VyLmVtYWlsKSA6XG4gICAgICAgICAgICB0aGlzLmlzRXh0ZXJuYWxJZEVxdWFsKHRoaXMudGFza0RldGFpbHMuYXNzaWduZWUuZXh0ZXJuYWxJZCwgdGhpcy5jdXJyZW50TG9nZ2VkVXNlci5leHRlcm5hbElkKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRW1haWxFcXVhbChhc3NpZ25lZU1haWwsIGN1cnJlbnRMb2dnZWRFbWFpbCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYXNzaWduZWVNYWlsLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09IGN1cnJlbnRMb2dnZWRFbWFpbC50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNFeHRlcm5hbElkRXF1YWwoYXNzaWduZWVFeHRlcm5hbElkLCBjdXJyZW50VXNlckV4dGVybmFsSWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGFzc2lnbmVlRXh0ZXJuYWxJZC50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSBjdXJyZW50VXNlckV4dGVybmFsSWQudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICBpc0NvbXBsZXRlQnV0dG9uRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNBc3NpZ25lZFRvTWUoKSB8fCB0aGlzLmNhbkluaXRpYXRvckNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgaXNDb21wbGV0ZUJ1dHRvblZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5oYXNGb3JtS2V5KCkgJiYgdGhpcy5pc1Rhc2tBY3RpdmUoKSAmJiB0aGlzLmlzQ29tcGxldGVCdXR0b25FbmFibGVkKCk7XG4gICAgfVxuXG4gICAgY2FuSW5pdGlhdG9yQ29tcGxldGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzLmluaXRpYXRvckNhbkNvbXBsZXRlVGFzaztcbiAgICB9XG5cbiAgICBpc1NhdmVCdXR0b25WaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNTYXZlQnV0dG9uKCkgJiYgKCF0aGlzLmNhbkluaXRpYXRvckNvbXBsZXRlKCkgfHwgdGhpcy5pc0Fzc2lnbmVkVG9NZSgpKTtcbiAgICB9XG5cbiAgICBoYXNTYXZlQnV0dG9uKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93Rm9ybVNhdmVCdXR0b247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIG5leHQgb3BlbiB0YXNrXG4gICAgICogQHBhcmFtIHByb2Nlc3NJbnN0YW5jZUlkXG4gICAgICogQHBhcmFtIHByb2Nlc3NEZWZpbml0aW9uSWRcbiAgICAgKi9cbiAgICBwcml2YXRlIGxvYWROZXh0VGFzayhwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nLCBwcm9jZXNzRGVmaW5pdGlvbklkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdE5vZGUgPSBuZXcgVGFza1F1ZXJ5UmVxdWVzdFJlcHJlc2VudGF0aW9uTW9kZWwoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcHJvY2Vzc0luc3RhbmNlSWQ6IHByb2Nlc3NJbnN0YW5jZUlkLFxuICAgICAgICAgICAgICAgIHByb2Nlc3NEZWZpbml0aW9uSWQ6IHByb2Nlc3NEZWZpbml0aW9uSWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy50YXNrTGlzdFNlcnZpY2UuZ2V0VGFza3MocmVxdWVzdE5vZGUpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFza0RldGFpbHMgPSBuZXcgVGFza0RldGFpbHNNb2RlbChyZXNwb25zZVswXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb21wbGV0ZSBidXR0b24gY2xpY2tlZFxuICAgICAqL1xuICAgIG9uQ29tcGxldGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudGFza0xpc3RTZXJ2aWNlLmNvbXBsZXRlVGFzayh0aGlzLnRhc2tJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKHJlcykgPT4gdGhpcy5vbkZvcm1Db21wbGV0ZWQobnVsbClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBvblNob3dBdHRhY2hGb3JtKCkge1xuICAgICAgICB0aGlzLnNob3dBdHRhY2hGb3JtID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBvbkNhbmNlbEF0dGFjaEZvcm0oKSB7XG4gICAgICAgIHRoaXMuc2hvd0F0dGFjaEZvcm0gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBvbkNvbXBsZXRlQXR0YWNoRm9ybSgpIHtcbiAgICAgICAgdGhpcy5zaG93QXR0YWNoRm9ybSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRoaXMudGFza0lkKTtcbiAgICB9XG5cbiAgICBvbkZvcm1Db250ZW50Q2xpY2soY29udGVudDogQ29udGVudExpbmtNb2RlbCk6IHZvaWQge1xuICAgICAgICB0aGlzLmZvcm1Db250ZW50Q2xpY2tlZC5lbWl0KGNvbnRlbnQpO1xuICAgIH1cblxuICAgIG9uRm9ybVNhdmVkKGZvcm06IEZvcm1Nb2RlbCk6IHZvaWQge1xuICAgICAgICB0aGlzLmZvcm1TYXZlZC5lbWl0KGZvcm0pO1xuICAgIH1cblxuICAgIG9uRm9ybUNvbXBsZXRlZChmb3JtOiBGb3JtTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5mb3JtQ29tcGxldGVkLmVtaXQoZm9ybSk7XG4gICAgICAgIGlmICh0aGlzLnNob3dOZXh0VGFzayAmJiAodGhpcy50YXNrRGV0YWlscy5wcm9jZXNzSW5zdGFuY2VJZCB8fCB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uSWQpKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWROZXh0VGFzayh0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NJbnN0YW5jZUlkLCB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uSWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25Gb3JtTG9hZGVkKGZvcm06IEZvcm1Nb2RlbCk6IHZvaWQge1xuICAgICAgICB0aGlzLnRhc2tGb3JtTmFtZSA9IChmb3JtICYmIGZvcm0ubmFtZSA/IGZvcm0ubmFtZSA6IG51bGwpO1xuICAgICAgICB0aGlzLmZvcm1Mb2FkZWQuZW1pdChmb3JtKTtcbiAgICB9XG5cbiAgICBvbkNoZWNrbGlzdFRhc2tDcmVhdGVkKHRhc2s6IFRhc2tEZXRhaWxzTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50YXNrQ3JlYXRlZC5lbWl0KHRhc2spO1xuICAgIH1cblxuICAgIG9uQ2hlY2tsaXN0VGFza0RlbGV0ZWQodGFza0lkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50YXNrRGVsZXRlZC5lbWl0KHRhc2tJZCk7XG4gICAgfVxuXG4gICAgb25Gb3JtRXJyb3IoZXJyb3I6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmVycm9yRGlhbG9nUmVmID0gdGhpcy5kaWFsb2cub3Blbih0aGlzLmVycm9yRGlhbG9nLCB7IHdpZHRoOiAnNTAwcHgnIH0pO1xuICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyb3IpO1xuICAgIH1cblxuICAgIG9uRm9ybUV4ZWN1dGVPdXRjb21lKGV2ZW50OiBGb3JtT3V0Y29tZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIHRoaXMuZXhlY3V0ZU91dGNvbWUuZW1pdChldmVudCk7XG4gICAgfVxuXG4gICAgY2xvc2VFcnJvckRpYWxvZygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICB9XG5cbiAgICBvbkNsYWltQWN0aW9uKHRhc2tJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2xhaW1lZFRhc2suZW1pdCh0YXNrSWQpO1xuICAgICAgICB0aGlzLmxvYWREZXRhaWxzKHRhc2tJZCk7XG4gICAgfVxuXG4gICAgb25VbmNsYWltQWN0aW9uKHRhc2tJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMudW5DbGFpbWVkVGFzay5lbWl0KHRhc2tJZCk7XG4gICAgICAgIHRoaXMubG9hZERldGFpbHModGFza0lkKTtcbiAgICB9XG5cbiAgICBpc0NvbXBsZXRlZFRhc2soKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzICYmIHRoaXMudGFza0RldGFpbHMuZW5kRGF0ZSA/IHRydWUgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgc2VhcmNoVXNlcihzZWFyY2hlZFdvcmQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnBlb3BsZVByb2Nlc3NTZXJ2aWNlLmdldFdvcmtmbG93VXNlcnMobnVsbCwgc2VhcmNoZWRXb3JkKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgodXNlcnMpID0+IHtcbiAgICAgICAgICAgICAgICB1c2VycyA9IHVzZXJzLmZpbHRlcigodXNlcikgPT4gdXNlci5pZCAhPT0gdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZS5pZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2hPYnNlcnZlci5uZXh0KHVzZXJzKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdDb3VsZCBub3QgbG9hZCB1c2VycycpKTtcbiAgICB9XG5cbiAgICBvbkNsb3NlU2VhcmNoKCkge1xuICAgICAgICB0aGlzLnNob3dBc3NpZ25lZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFzc2lnblRhc2tUb1VzZXIoc2VsZWN0ZWRVc2VyOiBVc2VyUHJvY2Vzc01vZGVsKSB7XG4gICAgICAgIHRoaXMudGFza0xpc3RTZXJ2aWNlLmFzc2lnblRhc2sodGhpcy50YXNrRGV0YWlscy5pZCwgc2VsZWN0ZWRVc2VyKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuaW5mbygnVGFzayBBc3NpZ25lZCB0byAnICsgc2VsZWN0ZWRVc2VyLmVtYWlsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2lnblRhc2suZW1pdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2hvd0Fzc2lnbmVlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0VGFza0hlYWRlclZpZXdDbGFzcygpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5zaG93QXNzaWduZWUpIHtcbiAgICAgICAgICAgIHJldHVybiAnYXNzaWduLWVkaXQtdmlldyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RlZmF1bHQtdmlldyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1JlYWRPbmx5Q29tbWVudCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnRhc2tEZXRhaWxzICYmIHRoaXMudGFza0RldGFpbHMuaXNDb21wbGV0ZWQoKSkgJiYgKHRoaXMudGFza1Blb3BsZSAmJiB0aGlzLnRhc2tQZW9wbGUubGVuZ3RoID09PSAwKTtcbiAgICB9XG59XG4iXX0=