/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material';
import { Observable } from 'rxjs';
import { TaskDetailsEvent } from '../../task-list';
import { ProcessInstance } from '../models/process-instance.model';
import { ProcessService } from './../services/process.service';
import { share } from 'rxjs/operators';
var ProcessInstanceTasksComponent = /** @class */ (function () {
    function ProcessInstanceTasksComponent(activitiProcess, logService, dialog) {
        var _this = this;
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.dialog = dialog;
        /**
         * Toggles whether to show a refresh button next to the list of tasks to allow
         * it to be updated from the server.
         */
        this.showRefreshButton = true;
        /**
         * Emitted when an error occurs.
         */
        this.error = new EventEmitter();
        this.activeTasks = [];
        this.completedTasks = [];
        /**
         * Emitted when a task is clicked.
         */
        this.taskClick = new EventEmitter();
        this.task$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) { return _this.taskObserver = observer; }))
            .pipe(share());
        this.completedTask$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) { return _this.completedTaskObserver = observer; }))
            .pipe(share());
    }
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.task$.subscribe((/**
         * @param {?} task
         * @return {?}
         */
        function (task) {
            _this.activeTasks.push(task);
        }));
        this.completedTask$.subscribe((/**
         * @param {?} task
         * @return {?}
         */
        function (task) {
            _this.completedTasks.push(task);
        }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var processInstanceDetails = changes['processInstanceDetails'];
        if (processInstanceDetails && processInstanceDetails.currentValue) {
            this.load(processInstanceDetails.currentValue.id);
        }
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.load = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        this.loadActive(processInstanceId);
        this.loadCompleted(processInstanceId);
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.loadActive = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        var _this = this;
        this.activeTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, null).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                res.forEach((/**
                 * @param {?} task
                 * @return {?}
                 */
                function (task) {
                    _this.taskObserver.next(task);
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.error.emit(err);
            }));
        }
        else {
            this.activeTasks = [];
        }
    };
    /**
     * @param {?} processInstanceId
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.loadCompleted = /**
     * @param {?} processInstanceId
     * @return {?}
     */
    function (processInstanceId) {
        var _this = this;
        this.completedTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, 'completed').subscribe((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                res.forEach((/**
                 * @param {?} task
                 * @return {?}
                 */
                function (task) {
                    _this.completedTaskObserver.next(task);
                }));
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.error.emit(err);
            }));
        }
        else {
            this.completedTasks = [];
        }
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.hasStartFormDefined = /**
     * @return {?}
     */
    function () {
        return this.processInstanceDetails && this.processInstanceDetails.startFormDefined === true;
    };
    /**
     * @param {?} user
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.getUserFullName = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        if (user) {
            return (user.firstName && user.firstName !== 'null'
                ? user.firstName + ' ' : '') +
                user.lastName;
        }
        return 'Nobody';
    };
    /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.getFormatDate = /**
     * @param {?} value
     * @param {?} format
     * @return {?}
     */
    function (value, format) {
        /** @type {?} */
        var datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error("ProcessListInstanceTask: error parsing date " + value + " to format " + format);
        }
    };
    /**
     * @param {?} $event
     * @param {?} task
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.clickTask = /**
     * @param {?} $event
     * @param {?} task
     * @return {?}
     */
    function ($event, task) {
        /** @type {?} */
        var args = new TaskDetailsEvent(task);
        this.taskClick.emit(args);
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.clickStartTask = /**
     * @return {?}
     */
    function () {
        this.processId = this.processInstanceDetails.id;
        this.showStartDialog();
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.showStartDialog = /**
     * @return {?}
     */
    function () {
        this.dialog.open(this.startDialog, { height: '500px', width: '700px' });
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.closeStartDialog = /**
     * @return {?}
     */
    function () {
        this.dialog.closeAll();
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.onRefreshClicked = /**
     * @return {?}
     */
    function () {
        this.load(this.processInstanceDetails.id);
    };
    /**
     * @return {?}
     */
    ProcessInstanceTasksComponent.prototype.onFormContentClick = /**
     * @return {?}
     */
    function () {
        this.closeStartDialog();
    };
    ProcessInstanceTasksComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-process-instance-tasks',
                    template: "<div  *ngIf=\"showRefreshButton\" class=\"process-tasks-refresh\" >\n    <button mat-icon-button (click)=\"onRefreshClicked()\">\n        <mat-icon class=\"md-24\" aria-label=\"Refresh\">refresh</mat-icon>\n    </button>\n</div>\n\n<!-- ACTIVE FORM -->\n\n<mat-chip-list>\n    <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_ACTIVE'|translate }}</span>\n    <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{activeTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"activeTasks?.length > 0\" data-automation-id=\"active-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of activeTasks\" (click)=\"clickTask($event, task)\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user: getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n                </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<!-- START FORM -->\n\n<div *ngIf=\"activeTasks?.length === 0\" data-automation-id=\"active-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_ACTIVE' | translate }}\n</div>\n\n<div *ngIf=\"hasStartFormDefined()\">\n    <span class=\"adf-activiti-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</span>\n\n    <!--IF START TASK COMPLETED -->\n    <div class=\"menu-container\">\n        <mat-list>\n            <mat-list-item class=\"process-tasks__task-item\" (click)=\"clickStartTask()\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(processInstanceDetails.startedBy), created: getFormatDate(processInstanceDetails.started, 'mediumDate') } }}\n                </span>\n            </mat-list-item>\n        </mat-list>\n    </div>\n\n</div>\n\n<!-- COMPLETED FORM -->\n<mat-chip-list>\n        <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_COMPLETED'|translate }}</span>\n        <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{completedTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"completedTasks?.length > 0\" data-automation-id=\"completed-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of completedTasks\" (click)=\"clickTask($event, task)\">\n            <mat-icon mat-list-icon>assignment</mat-icon>\n            <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n            <span matLine>\n                {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n            </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<div *ngIf=\"completedTasks?.length === 0\" data-automation-id=\"completed-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_COMPLETED' | translate }}\n</div>\n\n<ng-template *ngIf=\"hasStartFormDefined()\" #startDialog>\n    <div id=\"adf-start-process-dialog\" class=\"adf-start-process-dialog\">\n        <h4 matDialogTitle>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h4>\n        <div mat-dialog-content class=\"adf-start-process-dialog-content\">\n            <adf-start-form [processId]=\"processId\"\n                                 [showRefreshButton]=\"false\" [readOnlyForm]=\"true\"\n                                 (formContentClicked)='onFormContentClick()'>\n            </adf-start-form>\n        </div>\n        <div mat-dialog-actions class=\"adf-start-process-dialog-actions\">\n            <button mat-button type=\"button\" (click)=\"closeStartDialog()\">{{ 'ADF_PROCESS_LIST.DETAILS.TASKS.TASK_CLOSE' | translate }}</button>\n        </div>\n    </div>\n</ng-template>\n",
                    styles: [":host{width:100%}.activiti-label{font-weight:bolder;vertical-align:top}.adf-process-badge{pointer-events:none;outline:0}.adf-chip-label{position:relative;top:5px;margin-right:8px;font-weight:700}.menu-container{margin-bottom:32px}.activiti-label+.icon{position:relative;top:-2px}.task-details-dialog{position:fixed;top:50%;-webkit-transform:translate(0,-50%);transform:translate(0,-50%);width:40%}.process-tasks-refresh{float:right}.adf-start-process-dialog{width:100%;height:100%;display:flex;flex-direction:column}.adf-start-process-dialog-content{flex-grow:1}.adf-start-process-dialog-actions{display:flex;justify-content:flex-end}.no-results{margin-left:9px;font-size:14px;font-weight:400;letter-spacing:0;line-height:18px;color:rgba(0,0,0,.54);display:block;padding:12px}.process-tasks__task-item{cursor:pointer}"]
                }] }
    ];
    /** @nocollapse */
    ProcessInstanceTasksComponent.ctorParameters = function () { return [
        { type: ProcessService },
        { type: LogService },
        { type: MatDialog }
    ]; };
    ProcessInstanceTasksComponent.propDecorators = {
        processInstanceDetails: [{ type: Input }],
        showRefreshButton: [{ type: Input }],
        error: [{ type: Output }],
        startDialog: [{ type: ViewChild, args: ['startDialog',] }],
        taskDetails: [{ type: ViewChild, args: ['taskDetails',] }],
        taskClick: [{ type: Output }]
    };
    return ProcessInstanceTasksComponent;
}());
export { ProcessInstanceTasksComponent };
if (false) {
    /**
     * (**required**) The ID of the process instance to display tasks for.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.processInstanceDetails;
    /**
     * Toggles whether to show a refresh button next to the list of tasks to allow
     * it to be updated from the server.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.showRefreshButton;
    /**
     * Emitted when an error occurs.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.error;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.activeTasks;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTasks;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.taskObserver;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.completedTaskObserver;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.task$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.completedTask$;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.message;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.processId;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.startDialog;
    /** @type {?} */
    ProcessInstanceTasksComponent.prototype.taskDetails;
    /**
     * Emitted when a task is clicked.
     * @type {?}
     */
    ProcessInstanceTasksComponent.prototype.taskClick;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.activitiProcess;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    ProcessInstanceTasksComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLXByb2Nlc3Mtc2VydmljZXMvIiwic291cmNlcyI6WyJwcm9jZXNzLWxpc3QvY29tcG9uZW50cy9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEgsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxVQUFVLEVBQVksTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFvQixNQUFNLGlCQUFpQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXZDO0lBMkNJLHVDQUFvQixlQUErQixFQUMvQixVQUFzQixFQUN0QixNQUFpQjtRQUZyQyxpQkFPQztRQVBtQixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7UUFDL0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixXQUFNLEdBQU4sTUFBTSxDQUFXOzs7OztRQTlCckMsc0JBQWlCLEdBQVksSUFBSSxDQUFDOzs7O1FBSWxDLFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVuRCxnQkFBVyxHQUF1QixFQUFFLENBQUM7UUFD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LG9EQUNpQjs7SUFFakIsb0RBQ2lCOzs7OztJQUdqQixrREFDaUY7Ozs7O0lBRXJFLHdEQUF1Qzs7Ozs7SUFDdkMsbURBQThCOzs7OztJQUM5QiwrQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNFdmVudCwgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uLy4uL3Rhc2stbGlzdCc7XG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2UgfSBmcm9tICcuLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvcHJvY2Vzcy5zZXJ2aWNlJztcbmltcG9ydCB7IHNoYXJlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1wcm9jZXNzLWluc3RhbmNlLXRhc2tzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vcHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUHJvY2Vzc0luc3RhbmNlVGFza3NDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgICAvKiogKCoqcmVxdWlyZWQqKikgVGhlIElEIG9mIHRoZSBwcm9jZXNzIGluc3RhbmNlIHRvIGRpc3BsYXkgdGFza3MgZm9yLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0luc3RhbmNlRGV0YWlsczogUHJvY2Vzc0luc3RhbmNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciB0byBzaG93IGEgcmVmcmVzaCBidXR0b24gbmV4dCB0byB0aGUgbGlzdCBvZiB0YXNrcyB0byBhbGxvd1xuICAgICAqIGl0IHRvIGJlIHVwZGF0ZWQgZnJvbSB0aGUgc2VydmVyLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1JlZnJlc2hCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBhY3RpdmVUYXNrczogVGFza0RldGFpbHNNb2RlbFtdID0gW107XG4gICAgY29tcGxldGVkVGFza3M6IFRhc2tEZXRhaWxzTW9kZWxbXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSB0YXNrT2JzZXJ2ZXI6IE9ic2VydmVyPFRhc2tEZXRhaWxzTW9kZWw+O1xuICAgIHByaXZhdGUgY29tcGxldGVkVGFza09ic2VydmVyOiBPYnNlcnZlcjxUYXNrRGV0YWlsc01vZGVsPjtcblxuICAgIHRhc2skOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+O1xuICAgIGNvbXBsZXRlZFRhc2skOiBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+O1xuXG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHByb2Nlc3NJZDogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgnc3RhcnREaWFsb2cnKVxuICAgIHN0YXJ0RGlhbG9nOiBhbnk7XG5cbiAgICBAVmlld0NoaWxkKCd0YXNrRGV0YWlscycpXG4gICAgdGFza0RldGFpbHM6IGFueTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYSB0YXNrIGlzIGNsaWNrZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgdGFza0NsaWNrOiBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzRXZlbnQ+KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2cpIHtcbiAgICAgICAgdGhpcy50YXNrJCA9IG5ldyBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+KChvYnNlcnZlcikgPT4gdGhpcy50YXNrT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKHNoYXJlKCkpO1xuICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2skID0gbmV3IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4oKG9ic2VydmVyKSA9PiB0aGlzLmNvbXBsZXRlZFRhc2tPYnNlcnZlciA9IG9ic2VydmVyKVxuICAgICAgICAgICAgLnBpcGUoc2hhcmUoKSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMudGFzayQuc3Vic2NyaWJlKCh0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2tzLnB1c2godGFzayk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2skLnN1YnNjcmliZSgodGFzazogVGFza0RldGFpbHNNb2RlbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcy5wdXNoKHRhc2spO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NJbnN0YW5jZURldGFpbHMgPSBjaGFuZ2VzWydwcm9jZXNzSW5zdGFuY2VEZXRhaWxzJ107XG4gICAgICAgIGlmIChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzICYmIHByb2Nlc3NJbnN0YW5jZURldGFpbHMuY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWQocHJvY2Vzc0luc3RhbmNlRGV0YWlscy5jdXJyZW50VmFsdWUuaWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZChwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMubG9hZEFjdGl2ZShwcm9jZXNzSW5zdGFuY2VJZCk7XG4gICAgICAgIHRoaXMubG9hZENvbXBsZXRlZChwcm9jZXNzSW5zdGFuY2VJZCk7XG4gICAgfVxuXG4gICAgbG9hZEFjdGl2ZShwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlVGFza3MgPSBbXTtcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZUlkKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5nZXRQcm9jZXNzVGFza3MocHJvY2Vzc0luc3RhbmNlSWQsIG51bGwpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGFza09ic2VydmVyLm5leHQodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZENvbXBsZXRlZChwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MgPSBbXTtcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZUlkKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5nZXRQcm9jZXNzVGFza3MocHJvY2Vzc0luc3RhbmNlSWQsICdjb21wbGV0ZWQnKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlczogVGFza0RldGFpbHNNb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKCh0YXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2tPYnNlcnZlci5uZXh0KHRhc2spO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza3MgPSBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1N0YXJ0Rm9ybURlZmluZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLnN0YXJ0Rm9ybURlZmluZWQgPT09IHRydWU7XG4gICAgfVxuXG4gICAgZ2V0VXNlckZ1bGxOYW1lKHVzZXI6IGFueSkge1xuICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgcmV0dXJuICh1c2VyLmZpcnN0TmFtZSAmJiB1c2VyLmZpcnN0TmFtZSAhPT0gJ251bGwnXG4gICAgICAgICAgICAgICAgICAgID8gdXNlci5maXJzdE5hbWUgKyAnICcgOiAnJykgK1xuICAgICAgICAgICAgICAgIHVzZXIubGFzdE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdOb2JvZHknO1xuICAgIH1cblxuICAgIGdldEZvcm1hdERhdGUodmFsdWUsIGZvcm1hdDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGRhdGVQaXBlID0gbmV3IERhdGVQaXBlKCdlbi1VUycpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGVQaXBlLnRyYW5zZm9ybSh2YWx1ZSwgZm9ybWF0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoYFByb2Nlc3NMaXN0SW5zdGFuY2VUYXNrOiBlcnJvciBwYXJzaW5nIGRhdGUgJHt2YWx1ZX0gdG8gZm9ybWF0ICR7Zm9ybWF0fWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xpY2tUYXNrKCRldmVudDogYW55LCB0YXNrOiBUYXNrRGV0YWlsc01vZGVsKSB7XG4gICAgICAgIGNvbnN0IGFyZ3MgPSBuZXcgVGFza0RldGFpbHNFdmVudCh0YXNrKTtcbiAgICAgICAgdGhpcy50YXNrQ2xpY2suZW1pdChhcmdzKTtcbiAgICB9XG5cbiAgICBjbGlja1N0YXJ0VGFzaygpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzSWQgPSB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuaWQ7XG4gICAgICAgIHRoaXMuc2hvd1N0YXJ0RGlhbG9nKCk7XG4gICAgfVxuXG4gICAgc2hvd1N0YXJ0RGlhbG9nKCkge1xuICAgICAgICB0aGlzLmRpYWxvZy5vcGVuKHRoaXMuc3RhcnREaWFsb2csIHsgaGVpZ2h0OiAnNTAwcHgnLCB3aWR0aDogJzcwMHB4JyB9KTtcbiAgICB9XG5cbiAgICBjbG9zZVN0YXJ0RGlhbG9nKCkge1xuICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZUFsbCgpO1xuICAgIH1cblxuICAgIG9uUmVmcmVzaENsaWNrZWQoKSB7XG4gICAgICAgIHRoaXMubG9hZCh0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuaWQpO1xuICAgIH1cblxuICAgIG9uRm9ybUNvbnRlbnRDbGljaygpIHtcbiAgICAgICAgdGhpcy5jbG9zZVN0YXJ0RGlhbG9nKCk7XG4gICAgfVxufVxuIl19