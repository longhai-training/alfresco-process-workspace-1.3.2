/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { PeopleProcessService } from '@alfresco/adf-core';
import { Component, Input, ViewChild } from '@angular/core';
import { Observable } from 'rxjs';
import { PeopleSearchComponent } from '../people-search/people-search.component';
import { share } from 'rxjs/operators';
var PeopleComponent = /** @class */ (function () {
    function PeopleComponent(logService, peopleProcessService) {
        var _this = this;
        this.logService = logService;
        this.peopleProcessService = peopleProcessService;
        /**
         * The array of User objects to display.
         */
        this.people = [];
        /**
         * The numeric ID of the task.
         */
        this.taskId = '';
        /**
         * Should the data be read-only?
         */
        this.readOnly = false;
        this.showAssignment = false;
        this.peopleSearch$ = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) { return _this.peopleSearchObserver = observer; }))
            .pipe(share());
    }
    /**
     * @return {?}
     */
    PeopleComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.involveUserAndCloseSearch = /**
     * @return {?}
     */
    function () {
        if (this.peopleSearch) {
            this.peopleSearch.involveUserAndClose();
        }
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.involveUserWithoutCloseSearch = /**
     * @return {?}
     */
    function () {
        if (this.peopleSearch) {
            this.peopleSearch.involveUser();
        }
    };
    /**
     * @param {?} searchedWord
     * @return {?}
     */
    PeopleComponent.prototype.searchUser = /**
     * @param {?} searchedWord
     * @return {?}
     */
    function (searchedWord) {
        var _this = this;
        this.peopleProcessService.getWorkflowUsers(this.taskId, searchedWord)
            .subscribe((/**
         * @param {?} users
         * @return {?}
         */
        function (users) {
            _this.peopleSearchObserver.next(users);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) { return _this.logService.error(error); }));
    };
    /**
     * @param {?} user
     * @return {?}
     */
    PeopleComponent.prototype.involveUser = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        var _this = this;
        this.peopleProcessService.involveUserWithTask(this.taskId, user.id.toString())
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this.people = tslib_1.__spread(_this.people, [user]);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) { return _this.logService.error('Impossible to involve user with task'); }));
    };
    /**
     * @param {?} user
     * @return {?}
     */
    PeopleComponent.prototype.removeInvolvedUser = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        var _this = this;
        this.peopleProcessService.removeInvolvedUser(this.taskId, user.id.toString())
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this.people = _this.people.filter((/**
             * @param {?} involvedUser
             * @return {?}
             */
            function (involvedUser) {
                return involvedUser.id !== user.id;
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) { return _this.logService.error('Impossible to remove involved user from task'); }));
    };
    /**
     * @param {?} firstName
     * @param {?} lastName
     * @param {?=} delimiter
     * @return {?}
     */
    PeopleComponent.prototype.getDisplayUser = /**
     * @param {?} firstName
     * @param {?} lastName
     * @param {?=} delimiter
     * @return {?}
     */
    function (firstName, lastName, delimiter) {
        if (delimiter === void 0) { delimiter = '-'; }
        firstName = (firstName !== null ? firstName : '');
        lastName = (lastName !== null ? lastName : '');
        return firstName + delimiter + lastName;
    };
    /**
     * @param {?} firstName
     * @param {?} lastName
     * @return {?}
     */
    PeopleComponent.prototype.getInitialUserName = /**
     * @param {?} firstName
     * @param {?} lastName
     * @return {?}
     */
    function (firstName, lastName) {
        firstName = (firstName !== null && firstName !== '' ? firstName[0] : '');
        lastName = (lastName !== null && lastName !== '' ? lastName[0] : '');
        return this.getDisplayUser(firstName, lastName, '');
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.onAddAssignment = /**
     * @return {?}
     */
    function () {
        this.showAssignment = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PeopleComponent.prototype.onClickAction = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.type === 'remove') {
            this.removeInvolvedUser(event.value);
        }
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.hasPeople = /**
     * @return {?}
     */
    function () {
        return this.people && this.people.length > 0;
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.isEditMode = /**
     * @return {?}
     */
    function () {
        return !this.readOnly;
    };
    /**
     * @return {?}
     */
    PeopleComponent.prototype.onCloseSearch = /**
     * @return {?}
     */
    function () {
        this.showAssignment = false;
    };
    PeopleComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-people',
                    template: "<mat-card class=\"adf-assignment-top-container\">\n    <div mat-card-content class=\"adf-assignment-top-container-content\">\n        <div class=\"assignment-header\">\n                <div *ngIf=\"hasPeople()\" class=\"adf-assignment-count\" id=\"people-title\">\n                    {{ 'ADF_TASK_LIST.DETAILS.LABELS.PEOPLE' | translate }} {{ ' (' + people.length + ')' }}\n                </div>\n                <div *ngIf=\"!hasPeople()\" class=\"adf-assignment-count\" id=\"no-people-label\">\n                    {{ 'ADF_TASK_LIST.DETAILS.PEOPLE.NONE' | translate }}\n                </div>\n                <div *ngIf=\"isEditMode()\" class=\"adf-add-people\" (click)=\"onAddAssignment()\">\n                    <mat-icon class=\"adf-add-person-icon\">person_add</mat-icon>\n                </div>\n            </div>\n            <div class=\"adf-assignment-container\" *ngIf=\"showAssignment\">\n                <adf-people-search\n                    #peopleSearch\n                    (searchPeople)=\"searchUser($event)\"\n                    (success)=\"involveUser($event)\"\n                    (closeSearch)=\"onCloseSearch()\"\n                    [results]=\"peopleSearch$\">\n                    <ng-container adf-people-search-title>{{ 'ADF_TASK_LIST.DETAILS.LABELS.ADD_PEOPLE' | translate }}</ng-container>\n                    <ng-container adf-people-search-action-label>{{ 'ADF_TASK_LIST.PEOPLE.ADD_USER' | translate }}</ng-container>\n                </adf-people-search>\n            </div>\n            <div class=\"adf-assignment-list-container\" id=\"assignment-people-list\" *ngIf=\"hasPeople()\">\n                <adf-people-list\n                [users]=\"people\"\n                [actions]=\"isEditMode()\"\n                (clickAction)=\"onClickAction($event)\">\n                    <data-columns>\n                        <data-column key=\"firstName\">\n                            <ng-template let-entry=\"$implicit\">\n                                <div *ngIf=\"!entry.row.obj.pictureId\" class=\"adf-people-search-people-pic\">\n                                    {{getInitialUserName(entry.row.obj.firstName, entry.row.obj.lastName)}}</div>\n                                <div>\n                                    <img [alt]=\"getDisplayUser(entry.row.obj.firstName, entry.row.obj.lastName, ' ')\" *ngIf=\"entry.row.obj.pictureId\" class=\"adf-people-img\"\n                                        [src]=\"peopleProcessService.getUserImage(entry.row.obj)\"/>\n                                </div>\n                            </ng-template>\n                        </data-column>\n                        <data-column key=\"email\" class=\"adf-full-width\">\n                            <ng-template let-entry=\"$implicit\">\n                                <div class=\"adf-people-user-info\">\n                                    <div class=\"adf-people-full-name\">{{ getDisplayUser(entry.row.obj.firstName, entry.row.obj.lastName, ' ') }}</div>\n                                    <div class=\"adf-people-email\">{{ entry.row.obj.email }}</div>\n                                </div>\n                            </ng-template>\n                        </data-column>\n                    </data-columns>\n                </adf-people-list>\n            </div>\n    </div>\n</mat-card>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    PeopleComponent.ctorParameters = function () { return [
        { type: LogService },
        { type: PeopleProcessService }
    ]; };
    PeopleComponent.propDecorators = {
        people: [{ type: Input }],
        taskId: [{ type: Input }],
        readOnly: [{ type: Input }],
        peopleSearch: [{ type: ViewChild, args: ['peopleSearch',] }]
    };
    return PeopleComponent;
}());
export { PeopleComponent };
if (false) {
    /**
     * The array of User objects to display.
     * @type {?}
     */
    PeopleComponent.prototype.people;
    /**
     * The numeric ID of the task.
     * @type {?}
     */
    PeopleComponent.prototype.taskId;
    /**
     * Should the data be read-only?
     * @type {?}
     */
    PeopleComponent.prototype.readOnly;
    /** @type {?} */
    PeopleComponent.prototype.peopleSearch;
    /** @type {?} */
    PeopleComponent.prototype.showAssignment;
    /**
     * @type {?}
     * @private
     */
    PeopleComponent.prototype.peopleSearchObserver;
    /** @type {?} */
    PeopleComponent.prototype.peopleSearch$;
    /**
     * @type {?}
     * @private
     */
    PeopleComponent.prototype.logService;
    /** @type {?} */
    PeopleComponent.prototype.peopleProcessService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVvcGxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtcHJvY2Vzcy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInBlb3BsZS9jb21wb25lbnRzL3Blb3BsZS9wZW9wbGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFvQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFELE9BQU8sRUFBaUIsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLE1BQU0sQ0FBQztBQUU1QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNqRixPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdkM7SUEyQkkseUJBQW9CLFVBQXNCLEVBQVMsb0JBQTBDO1FBQTdGLGlCQUtDO1FBTG1CLGVBQVUsR0FBVixVQUFVLENBQVk7UUFBUyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCOzs7O1FBbEI3RixXQUFNLEdBQXVCLEVBQUUsQ0FBQzs7OztRQUloQyxXQUFNLEdBQVcsRUFBRSxDQUFDOzs7O1FBSXBCLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFLMUIsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFNNUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLFVBQVU7Ozs7UUFBcUIsVUFBQyxRQUFRLElBQUssT0FBQSxLQUFJLENBQUMsb0JBQW9CLEdBQUcsUUFBUSxFQUFwQyxDQUFvQyxFQUFDO2FBQ3RHLElBQUksQ0FDRCxLQUFLLEVBQUUsQ0FDVixDQUFDO0lBQ1YsQ0FBQzs7OztJQUVELGtDQUFROzs7SUFBUjtJQUNBLENBQUM7Ozs7SUFFRCx5Q0FBZTs7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RDs7SUFDM0Qsd0NBQThDOzs7OztJQUVsQyxxQ0FBOEI7O0lBQUUsK0NBQWlEIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgTG9nU2VydmljZSwgVXNlclByb2Nlc3NNb2RlbCB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBQZW9wbGVQcm9jZXNzU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFVzZXJFdmVudE1vZGVsIH0gZnJvbSAnLi4vLi4vLi4vdGFzay1saXN0L21vZGVscy91c2VyLWV2ZW50Lm1vZGVsJztcbmltcG9ydCB7IFBlb3BsZVNlYXJjaENvbXBvbmVudCB9IGZyb20gJy4uL3Blb3BsZS1zZWFyY2gvcGVvcGxlLXNlYXJjaC5jb21wb25lbnQnO1xuaW1wb3J0IHsgc2hhcmUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXBlb3BsZScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Blb3BsZS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vcGVvcGxlLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUGVvcGxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcblxuICAgIC8qKiBUaGUgYXJyYXkgb2YgVXNlciBvYmplY3RzIHRvIGRpc3BsYXkuICovXG4gICAgQElucHV0KClcbiAgICBwZW9wbGU6IFVzZXJQcm9jZXNzTW9kZWxbXSA9IFtdO1xuXG4gICAgLyoqIFRoZSBudW1lcmljIElEIG9mIHRoZSB0YXNrLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgdGFza0lkOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBTaG91bGQgdGhlIGRhdGEgYmUgcmVhZC1vbmx5PyAqL1xuICAgIEBJbnB1dCgpXG4gICAgcmVhZE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBWaWV3Q2hpbGQoJ3Blb3BsZVNlYXJjaCcpXG4gICAgcGVvcGxlU2VhcmNoOiBQZW9wbGVTZWFyY2hDb21wb25lbnQ7XG5cbiAgICBzaG93QXNzaWdubWVudDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBwZW9wbGVTZWFyY2hPYnNlcnZlcjogT2JzZXJ2ZXI8VXNlclByb2Nlc3NNb2RlbFtdPjtcbiAgICBwZW9wbGVTZWFyY2gkOiBPYnNlcnZhYmxlPFVzZXJQcm9jZXNzTW9kZWxbXT47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsIHB1YmxpYyBwZW9wbGVQcm9jZXNzU2VydmljZTogUGVvcGxlUHJvY2Vzc1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2gkID0gbmV3IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPigob2JzZXJ2ZXIpID0+IHRoaXMucGVvcGxlU2VhcmNoT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHNoYXJlKClcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIH1cblxuICAgIGludm9sdmVVc2VyQW5kQ2xvc2VTZWFyY2goKSB7XG4gICAgICAgIGlmICh0aGlzLnBlb3BsZVNlYXJjaCkge1xuICAgICAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2guaW52b2x2ZVVzZXJBbmRDbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW52b2x2ZVVzZXJXaXRob3V0Q2xvc2VTZWFyY2goKSB7XG4gICAgICAgIGlmICh0aGlzLnBlb3BsZVNlYXJjaCkge1xuICAgICAgICAgICAgdGhpcy5wZW9wbGVTZWFyY2guaW52b2x2ZVVzZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlYXJjaFVzZXIoc2VhcmNoZWRXb3JkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5wZW9wbGVQcm9jZXNzU2VydmljZS5nZXRXb3JrZmxvd1VzZXJzKHRoaXMudGFza0lkLCBzZWFyY2hlZFdvcmQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh1c2VycykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGVvcGxlU2VhcmNoT2JzZXJ2ZXIubmV4dCh1c2Vycyk7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcikpO1xuICAgIH1cblxuICAgIGludm9sdmVVc2VyKHVzZXI6IFVzZXJQcm9jZXNzTW9kZWwpIHtcbiAgICAgICAgdGhpcy5wZW9wbGVQcm9jZXNzU2VydmljZS5pbnZvbHZlVXNlcldpdGhUYXNrKHRoaXMudGFza0lkLCB1c2VyLmlkLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlb3BsZSA9IFsuLi50aGlzLnBlb3BsZSwgdXNlcl07XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMubG9nU2VydmljZS5lcnJvcignSW1wb3NzaWJsZSB0byBpbnZvbHZlIHVzZXIgd2l0aCB0YXNrJykpO1xuICAgIH1cblxuICAgIHJlbW92ZUludm9sdmVkVXNlcih1c2VyOiBVc2VyUHJvY2Vzc01vZGVsKSB7XG4gICAgICAgIHRoaXMucGVvcGxlUHJvY2Vzc1NlcnZpY2UucmVtb3ZlSW52b2x2ZWRVc2VyKHRoaXMudGFza0lkLCB1c2VyLmlkLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlb3BsZSA9IHRoaXMucGVvcGxlLmZpbHRlcigoaW52b2x2ZWRVc2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnZvbHZlZFVzZXIuaWQgIT09IHVzZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCAoZXJyb3IpID0+IHRoaXMubG9nU2VydmljZS5lcnJvcignSW1wb3NzaWJsZSB0byByZW1vdmUgaW52b2x2ZWQgdXNlciBmcm9tIHRhc2snKSk7XG4gICAgfVxuXG4gICAgZ2V0RGlzcGxheVVzZXIoZmlyc3ROYW1lOiBzdHJpbmcsIGxhc3ROYW1lOiBzdHJpbmcsIGRlbGltaXRlcjogc3RyaW5nID0gJy0nKTogc3RyaW5nIHtcbiAgICAgICAgZmlyc3ROYW1lID0gKGZpcnN0TmFtZSAhPT0gbnVsbCA/IGZpcnN0TmFtZSA6ICcnKTtcbiAgICAgICAgbGFzdE5hbWUgPSAobGFzdE5hbWUgIT09IG51bGwgPyBsYXN0TmFtZSA6ICcnKTtcbiAgICAgICAgcmV0dXJuIGZpcnN0TmFtZSArIGRlbGltaXRlciArIGxhc3ROYW1lO1xuICAgIH1cblxuICAgIGdldEluaXRpYWxVc2VyTmFtZShmaXJzdE5hbWU6IHN0cmluZywgbGFzdE5hbWU6IHN0cmluZykge1xuICAgICAgICBmaXJzdE5hbWUgPSAoZmlyc3ROYW1lICE9PSBudWxsICYmIGZpcnN0TmFtZSAhPT0gJycgPyBmaXJzdE5hbWVbMF0gOiAnJyk7XG4gICAgICAgIGxhc3ROYW1lID0gKGxhc3ROYW1lICE9PSBudWxsICYmIGxhc3ROYW1lICE9PSAnJyA/IGxhc3ROYW1lWzBdIDogJycpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREaXNwbGF5VXNlcihmaXJzdE5hbWUsIGxhc3ROYW1lLCAnJyk7XG4gICAgfVxuXG4gICAgb25BZGRBc3NpZ25tZW50KCkge1xuICAgICAgICB0aGlzLnNob3dBc3NpZ25tZW50ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBvbkNsaWNrQWN0aW9uKGV2ZW50OiBVc2VyRXZlbnRNb2RlbCkge1xuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ3JlbW92ZScpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSW52b2x2ZWRVc2VyKGV2ZW50LnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1Blb3BsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVvcGxlICYmIHRoaXMucGVvcGxlLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgaXNFZGl0TW9kZSgpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLnJlYWRPbmx5O1xuICAgIH1cblxuICAgIG9uQ2xvc2VTZWFyY2goKSB7XG4gICAgICAgIHRoaXMuc2hvd0Fzc2lnbm1lbnQgPSBmYWxzZTtcbiAgICB9XG59XG4iXX0=