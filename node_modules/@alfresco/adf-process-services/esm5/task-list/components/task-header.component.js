/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { BpmUserService, CardViewDateItemModel, CardViewMapItemModel, CardViewTextItemModel, LogService, TranslationService, AppConfigService } from '@alfresco/adf-core';
import { TaskDetailsModel } from '../models/task-details.model';
import { TaskListService } from './../services/tasklist.service';
import { TaskDescriptionValidator } from '../validators/task-description.validator';
var TaskHeaderComponent = /** @class */ (function () {
    function TaskHeaderComponent(activitiTaskService, bpmUserService, translationService, logService, appConfig) {
        this.activitiTaskService = activitiTaskService;
        this.bpmUserService = bpmUserService;
        this.translationService = translationService;
        this.logService = logService;
        this.appConfig = appConfig;
        /**
         * The name of the form.
         */
        this.formName = null;
        /**
         * Emitted when the task is claimed.
         */
        this.claim = new EventEmitter();
        /**
         * Emitted when the task is unclaimed (ie, requeued).
         */
        this.unclaim = new EventEmitter();
        this.inEdit = false;
    }
    /**
     * @return {?}
     */
    TaskHeaderComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.loadCurrentBpmUserId();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TaskHeaderComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.refreshData();
    };
    /**
     * @private
     * @param {?} parentInfoMap
     * @return {?}
     */
    TaskHeaderComponent.prototype.initDefaultProperties = /**
     * @private
     * @param {?} parentInfoMap
     * @return {?}
     */
    function (parentInfoMap) {
        return [
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.ASSIGNEE',
                value: this.taskDetails.getFullName(),
                key: 'assignee',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.ASSIGNEE_DEFAULT'),
                clickable: !this.isCompleted(),
                icon: 'create'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.STATUS',
                value: this.getTaskStatus(),
                key: 'status'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PRIORITY',
                value: this.taskDetails.priority,
                key: 'priority',
                editable: true
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DUE_DATE',
                value: this.taskDetails.dueDate,
                key: 'dueDate',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.DUE_DATE_DEFAULT'),
                editable: true
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.CATEGORY',
                value: this.taskDetails.category,
                key: 'category',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.CATEGORY_DEFAULT')
            }),
            new CardViewMapItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PARENT_NAME',
                value: parentInfoMap,
                key: 'parentName',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.PARENT_NAME_DEFAULT'),
                clickable: true
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.CREATED',
                value: this.taskDetails.created,
                key: 'created'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DURATION',
                value: this.getTaskDuration(),
                key: 'duration'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PARENT_TASK_ID',
                value: this.taskDetails.parentTaskId,
                key: 'parentTaskId'
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.END_DATE',
                value: this.taskDetails.endDate,
                key: 'endDate'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.ID',
                value: this.taskDetails.id,
                key: 'id'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DESCRIPTION',
                value: this.taskDetails.description,
                key: 'description',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.DESCRIPTION_DEFAULT'),
                multiline: true,
                editable: true,
                validators: [new TaskDescriptionValidator()]
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.FORM_NAME',
                value: this.formName,
                key: 'formName',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.FORM_NAME_DEFAULT'),
                clickable: !!this.formName,
                icon: 'create'
            })
        ];
    };
    /**
     * Refresh the card data
     */
    /**
     * Refresh the card data
     * @return {?}
     */
    TaskHeaderComponent.prototype.refreshData = /**
     * Refresh the card data
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.taskDetails) {
            /** @type {?} */
            var parentInfoMap = this.getParentInfo();
            /** @type {?} */
            var defaultProperties = this.initDefaultProperties(parentInfoMap);
            /** @type {?} */
            var filteredProperties_1 = this.appConfig.get('adf-task-header.presets.properties');
            this.properties = defaultProperties.filter((/**
             * @param {?} cardItem
             * @return {?}
             */
            function (cardItem) { return _this.isValidSelection(filteredProperties_1, cardItem); }));
        }
    };
    /**
     * @private
     * @param {?} filteredProperties
     * @param {?} cardItem
     * @return {?}
     */
    TaskHeaderComponent.prototype.isValidSelection = /**
     * @private
     * @param {?} filteredProperties
     * @param {?} cardItem
     * @return {?}
     */
    function (filteredProperties, cardItem) {
        return filteredProperties ? filteredProperties.indexOf(cardItem.key) >= 0 : true;
    };
    /**
     * Loads current bpm userId
     */
    /**
     * Loads current bpm userId
     * @private
     * @return {?}
     */
    TaskHeaderComponent.prototype.loadCurrentBpmUserId = /**
     * Loads current bpm userId
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.bpmUserService.getCurrentUserInfo().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.currentUserId = res ? +res.id : null;
        }));
    };
    /**
     * Return the process parent information
     */
    /**
     * Return the process parent information
     * @return {?}
     */
    TaskHeaderComponent.prototype.getParentInfo = /**
     * Return the process parent information
     * @return {?}
     */
    function () {
        if (this.taskDetails.processInstanceId && this.taskDetails.processDefinitionName) {
            return new Map([[this.taskDetails.processInstanceId, this.taskDetails.processDefinitionName]]);
        }
    };
    /**
     * Does the task have an assignee
     */
    /**
     * Does the task have an assignee
     * @return {?}
     */
    TaskHeaderComponent.prototype.hasAssignee = /**
     * Does the task have an assignee
     * @return {?}
     */
    function () {
        return !!this.taskDetails.assignee ? true : false;
    };
    /**
     * Returns true if the task is assigned to logged in user
     */
    /**
     * Returns true if the task is assigned to logged in user
     * @param {?} userId
     * @return {?}
     */
    TaskHeaderComponent.prototype.isAssignedTo = /**
     * Returns true if the task is assigned to logged in user
     * @param {?} userId
     * @return {?}
     */
    function (userId) {
        return this.hasAssignee() ? this.taskDetails.assignee.id === userId : false;
    };
    /**
     * Return true if the task assigned
     */
    /**
     * Return true if the task assigned
     * @return {?}
     */
    TaskHeaderComponent.prototype.isAssignedToCurrentUser = /**
     * Return true if the task assigned
     * @return {?}
     */
    function () {
        return this.hasAssignee() && this.isAssignedTo(this.currentUserId);
    };
    /**
     * Return true if the user is a candidate member
     */
    /**
     * Return true if the user is a candidate member
     * @return {?}
     */
    TaskHeaderComponent.prototype.isCandidateMember = /**
     * Return true if the user is a candidate member
     * @return {?}
     */
    function () {
        return this.taskDetails.managerOfCandidateGroup || this.taskDetails.memberOfCandidateGroup || this.taskDetails.memberOfCandidateUsers;
    };
    /**
     * Return true if the task claimable
     */
    /**
     * Return true if the task claimable
     * @return {?}
     */
    TaskHeaderComponent.prototype.isTaskClaimable = /**
     * Return true if the task claimable
     * @return {?}
     */
    function () {
        return !this.hasAssignee() && this.isCandidateMember();
    };
    /**
     * Return true if the task claimed by candidate member.
     */
    /**
     * Return true if the task claimed by candidate member.
     * @return {?}
     */
    TaskHeaderComponent.prototype.isTaskClaimedByCandidateMember = /**
     * Return true if the task claimed by candidate member.
     * @return {?}
     */
    function () {
        return this.isCandidateMember() && this.isAssignedToCurrentUser() && !this.isCompleted();
    };
    /**
     * Returns task's status
     */
    /**
     * Returns task's status
     * @return {?}
     */
    TaskHeaderComponent.prototype.getTaskStatus = /**
     * Returns task's status
     * @return {?}
     */
    function () {
        return (this.taskDetails && this.taskDetails.isCompleted()) ? 'Completed' : 'Running';
    };
    /**
     * Claim task
     *
     * @param taskId
     */
    /**
     * Claim task
     *
     * @param {?} taskId
     * @return {?}
     */
    TaskHeaderComponent.prototype.claimTask = /**
     * Claim task
     *
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        var _this = this;
        this.activitiTaskService.claimTask(taskId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.logService.info('Task claimed');
            _this.claim.emit(taskId);
        }));
    };
    /**
     * Unclaim task
     *
     * @param taskId
     */
    /**
     * Unclaim task
     *
     * @param {?} taskId
     * @return {?}
     */
    TaskHeaderComponent.prototype.unclaimTask = /**
     * Unclaim task
     *
     * @param {?} taskId
     * @return {?}
     */
    function (taskId) {
        var _this = this;
        this.activitiTaskService.unclaimTask(taskId).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.logService.info('Task unclaimed');
            _this.unclaim.emit(taskId);
        }));
    };
    /**
     * Returns true if the task is completed
     */
    /**
     * Returns true if the task is completed
     * @return {?}
     */
    TaskHeaderComponent.prototype.isCompleted = /**
     * Returns true if the task is completed
     * @return {?}
     */
    function () {
        return this.taskDetails && !!this.taskDetails.endDate;
    };
    /**
     * @return {?}
     */
    TaskHeaderComponent.prototype.getTaskDuration = /**
     * @return {?}
     */
    function () {
        return this.taskDetails.duration ? this.taskDetails.duration + " ms" : '';
    };
    TaskHeaderComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-task-header',
                    template: "<mat-card *ngIf=\"taskDetails\" class=\"adf-card-container\">\n    <mat-card-content>\n        <adf-card-view [properties]=\"properties\" [editable]=\"!isCompleted()\"></adf-card-view>\n    </mat-card-content>\n\n    <mat-card-actions class=\"adf-controls\">\n        <button *ngIf=\"isTaskClaimedByCandidateMember()\" mat-button data-automation-id=\"header-unclaim-button\" id=\"unclaim-task\" (click)=\"unclaimTask(taskDetails.id)\" class=\"adf-claim-controls\">{{ 'ADF_TASK_LIST.DETAILS.BUTTON.UNCLAIM' | translate }}\n        </button>\n        <button *ngIf=\"isTaskClaimable()\" mat-button data-automation-id=\"header-claim-button\" id=\"claim-task\" (click)=\"claimTask(taskDetails.id)\" class=\"adf-claim-controls\">{{ 'ADF_TASK_LIST.DETAILS.BUTTON.CLAIM' | translate }}\n        </button>\n    </mat-card-actions>\n</mat-card>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    TaskHeaderComponent.ctorParameters = function () { return [
        { type: TaskListService },
        { type: BpmUserService },
        { type: TranslationService },
        { type: LogService },
        { type: AppConfigService }
    ]; };
    TaskHeaderComponent.propDecorators = {
        formName: [{ type: Input }],
        taskDetails: [{ type: Input }],
        claim: [{ type: Output }],
        unclaim: [{ type: Output }]
    };
    return TaskHeaderComponent;
}());
export { TaskHeaderComponent };
if (false) {
    /**
     * The name of the form.
     * @type {?}
     */
    TaskHeaderComponent.prototype.formName;
    /**
     * (required) Details related to the task.
     * @type {?}
     */
    TaskHeaderComponent.prototype.taskDetails;
    /**
     * Emitted when the task is claimed.
     * @type {?}
     */
    TaskHeaderComponent.prototype.claim;
    /**
     * Emitted when the task is unclaimed (ie, requeued).
     * @type {?}
     */
    TaskHeaderComponent.prototype.unclaim;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.currentUserId;
    /** @type {?} */
    TaskHeaderComponent.prototype.properties;
    /** @type {?} */
    TaskHeaderComponent.prototype.inEdit;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.activitiTaskService;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.bpmUserService;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.translationService;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    TaskHeaderComponent.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1oZWFkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1wcm9jZXNzLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsidGFzay1saXN0L2NvbXBvbmVudHMvdGFzay1oZWFkZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN6RyxPQUFPLEVBQ0gsY0FBYyxFQUNkLHFCQUFxQixFQUVyQixvQkFBb0IsRUFDcEIscUJBQXFCLEVBRXJCLFVBQVUsRUFDVixrQkFBa0IsRUFDbEIsZ0JBQWdCLEVBQ25CLE1BQU0sb0JBQW9CLENBQUM7QUFDNUIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2pFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBRXBGO0lBNEJJLDZCQUFvQixtQkFBb0MsRUFDcEMsY0FBOEIsRUFDOUIsa0JBQXNDLEVBQ3RDLFVBQXNCLEVBQ3RCLFNBQTJCO1FBSjNCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBaUI7UUFDcEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixjQUFTLEdBQVQsU0FBUyxDQUFrQjs7OztRQXZCL0MsYUFBUSxHQUFXLElBQUksQ0FBQzs7OztRQVF4QixVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7Ozs7UUFJbkQsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBS3JELFdBQU0sR0FBWSxLQUFLLENBQUM7SUFPeEIsQ0FBQzs7OztJQUVE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QWxSRCxJQWtSQztTQTdRWSxtQkFBbUI7Ozs7OztJQUc1Qix1Q0FDd0I7Ozs7O0lBR3hCLDBDQUM4Qjs7Ozs7SUFHOUIsb0NBQ21EOzs7OztJQUduRCxzQ0FDcUQ7Ozs7O0lBRXJELDRDQUE4Qjs7SUFFOUIseUNBQTRCOztJQUM1QixxQ0FBd0I7Ozs7O0lBRVosa0RBQTRDOzs7OztJQUM1Qyw2Q0FBc0M7Ozs7O0lBQ3RDLGlEQUE4Qzs7Ozs7SUFDOUMseUNBQThCOzs7OztJQUM5Qix3Q0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQnBtVXNlclNlcnZpY2UsXG4gICAgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsLFxuICAgIENhcmRWaWV3SXRlbSxcbiAgICBDYXJkVmlld01hcEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld1RleHRJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdCYXNlSXRlbU1vZGVsLFxuICAgIExvZ1NlcnZpY2UsXG4gICAgVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgIEFwcENvbmZpZ1NlcnZpY2Vcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFRhc2tEZXRhaWxzTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvdGFzay1kZXRhaWxzLm1vZGVsJztcbmltcG9ydCB7IFRhc2tMaXN0U2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvdGFza2xpc3Quc2VydmljZSc7XG5pbXBvcnQgeyBUYXNrRGVzY3JpcHRpb25WYWxpZGF0b3IgfSBmcm9tICcuLi92YWxpZGF0b3JzL3Rhc2stZGVzY3JpcHRpb24udmFsaWRhdG9yJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtdGFzay1oZWFkZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi90YXNrLWhlYWRlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdGFzay1oZWFkZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYXNrSGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQge1xuXG4gICAgLyoqIFRoZSBuYW1lIG9mIHRoZSBmb3JtLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZm9ybU5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBEZXRhaWxzIHJlbGF0ZWQgdG8gdGhlIHRhc2suICovXG4gICAgQElucHV0KClcbiAgICB0YXNrRGV0YWlsczogVGFza0RldGFpbHNNb2RlbDtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHRhc2sgaXMgY2xhaW1lZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjbGFpbTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHRhc2sgaXMgdW5jbGFpbWVkIChpZSwgcmVxdWV1ZWQpLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHVuY2xhaW06IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBwcml2YXRlIGN1cnJlbnRVc2VySWQ6IG51bWJlcjtcblxuICAgIHByb3BlcnRpZXM6IENhcmRWaWV3SXRlbSBbXTtcbiAgICBpbkVkaXQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWN0aXZpdGlUYXNrU2VydmljZTogVGFza0xpc3RTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYnBtVXNlclNlcnZpY2U6IEJwbVVzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnOiBBcHBDb25maWdTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubG9hZEN1cnJlbnRCcG1Vc2VySWQoKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaERhdGEoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXREZWZhdWx0UHJvcGVydGllcyhwYXJlbnRJbmZvTWFwKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuQVNTSUdORUUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5nZXRGdWxsTmFtZSgpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdhc3NpZ25lZScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5BU1NJR05FRV9ERUZBVUxUJyksXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogIXRoaXMuaXNDb21wbGV0ZWQoKSxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2NyZWF0ZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLlNUQVRVUycsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdldFRhc2tTdGF0dXMoKSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnc3RhdHVzJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuUFJJT1JJVFknLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAncHJpb3JpdHknLFxuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuRFVFX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5kdWVEYXRlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdkdWVEYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkRVRV9EQVRFX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkNBVEVHT1JZJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2NhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkNBVEVHT1JZX0RFRkFVTFQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdNYXBJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5QQVJFTlRfTkFNRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwYXJlbnRJbmZvTWFwLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdwYXJlbnROYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLlBBUkVOVF9OQU1FX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld0RhdGVJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5DUkVBVEVEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnY3JlYXRlZCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkRVUkFUSU9OJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0VGFza0R1cmF0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2R1cmF0aW9uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuUEFSRU5UX1RBU0tfSUQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5wYXJlbnRUYXNrSWQsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ3BhcmVudFRhc2tJZCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkVORF9EQVRFJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuZW5kRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnZW5kRGF0ZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLklEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuaWQsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2lkJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuREVTQ1JJUFRJT04nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnZGVzY3JpcHRpb24nLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuREVTQ1JJUFRJT05fREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3JzOiBbbmV3IFRhc2tEZXNjcmlwdGlvblZhbGlkYXRvcigpXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuRk9STV9OQU1FJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZm9ybU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2Zvcm1OYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkZPUk1fTkFNRV9ERUZBVUxUJyksXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogISF0aGlzLmZvcm1OYW1lLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnY3JlYXRlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSBjYXJkIGRhdGFcbiAgICAgKi9cbiAgICByZWZyZXNoRGF0YSgpIHtcbiAgICAgICAgaWYgKHRoaXMudGFza0RldGFpbHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudEluZm9NYXAgPSB0aGlzLmdldFBhcmVudEluZm8oKTtcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRQcm9wZXJ0aWVzID0gdGhpcy5pbml0RGVmYXVsdFByb3BlcnRpZXMocGFyZW50SW5mb01hcCk7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZFByb3BlcnRpZXM6IHN0cmluZ1tdID0gdGhpcy5hcHBDb25maWcuZ2V0KCdhZGYtdGFzay1oZWFkZXIucHJlc2V0cy5wcm9wZXJ0aWVzJyk7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBkZWZhdWx0UHJvcGVydGllcy5maWx0ZXIoKGNhcmRJdGVtKSA9PiB0aGlzLmlzVmFsaWRTZWxlY3Rpb24oZmlsdGVyZWRQcm9wZXJ0aWVzLCBjYXJkSXRlbSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkU2VsZWN0aW9uKGZpbHRlcmVkUHJvcGVydGllczogc3RyaW5nW10sIGNhcmRJdGVtOiBDYXJkVmlld0Jhc2VJdGVtTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlcmVkUHJvcGVydGllcyA/IGZpbHRlcmVkUHJvcGVydGllcy5pbmRleE9mKGNhcmRJdGVtLmtleSkgPj0gMCA6IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgY3VycmVudCBicG0gdXNlcklkXG4gICAgICovXG4gICAgcHJpdmF0ZSBsb2FkQ3VycmVudEJwbVVzZXJJZCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5icG1Vc2VyU2VydmljZS5nZXRDdXJyZW50VXNlckluZm8oKS5zdWJzY3JpYmUoKHJlcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlcklkID0gcmVzID8gK3Jlcy5pZCA6IG51bGw7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgcHJvY2VzcyBwYXJlbnQgaW5mb3JtYXRpb25cbiAgICAgKi9cbiAgICBnZXRQYXJlbnRJbmZvKCkge1xuICAgICAgICBpZiAodGhpcy50YXNrRGV0YWlscy5wcm9jZXNzSW5zdGFuY2VJZCAmJiB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXAoW1t0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NJbnN0YW5jZUlkLCB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uTmFtZV1dKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERvZXMgdGhlIHRhc2sgaGF2ZSBhbiBhc3NpZ25lZVxuICAgICAqL1xuICAgIHB1YmxpYyBoYXNBc3NpZ25lZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHRhc2sgaXMgYXNzaWduZWQgdG8gbG9nZ2VkIGluIHVzZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgaXNBc3NpZ25lZFRvKHVzZXJJZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNBc3NpZ25lZSgpID8gdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZS5pZCA9PT0gdXNlcklkIDogZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHRhc2sgYXNzaWduZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgaXNBc3NpZ25lZFRvQ3VycmVudFVzZXIoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0Fzc2lnbmVlKCkgJiYgdGhpcy5pc0Fzc2lnbmVkVG8odGhpcy5jdXJyZW50VXNlcklkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdXNlciBpcyBhIGNhbmRpZGF0ZSBtZW1iZXJcbiAgICAgKi9cbiAgICBpc0NhbmRpZGF0ZU1lbWJlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMubWFuYWdlck9mQ2FuZGlkYXRlR3JvdXAgfHwgdGhpcy50YXNrRGV0YWlscy5tZW1iZXJPZkNhbmRpZGF0ZUdyb3VwIHx8IHRoaXMudGFza0RldGFpbHMubWVtYmVyT2ZDYW5kaWRhdGVVc2VycztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdGFzayBjbGFpbWFibGVcbiAgICAgKi9cbiAgICBwdWJsaWMgaXNUYXNrQ2xhaW1hYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXRoaXMuaGFzQXNzaWduZWUoKSAmJiB0aGlzLmlzQ2FuZGlkYXRlTWVtYmVyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHRhc2sgY2xhaW1lZCBieSBjYW5kaWRhdGUgbWVtYmVyLlxuICAgICAqL1xuICAgIHB1YmxpYyBpc1Rhc2tDbGFpbWVkQnlDYW5kaWRhdGVNZW1iZXIoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQ2FuZGlkYXRlTWVtYmVyKCkgJiYgdGhpcy5pc0Fzc2lnbmVkVG9DdXJyZW50VXNlcigpICYmICF0aGlzLmlzQ29tcGxldGVkKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0YXNrJ3Mgc3RhdHVzXG4gICAgICovXG4gICAgZ2V0VGFza1N0YXR1cygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gKHRoaXMudGFza0RldGFpbHMgJiYgdGhpcy50YXNrRGV0YWlscy5pc0NvbXBsZXRlZCgpKSA/ICdDb21wbGV0ZWQnIDogJ1J1bm5pbmcnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsYWltIHRhc2tcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YXNrSWRcbiAgICAgKi9cbiAgICBjbGFpbVRhc2sodGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3Rpdml0aVRhc2tTZXJ2aWNlLmNsYWltVGFzayh0YXNrSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKCdUYXNrIGNsYWltZWQnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsYWltLmVtaXQodGFza0lkKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVuY2xhaW0gdGFza1xuICAgICAqXG4gICAgICogQHBhcmFtIHRhc2tJZFxuICAgICAqL1xuICAgIHVuY2xhaW1UYXNrKHRhc2tJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlUYXNrU2VydmljZS51bmNsYWltVGFzayh0YXNrSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5pbmZvKCdUYXNrIHVuY2xhaW1lZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMudW5jbGFpbS5lbWl0KHRhc2tJZCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHRhc2sgaXMgY29tcGxldGVkXG4gICAgICovXG4gICAgaXNDb21wbGV0ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzICYmICEhdGhpcy50YXNrRGV0YWlscy5lbmREYXRlO1xuICAgIH1cblxuICAgIGdldFRhc2tEdXJhdGlvbigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrRGV0YWlscy5kdXJhdGlvbiA/IGAke3RoaXMudGFza0RldGFpbHMuZHVyYXRpb259IG1zYCA6ICcnO1xuICAgIH1cbn1cbiJdfQ==