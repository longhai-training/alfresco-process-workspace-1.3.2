/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, ViewEncapsulation, ViewChild } from '@angular/core';
import { AuthenticationService } from '../../services/authentication.service';
import { BpmUserService } from './../services/bpm-user.service';
import { EcmUserService } from './../services/ecm-user.service';
import { IdentityUserService } from '../services/identity-user.service';
import { of } from 'rxjs';
import { MatMenuTrigger } from '@angular/material';
var UserInfoComponent = /** @class */ (function () {
    function UserInfoComponent(ecmUserService, bpmUserService, identityUserService, authService) {
        this.ecmUserService = ecmUserService;
        this.bpmUserService = bpmUserService;
        this.identityUserService = identityUserService;
        this.authService = authService;
        /**
         * Custom path for the background banner image for ACS users.
         */
        this.ecmBackgroundImage = './assets/images/ecm-background.png';
        /**
         * Custom path for the background banner image for APS users.
         */
        this.bpmBackgroundImage = './assets/images/bpm-background.png';
        /**
         * Custom choice for opening the menu at the bottom. Can be `before` or `after`.
         */
        this.menuPositionX = 'after';
        /**
         * Custom choice for opening the menu at the bottom. Can be `above` or `below`.
         */
        this.menuPositionY = 'below';
        /**
         * Shows/hides the username next to the user info button.
         */
        this.showName = true;
        /**
         * When the username is shown, this defines its position relative to the user info button.
         * Can be `right` or `left`.
         */
        this.namePosition = 'right';
    }
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getUserInfo();
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.getUserInfo = /**
     * @return {?}
     */
    function () {
        if (this.authService.isOauth()) {
            this.loadIdentityUserInfo();
        }
        else if (this.authService.isEcmLoggedIn() && this.authService.isBpmLoggedIn()) {
            this.loadEcmUserInfo();
            this.loadBpmUserInfo();
        }
        else if (this.authService.isEcmLoggedIn()) {
            this.loadEcmUserInfo();
        }
        else if (this.authService.isBpmLoggedIn()) {
            this.loadBpmUserInfo();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    UserInfoComponent.prototype.onKeyPress = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.closeUserModal(event);
    };
    /**
     * @private
     * @param {?} $event
     * @return {?}
     */
    UserInfoComponent.prototype.closeUserModal = /**
     * @private
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if ($event.keyCode === 27) {
            this.trigger.closeMenu();
        }
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.isLoggedIn = /**
     * @return {?}
     */
    function () {
        return this.authService.isLoggedIn();
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.loadEcmUserInfo = /**
     * @return {?}
     */
    function () {
        this.ecmUser$ = this.ecmUserService.getCurrentUserInfo();
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.loadBpmUserInfo = /**
     * @return {?}
     */
    function () {
        this.bpmUser$ = this.bpmUserService.getCurrentUserInfo();
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.loadIdentityUserInfo = /**
     * @return {?}
     */
    function () {
        this.identityUser$ = of(this.identityUserService.getCurrentUserInfo());
    };
    /**
     * @param {?} event
     * @return {?}
     */
    UserInfoComponent.prototype.stopClosing = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.stopPropagation();
    };
    /**
     * @param {?} avatarId
     * @return {?}
     */
    UserInfoComponent.prototype.getEcmAvatar = /**
     * @param {?} avatarId
     * @return {?}
     */
    function (avatarId) {
        return this.ecmUserService.getUserProfileImage(avatarId);
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.getBpmUserImage = /**
     * @return {?}
     */
    function () {
        return this.bpmUserService.getCurrentUserProfileImage();
    };
    /**
     * @return {?}
     */
    UserInfoComponent.prototype.showOnRight = /**
     * @return {?}
     */
    function () {
        return this.namePosition === 'right';
    };
    UserInfoComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-userinfo',
                    template: "<div id=\"userinfo_container\" [class.adf-userinfo-name-right]=\"showOnRight()\" (keyup)=\"onKeyPress($event)\"\n    class=\"adf-userinfo-container\" *ngIf=\"isLoggedIn()\">\n\n    <ng-container *ngIf=\"showName\">\n        <span *ngIf=\"identityUser$ | async as identityUser; else showBpmAndEcmUserFullNames\" id=\"adf-userinfo-identity-name-display\"\n            class=\"adf-userinfo-name\">{{identityUser | fullName}}</span>\n        <ng-template #showBpmAndEcmUserFullNames>\n            <span *ngIf=\"ecmUser$ | async as ecmUser; else showBpmUserFullName\" id=\"adf-userinfo-ecm-name-display\"\n                class=\"adf-userinfo-name\">{{ecmUser | fullName}}</span>\n            <ng-template #showBpmUserFullName>\n                <span *ngIf=\"bpmUser$ | async as bpmUser\" id=\"adf-userinfo-bpm-name-display\"\n                    class=\"adf-userinfo-name\">{{bpmUser | fullName}}</span>\n            </ng-template>\n        </ng-template>\n    </ng-container>\n\n    <button mat-button [matMenuTriggerFor]=\"menu\" class=\"adf-userinfo-menu_button\" data-automation-id=\"adf-user-profile\">\n        <div class=\"adf-userinfo-button-profile\" id=\"user-profile\">\n            <div *ngIf=\"identityUser$ | async as identityUser; else showBpmAndEcmUserImage\" id=\"identity-user-image\">\n                <div [outerHTML]=\"identityUser | usernameInitials:'adf-userinfo-pic'\"></div>\n            </div>\n            <ng-template #showBpmAndEcmUserImage>\n                <div *ngIf=\"ecmUser$ | async as ecmUser; else showBpmUserImage\" id=\"ecm-user-image\">\n                    <div *ngIf=\"ecmUser.avatarId; else initialTemplate\" class=\"adf-userinfo-profile-container\">\n                        <img id=\"logged-user-img\" [src]=\"getEcmAvatar(ecmUser.avatarId)\" alt=\"user-info-profile-button\"\n                            class=\"adf-userinfo-profile-image\"/>\n                    </div>\n                    <ng-template #initialTemplate>\n                        <div [outerHTML]=\"ecmUser | usernameInitials:'adf-userinfo-pic'\"></div>\n                    </ng-template>\n                </div>\n                <ng-template #showBpmUserImage>\n                    <div *ngIf=\"bpmUser$ | async as bpmUser\" id=\"bpm-user-image\">\n                            <div *ngIf=\"bpmUser.pictureId; else initialTemplate\" class=\"adf-userinfo-profile-container\">\n                                <img id=\"logged-user-img\" [src]=\"getBpmUserImage()\" alt=\"user-info-profile-button\"\n                                    class=\"adf-userinfo-profile-image\"/>\n                            </div>\n                            <ng-template #initialTemplate>\n                                <div [outerHTML]=\"bpmUser | usernameInitials:'adf-userinfo-pic'\"></div>\n                            </ng-template>\n                    </div>\n                </ng-template>\n            </ng-template>\n        </div>\n    </button>\n    <mat-menu #menu=\"matMenu\" id=\"user-profile-lists\" [xPosition]=\"menuPositionX\" [yPosition]=\"menuPositionY\" [overlapTrigger]=\"false\" class=\"adf-userinfo-menu\">\n        <mat-tab-group id=\"tab-group-env\" (click)=\"stopClosing($event)\"\n            class=\"adf-userinfo-tab\" [class.adf-hide-tab]=\"!(bpmUser$ | async) || !(ecmUser$ | async)\">\n            <mat-tab id=\"ecm-panel\" label=\"{{ 'USER_PROFILE.TAB.CS' | translate }}\" *ngIf=\"ecmUser$ | async as ecmUser\">\n                <mat-card class=\"adf-userinfo-card\">\n                    <mat-card-header class=\"adf-userinfo-card-header\" [style.background-image]=\"'url(' + ecmBackgroundImage + ')'\">\n                        <div *ngIf=\"ecmUser.avatarId; else initialTemplate\" class=\"adf-userinfo-profile-container adf-hide-small\">\n                            <img class=\"adf-userinfo-profile-picture\" id=\"ecm-user-detail-image\"\n                                alt=\"ecm-profile-image\" [src]=\"getEcmAvatar(ecmUser.avatarId)\" />\n                        </div>\n                        <ng-template #initialTemplate>\n                            <div [outerHTML]=\"ecmUser | usernameInitials:'adf-userinfo-profile-initials adf-hide-small'\"></div>\n                        </ng-template>\n\n                       <div class=\"adf-userinfo-title\" id=\"ecm-username\">{{ecmUser | fullName}}</div>\n                    </mat-card-header>\n                    <mat-card-content>\n                        <div class=\"adf-userinfo-supporting-text\">\n                                <div class=\"adf-userinfo-detail\">\n                                    <span id=\"ecm-full-name\" class=\"adf-userinfo__detail-title\">{{ecmUser | fullName}}</span>\n                                    <span class=\"adf-userinfo__detail-profile\" id=\"ecm-email\"> {{ecmUser.email}} </span>\n                                </div>\n                                <div class=\"adf-userinfo-detail\">\n                                    <span class=\"adf-userinfo__secondary-info\" id=\"ecm-job-title-label\">\n                                        {{ 'USER_PROFILE.LABELS.ECM.JOB_TITLE' | translate }}\n                                        <span id=\"ecm-job-title\" class=\"adf-userinfo__detail-profile\"> {{ ecmUser.jobTitle ? ecmUser.jobTitle : 'N/A' }} </span>\n                                    </span>\n                                </div>\n                        </div>\n                    </mat-card-content>\n                </mat-card>\n            </mat-tab>\n            <mat-tab id=\"bpm-panel\" label=\"{{ 'USER_PROFILE.TAB.PS' | translate }}\" *ngIf=\"bpmUser$ | async as bpmUser\">\n            <mat-card class=\"adf-userinfo-card\">\n                <mat-card-header class=\"adf-userinfo-card-header\" [style.background-image]=\"'url(' + bpmBackgroundImage + ')'\">\n                    <img *ngIf=\"bpmUser.pictureId; else initialTemplate\" class=\"adf-userinfo-profile-picture adf-hide-small\" id=\"bpm-user-detail-image\"\n                            alt=\"bpm-profile-image\" [src]=\"getBpmUserImage()\"/>\n                    <ng-template #initialTemplate>\n                        <div [outerHTML]=\"bpmUser | usernameInitials:'adf-userinfo-profile-initials adf-hide-small'\"></div>\n                    </ng-template>\n                   <div class=\"adf-userinfo-title\" id=\"bpm-username\">{{bpmUser | fullName}}</div>\n                </mat-card-header>\n                <mat-card-content>\n                    <div class=\"adf-userinfo-supporting-text\">\n                            <div class=\"adf-userinfo-detail\">\n                                <span id=\"bpm-full-name\" class=\"adf-userinfo__detail-title\">{{ bpmUser | fullName }}</span>\n                                <span class=\"adf-userinfo__detail-profile\" id=\"bpm-email\"> {{bpmUser.email}} </span>\n                            </div>\n                            <div class=\"adf-userinfo-detail\">\n                                <span id=\"bpm-tenant\" class=\"adf-userinfo__secondary-info\">\n                                    {{ 'USER_PROFILE.LABELS.BPM.TENANT' | translate }}\n                                    <span class=\"adf-userinfo__detail-profile\">{{ bpmUser.tenantName ? bpmUser.tenantName : '' }}</span>\n                                </span>\n                            </div>\n                    </div>\n                </mat-card-content>\n            </mat-card>\n            </mat-tab>\n            <mat-tab id=\"identity-panel\" *ngIf=\"identityUser$ | async as identityUser\">\n                <mat-card class=\"adf-userinfo-card\">\n                    <mat-card-header class=\"adf-userinfo-card-header\" [style.background-image]=\"'url(' + bpmBackgroundImage + ')'\">\n                        <div\n                            [outerHTML]=\"identityUser | usernameInitials:'adf-userinfo-profile-initials adf-hide-small'\">\n                        </div>\n                       <div class=\"adf-userinfo-title\" id=\"identity-username\">{{identityUser | fullName}}</div>\n                    </mat-card-header>\n                    <mat-card-content>\n                        <div class=\"adf-userinfo-supporting-text\">\n                                <div class=\"adf-userinfo-detail\">\n                                    <span id=\"identity-full-name\" class=\"adf-userinfo__detail-title\">{{identityUser | fullName}}</span>\n                                    <span class=\"adf-userinfo__detail-profile\" id=\"identity-email\"> {{identityUser.email}} </span>\n                                </div>\n                        </div>\n                    </mat-card-content>\n                </mat-card>\n            </mat-tab>\n        </mat-tab-group>\n    </mat-menu>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    UserInfoComponent.ctorParameters = function () { return [
        { type: EcmUserService },
        { type: BpmUserService },
        { type: IdentityUserService },
        { type: AuthenticationService }
    ]; };
    UserInfoComponent.propDecorators = {
        trigger: [{ type: ViewChild, args: [MatMenuTrigger,] }],
        ecmBackgroundImage: [{ type: Input }],
        bpmBackgroundImage: [{ type: Input }],
        menuPositionX: [{ type: Input }],
        menuPositionY: [{ type: Input }],
        showName: [{ type: Input }],
        namePosition: [{ type: Input }]
    };
    return UserInfoComponent;
}());
export { UserInfoComponent };
if (false) {
    /** @type {?} */
    UserInfoComponent.prototype.trigger;
    /**
     * Custom path for the background banner image for ACS users.
     * @type {?}
     */
    UserInfoComponent.prototype.ecmBackgroundImage;
    /**
     * Custom path for the background banner image for APS users.
     * @type {?}
     */
    UserInfoComponent.prototype.bpmBackgroundImage;
    /**
     * Custom choice for opening the menu at the bottom. Can be `before` or `after`.
     * @type {?}
     */
    UserInfoComponent.prototype.menuPositionX;
    /**
     * Custom choice for opening the menu at the bottom. Can be `above` or `below`.
     * @type {?}
     */
    UserInfoComponent.prototype.menuPositionY;
    /**
     * Shows/hides the username next to the user info button.
     * @type {?}
     */
    UserInfoComponent.prototype.showName;
    /**
     * When the username is shown, this defines its position relative to the user info button.
     * Can be `right` or `left`.
     * @type {?}
     */
    UserInfoComponent.prototype.namePosition;
    /** @type {?} */
    UserInfoComponent.prototype.ecmUser$;
    /** @type {?} */
    UserInfoComponent.prototype.bpmUser$;
    /** @type {?} */
    UserInfoComponent.prototype.identityUser$;
    /** @type {?} */
    UserInfoComponent.prototype.selectedIndex;
    /**
     * @type {?}
     * @private
     */
    UserInfoComponent.prototype.ecmUserService;
    /**
     * @type {?}
     * @private
     */
    UserInfoComponent.prototype.bpmUserService;
    /**
     * @type {?}
     * @private
     */
    UserInfoComponent.prototype.identityUserService;
    /**
     * @type {?}
     * @private
     */
    UserInfoComponent.prototype.authService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1pbmZvLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29yZS8iLCJzb3VyY2VzIjpbInVzZXJpbmZvL2NvbXBvbmVudHMvdXNlci1pbmZvLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFJOUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsRUFBRSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVuRDtJQXlDSSwyQkFBb0IsY0FBOEIsRUFDOUIsY0FBOEIsRUFDOUIsbUJBQXdDLEVBQ3hDLFdBQWtDO1FBSGxDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7Ozs7UUFoQ3RELHVCQUFrQixHQUFXLG9DQUFvQyxDQUFDOzs7O1FBSWxFLHVCQUFrQixHQUFXLG9DQUFvQyxDQUFDOzs7O1FBSWxFLGtCQUFhLEdBQVcsT0FBTyxDQUFDOzs7O1FBSWhDLGtCQUFhLEdBQVcsT0FBTyxDQUFDOzs7O1FBSWhDLGFBQVEsR0FBWSxJQUFJLENBQUM7Ozs7O1FBTXpCLGlCQUFZLEdBQVcsT0FBTyxDQUFDO0lBVy9CLENBQUM7Ozs7SUFF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S3pCLHlDQUMrQjs7SUFFL0IscUNBQW1DOztJQUNuQyxxQ0FBbUM7O0lBQ25DLDBDQUE2Qzs7SUFDN0MsMENBQXNCOzs7OztJQUVWLDJDQUFzQzs7Ozs7SUFDdEMsMkNBQXNDOzs7OztJQUN0QyxnREFBZ0Q7Ozs7O0lBQ2hELHdDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVmlld0VuY2Fwc3VsYXRpb24sIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBCcG1Vc2VyTW9kZWwgfSBmcm9tICcuLy4uL21vZGVscy9icG0tdXNlci5tb2RlbCc7XG5pbXBvcnQgeyBFY21Vc2VyTW9kZWwgfSBmcm9tICcuLy4uL21vZGVscy9lY20tdXNlci5tb2RlbCc7XG5pbXBvcnQgeyBJZGVudGl0eVVzZXJNb2RlbCB9IGZyb20gJy4vLi4vbW9kZWxzL2lkZW50aXR5LXVzZXIubW9kZWwnO1xuaW1wb3J0IHsgQnBtVXNlclNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2JwbS11c2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgRWNtVXNlclNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2VzL2VjbS11c2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgSWRlbnRpdHlVc2VyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2lkZW50aXR5LXVzZXIuc2VydmljZSc7XG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTWF0TWVudVRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXVzZXJpbmZvJyxcbiAgICBzdHlsZVVybHM6IFsnLi91c2VyLWluZm8uY29tcG9uZW50LnNjc3MnXSxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdXNlci1pbmZvLmNvbXBvbmVudC5odG1sJyxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJJbmZvQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIEBWaWV3Q2hpbGQoTWF0TWVudVRyaWdnZXIpIHRyaWdnZXI6IE1hdE1lbnVUcmlnZ2VyO1xuXG4gICAgLyoqIEN1c3RvbSBwYXRoIGZvciB0aGUgYmFja2dyb3VuZCBiYW5uZXIgaW1hZ2UgZm9yIEFDUyB1c2Vycy4gKi9cbiAgICBASW5wdXQoKVxuICAgIGVjbUJhY2tncm91bmRJbWFnZTogc3RyaW5nID0gJy4vYXNzZXRzL2ltYWdlcy9lY20tYmFja2dyb3VuZC5wbmcnO1xuXG4gICAgLyoqIEN1c3RvbSBwYXRoIGZvciB0aGUgYmFja2dyb3VuZCBiYW5uZXIgaW1hZ2UgZm9yIEFQUyB1c2Vycy4gKi9cbiAgICBASW5wdXQoKVxuICAgIGJwbUJhY2tncm91bmRJbWFnZTogc3RyaW5nID0gJy4vYXNzZXRzL2ltYWdlcy9icG0tYmFja2dyb3VuZC5wbmcnO1xuXG4gICAgLyoqIEN1c3RvbSBjaG9pY2UgZm9yIG9wZW5pbmcgdGhlIG1lbnUgYXQgdGhlIGJvdHRvbS4gQ2FuIGJlIGBiZWZvcmVgIG9yIGBhZnRlcmAuICovXG4gICAgQElucHV0KClcbiAgICBtZW51UG9zaXRpb25YOiBzdHJpbmcgPSAnYWZ0ZXInO1xuXG4gICAgLyoqIEN1c3RvbSBjaG9pY2UgZm9yIG9wZW5pbmcgdGhlIG1lbnUgYXQgdGhlIGJvdHRvbS4gQ2FuIGJlIGBhYm92ZWAgb3IgYGJlbG93YC4gKi9cbiAgICBASW5wdXQoKVxuICAgIG1lbnVQb3NpdGlvblk6IHN0cmluZyA9ICdiZWxvdyc7XG5cbiAgICAvKiogU2hvd3MvaGlkZXMgdGhlIHVzZXJuYW1lIG5leHQgdG8gdGhlIHVzZXIgaW5mbyBidXR0b24uICovXG4gICAgQElucHV0KClcbiAgICBzaG93TmFtZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogV2hlbiB0aGUgdXNlcm5hbWUgaXMgc2hvd24sIHRoaXMgZGVmaW5lcyBpdHMgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIHVzZXIgaW5mbyBidXR0b24uXG4gICAgICogQ2FuIGJlIGByaWdodGAgb3IgYGxlZnRgLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgbmFtZVBvc2l0aW9uOiBzdHJpbmcgPSAncmlnaHQnO1xuXG4gICAgZWNtVXNlciQ6IE9ic2VydmFibGU8RWNtVXNlck1vZGVsPjtcbiAgICBicG1Vc2VyJDogT2JzZXJ2YWJsZTxCcG1Vc2VyTW9kZWw+O1xuICAgIGlkZW50aXR5VXNlciQ6IE9ic2VydmFibGU8SWRlbnRpdHlVc2VyTW9kZWw+O1xuICAgIHNlbGVjdGVkSW5kZXg6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWNtVXNlclNlcnZpY2U6IEVjbVVzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYnBtVXNlclNlcnZpY2U6IEJwbVVzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgaWRlbnRpdHlVc2VyU2VydmljZTogSWRlbnRpdHlVc2VyU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoZW50aWNhdGlvblNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5nZXRVc2VySW5mbygpO1xuICAgIH1cblxuICAgIGdldFVzZXJJbmZvKCkge1xuICAgICAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc09hdXRoKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZElkZW50aXR5VXNlckluZm8oKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dGhTZXJ2aWNlLmlzRWNtTG9nZ2VkSW4oKSAmJiB0aGlzLmF1dGhTZXJ2aWNlLmlzQnBtTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkRWNtVXNlckluZm8oKTtcbiAgICAgICAgICAgIHRoaXMubG9hZEJwbVVzZXJJbmZvKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdXRoU2VydmljZS5pc0VjbUxvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEVjbVVzZXJJbmZvKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdXRoU2VydmljZS5pc0JwbUxvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEJwbVVzZXJJbmZvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbktleVByZXNzKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIHRoaXMuY2xvc2VVc2VyTW9kYWwoZXZlbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xvc2VVc2VyTW9kYWwoJGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmICgkZXZlbnQua2V5Q29kZSA9PT0gMjcgKSB7XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIuY2xvc2VNZW51KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0xvZ2dlZEluKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hdXRoU2VydmljZS5pc0xvZ2dlZEluKCk7XG4gICAgfVxuXG4gICAgbG9hZEVjbVVzZXJJbmZvKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVjbVVzZXIkID0gdGhpcy5lY21Vc2VyU2VydmljZS5nZXRDdXJyZW50VXNlckluZm8oKTtcbiAgICB9XG5cbiAgICBsb2FkQnBtVXNlckluZm8oKSB7XG4gICAgICAgIHRoaXMuYnBtVXNlciQgPSB0aGlzLmJwbVVzZXJTZXJ2aWNlLmdldEN1cnJlbnRVc2VySW5mbygpO1xuICAgIH1cblxuICAgIGxvYWRJZGVudGl0eVVzZXJJbmZvKCkge1xuICAgICAgICB0aGlzLmlkZW50aXR5VXNlciQgPSBvZih0aGlzLmlkZW50aXR5VXNlclNlcnZpY2UuZ2V0Q3VycmVudFVzZXJJbmZvKCkpO1xuICAgIH1cblxuICAgIHN0b3BDbG9zaW5nKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIGdldEVjbUF2YXRhcihhdmF0YXJJZDogYW55ICk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmVjbVVzZXJTZXJ2aWNlLmdldFVzZXJQcm9maWxlSW1hZ2UoYXZhdGFySWQpO1xuICAgIH1cblxuICAgIGdldEJwbVVzZXJJbWFnZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5icG1Vc2VyU2VydmljZS5nZXRDdXJyZW50VXNlclByb2ZpbGVJbWFnZSgpO1xuICAgIH1cblxuICAgIHNob3dPblJpZ2h0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5uYW1lUG9zaXRpb24gPT09ICdyaWdodCc7XG4gICAgfVxufVxuIl19