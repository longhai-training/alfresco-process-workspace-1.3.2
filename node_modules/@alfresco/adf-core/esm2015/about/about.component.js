/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation, Input } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { AuthenticationService } from '../services/authentication.service';
import { DiscoveryApiService } from '../services/discovery-api.service';
import { ObjectDataTableAdapter } from '../datatable/data/object-datatable-adapter';
import { AppConfigService, AppConfigValues } from '../app-config/app-config.service';
import { AppExtensionService } from '@alfresco/adf-extensions';
export class AboutComponent {
    /**
     * @param {?} http
     * @param {?} appConfig
     * @param {?} authService
     * @param {?} discovery
     * @param {?} appExtensions
     */
    constructor(http, appConfig, authService, discovery, appExtensions) {
        this.http = http;
        this.appConfig = appConfig;
        this.authService = authService;
        this.discovery = discovery;
        this.extensionColumns = ['$id', '$name', '$version', '$vendor', '$license', '$runtime', '$description'];
        /**
         * Commit corresponding to the version of ADF to be used.
         */
        this.githubUrlCommitAlpha = 'https://github.com/Alfresco/alfresco-ng2-components/commits/';
        /**
         * Toggles showing/hiding of extensions block.
         */
        this.showExtensions = true;
        /**
         * Regular expression for filtering dependencies packages.
         */
        this.regexp = '^(@alfresco)';
        this.ecmHost = '';
        this.bpmHost = '';
        this.ecmVersion = null;
        this.bpmVersion = null;
        this.extensions$ = appExtensions.references$;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.authService.isEcmLoggedIn()) {
            this.discovery.getEcmProductInfo().subscribe((/**
             * @param {?} ecmVers
             * @return {?}
             */
            (ecmVers) => {
                this.ecmVersion = ecmVers;
                this.modules = new ObjectDataTableAdapter(this.ecmVersion.modules, [
                    { type: 'text', key: 'id', title: 'ABOUT.TABLE_HEADERS.MODULES.ID', sortable: true },
                    { type: 'text', key: 'title', title: 'ABOUT.TABLE_HEADERS.MODULES.TITLE', sortable: true },
                    { type: 'text', key: 'version', title: 'ABOUT.TABLE_HEADERS.MODULES.DESCRIPTION', sortable: true },
                    {
                        type: 'text',
                        key: 'installDate',
                        title: 'ABOUT.TABLE_HEADERS.MODULES.INSTALL_DATE',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'installState',
                        title: 'ABOUT.TABLE_HEADERS.MODULES.INSTALL_STATE',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'versionMin',
                        title: 'ABOUT.TABLE_HEADERS.MODULES.VERSION_MIN',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'versionMax',
                        title: 'ABOUT.TABLE_HEADERS.MODULES.VERSION_MAX',
                        sortable: true
                    }
                ]);
                this.status = new ObjectDataTableAdapter([this.ecmVersion.status], [
                    { type: 'text', key: 'isReadOnly', title: 'ABOUT.TABLE_HEADERS.STATUS.READ_ONLY', sortable: true },
                    {
                        type: 'text',
                        key: 'isAuditEnabled',
                        title: 'ABOUT.TABLE_HEADERS.STATUS.AUDIT_ENABLED',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'isQuickShareEnabled',
                        title: 'ABOUT.TABLE_HEADERS.STATUS.QUICK_SHARE_ENABLED',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'isThumbnailGenerationEnabled',
                        title: 'ABOUT.TABLE_HEADERS.STATUS.THUMBNAIL_ENABLED',
                        sortable: true
                    }
                ]);
                this.license = new ObjectDataTableAdapter([this.ecmVersion.license], [
                    { type: 'text', key: 'issuedAt', title: 'ABOUT.TABLE_HEADERS.LICENSE.ISSUES_AT', sortable: true },
                    { type: 'text', key: 'expiresAt', title: 'ABOUT.TABLE_HEADERS.LICENSE.EXPIRES_AT', sortable: true },
                    {
                        type: 'text',
                        key: 'remainingDays',
                        title: 'ABOUT.TABLE_HEADERS.LICENSE.REMAINING_DAYS',
                        sortable: true
                    },
                    { type: 'text', key: 'holder', title: 'ABOUT.TABLE_HEADERS.LICENSE.HOLDER', sortable: true },
                    { type: 'text', key: 'mode', title: 'ABOUT.TABLE_HEADERS.LICENSE.MODE', sortable: true },
                    {
                        type: 'text',
                        key: 'isClusterEnabled',
                        title: 'ABOUT.TABLE_HEADERS.LICENSE.CLUSTER_ENABLED',
                        sortable: true
                    },
                    {
                        type: 'text',
                        key: 'isCryptodocEnabled',
                        title: 'ABOUT.TABLE_HEADERS.LICENSE.CRYPTODOC_ENABLED',
                        sortable: true
                    }
                ]);
            }));
        }
        if (this.authService.isBpmLoggedIn()) {
            this.discovery.getBpmProductInfo().subscribe((/**
             * @param {?} bpmVers
             * @return {?}
             */
            (bpmVers) => {
                this.bpmVersion = bpmVers;
            }));
        }
        this.http.get('/versions.json?' + new Date()).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            /** @type {?} */
            const alfrescoPackages = Object.keys(response.dependencies).filter((/**
             * @param {?} val
             * @return {?}
             */
            (val) => {
                return new RegExp(this.regexp).test(val);
            }));
            /** @type {?} */
            const alfrescoPackagesTableRepresentation = [];
            alfrescoPackages.forEach((/**
             * @param {?} val
             * @return {?}
             */
            (val) => {
                alfrescoPackagesTableRepresentation.push({
                    name: val,
                    version: (response.dependencies[val].version || response.dependencies[val].required.version)
                });
            }));
            this.gitHubLinkCreation(alfrescoPackagesTableRepresentation);
            this.data = new ObjectDataTableAdapter(alfrescoPackagesTableRepresentation, [
                { type: 'text', key: 'name', title: 'Name', sortable: true },
                { type: 'text', key: 'version', title: 'Version', sortable: true }
            ]);
        }));
        this.ecmHost = this.appConfig.get(AppConfigValues.ECMHOST);
        this.bpmHost = this.appConfig.get(AppConfigValues.BPMHOST);
    }
    /**
     * @private
     * @param {?} alfrescoPackagesTableRepresentation
     * @return {?}
     */
    gitHubLinkCreation(alfrescoPackagesTableRepresentation) {
        /** @type {?} */
        const corePackage = alfrescoPackagesTableRepresentation.find((/**
         * @param {?} packageUp
         * @return {?}
         */
        (packageUp) => {
            return packageUp.name === '@alfresco/adf-core';
        }));
        if (corePackage) {
            /** @type {?} */
            const commitIsh = corePackage.version.split('-');
            if (commitIsh.length > 1) {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + commitIsh[1];
            }
            else {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + corePackage.version;
            }
        }
    }
}
AboutComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-about',
                template: "<div class=\"adf-about-container\">\n    <div class=\"adf-extension-details-container\" *ngIf=\"showExtensions\">\n        <h3>{{ 'ABOUT.TITLE' | translate }}</h3>\n        <mat-table [dataSource]=\"extensions$ | async\">\n            <!-- $id Column -->\n            <ng-container matColumnDef=\"$id\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.ID' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$id}}</mat-cell>\n            </ng-container>\n\n            <!-- $name Column -->\n            <ng-container matColumnDef=\"$name\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.NAME' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$name}}</mat-cell>\n            </ng-container>\n\n            <!-- $version Column -->\n            <ng-container matColumnDef=\"$version\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.VERSION' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$version}}</mat-cell>\n            </ng-container>\n\n            <!-- $vendor Column -->\n            <ng-container matColumnDef=\"$vendor\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.VENDOR' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$vendor}}</mat-cell>\n            </ng-container>\n\n            <!-- $license Column -->\n            <ng-container matColumnDef=\"$license\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.LICENSE' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$license}}</mat-cell>\n            </ng-container>\n\n            <!-- $runtime Column -->\n            <ng-container matColumnDef=\"$runtime\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.RUNTIME' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$runtime}}</mat-cell>\n            </ng-container>\n\n            <!-- $description Column -->\n            <ng-container matColumnDef=\"$description\">\n                <mat-header-cell *matHeaderCellDef>{{ 'ABOUT.TABLE_HEADERS.DESCRIPTION' | translate }}</mat-header-cell>\n                <mat-cell *matCellDef=\"let element\">{{element.$description}}</mat-cell>\n            </ng-container>\n\n            <mat-header-row *matHeaderRowDef=\"extensionColumns\"></mat-header-row>\n            <mat-row *matRowDef=\"let row; columns: extensionColumns;\"></mat-row>\n        </mat-table>\n    </div>\n    <h3>{{ 'ABOUT.SERVER_SETTINGS.TITLE' | translate }}</h3>\n    <mat-list>\n        <small>{{ 'ABOUT.SERVER_SETTINGS.DESCRIPTION' | translate }}</small>\n        <mat-list-item>\n            <h4 matLine> {{ 'ABOUT.SERVER_SETTINGS.PROCESS_SERVICE_HOST' | translate: { value: bpmHost } }}</h4>\n        </mat-list-item>\n        <mat-divider></mat-divider>\n        <mat-list-item>\n            <h4 matLine>{{ 'ABOUT.SERVER_SETTINGS.PROCESS_SERVICE_HOST' | translate: { value: ecmHost } }}</h4>\n        </mat-list-item>\n    </mat-list>\n\n    <h3>{{ 'ABOUT.VERSIONS.TITLE' | translate }}</h3>\n    <div *ngIf=\"bpmVersion\">\n        <h3>{{ 'ABOUT.VERSIONS.PROCESS_SERVICE' | translate }}</h3>\n        <div> {{ 'ABOUT.VERSIONS.divS.EDITION' | translate }} </div> {{ bpmVersion.edition }}\n        <p></p>\n        <div> {{ 'ABOUT.VERSIONS.divS.VERSION' | translate }} </div> {{ bpmVersion.majorVersion }}.{{\n        bpmVersion.minorVersion }}.{{ bpmVersion.revisionVersion }}\n    </div>\n    <div *ngIf=\"ecmVersion\">\n        <h3>{{ 'ABOUT.VERSIONS.CONTENT_SERVICE' | translate }}</h3>\n        <div>{{ 'ABOUT.VERSIONS.divS.EDITION' | translate }}</div> {{ ecmVersion.edition }}\n        <p></p>\n        <div> {{ 'ABOUT.VERSIONS.divS.VERSION' | translate }} </div> {{ ecmVersion.version.display }}\n        <p></p>\n        <h4>{{ 'ABOUT.VERSIONS.divS.LICENSE' | translate }}</h4>\n        <adf-datatable [data]=\"license\"></adf-datatable>\n\n        <h4> {{ 'ABOUT.VERSIONS.divS.STATUS' | translate }}</h4>\n        <adf-datatable [data]=\"status\"></adf-datatable>\n\n        <h4>{{ 'ABOUT.VERSIONS.divS.MODULES' | translate }}</h4>\n\n        <adf-datatable [data]=\"modules\"></adf-datatable>\n    </div>\n\n    <div *ngIf=\"githubUrlCommitAlpha\">\n        <h3>{{ 'ABOUT.SOURCE_CODE.TITLE' | translate }}</h3>\n        <small>{{ 'ABOUT.SOURCE_CODE.DESCRIPTION' | translate }}</small>\n        <div>\n            <a [href]=\"githubUrlCommitAlpha\">{{githubUrlCommitAlpha}}</a>\n        </div>\n    </div>\n\n    <h3>{{ 'ABOUT.PACKAGES.TITLE' | translate }}</h3>\n    <small>{{ 'ABOUT.PACKAGES.DESCRIPTION' | translate }}</small>\n    <adf-datatable [data]=\"data\"></adf-datatable>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-about-container{padding:10px}.adf-table-version{width:60%;border:0;border-spacing:0;text-align:center}"]
            }] }
];
/** @nocollapse */
AboutComponent.ctorParameters = () => [
    { type: HttpClient },
    { type: AppConfigService },
    { type: AuthenticationService },
    { type: DiscoveryApiService },
    { type: AppExtensionService }
];
AboutComponent.propDecorators = {
    githubUrlCommitAlpha: [{ type: Input }],
    showExtensions: [{ type: Input }],
    regexp: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    AboutComponent.prototype.data;
    /** @type {?} */
    AboutComponent.prototype.status;
    /** @type {?} */
    AboutComponent.prototype.license;
    /** @type {?} */
    AboutComponent.prototype.modules;
    /** @type {?} */
    AboutComponent.prototype.extensionColumns;
    /** @type {?} */
    AboutComponent.prototype.extensions$;
    /**
     * Commit corresponding to the version of ADF to be used.
     * @type {?}
     */
    AboutComponent.prototype.githubUrlCommitAlpha;
    /**
     * Toggles showing/hiding of extensions block.
     * @type {?}
     */
    AboutComponent.prototype.showExtensions;
    /**
     * Regular expression for filtering dependencies packages.
     * @type {?}
     */
    AboutComponent.prototype.regexp;
    /** @type {?} */
    AboutComponent.prototype.ecmHost;
    /** @type {?} */
    AboutComponent.prototype.bpmHost;
    /** @type {?} */
    AboutComponent.prototype.ecmVersion;
    /** @type {?} */
    AboutComponent.prototype.bpmVersion;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.appConfig;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.authService;
    /**
     * @type {?}
     * @private
     */
    AboutComponent.prototype.discovery;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJvdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1jb3JlLyIsInNvdXJjZXMiOlsiYWJvdXQvYWJvdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxTQUFTLEVBQVUsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUUzRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUNwRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFckYsT0FBTyxFQUFnQixtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBUTdFLE1BQU0sT0FBTyxjQUFjOzs7Ozs7OztJQTBCdkIsWUFBb0IsSUFBZ0IsRUFDaEIsU0FBMkIsRUFDM0IsV0FBa0MsRUFDbEMsU0FBOEIsRUFDdEMsYUFBa0M7UUFKMUIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUMzQixnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUFDbEMsY0FBUyxHQUFULFNBQVMsQ0FBcUI7UUF2QmxELHFCQUFnQixHQUFhLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsY0FBYyxDQUFDLENBQUM7Ozs7UUFLN0cseUJBQW9CLEdBQUcsOERBQThELENBQUM7Ozs7UUFJdEYsbUJBQWMsR0FBRyxJQUFJLENBQUM7Ozs7UUFHYixXQUFNLEdBQUcsY0FBYyxDQUFDO1FB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QTBDOzs7OztJQUU5Qiw4QkFBd0I7Ozs7O0lBQ3hCLG1DQUFtQzs7Ozs7SUFDbkMscUNBQTBDOzs7OztJQUMxQyxtQ0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0VuY2Fwc3VsYXRpb24sIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYXV0aGVudGljYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBCcG1Qcm9kdWN0VmVyc2lvbk1vZGVsLCBFY21Qcm9kdWN0VmVyc2lvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2R1Y3QtdmVyc2lvbi5tb2RlbCc7XG5pbXBvcnQgeyBEaXNjb3ZlcnlBcGlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZGlzY292ZXJ5LWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIgfSBmcm9tICcuLi9kYXRhdGFibGUvZGF0YS9vYmplY3QtZGF0YXRhYmxlLWFkYXB0ZXInO1xuaW1wb3J0IHsgQXBwQ29uZmlnU2VydmljZSwgQXBwQ29uZmlnVmFsdWVzIH0gZnJvbSAnLi4vYXBwLWNvbmZpZy9hcHAtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRXh0ZW5zaW9uUmVmLCBBcHBFeHRlbnNpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1leHRlbnNpb25zJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtYWJvdXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9hYm91dC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vYWJvdXQuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIEFib3V0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGRhdGE6IE9iamVjdERhdGFUYWJsZUFkYXB0ZXI7XG4gICAgc3RhdHVzOiBPYmplY3REYXRhVGFibGVBZGFwdGVyO1xuICAgIGxpY2Vuc2U6IE9iamVjdERhdGFUYWJsZUFkYXB0ZXI7XG4gICAgbW9kdWxlczogT2JqZWN0RGF0YVRhYmxlQWRhcHRlcjtcbiAgICBleHRlbnNpb25Db2x1bW5zOiBzdHJpbmdbXSA9IFsnJGlkJywgJyRuYW1lJywgJyR2ZXJzaW9uJywgJyR2ZW5kb3InLCAnJGxpY2Vuc2UnLCAnJHJ1bnRpbWUnLCAnJGRlc2NyaXB0aW9uJ107XG4gICAgZXh0ZW5zaW9ucyQ6IE9ic2VydmFibGU8RXh0ZW5zaW9uUmVmW10+O1xuXG4gICAgLyoqIENvbW1pdCBjb3JyZXNwb25kaW5nIHRvIHRoZSB2ZXJzaW9uIG9mIEFERiB0byBiZSB1c2VkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2l0aHViVXJsQ29tbWl0QWxwaGEgPSAnaHR0cHM6Ly9naXRodWIuY29tL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2NvbW1pdHMvJztcblxuICAgIC8qKiBUb2dnbGVzIHNob3dpbmcvaGlkaW5nIG9mIGV4dGVuc2lvbnMgYmxvY2suICovXG4gICAgQElucHV0KClcbiAgICBzaG93RXh0ZW5zaW9ucyA9IHRydWU7XG5cbiAgICAvKiogUmVndWxhciBleHByZXNzaW9uIGZvciBmaWx0ZXJpbmcgZGVwZW5kZW5jaWVzIHBhY2thZ2VzLiAqL1xuICAgIEBJbnB1dCgpIHJlZ2V4cCA9ICdeKEBhbGZyZXNjbyknO1xuXG4gICAgZWNtSG9zdCA9ICcnO1xuICAgIGJwbUhvc3QgPSAnJztcblxuICAgIGVjbVZlcnNpb246IEVjbVByb2R1Y3RWZXJzaW9uTW9kZWwgPSBudWxsO1xuICAgIGJwbVZlcnNpb246IEJwbVByb2R1Y3RWZXJzaW9uTW9kZWwgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnOiBBcHBDb25maWdTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhlbnRpY2F0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGRpc2NvdmVyeTogRGlzY292ZXJ5QXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBhcHBFeHRlbnNpb25zOiBBcHBFeHRlbnNpb25TZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZXh0ZW5zaW9ucyQgPSBhcHBFeHRlbnNpb25zLnJlZmVyZW5jZXMkO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuXG4gICAgICAgIGlmICh0aGlzLmF1dGhTZXJ2aWNlLmlzRWNtTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgdGhpcy5kaXNjb3ZlcnkuZ2V0RWNtUHJvZHVjdEluZm8oKS5zdWJzY3JpYmUoKGVjbVZlcnMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVjbVZlcnNpb24gPSBlY21WZXJzO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tb2R1bGVzID0gbmV3IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIodGhpcy5lY21WZXJzaW9uLm1vZHVsZXMsIFtcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2lkJywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLk1PRFVMRVMuSUQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAndGl0bGUnLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5USVRMRScsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICd2ZXJzaW9uJywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLk1PRFVMRVMuREVTQ1JJUFRJT04nLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICdpbnN0YWxsRGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5JTlNUQUxMX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAnaW5zdGFsbFN0YXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5NT0RVTEVTLklOU1RBTExfU1RBVEUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAndmVyc2lvbk1pbicsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTU9EVUxFUy5WRVJTSU9OX01JTicsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICd2ZXJzaW9uTWF4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5NT0RVTEVTLlZFUlNJT05fTUFYJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gbmV3IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIoW3RoaXMuZWNtVmVyc2lvbi5zdGF0dXNdLCBbXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpc1JlYWRPbmx5JywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLlNUQVRVUy5SRUFEX09OTFknLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICdpc0F1ZGl0RW5hYmxlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuU1RBVFVTLkFVRElUX0VOQUJMRUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAnaXNRdWlja1NoYXJlRW5hYmxlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuU1RBVFVTLlFVSUNLX1NIQVJFX0VOQUJMRUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAnaXNUaHVtYm5haWxHZW5lcmF0aW9uRW5hYmxlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuU1RBVFVTLlRIVU1CTkFJTF9FTkFCTEVEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubGljZW5zZSA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKFt0aGlzLmVjbVZlcnNpb24ubGljZW5zZV0sIFtcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2lzc3VlZEF0JywgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLkxJQ0VOU0UuSVNTVUVTX0FUJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2V4cGlyZXNBdCcsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLkVYUElSRVNfQVQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICdyZW1haW5pbmdEYXlzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLlJFTUFJTklOR19EQVlTJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdob2xkZXInLCB0aXRsZTogJ0FCT1VULlRBQkxFX0hFQURFUlMuTElDRU5TRS5IT0xERVInLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnbW9kZScsIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLk1PREUnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICdpc0NsdXN0ZXJFbmFibGVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQUJPVVQuVEFCTEVfSEVBREVSUy5MSUNFTlNFLkNMVVNURVJfRU5BQkxFRCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICdpc0NyeXB0b2RvY0VuYWJsZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBQk9VVC5UQUJMRV9IRUFERVJTLkxJQ0VOU0UuQ1JZUFRPRE9DX0VOQUJMRUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc0JwbUxvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJ5LmdldEJwbVByb2R1Y3RJbmZvKCkuc3Vic2NyaWJlKChicG1WZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5icG1WZXJzaW9uID0gYnBtVmVycztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5odHRwLmdldCgnL3ZlcnNpb25zLmpzb24/JyArIG5ldyBEYXRlKCkpLnN1YnNjcmliZSgocmVzcG9uc2U6IGFueSkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBhbGZyZXNjb1BhY2thZ2VzID0gT2JqZWN0LmtleXMocmVzcG9uc2UuZGVwZW5kZW5jaWVzKS5maWx0ZXIoKHZhbCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHRoaXMucmVnZXhwKS50ZXN0KHZhbCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24gPSBbXTtcbiAgICAgICAgICAgIGFsZnJlc2NvUGFja2FnZXMuZm9yRWFjaCgodmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogKHJlc3BvbnNlLmRlcGVuZGVuY2llc1t2YWxdLnZlcnNpb24gfHwgcmVzcG9uc2UuZGVwZW5kZW5jaWVzW3ZhbF0ucmVxdWlyZWQudmVyc2lvbilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmdpdEh1YkxpbmtDcmVhdGlvbihhbGZyZXNjb1BhY2thZ2VzVGFibGVSZXByZXNlbnRhdGlvbik7XG5cbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uLCBbXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ25hbWUnLCB0aXRsZTogJ05hbWUnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICd2ZXJzaW9uJywgdGl0bGU6ICdWZXJzaW9uJywgc29ydGFibGU6IHRydWUgfVxuICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lY21Ib3N0ID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oQXBwQ29uZmlnVmFsdWVzLkVDTUhPU1QpO1xuICAgICAgICB0aGlzLmJwbUhvc3QgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPihBcHBDb25maWdWYWx1ZXMuQlBNSE9TVCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnaXRIdWJMaW5rQ3JlYXRpb24oYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29yZVBhY2thZ2UgPSBhbGZyZXNjb1BhY2thZ2VzVGFibGVSZXByZXNlbnRhdGlvbi5maW5kKChwYWNrYWdlVXApID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwYWNrYWdlVXAubmFtZSA9PT0gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjb3JlUGFja2FnZSkge1xuICAgICAgICAgICAgY29uc3QgY29tbWl0SXNoID0gY29yZVBhY2thZ2UudmVyc2lvbi5zcGxpdCgnLScpO1xuICAgICAgICAgICAgaWYgKGNvbW1pdElzaC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5naXRodWJVcmxDb21taXRBbHBoYSA9IHRoaXMuZ2l0aHViVXJsQ29tbWl0QWxwaGEgKyBjb21taXRJc2hbMV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2l0aHViVXJsQ29tbWl0QWxwaGEgPSB0aGlzLmdpdGh1YlVybENvbW1pdEFscGhhICsgY29yZVBhY2thZ2UudmVyc2lvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==