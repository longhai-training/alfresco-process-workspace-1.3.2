/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ObjectUtils } from '@alfresco/adf-core';
var ShareDataRow = /** @class */ (function () {
    function ShareDataRow(obj, contentService, permissionsStyle, thumbnailService) {
        this.obj = obj;
        this.contentService = contentService;
        this.permissionsStyle = permissionsStyle;
        this.thumbnailService = thumbnailService;
        this.cache = {};
        this.isSelected = false;
        this.cssClass = '';
        if (!obj) {
            throw new Error(ShareDataRow.ERR_OBJECT_NOT_FOUND);
        }
        this.isDropTarget = this.isFolderAndHasPermissionToUpload(obj);
        if (permissionsStyle) {
            this.cssClass = this.getPermissionClass(obj);
        }
    }
    Object.defineProperty(ShareDataRow.prototype, "node", {
        get: /**
         * @return {?}
         */
        function () {
            return this.obj;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.obj = value;
            this.cache = {};
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} nodeEntity
     * @return {?}
     */
    ShareDataRow.prototype.getPermissionClass = /**
     * @param {?} nodeEntity
     * @return {?}
     */
    function (nodeEntity) {
        var _this = this;
        /** @type {?} */
        var permissionsClasses = '';
        this.permissionsStyle.forEach((/**
         * @param {?} currentPermissionsStyle
         * @return {?}
         */
        function (currentPermissionsStyle) {
            if (_this.applyPermissionStyleToFolder(nodeEntity.entry, currentPermissionsStyle) || _this.applyPermissionStyleToFile(nodeEntity.entry, currentPermissionsStyle)) {
                if (_this.contentService.hasAllowableOperations(nodeEntity.entry, currentPermissionsStyle.permission)) {
                    permissionsClasses += " " + currentPermissionsStyle.css;
                }
            }
        }));
        return permissionsClasses;
    };
    /**
     * @private
     * @param {?} node
     * @param {?} currentPermissionsStyle
     * @return {?}
     */
    ShareDataRow.prototype.applyPermissionStyleToFile = /**
     * @private
     * @param {?} node
     * @param {?} currentPermissionsStyle
     * @return {?}
     */
    function (node, currentPermissionsStyle) {
        return (currentPermissionsStyle.isFile && node.isFile);
    };
    /**
     * @private
     * @param {?} node
     * @param {?} currentPermissionsStyle
     * @return {?}
     */
    ShareDataRow.prototype.applyPermissionStyleToFolder = /**
     * @private
     * @param {?} node
     * @param {?} currentPermissionsStyle
     * @return {?}
     */
    function (node, currentPermissionsStyle) {
        return (currentPermissionsStyle.isFolder && node.isFolder);
    };
    /**
     * @param {?} nodeEntry
     * @return {?}
     */
    ShareDataRow.prototype.isFolderAndHasPermissionToUpload = /**
     * @param {?} nodeEntry
     * @return {?}
     */
    function (nodeEntry) {
        return this.isFolder(nodeEntry) && this.contentService.hasAllowableOperations(nodeEntry.entry, 'create');
    };
    /**
     * @param {?} nodeEntry
     * @return {?}
     */
    ShareDataRow.prototype.isFolder = /**
     * @param {?} nodeEntry
     * @return {?}
     */
    function (nodeEntry) {
        return nodeEntry.entry && nodeEntry.entry.isFolder;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    ShareDataRow.prototype.cacheValue = /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        this.cache[key] = value;
        return value;
    };
    /**
     * @param {?} key
     * @return {?}
     */
    ShareDataRow.prototype.getValue = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (this.cache[key] !== undefined) {
            return this.cache[key];
        }
        return ObjectUtils.getValue(this.obj.entry, key);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ShareDataRow.prototype.imageErrorResolver = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.obj.entry.content) {
            return this.thumbnailService.getMimeTypeIcon(this.obj.entry.content.mimeType);
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    ShareDataRow.prototype.hasValue = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return this.getValue(key) !== undefined;
    };
    ShareDataRow.ERR_OBJECT_NOT_FOUND = 'Object source not found';
    return ShareDataRow;
}());
export { ShareDataRow };
if (false) {
    /** @type {?} */
    ShareDataRow.ERR_OBJECT_NOT_FOUND;
    /** @type {?} */
    ShareDataRow.prototype.cache;
    /** @type {?} */
    ShareDataRow.prototype.isSelected;
    /** @type {?} */
    ShareDataRow.prototype.isDropTarget;
    /** @type {?} */
    ShareDataRow.prototype.cssClass;
    /**
     * @type {?}
     * @private
     */
    ShareDataRow.prototype.obj;
    /**
     * @type {?}
     * @private
     */
    ShareDataRow.prototype.contentService;
    /**
     * @type {?}
     * @private
     */
    ShareDataRow.prototype.permissionsStyle;
    /**
     * @type {?}
     * @private
     */
    ShareDataRow.prototype.thumbnailService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtZGF0YS1yb3cubW9kZWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJkb2N1bWVudC1saXN0L2RhdGEvc2hhcmUtZGF0YS1yb3cubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkEsT0FBTyxFQUFXLFdBQVcsRUFBb0MsTUFBTSxvQkFBb0IsQ0FBQztBQUk1RjtJQWtCSSxzQkFBb0IsR0FBYyxFQUNkLGNBQThCLEVBQzlCLGdCQUF3QyxFQUN4QyxnQkFBbUM7UUFIbkMsUUFBRyxHQUFILEdBQUcsQ0FBVztRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXdCO1FBQ3hDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBbUI7UUFqQnZELFVBQUssR0FBMkIsRUFBRSxDQUFDO1FBQ25DLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFFNUIsYUFBUSxHQUFXLEVBQUUsQ0FBQztRQWVsQixJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ04sTUFBTSxJQUFJLEtBQUssQ0FBQyxZQUFZLENBQUMsb0JBQW9CLENBQUMsQ0FBQztTQUN0RDtRQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRS9ELElBQUksZ0JBQWdCLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDaEQ7SUFDTCxDQUFDO0lBdEJELHNCQUFJLDhCQUFJOzs7O1FBQVI7WUFDSSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDcEIsQ0FBQzs7Ozs7UUFFRCxVQUFTLEtBQWdCO1lBQ3JCLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFB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Ozs7OztJQVdWLDJCQUFzQjs7Ozs7SUFDdEIsc0NBQXNDOzs7OztJQUN0Qyx3Q0FBZ0Q7Ozs7O0lBQ2hELHdDQUEyQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERhdGFSb3csIE9iamVjdFV0aWxzLCBUaHVtYm5haWxTZXJ2aWNlLCBDb250ZW50U2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBNaW5pbWFsTm9kZSwgTm9kZUVudHJ5IH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBQZXJtaXNzaW9uU3R5bGVNb2RlbCB9IGZyb20gJy4vLi4vbW9kZWxzL3Blcm1pc3Npb25zLXN0eWxlLm1vZGVsJztcblxuZXhwb3J0IGNsYXNzIFNoYXJlRGF0YVJvdyBpbXBsZW1lbnRzIERhdGFSb3cge1xuXG4gICAgc3RhdGljIEVSUl9PQkpFQ1RfTk9UX0ZPVU5EOiBzdHJpbmcgPSAnT2JqZWN0IHNvdXJjZSBub3QgZm91bmQnO1xuXG4gICAgY2FjaGU6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBpc1NlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgaXNEcm9wVGFyZ2V0OiBib29sZWFuO1xuICAgIGNzc0NsYXNzOiBzdHJpbmcgPSAnJztcblxuICAgIGdldCBub2RlKCk6IE5vZGVFbnRyeSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9iajtcbiAgICB9XG5cbiAgICBzZXQgbm9kZSh2YWx1ZTogTm9kZUVudHJ5KSB7XG4gICAgICAgIHRoaXMub2JqID0gdmFsdWU7XG4gICAgICAgIHRoaXMuY2FjaGUgPSB7fTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG9iajogTm9kZUVudHJ5LFxuICAgICAgICAgICAgICAgIHByaXZhdGUgY29udGVudFNlcnZpY2U6IENvbnRlbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcGVybWlzc2lvbnNTdHlsZTogUGVybWlzc2lvblN0eWxlTW9kZWxbXSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRodW1ibmFpbFNlcnZpY2U/OiBUaHVtYm5haWxTZXJ2aWNlKSB7XG4gICAgICAgIGlmICghb2JqKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoU2hhcmVEYXRhUm93LkVSUl9PQkpFQ1RfTk9UX0ZPVU5EKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaXNEcm9wVGFyZ2V0ID0gdGhpcy5pc0ZvbGRlckFuZEhhc1Blcm1pc3Npb25Ub1VwbG9hZChvYmopO1xuXG4gICAgICAgIGlmIChwZXJtaXNzaW9uc1N0eWxlKSB7XG4gICAgICAgICAgICB0aGlzLmNzc0NsYXNzID0gdGhpcy5nZXRQZXJtaXNzaW9uQ2xhc3Mob2JqKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFBlcm1pc3Npb25DbGFzcyhub2RlRW50aXR5OiBOb2RlRW50cnkpOiBzdHJpbmcge1xuICAgICAgICBsZXQgcGVybWlzc2lvbnNDbGFzc2VzID0gJyc7XG5cbiAgICAgICAgdGhpcy5wZXJtaXNzaW9uc1N0eWxlLmZvckVhY2goKGN1cnJlbnRQZXJtaXNzaW9uc1N0eWxlOiBQZXJtaXNzaW9uU3R5bGVNb2RlbCkgPT4ge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hcHBseVBlcm1pc3Npb25TdHlsZVRvRm9sZGVyKG5vZGVFbnRpdHkuZW50cnksIGN1cnJlbnRQZXJtaXNzaW9uc1N0eWxlKSB8fCB0aGlzLmFwcGx5UGVybWlzc2lvblN0eWxlVG9GaWxlKG5vZGVFbnRpdHkuZW50cnksIGN1cnJlbnRQZXJtaXNzaW9uc1N0eWxlKSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudFNlcnZpY2UuaGFzQWxsb3dhYmxlT3BlcmF0aW9ucyhub2RlRW50aXR5LmVudHJ5LCBjdXJyZW50UGVybWlzc2lvbnNTdHlsZS5wZXJtaXNzaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uc0NsYXNzZXMgKz0gYCAke2N1cnJlbnRQZXJtaXNzaW9uc1N0eWxlLmNzc31gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcGVybWlzc2lvbnNDbGFzc2VzO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXBwbHlQZXJtaXNzaW9uU3R5bGVUb0ZpbGUobm9kZTogTWluaW1hbE5vZGUsIGN1cnJlbnRQZXJtaXNzaW9uc1N0eWxlOiBQZXJtaXNzaW9uU3R5bGVNb2RlbCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKGN1cnJlbnRQZXJtaXNzaW9uc1N0eWxlLmlzRmlsZSAmJiBub2RlLmlzRmlsZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhcHBseVBlcm1pc3Npb25TdHlsZVRvRm9sZGVyKG5vZGU6IE1pbmltYWxOb2RlLCBjdXJyZW50UGVybWlzc2lvbnNTdHlsZTogUGVybWlzc2lvblN0eWxlTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChjdXJyZW50UGVybWlzc2lvbnNTdHlsZS5pc0ZvbGRlciAmJiBub2RlLmlzRm9sZGVyKTtcbiAgICB9XG5cbiAgICBpc0ZvbGRlckFuZEhhc1Blcm1pc3Npb25Ub1VwbG9hZChub2RlRW50cnk6IE5vZGVFbnRyeSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0ZvbGRlcihub2RlRW50cnkpICYmIHRoaXMuY29udGVudFNlcnZpY2UuaGFzQWxsb3dhYmxlT3BlcmF0aW9ucyhub2RlRW50cnkuZW50cnksICdjcmVhdGUnKTtcbiAgICB9XG5cbiAgICBpc0ZvbGRlcihub2RlRW50cnk6IE5vZGVFbnRyeSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gbm9kZUVudHJ5LmVudHJ5ICYmIG5vZGVFbnRyeS5lbnRyeS5pc0ZvbGRlcjtcbiAgICB9XG5cbiAgICBjYWNoZVZhbHVlKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogYW55IHtcbiAgICAgICAgdGhpcy5jYWNoZVtrZXldID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXRWYWx1ZShrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIGlmICh0aGlzLmNhY2hlW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVba2V5XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT2JqZWN0VXRpbHMuZ2V0VmFsdWUodGhpcy5vYmouZW50cnksIGtleSk7XG4gICAgfVxuXG4gICAgaW1hZ2VFcnJvclJlc29sdmVyKGV2ZW50OiBFdmVudCk6IGFueSB7XG4gICAgICAgIGlmICh0aGlzLm9iai5lbnRyeS5jb250ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxTZXJ2aWNlLmdldE1pbWVUeXBlSWNvbih0aGlzLm9iai5lbnRyeS5jb250ZW50Lm1pbWVUeXBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhc1ZhbHVlKGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKGtleSkgIT09IHVuZGVmaW5lZDtcbiAgICB9XG59XG4iXX0=