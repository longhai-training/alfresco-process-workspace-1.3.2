/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import { AlfrescoApiService, ContentService, NodeDownloadDirective } from '@alfresco/adf-core';
import { MatDialog } from '@angular/material';
import { DocumentListService } from './document-list.service';
import { ContentNodeDialogService } from '../../content-node-selector/content-node-dialog.service';
import * as i0 from "@angular/core";
import * as i1 from "../../content-node-selector/content-node-dialog.service";
import * as i2 from "@angular/material/dialog";
import * as i3 from "@alfresco/adf-core";
import * as i4 from "./document-list.service";
var NodeActionsService = /** @class */ (function () {
    function NodeActionsService(contentDialogService, dialogRef, content, documentListService, apiService, dialog) {
        this.contentDialogService = contentDialogService;
        this.dialogRef = dialogRef;
        this.content = content;
        this.documentListService = documentListService;
        this.apiService = apiService;
        this.dialog = dialog;
        this.error = new EventEmitter();
    }
    /**
     * @param {?} node
     * @return {?}
     */
    NodeActionsService.prototype.downloadNode = /**
     * @param {?} node
     * @return {?}
     */
    function (node) {
        new NodeDownloadDirective(this.apiService, this.dialog)
            .downloadNode(node);
    };
    /**
     * Copy content node
     *
     * @param contentEntry node to copy
     * @param permission permission which is needed to apply the action
     */
    /**
     * Copy content node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.copyContent = /**
     * Copy content node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('copy', 'content', contentEntry, permission);
    };
    /**
     * Copy folder node
     *
     * @param contentEntry node to copy
     * @param permission permission which is needed to apply the action
     */
    /**
     * Copy folder node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.copyFolder = /**
     * Copy folder node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('copy', 'folder', contentEntry, permission);
    };
    /**
     * Move content node
     *
     * @param contentEntry node to move
     * @param permission permission which is needed to apply the action
     */
    /**
     * Move content node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.moveContent = /**
     * Move content node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('move', 'content', contentEntry, permission);
    };
    /**
     * Move folder node
     *
     * @param contentEntry node to move
     * @param permission permission which is needed to apply the action
     */
    /**
     * Move folder node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.moveFolder = /**
     * Move folder node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('move', 'folder', contentEntry, permission);
    };
    /**
     * General method for performing the given operation (copy|move)
     *
     * @param action the action to perform (copy|move)
     * @param type type of the content (content|folder)
     * @param contentEntry the contentEntry which has to have the action performed on
     * @param permission permission which is needed to apply the action
     */
    /**
     * General method for performing the given operation (copy|move)
     *
     * @private
     * @param {?} action the action to perform (copy|move)
     * @param {?} type type of the content (content|folder)
     * @param {?} contentEntry the contentEntry which has to have the action performed on
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.doFileOperation = /**
     * General method for performing the given operation (copy|move)
     *
     * @private
     * @param {?} action the action to perform (copy|move)
     * @param {?} type type of the content (content|folder)
     * @param {?} contentEntry the contentEntry which has to have the action performed on
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (action, type, contentEntry, permission) {
        var _this = this;
        /** @type {?} */
        var observable = new Subject();
        this.contentDialogService
            .openCopyMoveDialog(action, contentEntry, permission)
            .subscribe((/**
         * @param {?} selections
         * @return {?}
         */
        function (selections) {
            /** @type {?} */
            var selection = selections[0];
            _this.documentListService[action + "Node"].call(_this.documentListService, contentEntry.id, selection.id)
                .subscribe(observable.next.bind(observable, "OPERATION.SUCCESS." + type.toUpperCase() + "." + action.toUpperCase()), observable.error.bind(observable));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            observable.error(error);
            return observable;
        }));
        return observable;
    };
    NodeActionsService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    NodeActionsService.ctorParameters = function () { return [
        { type: ContentNodeDialogService },
        { type: MatDialog },
        { type: ContentService },
        { type: DocumentListService },
        { type: AlfrescoApiService },
        { type: MatDialog }
    ]; };
    NodeActionsService.propDecorators = {
        error: [{ type: Output }]
    };
    /** @nocollapse */ NodeActionsService.ngInjectableDef = i0.defineInjectable({ factory: function NodeActionsService_Factory() { return new NodeActionsService(i0.inject(i1.ContentNodeDialogService), i0.inject(i2.MatDialog), i0.inject(i3.ContentService), i0.inject(i4.DocumentListService), i0.inject(i3.AlfrescoApiService), i0.inject(i2.MatDialog)); }, token: NodeActionsService, providedIn: "root" });
    return NodeActionsService;
}());
export { NodeActionsService };
if (false) {
    /** @type {?} */
    NodeActionsService.prototype.error;
    /**
     * @type {?}
     * @private
     */
    NodeActionsService.prototype.contentDialogService;
    /** @type {?} */
    NodeActionsService.prototype.dialogRef;
    /** @type {?} */
    NodeActionsService.prototype.content;
    /**
     * @type {?}
     * @private
     */
    NodeActionsService.prototype.documentListService;
    /**
     * @type {?}
     * @private
     */
    NodeActionsService.prototype.apiService;
    /**
     * @type {?}
     * @private
     */
    NodeActionsService.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS1hY3Rpb25zLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJkb2N1bWVudC1saXN0L3NlcnZpY2VzL25vZGUtYWN0aW9ucy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVqRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxjQUFjLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMvRixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0seURBQXlELENBQUM7Ozs7OztBQUVuRztJQVFJLDRCQUFvQixvQkFBOEMsRUFDL0MsU0FBb0IsRUFDcEIsT0FBdUIsRUFDdEIsbUJBQXlDLEVBQ3pDLFVBQStCLEVBQy9CLE1BQWtCO1FBTGxCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBMEI7UUFDL0MsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUN0Qix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXNCO1FBQ3pDLGVBQVUsR0FBVixVQUFVLENBQXFCO1FBQy9CLFdBQU0sR0FBTixNQUFNLENBQVk7UUFQdEMsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0lBT1YsQ0FBQzs7Ozs7SUFFMUMseUNBQVk7Ozs7SUFBWixVQUFhLElBQWU7UUFDeEIsSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUM7YUFDbEQsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRDs7Ozs7T0FLRzs7Ozs7Ozs7SUFDSSx3Q0FBVzs7Ozs7OztJQUFsQixVQUFtQixZQUFrQixFQUFFLFVBQW1CO1FBQ3RELE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQ7Ozs7O09BS0c7Ozs7Ozs7O0lBQ0ksdUNBQVU7Ozs7Ozs7SUFBakIsVUFBa0IsWUFBa0IsRUFBRSxVQUFtQjtRQUNyRCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVEOzs7OztPQUtHOzs7Ozs7OztJQUNJLHdDQUFXOzs7Ozs7O0lBQWxCLFVBQW1CLFlBQWtCLEVBQUUsVUFBbUI7UUFDdEQsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFRDs7Ozs7T0FLRzs7Ozs7Ozs7SUFDSSx1Q0FBVTs7Ozs7OztJQUFqQixVQUFrQixZQUFrQixFQUFFLFVBQW1CO1FBQ3JELE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRzs7Ozs7Ozs7Ozs7SUFDSyw0Q0FBZTs7Ozs7Ozs7OztJQUF2QixVQUF3QixNQUFjLEVBQUUsSUFBWSxFQUFFLFlBQWtCLEVBQUUsVUFBbUI7UUFBN0YsaUJBa0JDOztZQWpCUyxVQUFVLEdBQW9CLElBQUksT0FBTyxFQUFVO1FBRXpELElBQUksQ0FBQyxvQkFBb0I7YUFDcEIsa0JBQWtCLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRSxVQUFVLENBQUM7YUFDcEQsU0FBUzs7OztRQUFDLFVBQUMsVUFBa0I7O2dCQUNwQixTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUMvQixLQUFJLENBQUMsbUJBQW1CLENBQUksTUFBTSxTQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLG1CQUFtQixFQUFFLFlBQVksQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDLEVBQUUsQ0FBQztpQkFDbEcsU0FBUyxDQUNWLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSx1QkFBcUIsSUFBSSxDQUFDLFdBQVcsRUFBRSxTQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUksQ0FBQyxFQUNuRyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDaEMsQ0FBQztRQUNWLENBQUM7Ozs7UUFDRCxVQUFDLEtBQUs7WUFDRixVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hCLE9BQU8sVUFBVSxDQUFDO1FBQ3RCLENBQUMsRUFBQyxDQUFDO1FBQ1AsT0FBTyxVQUFVLENBQUM7SUFDdEIsQ0FBQzs7Z0JBdEZKLFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7Ozs7Z0JBSlEsd0JBQXdCO2dCQUh4QixTQUFTO2dCQURXLGNBQWM7Z0JBR2xDLG1CQUFtQjtnQkFIbkIsa0JBQWtCO2dCQUNsQixTQUFTOzs7d0JBVWIsTUFBTTs7OzZCQS9CWDtDQWlIQyxBQXZGRCxJQXVGQztTQXBGWSxrQkFBa0I7OztJQUUzQixtQ0FDbUQ7Ozs7O0lBRXZDLGtEQUFzRDs7SUFDdEQsdUNBQTJCOztJQUMzQixxQ0FBOEI7Ozs7O0lBQzlCLGlEQUFpRDs7Ozs7SUFDakQsd0NBQXVDOzs7OztJQUN2QyxvQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTm9kZSwgTm9kZUVudHJ5IH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UsIENvbnRlbnRTZXJ2aWNlLCBOb2RlRG93bmxvYWREaXJlY3RpdmUgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBEb2N1bWVudExpc3RTZXJ2aWNlIH0gZnJvbSAnLi9kb2N1bWVudC1saXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29udGVudE5vZGVEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29udGVudC1ub2RlLXNlbGVjdG9yL2NvbnRlbnQtbm9kZS1kaWFsb2cuc2VydmljZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgTm9kZUFjdGlvbnNTZXJ2aWNlIHtcblxuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb250ZW50RGlhbG9nU2VydmljZTogQ29udGVudE5vZGVEaWFsb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHB1YmxpYyBkaWFsb2dSZWY6IE1hdERpYWxvZyxcbiAgICAgICAgICAgICAgICBwdWJsaWMgY29udGVudDogQ29udGVudFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkb2N1bWVudExpc3RTZXJ2aWNlPzogRG9jdW1lbnRMaXN0U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwaVNlcnZpY2U/OiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkaWFsb2c/OiBNYXREaWFsb2cpIHt9XG5cbiAgICBkb3dubG9hZE5vZGUobm9kZTogTm9kZUVudHJ5KSB7XG4gICAgICAgIG5ldyBOb2RlRG93bmxvYWREaXJlY3RpdmUodGhpcy5hcGlTZXJ2aWNlLCB0aGlzLmRpYWxvZylcbiAgICAgICAgICAgIC5kb3dubG9hZE5vZGUobm9kZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29weSBjb250ZW50IG5vZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb250ZW50RW50cnkgbm9kZSB0byBjb3B5XG4gICAgICogQHBhcmFtIHBlcm1pc3Npb24gcGVybWlzc2lvbiB3aGljaCBpcyBuZWVkZWQgdG8gYXBwbHkgdGhlIGFjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBjb3B5Q29udGVudChjb250ZW50RW50cnk6IE5vZGUsIHBlcm1pc3Npb24/OiBzdHJpbmcpOiBTdWJqZWN0PHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kb0ZpbGVPcGVyYXRpb24oJ2NvcHknLCAnY29udGVudCcsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29weSBmb2xkZXIgbm9kZVxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbnRlbnRFbnRyeSBub2RlIHRvIGNvcHlcbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHVibGljIGNvcHlGb2xkZXIoY29udGVudEVudHJ5OiBOb2RlLCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9GaWxlT3BlcmF0aW9uKCdjb3B5JywgJ2ZvbGRlcicsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSBjb250ZW50IG5vZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb250ZW50RW50cnkgbm9kZSB0byBtb3ZlXG4gICAgICogQHBhcmFtIHBlcm1pc3Npb24gcGVybWlzc2lvbiB3aGljaCBpcyBuZWVkZWQgdG8gYXBwbHkgdGhlIGFjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBtb3ZlQ29udGVudChjb250ZW50RW50cnk6IE5vZGUsIHBlcm1pc3Npb24/OiBzdHJpbmcpOiBTdWJqZWN0PHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kb0ZpbGVPcGVyYXRpb24oJ21vdmUnLCAnY29udGVudCcsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSBmb2xkZXIgbm9kZVxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbnRlbnRFbnRyeSBub2RlIHRvIG1vdmVcbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHVibGljIG1vdmVGb2xkZXIoY29udGVudEVudHJ5OiBOb2RlLCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9GaWxlT3BlcmF0aW9uKCdtb3ZlJywgJ2ZvbGRlcicsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhbCBtZXRob2QgZm9yIHBlcmZvcm1pbmcgdGhlIGdpdmVuIG9wZXJhdGlvbiAoY29weXxtb3ZlKVxuICAgICAqXG4gICAgICogQHBhcmFtIGFjdGlvbiB0aGUgYWN0aW9uIHRvIHBlcmZvcm0gKGNvcHl8bW92ZSlcbiAgICAgKiBAcGFyYW0gdHlwZSB0eXBlIG9mIHRoZSBjb250ZW50IChjb250ZW50fGZvbGRlcilcbiAgICAgKiBAcGFyYW0gY29udGVudEVudHJ5IHRoZSBjb250ZW50RW50cnkgd2hpY2ggaGFzIHRvIGhhdmUgdGhlIGFjdGlvbiBwZXJmb3JtZWQgb25cbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBkb0ZpbGVPcGVyYXRpb24oYWN0aW9uOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgY29udGVudEVudHJ5OiBOb2RlLCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgY29uc3Qgb2JzZXJ2YWJsZTogU3ViamVjdDxzdHJpbmc+ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuXG4gICAgICAgIHRoaXMuY29udGVudERpYWxvZ1NlcnZpY2VcbiAgICAgICAgICAgIC5vcGVuQ29weU1vdmVEaWFsb2coYWN0aW9uLCBjb250ZW50RW50cnksIHBlcm1pc3Npb24pXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChzZWxlY3Rpb25zOiBOb2RlW10pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBzZWxlY3Rpb25zWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZVtgJHthY3Rpb259Tm9kZWBdLmNhbGwodGhpcy5kb2N1bWVudExpc3RTZXJ2aWNlLCBjb250ZW50RW50cnkuaWQsIHNlbGVjdGlvbi5pZClcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2YWJsZS5uZXh0LmJpbmQob2JzZXJ2YWJsZSwgYE9QRVJBVElPTi5TVUNDRVNTLiR7dHlwZS50b1VwcGVyQ2FzZSgpfS4ke2FjdGlvbi50b1VwcGVyQ2FzZSgpfWApLFxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLmVycm9yLmJpbmQob2JzZXJ2YWJsZSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcbiAgICB9XG59XG4iXX0=