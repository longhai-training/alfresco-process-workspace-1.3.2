/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { AlfrescoApiService, AppConfigService } from '@alfresco/adf-core';
import { RequestSortDefinitionInner } from '@alfresco/js-api';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
var SearchQueryBuilderService = /** @class */ (function () {
    function SearchQueryBuilderService(appConfig, alfrescoApiService) {
        this.appConfig = appConfig;
        this.alfrescoApiService = alfrescoApiService;
        this._userQuery = '';
        this.updated = new Subject();
        this.executed = new Subject();
        this.error = new Subject();
        this.categories = [];
        this.queryFragments = {};
        this.filterQueries = [];
        this.paging = null;
        this.sorting = [];
        this.userFacetBuckets = {};
        this.config = {
            categories: []
        };
        // TODO: to be supported in future iterations
        this.ranges = {};
        this.resetToDefaults();
    }
    Object.defineProperty(SearchQueryBuilderService.prototype, "userQuery", {
        get: /**
         * @return {?}
         */
        function () {
            return this._userQuery;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            value = (value || '').trim();
            this._userQuery = value ? "(" + value + ")" : '';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Resets the query to the defaults specified in the app config.
     */
    /**
     * Resets the query to the defaults specified in the app config.
     * @return {?}
     */
    SearchQueryBuilderService.prototype.resetToDefaults = /**
     * Resets the query to the defaults specified in the app config.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var template = this.appConfig.get('search');
        if (template) {
            this.config = JSON.parse(JSON.stringify(template));
            this.categories = (this.config.categories || []).filter((/**
             * @param {?} category
             * @return {?}
             */
            function (category) { return category.enabled; }));
            this.filterQueries = this.config.filterQueries || [];
            this.userFacetBuckets = {};
            if (this.config.sorting) {
                this.sorting = this.config.sorting.defaults || [];
            }
        }
    };
    /**
     * Adds a facet bucket to a field.
     * @param field The target field
     * @param bucket Bucket to add
     */
    /**
     * Adds a facet bucket to a field.
     * @param {?} field The target field
     * @param {?} bucket Bucket to add
     * @return {?}
     */
    SearchQueryBuilderService.prototype.addUserFacetBucket = /**
     * Adds a facet bucket to a field.
     * @param {?} field The target field
     * @param {?} bucket Bucket to add
     * @return {?}
     */
    function (field, bucket) {
        if (field && field.field && bucket) {
            /** @type {?} */
            var buckets = this.userFacetBuckets[field.field] || [];
            /** @type {?} */
            var existing = buckets.find((/**
             * @param {?} facetBucket
             * @return {?}
             */
            function (facetBucket) { return facetBucket.label === bucket.label; }));
            if (!existing) {
                buckets.push(bucket);
            }
            this.userFacetBuckets[field.field] = buckets;
        }
    };
    /**
     * Gets the buckets currently added to a field
     * @param field The target fields
     * @returns Bucket array
     */
    /**
     * Gets the buckets currently added to a field
     * @param {?} field The target fields
     * @return {?} Bucket array
     */
    SearchQueryBuilderService.prototype.getUserFacetBuckets = /**
     * Gets the buckets currently added to a field
     * @param {?} field The target fields
     * @return {?} Bucket array
     */
    function (field) {
        return this.userFacetBuckets[field] || [];
    };
    /**
     * Removes an existing bucket from a field.
     * @param field The target field
     * @param bucket Bucket to remove
     */
    /**
     * Removes an existing bucket from a field.
     * @param {?} field The target field
     * @param {?} bucket Bucket to remove
     * @return {?}
     */
    SearchQueryBuilderService.prototype.removeUserFacetBucket = /**
     * Removes an existing bucket from a field.
     * @param {?} field The target field
     * @param {?} bucket Bucket to remove
     * @return {?}
     */
    function (field, bucket) {
        if (field && field.field && bucket) {
            /** @type {?} */
            var buckets = this.userFacetBuckets[field.field] || [];
            this.userFacetBuckets[field.field] = buckets
                .filter((/**
             * @param {?} facetBucket
             * @return {?}
             */
            function (facetBucket) { return facetBucket.label !== bucket.label; }));
        }
    };
    /**
     * Adds a filter query to the current query.
     * @param query Query string to add
     */
    /**
     * Adds a filter query to the current query.
     * @param {?} query Query string to add
     * @return {?}
     */
    SearchQueryBuilderService.prototype.addFilterQuery = /**
     * Adds a filter query to the current query.
     * @param {?} query Query string to add
     * @return {?}
     */
    function (query) {
        if (query) {
            /** @type {?} */
            var existing = this.filterQueries.find((/**
             * @param {?} filterQuery
             * @return {?}
             */
            function (filterQuery) { return filterQuery.query === query; }));
            if (!existing) {
                this.filterQueries.push({ query: query });
            }
        }
    };
    /**
     * Removes an existing filter query.
     * @param query The query to remove
     */
    /**
     * Removes an existing filter query.
     * @param {?} query The query to remove
     * @return {?}
     */
    SearchQueryBuilderService.prototype.removeFilterQuery = /**
     * Removes an existing filter query.
     * @param {?} query The query to remove
     * @return {?}
     */
    function (query) {
        if (query) {
            this.filterQueries = this.filterQueries
                .filter((/**
             * @param {?} filterQuery
             * @return {?}
             */
            function (filterQuery) { return filterQuery.query !== query; }));
        }
    };
    /**
     * Gets a facet query by label.
     * @param label Label of the query
     * @returns Facet query data
     */
    /**
     * Gets a facet query by label.
     * @param {?} label Label of the query
     * @return {?} Facet query data
     */
    SearchQueryBuilderService.prototype.getFacetQuery = /**
     * Gets a facet query by label.
     * @param {?} label Label of the query
     * @return {?} Facet query data
     */
    function (label) {
        if (label && this.hasFacetQueries) {
            /** @type {?} */
            var result = this.config.facetQueries.queries.find((/**
             * @param {?} query
             * @return {?}
             */
            function (query) { return query.label === label; }));
            if (result) {
                return tslib_1.__assign({}, result);
            }
        }
        return null;
    };
    /**
     * Gets a facet field by label.
     * @param label Label of the facet field
     * @returns Facet field data
     */
    /**
     * Gets a facet field by label.
     * @param {?} label Label of the facet field
     * @return {?} Facet field data
     */
    SearchQueryBuilderService.prototype.getFacetField = /**
     * Gets a facet field by label.
     * @param {?} label Label of the facet field
     * @return {?} Facet field data
     */
    function (label) {
        if (label) {
            /** @type {?} */
            var fields = this.config.facetFields.fields || [];
            /** @type {?} */
            var result = fields.find((/**
             * @param {?} field
             * @return {?}
             */
            function (field) { return field.label === label; }));
            if (result) {
                result.label = this.getSupportedLabel(result.label);
                return tslib_1.__assign({}, result);
            }
        }
        return null;
    };
    /**
     * Builds the current query and triggers the `updated` event.
     */
    /**
     * Builds the current query and triggers the `updated` event.
     * @return {?}
     */
    SearchQueryBuilderService.prototype.update = /**
     * Builds the current query and triggers the `updated` event.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var query = this.buildQuery();
        this.updated.next(query);
    };
    /**
     * Builds and executes the current query.
     * @returns Nothing
     */
    /**
     * Builds and executes the current query.
     * @return {?} Nothing
     */
    SearchQueryBuilderService.prototype.execute = /**
     * Builds and executes the current query.
     * @return {?} Nothing
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var query, resultSetPaging, error_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        query = this.buildQuery();
                        if (!query) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.alfrescoApiService.searchApi.search(query)];
                    case 1:
                        resultSetPaging = _a.sent();
                        this.executed.next(resultSetPaging);
                        _a.label = 2;
                    case 2: return [3 /*break*/, 4];
                    case 3:
                        error_1 = _a.sent();
                        this.error.next(error_1);
                        this.executed.next({
                            list: {
                                pagination: {
                                    totalItems: 0
                                },
                                entries: []
                            }
                        });
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Builds the current query.
     * @returns The finished query
     */
    /**
     * Builds the current query.
     * @return {?} The finished query
     */
    SearchQueryBuilderService.prototype.buildQuery = /**
     * Builds the current query.
     * @return {?} The finished query
     */
    function () {
        /** @type {?} */
        var query = this.getFinalQuery();
        /** @type {?} */
        var include = this.config.include || [];
        if (include.length === 0) {
            include.push('path', 'allowableOperations');
        }
        if (query) {
            /** @type {?} */
            var result = (/** @type {?} */ ({
                query: {
                    query: query,
                    language: 'afts'
                },
                include: include,
                paging: this.paging,
                fields: this.config.fields,
                filterQueries: this.filterQueries,
                facetQueries: this.facetQueries,
                facetIntervals: this.facetIntervals,
                facetFields: this.facetFields,
                sort: this.sort,
                highlight: this.highlight
            }));
            result['facetFormat'] = 'V2';
            return result;
        }
        return null;
    };
    /**
     * Gets the primary sorting definition.
     * @returns The primary sorting definition
     */
    /**
     * Gets the primary sorting definition.
     * @return {?} The primary sorting definition
     */
    SearchQueryBuilderService.prototype.getPrimarySorting = /**
     * Gets the primary sorting definition.
     * @return {?} The primary sorting definition
     */
    function () {
        if (this.sorting && this.sorting.length > 0) {
            return this.sorting[0];
        }
        return null;
    };
    /**
     * Gets all pre-configured sorting options that users can choose from.
     * @returns Pre-configured sorting options
     */
    /**
     * Gets all pre-configured sorting options that users can choose from.
     * @return {?} Pre-configured sorting options
     */
    SearchQueryBuilderService.prototype.getSortingOptions = /**
     * Gets all pre-configured sorting options that users can choose from.
     * @return {?} Pre-configured sorting options
     */
    function () {
        if (this.config && this.config.sorting) {
            return this.config.sorting.options || [];
        }
        return [];
    };
    /**
     * Gets the query group.
     * @param query Target query
     * @returns Query group
     */
    /**
     * Gets the query group.
     * @param {?} query Target query
     * @return {?} Query group
     */
    SearchQueryBuilderService.prototype.getQueryGroup = /**
     * Gets the query group.
     * @param {?} query Target query
     * @return {?} Query group
     */
    function (query) {
        return query.group || this.config.facetQueries.label || 'Facet Queries';
    };
    Object.defineProperty(SearchQueryBuilderService.prototype, "hasFacetQueries", {
        /**
         * Checks if FacetQueries has been defined
         * @returns True if defined, false otherwise
         */
        get: /**
         * Checks if FacetQueries has been defined
         * @return {?} True if defined, false otherwise
         */
        function () {
            if (this.config
                && this.config.facetQueries
                && this.config.facetQueries.queries
                && this.config.facetQueries.queries.length > 0) {
                return true;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "hasFacetIntervals", {
        /**
         * Checks if FacetIntervals has been defined
         * @returns True if defined, false otherwise
         */
        get: /**
         * Checks if FacetIntervals has been defined
         * @return {?} True if defined, false otherwise
         */
        function () {
            if (this.config
                && this.config.facetIntervals
                && this.config.facetIntervals.intervals
                && this.config.facetIntervals.intervals.length > 0) {
                return true;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "hasFacetHighlight", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config && this.config.highlight ? true : false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "sort", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            return this.sorting.map((/**
             * @param {?} def
             * @return {?}
             */
            function (def) {
                return new RequestSortDefinitionInner({
                    type: def.type,
                    field: def.field,
                    ascending: def.ascending
                });
            }));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "facetQueries", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            var _this = this;
            if (this.hasFacetQueries) {
                return this.config.facetQueries.queries.map((/**
                 * @param {?} query
                 * @return {?}
                 */
                function (query) {
                    query.group = _this.getQueryGroup(query);
                    return (/** @type {?} */ (tslib_1.__assign({}, query)));
                }));
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "facetIntervals", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            var _this = this;
            if (this.hasFacetIntervals) {
                /** @type {?} */
                var configIntervals = this.config.facetIntervals;
                return {
                    intervals: configIntervals.intervals.map((/**
                     * @param {?} interval
                     * @return {?}
                     */
                    function (interval) { return (/** @type {?} */ ({
                        label: _this.getSupportedLabel(interval.label),
                        field: interval.field,
                        sets: interval.sets.map((/**
                         * @param {?} set
                         * @return {?}
                         */
                        function (set) { return (/** @type {?} */ ({
                            label: _this.getSupportedLabel(set.label),
                            start: set.start,
                            end: set.end,
                            startInclusive: set.startInclusive,
                            endInclusive: set.endInclusive
                        })); }))
                    })); }))
                };
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchQueryBuilderService.prototype, "highlight", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            return this.hasFacetHighlight ? this.config.highlight : null;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @protected
     * @return {?}
     */
    SearchQueryBuilderService.prototype.getFinalQuery = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var query = '';
        this.categories.forEach((/**
         * @param {?} facet
         * @return {?}
         */
        function (facet) {
            /** @type {?} */
            var customQuery = _this.queryFragments[facet.id];
            if (customQuery) {
                if (query.length > 0) {
                    query += ' AND ';
                }
                query += "(" + customQuery + ")";
            }
        }));
        /** @type {?} */
        var result = [this.userQuery, query]
            .filter((/**
         * @param {?} entry
         * @return {?}
         */
        function (entry) { return entry; }))
            .join(' AND ');
        if (this.userFacetBuckets) {
            Object.keys(this.userFacetBuckets).forEach((/**
             * @param {?} key
             * @return {?}
             */
            function (key) {
                /** @type {?} */
                var subQuery = (_this.userFacetBuckets[key] || [])
                    .filter((/**
                 * @param {?} bucket
                 * @return {?}
                 */
                function (bucket) { return bucket.filterQuery; }))
                    .map((/**
                 * @param {?} bucket
                 * @return {?}
                 */
                function (bucket) { return bucket.filterQuery; }))
                    .join(' OR ');
                if (subQuery) {
                    if (result.length > 0) {
                        result += ' AND ';
                    }
                    result += "(" + subQuery + ")";
                }
            }));
        }
        return result;
    };
    Object.defineProperty(SearchQueryBuilderService.prototype, "facetFields", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            var _this = this;
            /** @type {?} */
            var facetFields = this.config.facetFields && this.config.facetFields.fields;
            if (facetFields && facetFields.length > 0) {
                return {
                    facets: facetFields.map((/**
                     * @param {?} facet
                     * @return {?}
                     */
                    function (facet) { return (/** @type {?} */ ({
                        field: facet.field,
                        mincount: facet.mincount,
                        label: _this.getSupportedLabel(facet.label),
                        limit: facet.limit,
                        offset: facet.offset,
                        prefix: facet.prefix
                    })); }))
                };
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Encloses a label name with double quotes if it contains whitespace characters.
     * @param configLabel Original label text
     * @returns Label, possibly with quotes if it contains spaces
     */
    /**
     * Encloses a label name with double quotes if it contains whitespace characters.
     * @param {?} configLabel Original label text
     * @return {?} Label, possibly with quotes if it contains spaces
     */
    SearchQueryBuilderService.prototype.getSupportedLabel = /**
     * Encloses a label name with double quotes if it contains whitespace characters.
     * @param {?} configLabel Original label text
     * @return {?} Label, possibly with quotes if it contains spaces
     */
    function (configLabel) {
        /** @type {?} */
        var spaceInsideLabelIndex = configLabel.search(/\s/g);
        if (spaceInsideLabelIndex > -1) {
            return "\"" + configLabel + "\"";
        }
        return configLabel;
    };
    SearchQueryBuilderService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    SearchQueryBuilderService.ctorParameters = function () { return [
        { type: AppConfigService },
        { type: AlfrescoApiService }
    ]; };
    /** @nocollapse */ SearchQueryBuilderService.ngInjectableDef = i0.defineInjectable({ factory: function SearchQueryBuilderService_Factory() { return new SearchQueryBuilderService(i0.inject(i1.AppConfigService), i0.inject(i1.AlfrescoApiService)); }, token: SearchQueryBuilderService, providedIn: "root" });
    return SearchQueryBuilderService;
}());
export { SearchQueryBuilderService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SearchQueryBuilderService.prototype._userQuery;
    /** @type {?} */
    SearchQueryBuilderService.prototype.updated;
    /** @type {?} */
    SearchQueryBuilderService.prototype.executed;
    /** @type {?} */
    SearchQueryBuilderService.prototype.error;
    /** @type {?} */
    SearchQueryBuilderService.prototype.categories;
    /** @type {?} */
    SearchQueryBuilderService.prototype.queryFragments;
    /** @type {?} */
    SearchQueryBuilderService.prototype.filterQueries;
    /** @type {?} */
    SearchQueryBuilderService.prototype.paging;
    /** @type {?} */
    SearchQueryBuilderService.prototype.sorting;
    /**
     * @type {?}
     * @protected
     */
    SearchQueryBuilderService.prototype.userFacetBuckets;
    /** @type {?} */
    SearchQueryBuilderService.prototype.config;
    /** @type {?} */
    SearchQueryBuilderService.prototype.ranges;
    /**
     * @type {?}
     * @private
     */
    SearchQueryBuilderService.prototype.appConfig;
    /**
     * @type {?}
     * @private
     */
    SearchQueryBuilderService.prototype.alfrescoApiService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXF1ZXJ5LWJ1aWxkZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbInNlYXJjaC9zZWFyY2gtcXVlcnktYnVpbGRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDMUUsT0FBTyxFQUlILDBCQUEwQixFQUc3QixNQUFNLGtCQUFrQixDQUFDOzs7QUFVMUI7SUFtQ0ksbUNBQW9CLFNBQTJCLEVBQVUsa0JBQXNDO1FBQTNFLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQTlCdkYsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUV4QixZQUFPLEdBQUcsSUFBSSxPQUFPLEVBQWEsQ0FBQztRQUNuQyxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQW1CLENBQUM7UUFDMUMsVUFBSyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFFdEIsZUFBVSxHQUEwQixFQUFFLENBQUM7UUFDdkMsbUJBQWMsR0FBNkIsRUFBRSxDQUFDO1FBQzlDLGtCQUFhLEdBQWtCLEVBQUUsQ0FBQztRQUNsQyxXQUFNLEdBQThDLElBQUksQ0FBQztRQUN6RCxZQUFPLEdBQW1DLEVBQUUsQ0FBQztRQUVuQyxxQkFBZ0IsR0FBK0MsRUFBRSxDQUFDO1FBVzVFLFdBQU0sR0FBd0I7WUFDMUIsVUFBVSxFQUFFLEVBQUU7U0FDakIsQ0FBQzs7UUFHRixXQUFNLEdBQWtDLEVBQUUsQ0FBQztRQUd2QyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQWxCRCxzQkFBSSxnREFBUzs7OztRQUFiO1lBQ0ksT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQzNCLENBQUM7Ozs7O1FBRUQsVUFBYyxLQUFhO1lBQ3ZCLEtBQUssR0FBRyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBSSxLQUFLLE1BQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hELENBQUM7OztPQUxBO0lBa0JEOztPQUVHOzs7OztJQUNILG1EQUFlOzs7O0lBQWY7O1lBQ1UsUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFzQixRQUFRLENBQUM7UUFDbEUsSUFBSSxRQUFRLEVBQUU7WUFDVixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ25ELElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQyxRQUFRLElBQUssT0FBQSxRQUFRLENBQUMsT0FBTyxFQUFoQixDQUFnQixFQUFDLENBQUM7WUFDeEYsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsSUFBSSxFQUFFLENBQUM7WUFDckQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztZQUMzQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO2dCQUNyQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUM7YUFDckQ7U0FDSjtJQUNMLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0gsc0RBQWtCOzs7Ozs7SUFBbEIsVUFBbUIsS0FBaUIsRUFBRSxNQUF3QjtRQUMxRCxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLE1BQU0sRUFBRTs7Z0JBQzFCLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7O2dCQUNsRCxRQUFRLEdBQUcsT0FBTyxDQUFDLElBQUk7Ozs7WUFBQyxVQUFDLFdBQVcsSUFBSyxPQUFBLFdBQVcsQ0FBQyxLQUFLLEtBQUssTUFBTSxDQUFDLEtBQUssRUFBbEMsQ0FBa0MsRUFBQztZQUNsRixJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDeEI7WUFDRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQztTQUNoRDtJQUNMLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7SUFDSCx1REFBbUI7Ozs7O0lBQW5CLFVBQW9CLEtBQWE7UUFDN0IsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzlDLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0gseURBQXFCOzs7Ozs7SUFBckIsVUFBc0IsS0FBaUIsRUFBRSxNQUF3QjtRQUM3RCxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLE1BQU0sRUFBRTs7Z0JBQzFCLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7WUFDeEQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPO2lCQUN2QyxNQUFNOzs7O1lBQUMsVUFBQyxXQUFXLElBQUssT0FBQSxXQUFXLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxLQUFLLEVBQWxDLENBQWtDLEVBQUMsQ0FBQztTQUNwRTtJQUNMLENBQUM7SUFFRDs7O09BR0c7Ozs7OztJQUNILGtEQUFjOzs7OztJQUFkLFVBQWUsS0FBYTtRQUN4QixJQUFJLEtBQUssRUFBRTs7Z0JBQ0QsUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSTs7OztZQUFDLFVBQUMsV0FBVyxJQUFLLE9BQUEsV0FBVyxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQTNCLENBQTJCLEVBQUM7WUFDdEYsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDWCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2FBQzdDO1NBQ0o7SUFDTCxDQUFDO0lBRUQ7OztPQUdHOzs7Ozs7SUFDSCxxREFBaUI7Ozs7O0lBQWpCLFVBQWtCLEtBQWE7UUFDM0IsSUFBSSxLQUFLLEVBQUU7WUFDUCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhO2lCQUNsQyxNQUFNOzs7O1lBQUMsVUFBQyxXQUFXLElBQUssT0FBQSxXQUFXLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBM0IsQ0FBMkIsRUFBQyxDQUFDO1NBQzdEO0lBQ0wsQ0FBQztJQUVEOzs7O09BSUc7Ozs7OztJQUNILGlEQUFhOzs7OztJQUFiLFVBQWMsS0FBYTtRQUN2QixJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFOztnQkFDekIsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxLQUFLLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBckIsQ0FBcUIsRUFBQztZQUN0RixJQUFJLE1BQU0sRUFBRTtnQkFDUiw0QkFBWSxNQUFNLEVBQUc7YUFDeEI7U0FDSjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7SUFDSCxpREFBYTs7Ozs7SUFBYixVQUFjLEtBQWE7UUFDdkIsSUFBSSxLQUFLLEVBQUU7O2dCQUNELE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUksRUFBRTs7Z0JBQzdDLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSTs7OztZQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQXJCLENBQXFCLEVBQUM7WUFDNUQsSUFBSSxNQUFNLEVBQUU7Z0JBQ1IsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNwRCw0QkFBWSxNQUFNLEVBQUc7YUFDeEI7U0FDSjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSCwwQ0FBTTs7OztJQUFOOztZQUNVLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQy9CLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRDs7O09BR0c7Ozs7O0lBQ0csMkNBQU87Ozs7SUFBYjs7Ozs7Ozt3QkFFYyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTs2QkFDM0IsS0FBSyxFQUFMLHdCQUFLO3dCQUNvQyxxQkFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBQTs7d0JBQXhGLGVBQWUsR0FBb0IsU0FBcUQ7d0JBQzlGLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDOzs7Ozt3QkFHeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBSyxDQUFDLENBQUM7d0JBRXZCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDOzRCQUNmLElBQUksRUFBRTtnQ0FDRixVQUFVLEVBQUU7b0NBQ1IsVUFBVSxFQUFFLENBQUM7aUNBQ2hCO2dDQUNELE9BQU8sRUFBRSxFQUFFOzZCQUNkO3lCQUNKLENBQUMsQ0FBQzs7Ozs7O0tBRVY7SUFFRDs7O09BR0c7Ozs7O0lBQ0gsOENBQVU7Ozs7SUFBVjs7WUFDVSxLQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRTs7WUFFNUIsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLEVBQUU7UUFDekMsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1NBQy9DO1FBRUQsSUFBSSxLQUFLLEVBQUU7O2dCQUNELE1BQU0sR0FBYyxtQkFBWTtnQkFDbEMsS0FBSyxFQUFFO29CQUNILEtBQUssRUFBRSxLQUFLO29CQUNaLFFBQVEsRUFBRSxNQUFNO2lCQUNuQjtnQkFDRCxPQUFPLEVBQUUsT0FBTztnQkFDaEIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2dCQUMxQixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7Z0JBQ2pDLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWTtnQkFDL0IsY0FBYyxFQUFFLElBQUksQ0FBQyxjQUFjO2dCQUNuQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7Z0JBQzdCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtnQkFDZixTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVM7YUFDNUIsRUFBQTtZQUVELE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDN0IsT0FBTyxNQUFNLENBQUM7U0FDakI7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQ7OztPQUdHOzs7OztJQUNILHFEQUFpQjs7OztJQUFqQjtRQUNJLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDekMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzFCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7SUFDSCxxREFBaUI7Ozs7SUFBakI7UUFDSSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDO1NBQzVDO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7T0FJRzs7Ozs7O0lBQ0gsaURBQWE7Ozs7O0lBQWIsVUFBYyxLQUFLO1FBQ2YsT0FBTyxLQUFLLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxlQUFlLENBQUM7SUFDNUUsQ0FBQztJQU1ELHNCQUFJLHNEQUFlO1FBSm5COzs7V0FHRzs7Ozs7UUFDSDtZQUNJLElBQUksSUFBSSxDQUFDLE1BQU07bUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZO21CQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPO21CQUNoQyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDaEQsT0FBTyxJQUFJLENBQUM7YUFDZjtZQUNELE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7OztPQUFBO0lBTUQsc0JBQUksd0RBQWlCO1FBSnJCOzs7V0FHRzs7Ozs7UUFDSDtZQUNJLElBQUksSUFBSSxDQUFDLE1BQU07bUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjO21CQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTO21CQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDcEQsT0FBTyxJQUFJLENBQUM7YUFDZjtZQUNELE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksd0RBQWlCOzs7O1FBQXJCO1lBQ0ksT0FBTyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUMvRCxDQUFDOzs7T0FBQTtJQUVELHNCQUFjLDJDQUFJOzs7OztRQUFsQjtZQUNJLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHOzs7O1lBQUMsVUFBQyxHQUFHO2dCQUN4QixPQUFPLElBQUksMEJBQTBCLENBQUM7b0JBQ2xDLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSTtvQkFDZCxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUs7b0JBQ2hCLFNBQVMsRUFBRSxHQUFHLENBQUMsU0FBUztpQkFDM0IsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxFQUFDLENBQUM7UUFDUCxDQUFDOzs7T0FBQTtJQUVELHNCQUFjLG1EQUFZOzs7OztRQUExQjtZQUFBLGlCQVNDO1lBUkcsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO2dCQUN0QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHOzs7O2dCQUFDLFVBQUMsS0FBSztvQkFDOUMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUN4QyxPQUFPLHdDQUFrQixLQUFLLEdBQUUsQ0FBQztnQkFDckMsQ0FBQyxFQUFDLENBQUM7YUFDTjtZQUVELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7OztPQUFBO0lBRUQsc0JBQWMscURBQWM7Ozs7O1FBQTVCO1lBQUEsaUJBb0JDO1lBbkJHLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFOztvQkFDbEIsZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYztnQkFFbEQsT0FBTztvQkFDSCxTQUFTLEVBQUUsZUFBZSxDQUFDLFNBQVMsQ0FBQyxHQUFHOzs7O29CQUFDLFVBQUMsUUFBUSxXQUFLLG1CQUFNO3dCQUN6RCxLQUFLLEVBQUUsS0FBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7d0JBQzdDLEtBQUssRUFBRSxRQUFRLENBQUMsS0FBSzt3QkFDckIsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRzs7Ozt3QkFBQyxVQUFDLEdBQUcsV0FBSyxtQkFBTTs0QkFDbkMsS0FBSyxFQUFFLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDOzRCQUN4QyxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUs7NEJBQ2hCLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRzs0QkFDWixjQUFjLEVBQUUsR0FBRyxDQUFDLGNBQWM7NEJBQ2xDLFlBQVksRUFBRSxHQUFHLENBQUMsWUFBWTt5QkFDakMsRUFBQSxHQUFBLEVBQUM7cUJBQ0wsRUFBQSxHQUFBLEVBQUM7aUJBQ0wsQ0FBQzthQUNMO1lBRUQsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBYyxnREFBUzs7Ozs7UUFBdkI7WUFDSSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNqRSxDQUFDOzs7T0FBQTs7Ozs7SUFFUyxpREFBYTs7OztJQUF2QjtRQUFBLGlCQWlDQzs7WUFoQ08sS0FBSyxHQUFHLEVBQUU7UUFFZCxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFDLEtBQUs7O2dCQUNwQixXQUFXLEdBQUcsS0FBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ2pELElBQUksV0FBVyxFQUFFO2dCQUNiLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ2xCLEtBQUssSUFBSSxPQUFPLENBQUM7aUJBQ3BCO2dCQUNELEtBQUssSUFBSSxNQUFJLFdBQVcsTUFBRyxDQUFDO2FBQy9CO1FBQ0wsQ0FBQyxFQUFDLENBQUM7O1lBRUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUM7YUFDL0IsTUFBTTs7OztRQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxFQUFMLENBQUssRUFBQzthQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDO1FBRWxCLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3ZCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTzs7OztZQUFDLFVBQUMsR0FBRzs7b0JBQ3JDLFFBQVEsR0FBRyxDQUFDLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7cUJBQzlDLE1BQU07Ozs7Z0JBQUMsVUFBQyxNQUFNLElBQUssT0FBQSxNQUFNLENBQUMsV0FBVyxFQUFsQixDQUFrQixFQUFDO3FCQUN0QyxHQUFHOzs7O2dCQUFDLFVBQUMsTUFBTSxJQUFLLE9BQUEsTUFBTSxDQUFDLFdBQVcsRUFBbEIsQ0FBa0IsRUFBQztxQkFDbkMsSUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFDakIsSUFBSSxRQUFRLEVBQUU7b0JBQ1YsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTt3QkFDbkIsTUFBTSxJQUFJLE9BQU8sQ0FBQztxQkFDckI7b0JBQ0QsTUFBTSxJQUFJLE1BQUksUUFBUSxNQUFHLENBQUM7aUJBQzdCO1lBQ0wsQ0FBQyxFQUFDLENBQUM7U0FDTjtRQUVELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxzQkFBYyxrREFBVzs7Ozs7UUFBekI7WUFBQSxpQkFpQkM7O2dCQWhCUyxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTTtZQUU3RSxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDdkMsT0FBTztvQkFDSCxNQUFNLEVBQUUsV0FBVyxDQUFDLEdBQUc7Ozs7b0JBQUMsVUFBQyxLQUFLLFdBQUssbUJBQW9CO3dCQUNuRCxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7d0JBQ2xCLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTt3QkFDeEIsS0FBSyxFQUFFLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO3dCQUMxQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7d0JBQ2xCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTt3QkFDcEIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO3FCQUN2QixFQUFBLEdBQUEsRUFBQztpQkFDTCxDQUFDO2FBQ0w7WUFFRCxPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDOzs7T0FBQTtJQUVEOzs7O09BSUc7Ozs7OztJQUNILHFEQUFpQjs7Ozs7SUFBakIsVUFBa0IsV0FBbUI7O1lBQzNCLHFCQUFxQixHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ3ZELElBQUkscUJBQXFCLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDNUIsT0FBTyxPQUFJLFdBQVcsT0FBRyxDQUFDO1NBQzdCO1FBQ0QsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQzs7Z0JBellKLFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7Ozs7Z0JBcEI0QixnQkFBZ0I7Z0JBQXBDLGtCQUFrQjs7O29DQW5CM0I7Q0ErYUMsQUExWUQsSUEwWUM7U0F2WVkseUJBQXlCOzs7Ozs7SUFFbEMsK0NBQXdCOztJQUV4Qiw0Q0FBbUM7O0lBQ25DLDZDQUEwQzs7SUFDMUMsMENBQXNCOztJQUV0QiwrQ0FBdUM7O0lBQ3ZDLG1EQUE4Qzs7SUFDOUMsa0RBQWtDOztJQUNsQywyQ0FBeUQ7O0lBQ3pELDRDQUE2Qzs7Ozs7SUFFN0MscURBQTRFOztJQVc1RSwyQ0FFRTs7SUFHRiwyQ0FBMkM7Ozs7O0lBRS9CLDhDQUFtQzs7Ozs7SUFBRSx1REFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UsIEFwcENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHtcbiAgICBRdWVyeUJvZHksXG4gICAgUmVxdWVzdEZhY2V0RmllbGRzLFxuICAgIFJlcXVlc3RGYWNldEZpZWxkLFxuICAgIFJlcXVlc3RTb3J0RGVmaW5pdGlvbklubmVyLFxuICAgIFJlc3VsdFNldFBhZ2luZyxcbiAgICBSZXF1ZXN0SGlnaGxpZ2h0XG59IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgU2VhcmNoQ2F0ZWdvcnkgfSBmcm9tICcuL3NlYXJjaC1jYXRlZ29yeS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRmlsdGVyUXVlcnkgfSBmcm9tICcuL2ZpbHRlci1xdWVyeS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoUmFuZ2UgfSBmcm9tICcuL3NlYXJjaC1yYW5nZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoQ29uZmlndXJhdGlvbiB9IGZyb20gJy4vc2VhcmNoLWNvbmZpZ3VyYXRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0UXVlcnkgfSBmcm9tICcuL2ZhY2V0LXF1ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBTZWFyY2hTb3J0aW5nRGVmaW5pdGlvbiB9IGZyb20gJy4vc2VhcmNoLXNvcnRpbmctZGVmaW5pdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRmFjZXRGaWVsZCB9IGZyb20gJy4vZmFjZXQtZmllbGQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGRCdWNrZXQgfSBmcm9tICcuL2ZhY2V0LWZpZWxkLWJ1Y2tldC5pbnRlcmZhY2UnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSBfdXNlclF1ZXJ5ID0gJyc7XG5cbiAgICB1cGRhdGVkID0gbmV3IFN1YmplY3Q8UXVlcnlCb2R5PigpO1xuICAgIGV4ZWN1dGVkID0gbmV3IFN1YmplY3Q8UmVzdWx0U2V0UGFnaW5nPigpO1xuICAgIGVycm9yID0gbmV3IFN1YmplY3QoKTtcblxuICAgIGNhdGVnb3JpZXM6IEFycmF5PFNlYXJjaENhdGVnb3J5PiA9IFtdO1xuICAgIHF1ZXJ5RnJhZ21lbnRzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgICBmaWx0ZXJRdWVyaWVzOiBGaWx0ZXJRdWVyeVtdID0gW107XG4gICAgcGFnaW5nOiB7IG1heEl0ZW1zPzogbnVtYmVyOyBza2lwQ291bnQ/OiBudW1iZXIgfSA9IG51bGw7XG4gICAgc29ydGluZzogQXJyYXk8U2VhcmNoU29ydGluZ0RlZmluaXRpb24+ID0gW107XG5cbiAgICBwcm90ZWN0ZWQgdXNlckZhY2V0QnVja2V0czogeyBba2V5OiBzdHJpbmddOiBBcnJheTxGYWNldEZpZWxkQnVja2V0PiB9ID0ge307XG5cbiAgICBnZXQgdXNlclF1ZXJ5KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyUXVlcnk7XG4gICAgfVxuXG4gICAgc2V0IHVzZXJRdWVyeSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHZhbHVlID0gKHZhbHVlIHx8ICcnKS50cmltKCk7XG4gICAgICAgIHRoaXMuX3VzZXJRdWVyeSA9IHZhbHVlID8gYCgke3ZhbHVlfSlgIDogJyc7XG4gICAgfVxuXG4gICAgY29uZmlnOiBTZWFyY2hDb25maWd1cmF0aW9uID0ge1xuICAgICAgICBjYXRlZ29yaWVzOiBbXVxuICAgIH07XG5cbiAgICAvLyBUT0RPOiB0byBiZSBzdXBwb3J0ZWQgaW4gZnV0dXJlIGl0ZXJhdGlvbnNcbiAgICByYW5nZXM6IHsgW2lkOiBzdHJpbmddOiBTZWFyY2hSYW5nZSB9ID0ge307XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSwgcHJpdmF0ZSBhbGZyZXNjb0FwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSkge1xuICAgICAgICB0aGlzLnJlc2V0VG9EZWZhdWx0cygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgcXVlcnkgdG8gdGhlIGRlZmF1bHRzIHNwZWNpZmllZCBpbiB0aGUgYXBwIGNvbmZpZy5cbiAgICAgKi9cbiAgICByZXNldFRvRGVmYXVsdHMoKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdGhpcy5hcHBDb25maWcuZ2V0PFNlYXJjaENvbmZpZ3VyYXRpb24+KCdzZWFyY2gnKTtcbiAgICAgICAgaWYgKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVtcGxhdGUpKTtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcmllcyA9ICh0aGlzLmNvbmZpZy5jYXRlZ29yaWVzIHx8IFtdKS5maWx0ZXIoKGNhdGVnb3J5KSA9PiBjYXRlZ29yeS5lbmFibGVkKTtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcyA9IHRoaXMuY29uZmlnLmZpbHRlclF1ZXJpZXMgfHwgW107XG4gICAgICAgICAgICB0aGlzLnVzZXJGYWNldEJ1Y2tldHMgPSB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nID0gdGhpcy5jb25maWcuc29ydGluZy5kZWZhdWx0cyB8fCBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBmYWNldCBidWNrZXQgdG8gYSBmaWVsZC5cbiAgICAgKiBAcGFyYW0gZmllbGQgVGhlIHRhcmdldCBmaWVsZFxuICAgICAqIEBwYXJhbSBidWNrZXQgQnVja2V0IHRvIGFkZFxuICAgICAqL1xuICAgIGFkZFVzZXJGYWNldEJ1Y2tldChmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5maWVsZCAmJiBidWNrZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldHMgPSB0aGlzLnVzZXJGYWNldEJ1Y2tldHNbZmllbGQuZmllbGRdIHx8IFtdO1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBidWNrZXRzLmZpbmQoKGZhY2V0QnVja2V0KSA9PiBmYWNldEJ1Y2tldC5sYWJlbCA9PT0gYnVja2V0LmxhYmVsKTtcbiAgICAgICAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICBidWNrZXRzLnB1c2goYnVja2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXNlckZhY2V0QnVja2V0c1tmaWVsZC5maWVsZF0gPSBidWNrZXRzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgYnVja2V0cyBjdXJyZW50bHkgYWRkZWQgdG8gYSBmaWVsZFxuICAgICAqIEBwYXJhbSBmaWVsZCBUaGUgdGFyZ2V0IGZpZWxkc1xuICAgICAqIEByZXR1cm5zIEJ1Y2tldCBhcnJheVxuICAgICAqL1xuICAgIGdldFVzZXJGYWNldEJ1Y2tldHMoZmllbGQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkXSB8fCBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFuIGV4aXN0aW5nIGJ1Y2tldCBmcm9tIGEgZmllbGQuXG4gICAgICogQHBhcmFtIGZpZWxkIFRoZSB0YXJnZXQgZmllbGRcbiAgICAgKiBAcGFyYW0gYnVja2V0IEJ1Y2tldCB0byByZW1vdmVcbiAgICAgKi9cbiAgICByZW1vdmVVc2VyRmFjZXRCdWNrZXQoZmllbGQ6IEZhY2V0RmllbGQsIGJ1Y2tldDogRmFjZXRGaWVsZEJ1Y2tldCkge1xuICAgICAgICBpZiAoZmllbGQgJiYgZmllbGQuZmllbGQgJiYgYnVja2V0KSB7XG4gICAgICAgICAgICBjb25zdCBidWNrZXRzID0gdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkLmZpZWxkXSB8fCBbXTtcbiAgICAgICAgICAgIHRoaXMudXNlckZhY2V0QnVja2V0c1tmaWVsZC5maWVsZF0gPSBidWNrZXRzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZmFjZXRCdWNrZXQpID0+IGZhY2V0QnVja2V0LmxhYmVsICE9PSBidWNrZXQubGFiZWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGZpbHRlciBxdWVyeSB0byB0aGUgY3VycmVudCBxdWVyeS5cbiAgICAgKiBAcGFyYW0gcXVlcnkgUXVlcnkgc3RyaW5nIHRvIGFkZFxuICAgICAqL1xuICAgIGFkZEZpbHRlclF1ZXJ5KHF1ZXJ5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuZmlsdGVyUXVlcmllcy5maW5kKChmaWx0ZXJRdWVyeSkgPT4gZmlsdGVyUXVlcnkucXVlcnkgPT09IHF1ZXJ5KTtcbiAgICAgICAgICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclF1ZXJpZXMucHVzaCh7IHF1ZXJ5OiBxdWVyeSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYW4gZXhpc3RpbmcgZmlsdGVyIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSBxdWVyeSBUaGUgcXVlcnkgdG8gcmVtb3ZlXG4gICAgICovXG4gICAgcmVtb3ZlRmlsdGVyUXVlcnkocXVlcnk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcyA9IHRoaXMuZmlsdGVyUXVlcmllc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKGZpbHRlclF1ZXJ5KSA9PiBmaWx0ZXJRdWVyeS5xdWVyeSAhPT0gcXVlcnkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGZhY2V0IHF1ZXJ5IGJ5IGxhYmVsLlxuICAgICAqIEBwYXJhbSBsYWJlbCBMYWJlbCBvZiB0aGUgcXVlcnlcbiAgICAgKiBAcmV0dXJucyBGYWNldCBxdWVyeSBkYXRhXG4gICAgICovXG4gICAgZ2V0RmFjZXRRdWVyeShsYWJlbDogc3RyaW5nKTogRmFjZXRRdWVyeSB7XG4gICAgICAgIGlmIChsYWJlbCAmJiB0aGlzLmhhc0ZhY2V0UXVlcmllcykge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzLnF1ZXJpZXMuZmluZCgocXVlcnkpID0+IHF1ZXJ5LmxhYmVsID09PSBsYWJlbCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGZhY2V0IGZpZWxkIGJ5IGxhYmVsLlxuICAgICAqIEBwYXJhbSBsYWJlbCBMYWJlbCBvZiB0aGUgZmFjZXQgZmllbGRcbiAgICAgKiBAcmV0dXJucyBGYWNldCBmaWVsZCBkYXRhXG4gICAgICovXG4gICAgZ2V0RmFjZXRGaWVsZChsYWJlbDogc3RyaW5nKTogRmFjZXRGaWVsZCB7XG4gICAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5jb25maWcuZmFjZXRGaWVsZHMuZmllbGRzIHx8IFtdO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZmllbGRzLmZpbmQoKGZpZWxkKSA9PiBmaWVsZC5sYWJlbCA9PT0gbGFiZWwpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5sYWJlbCA9IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwocmVzdWx0LmxhYmVsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgdGhlIGN1cnJlbnQgcXVlcnkgYW5kIHRyaWdnZXJzIHRoZSBgdXBkYXRlZGAgZXZlbnQuXG4gICAgICovXG4gICAgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMuYnVpbGRRdWVyeSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZWQubmV4dChxdWVyeSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQnVpbGRzIGFuZCBleGVjdXRlcyB0aGUgY3VycmVudCBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyBOb3RoaW5nXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5idWlsZFF1ZXJ5KCk7XG4gICAgICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRTZXRQYWdpbmc6IFJlc3VsdFNldFBhZ2luZyA9IGF3YWl0IHRoaXMuYWxmcmVzY29BcGlTZXJ2aWNlLnNlYXJjaEFwaS5zZWFyY2gocXVlcnkpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhlY3V0ZWQubmV4dChyZXN1bHRTZXRQYWdpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5lcnJvci5uZXh0KGVycm9yKTtcblxuICAgICAgICAgICAgdGhpcy5leGVjdXRlZC5uZXh0KHtcbiAgICAgICAgICAgICAgICBsaXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsSXRlbXM6IDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZW50cmllczogW11cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgY3VycmVudCBxdWVyeS5cbiAgICAgKiBAcmV0dXJucyBUaGUgZmluaXNoZWQgcXVlcnlcbiAgICAgKi9cbiAgICBidWlsZFF1ZXJ5KCk6IFF1ZXJ5Qm9keSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5nZXRGaW5hbFF1ZXJ5KCk7XG5cbiAgICAgICAgY29uc3QgaW5jbHVkZSA9IHRoaXMuY29uZmlnLmluY2x1ZGUgfHwgW107XG4gICAgICAgIGlmIChpbmNsdWRlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaW5jbHVkZS5wdXNoKCdwYXRoJywgJ2FsbG93YWJsZU9wZXJhdGlvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0OiBRdWVyeUJvZHkgPSA8UXVlcnlCb2R5PiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogJ2FmdHMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiBpbmNsdWRlLFxuICAgICAgICAgICAgICAgIHBhZ2luZzogdGhpcy5wYWdpbmcsXG4gICAgICAgICAgICAgICAgZmllbGRzOiB0aGlzLmNvbmZpZy5maWVsZHMsXG4gICAgICAgICAgICAgICAgZmlsdGVyUXVlcmllczogdGhpcy5maWx0ZXJRdWVyaWVzLFxuICAgICAgICAgICAgICAgIGZhY2V0UXVlcmllczogdGhpcy5mYWNldFF1ZXJpZXMsXG4gICAgICAgICAgICAgICAgZmFjZXRJbnRlcnZhbHM6IHRoaXMuZmFjZXRJbnRlcnZhbHMsXG4gICAgICAgICAgICAgICAgZmFjZXRGaWVsZHM6IHRoaXMuZmFjZXRGaWVsZHMsXG4gICAgICAgICAgICAgICAgc29ydDogdGhpcy5zb3J0LFxuICAgICAgICAgICAgICAgIGhpZ2hsaWdodDogdGhpcy5oaWdobGlnaHRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlc3VsdFsnZmFjZXRGb3JtYXQnXSA9ICdWMic7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgcHJpbWFyeSBzb3J0aW5nIGRlZmluaXRpb24uXG4gICAgICogQHJldHVybnMgVGhlIHByaW1hcnkgc29ydGluZyBkZWZpbml0aW9uXG4gICAgICovXG4gICAgZ2V0UHJpbWFyeVNvcnRpbmcoKTogU2VhcmNoU29ydGluZ0RlZmluaXRpb24ge1xuICAgICAgICBpZiAodGhpcy5zb3J0aW5nICYmIHRoaXMuc29ydGluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3J0aW5nWzBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYWxsIHByZS1jb25maWd1cmVkIHNvcnRpbmcgb3B0aW9ucyB0aGF0IHVzZXJzIGNhbiBjaG9vc2UgZnJvbS5cbiAgICAgKiBAcmV0dXJucyBQcmUtY29uZmlndXJlZCBzb3J0aW5nIG9wdGlvbnNcbiAgICAgKi9cbiAgICBnZXRTb3J0aW5nT3B0aW9ucygpOiBTZWFyY2hTb3J0aW5nRGVmaW5pdGlvbltdIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLnNvcnRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5zb3J0aW5nLm9wdGlvbnMgfHwgW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHF1ZXJ5IGdyb3VwLlxuICAgICAqIEBwYXJhbSBxdWVyeSBUYXJnZXQgcXVlcnlcbiAgICAgKiBAcmV0dXJucyBRdWVyeSBncm91cFxuICAgICAqL1xuICAgIGdldFF1ZXJ5R3JvdXAocXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIHF1ZXJ5Lmdyb3VwIHx8IHRoaXMuY29uZmlnLmZhY2V0UXVlcmllcy5sYWJlbCB8fCAnRmFjZXQgUXVlcmllcyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIEZhY2V0UXVlcmllcyBoYXMgYmVlbiBkZWZpbmVkXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiBkZWZpbmVkLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBnZXQgaGFzRmFjZXRRdWVyaWVzKCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5jb25maWdcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0UXVlcmllc1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzLnF1ZXJpZXNcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0UXVlcmllcy5xdWVyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgRmFjZXRJbnRlcnZhbHMgaGFzIGJlZW4gZGVmaW5lZFxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgZGVmaW5lZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgZ2V0IGhhc0ZhY2V0SW50ZXJ2YWxzKCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5jb25maWdcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0SW50ZXJ2YWxzXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldEludGVydmFscy5pbnRlcnZhbHNcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0SW50ZXJ2YWxzLmludGVydmFscy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0IGhhc0ZhY2V0SGlnaGxpZ2h0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuaGlnaGxpZ2h0ID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgc29ydCgpOiBSZXF1ZXN0U29ydERlZmluaXRpb25Jbm5lcltdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGluZy5tYXAoKGRlZikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0U29ydERlZmluaXRpb25Jbm5lcih7XG4gICAgICAgICAgICAgICAgdHlwZTogZGVmLnR5cGUsXG4gICAgICAgICAgICAgICAgZmllbGQ6IGRlZi5maWVsZCxcbiAgICAgICAgICAgICAgICBhc2NlbmRpbmc6IGRlZi5hc2NlbmRpbmdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGZhY2V0UXVlcmllcygpOiBGYWNldFF1ZXJ5W10ge1xuICAgICAgICBpZiAodGhpcy5oYXNGYWNldFF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllcy5tYXAoKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgcXVlcnkuZ3JvdXAgPSB0aGlzLmdldFF1ZXJ5R3JvdXAocXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiA8RmFjZXRRdWVyeT4geyAuLi5xdWVyeSB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGZhY2V0SW50ZXJ2YWxzKCk6IGFueSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0ZhY2V0SW50ZXJ2YWxzKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdJbnRlcnZhbHMgPSB0aGlzLmNvbmZpZy5mYWNldEludGVydmFscztcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbHM6IGNvbmZpZ0ludGVydmFscy5pbnRlcnZhbHMubWFwKChpbnRlcnZhbCkgPT4gPGFueT4ge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5nZXRTdXBwb3J0ZWRMYWJlbChpbnRlcnZhbC5sYWJlbCksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpbnRlcnZhbC5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgc2V0czogaW50ZXJ2YWwuc2V0cy5tYXAoKHNldCkgPT4gPGFueT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwoc2V0LmxhYmVsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzZXQuc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHNldC5lbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluY2x1c2l2ZTogc2V0LnN0YXJ0SW5jbHVzaXZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kSW5jbHVzaXZlOiBzZXQuZW5kSW5jbHVzaXZlXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGhpZ2hsaWdodCgpOiBSZXF1ZXN0SGlnaGxpZ2h0IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzRmFjZXRIaWdobGlnaHQgPyB0aGlzLmNvbmZpZy5oaWdobGlnaHQgOiBudWxsO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXRGaW5hbFF1ZXJ5KCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBxdWVyeSA9ICcnO1xuXG4gICAgICAgIHRoaXMuY2F0ZWdvcmllcy5mb3JFYWNoKChmYWNldCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tUXVlcnkgPSB0aGlzLnF1ZXJ5RnJhZ21lbnRzW2ZhY2V0LmlkXTtcbiAgICAgICAgICAgIGlmIChjdXN0b21RdWVyeSkge1xuICAgICAgICAgICAgICAgIGlmIChxdWVyeS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5ICs9ICcgQU5EICc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHF1ZXJ5ICs9IGAoJHtjdXN0b21RdWVyeX0pYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IFt0aGlzLnVzZXJRdWVyeSwgcXVlcnldXG4gICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gZW50cnkpXG4gICAgICAgICAgICAuam9pbignIEFORCAnKTtcblxuICAgICAgICBpZiAodGhpcy51c2VyRmFjZXRCdWNrZXRzKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnVzZXJGYWNldEJ1Y2tldHMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YlF1ZXJ5ID0gKHRoaXMudXNlckZhY2V0QnVja2V0c1trZXldIHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChidWNrZXQpID0+IGJ1Y2tldC5maWx0ZXJRdWVyeSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoYnVja2V0KSA9PiBidWNrZXQuZmlsdGVyUXVlcnkpXG4gICAgICAgICAgICAgICAgICAgIC5qb2luKCcgT1IgJyk7XG4gICAgICAgICAgICAgICAgaWYgKHN1YlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgQU5EICc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAoJHtzdWJRdWVyeX0pYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBmYWNldEZpZWxkcygpOiBSZXF1ZXN0RmFjZXRGaWVsZHMge1xuICAgICAgICBjb25zdCBmYWNldEZpZWxkcyA9IHRoaXMuY29uZmlnLmZhY2V0RmllbGRzICYmIHRoaXMuY29uZmlnLmZhY2V0RmllbGRzLmZpZWxkcztcblxuICAgICAgICBpZiAoZmFjZXRGaWVsZHMgJiYgZmFjZXRGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmYWNldHM6IGZhY2V0RmllbGRzLm1hcCgoZmFjZXQpID0+IDxSZXF1ZXN0RmFjZXRGaWVsZD4ge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogZmFjZXQuZmllbGQsXG4gICAgICAgICAgICAgICAgICAgIG1pbmNvdW50OiBmYWNldC5taW5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwoZmFjZXQubGFiZWwpLFxuICAgICAgICAgICAgICAgICAgICBsaW1pdDogZmFjZXQubGltaXQsXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogZmFjZXQub2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IGZhY2V0LnByZWZpeFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jbG9zZXMgYSBsYWJlbCBuYW1lIHdpdGggZG91YmxlIHF1b3RlcyBpZiBpdCBjb250YWlucyB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuXG4gICAgICogQHBhcmFtIGNvbmZpZ0xhYmVsIE9yaWdpbmFsIGxhYmVsIHRleHRcbiAgICAgKiBAcmV0dXJucyBMYWJlbCwgcG9zc2libHkgd2l0aCBxdW90ZXMgaWYgaXQgY29udGFpbnMgc3BhY2VzXG4gICAgICovXG4gICAgZ2V0U3VwcG9ydGVkTGFiZWwoY29uZmlnTGFiZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHNwYWNlSW5zaWRlTGFiZWxJbmRleCA9IGNvbmZpZ0xhYmVsLnNlYXJjaCgvXFxzL2cpO1xuICAgICAgICBpZiAoc3BhY2VJbnNpZGVMYWJlbEluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBgXCIke2NvbmZpZ0xhYmVsfVwiYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnTGFiZWw7XG4gICAgfVxufVxuIl19