/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation } from '@angular/core';
import { SearchService, TranslationService } from '@alfresco/adf-core';
import { SearchQueryBuilderService } from '../../search-query-builder.service';
import { SearchFilterList } from './models/search-filter-list.model';
import { takeWhile } from 'rxjs/operators';
var SearchFilterComponent = /** @class */ (function () {
    function SearchFilterComponent(queryBuilder, searchService, translationService) {
        var _this = this;
        this.queryBuilder = queryBuilder;
        this.searchService = searchService;
        this.translationService = translationService;
        this.DEFAULT_PAGE_SIZE = 5;
        this.isAlive = true;
        /**
         * All facet field items to be displayed in the component. These are updated according to the response.
         *  When a new search is performed, the already existing items are updated with the new bucket count values and
         *  the newly received items are added to the responseFacets.
         */
        this.responseFacets = null;
        this.facetQueriesPageSize = this.DEFAULT_PAGE_SIZE;
        this.facetQueriesLabel = 'Facet Queries';
        this.facetExpanded = {
            'default': false
        };
        this.selectedBuckets = [];
        if (queryBuilder.config && queryBuilder.config.facetQueries) {
            this.facetQueriesLabel = queryBuilder.config.facetQueries.label || 'Facet Queries';
            this.facetQueriesPageSize = queryBuilder.config.facetQueries.pageSize || this.DEFAULT_PAGE_SIZE;
            this.facetExpanded['query'] = queryBuilder.config.facetQueries.expanded;
        }
        if (queryBuilder.config && queryBuilder.config.facetFields) {
            this.facetExpanded['field'] = queryBuilder.config.facetFields.expanded;
        }
        if (queryBuilder.config && queryBuilder.config.facetIntervals) {
            this.facetExpanded['interval'] = queryBuilder.config.facetIntervals.expanded;
        }
        this.displayResetButton = this.queryBuilder.config && !!this.queryBuilder.config.resetButton;
        this.queryBuilder.updated.pipe(takeWhile((/**
         * @return {?}
         */
        function () { return _this.isAlive; }))).subscribe((/**
         * @return {?}
         */
        function () {
            _this.queryBuilder.execute();
        }));
    }
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.queryBuilder) {
            this.queryBuilder.executed.pipe(takeWhile((/**
             * @return {?}
             */
            function () { return _this.isAlive; }))).subscribe((/**
             * @param {?} resultSetPaging
             * @return {?}
             */
            function (resultSetPaging) {
                _this.onDataLoaded(resultSetPaging);
                _this.searchService.dataLoaded.next(resultSetPaging);
            }));
        }
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.isAlive = false;
    };
    /**
     * @private
     * @return {?}
     */
    SearchFilterComponent.prototype.updateSelectedBuckets = /**
     * @private
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.responseFacets) {
            this.selectedBuckets = [];
            var _loop_1 = function (field) {
                var _a;
                if (field.buckets) {
                    (_a = this_1.selectedBuckets).push.apply(_a, tslib_1.__spread(this_1.queryBuilder.getUserFacetBuckets(field.field)
                        .filter((/**
                     * @param {?} bucket
                     * @return {?}
                     */
                    function (bucket) { return bucket.checked; }))
                        .map((/**
                     * @param {?} bucket
                     * @return {?}
                     */
                    function (bucket) {
                        return { field: field, bucket: bucket };
                    }))));
                }
            };
            var this_1 = this;
            try {
                for (var _b = tslib_1.__values(this.responseFacets), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var field = _c.value;
                    _loop_1(field);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        else {
            this.selectedBuckets = [];
        }
    };
    /**
     * @param {?} event
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.onToggleBucket = /**
     * @param {?} event
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (event, field, bucket) {
        if (event && bucket) {
            if (event.checked) {
                this.selectFacetBucket(field, bucket);
            }
            else {
                this.unselectFacetBucket(field, bucket);
            }
        }
    };
    /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.selectFacetBucket = /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (field, bucket) {
        if (bucket) {
            bucket.checked = true;
            this.queryBuilder.addUserFacetBucket(field, bucket);
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.unselectFacetBucket = /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (field, bucket) {
        if (bucket) {
            bucket.checked = false;
            this.queryBuilder.removeUserFacetBucket(field, bucket);
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.canResetSelectedBuckets = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        if (field && field.buckets) {
            return field.buckets.items.some((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) { return bucket.checked; }));
        }
        return false;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.resetSelectedBuckets = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var e_2, _a;
        if (field && field.buckets) {
            try {
                for (var _b = tslib_1.__values(field.buckets.items), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var bucket = _c.value;
                    bucket.checked = false;
                    this.queryBuilder.removeUserFacetBucket(field, bucket);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.resetAllSelectedBuckets = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.responseFacets.forEach((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            var e_3, _a;
            if (field && field.buckets) {
                try {
                    for (var _b = tslib_1.__values(field.buckets.items), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var bucket = _c.value;
                        bucket.checked = false;
                        _this.queryBuilder.removeUserFacetBucket(field, bucket);
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
                _this.updateSelectedBuckets();
            }
        }));
        this.queryBuilder.update();
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.resetAll = /**
     * @return {?}
     */
    function () {
        this.resetAllSelectedBuckets();
        this.responseFacets = null;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.shouldExpand = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.facetExpanded[field.type] || this.facetExpanded['default'];
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SearchFilterComponent.prototype.onDataLoaded = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var context = data.list.context;
        if (context) {
            this.parseFacets(context);
        }
        else {
            this.responseFacets = null;
        }
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacets = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        this.parseFacetFields(context);
        this.parseFacetIntervals(context);
        this.parseFacetQueries(context);
    };
    /**
     * @private
     * @param {?} context
     * @param {?} configFacetFields
     * @param {?} itemType
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetItems = /**
     * @private
     * @param {?} context
     * @param {?} configFacetFields
     * @param {?} itemType
     * @return {?}
     */
    function (context, configFacetFields, itemType) {
        var _this = this;
        configFacetFields.forEach((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            /** @type {?} */
            var responseField = _this.findFacet(context, itemType, field.label);
            /** @type {?} */
            var responseBuckets = _this.getResponseBuckets(responseField, field)
                .filter(_this.getFilterByMinCount(field.mincount));
            /** @type {?} */
            var alreadyExistingField = _this.findResponseFacet(itemType, field.label);
            if (alreadyExistingField) {
                /** @type {?} */
                var alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                _this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                /** @type {?} */
                var bucketList = new SearchFilterList(responseBuckets, field.pageSize);
                bucketList.filter = _this.getBucketFilterFunction(bucketList);
                if (!_this.responseFacets) {
                    _this.responseFacets = [];
                }
                _this.responseFacets.push((/** @type {?} */ (tslib_1.__assign({}, field, { type: responseField.type || itemType, label: field.label, pageSize: field.pageSize | _this.DEFAULT_PAGE_SIZE, currentPageSize: field.pageSize | _this.DEFAULT_PAGE_SIZE, buckets: bucketList }))));
            }
        }));
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetFields = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        /** @type {?} */
        var configFacetFields = this.queryBuilder.config.facetFields && this.queryBuilder.config.facetFields.fields || [];
        this.parseFacetItems(context, configFacetFields, 'field');
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetIntervals = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        /** @type {?} */
        var configFacetIntervals = this.queryBuilder.config.facetIntervals && this.queryBuilder.config.facetIntervals.intervals || [];
        this.parseFacetItems(context, configFacetIntervals, 'interval');
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetQueries = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        var _this = this;
        /** @type {?} */
        var configFacetQueries = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.queries || [];
        /** @type {?} */
        var configGroups = configFacetQueries.reduce((/**
         * @param {?} acc
         * @param {?} query
         * @return {?}
         */
        function (acc, query) {
            /** @type {?} */
            var group = _this.queryBuilder.getQueryGroup(query);
            if (acc[group]) {
                acc[group].push(query);
            }
            else {
                acc[group] = [query];
            }
            return acc;
        }), []);
        /** @type {?} */
        var mincount = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.mincount;
        /** @type {?} */
        var mincountFilter = this.getFilterByMinCount(mincount);
        Object.keys(configGroups).forEach((/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            /** @type {?} */
            var responseField = _this.findFacet(context, 'query', group);
            /** @type {?} */
            var responseBuckets = _this.getResponseQueryBuckets(responseField, configGroups[group])
                .filter(mincountFilter);
            /** @type {?} */
            var alreadyExistingField = _this.findResponseFacet('query', group);
            if (alreadyExistingField) {
                /** @type {?} */
                var alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                _this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                /** @type {?} */
                var bucketList = new SearchFilterList(responseBuckets, _this.facetQueriesPageSize);
                bucketList.filter = _this.getBucketFilterFunction(bucketList);
                if (!_this.responseFacets) {
                    _this.responseFacets = [];
                }
                _this.responseFacets.push((/** @type {?} */ ({
                    field: group,
                    type: responseField.type || 'query',
                    label: group,
                    pageSize: _this.DEFAULT_PAGE_SIZE,
                    currentPageSize: _this.DEFAULT_PAGE_SIZE,
                    buckets: bucketList
                })));
            }
        }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} configField
     * @return {?}
     */
    SearchFilterComponent.prototype.getResponseBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} configField
     * @return {?}
     */
    function (responseField, configField) {
        var _this = this;
        return ((responseField && responseField.buckets) || []).map((/**
         * @param {?} respBucket
         * @return {?}
         */
        function (respBucket) {
            respBucket['count'] = _this.getCountValue(respBucket);
            respBucket.filterQuery = respBucket.filterQuery || _this.getCorrespondingFilterQuery(configField, respBucket.label);
            return (/** @type {?} */ (tslib_1.__assign({}, respBucket, { checked: false, display: respBucket.display, label: respBucket.label })));
        }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} configGroup
     * @return {?}
     */
    SearchFilterComponent.prototype.getResponseQueryBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} configGroup
     * @return {?}
     */
    function (responseField, configGroup) {
        var _this = this;
        return (configGroup || []).map((/**
         * @param {?} query
         * @return {?}
         */
        function (query) {
            /** @type {?} */
            var respBucket = ((responseField && responseField.buckets) || [])
                .find((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) { return bucket.label === query.label; }));
            respBucket['count'] = _this.getCountValue(respBucket);
            return (/** @type {?} */ (tslib_1.__assign({}, respBucket, { checked: false, display: respBucket.display, label: respBucket.label })));
        }));
    };
    /**
     * @private
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.getCountValue = /**
     * @private
     * @param {?} bucket
     * @return {?}
     */
    function (bucket) {
        return (!!bucket && !!bucket.metrics && bucket.metrics[0] && bucket.metrics[0].value && bucket.metrics[0].value.count)
            || 0;
    };
    /**
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.getBucketCountDisplay = /**
     * @param {?} bucket
     * @return {?}
     */
    function (bucket) {
        return bucket.count === null ? '' : "(" + bucket.count + ")";
    };
    /**
     * @private
     * @param {?} mincountInput
     * @return {?}
     */
    SearchFilterComponent.prototype.getFilterByMinCount = /**
     * @private
     * @param {?} mincountInput
     * @return {?}
     */
    function (mincountInput) {
        return (/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            /** @type {?} */
            var mincount = mincountInput;
            if (mincount === undefined) {
                mincount = 1;
            }
            return bucket.count >= mincount;
        });
    };
    /**
     * @private
     * @param {?} configFacetItem
     * @param {?} bucketLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.getCorrespondingFilterQuery = /**
     * @private
     * @param {?} configFacetItem
     * @param {?} bucketLabel
     * @return {?}
     */
    function (configFacetItem, bucketLabel) {
        /** @type {?} */
        var filterQuery = null;
        if (configFacetItem.field && bucketLabel) {
            if (configFacetItem.sets) {
                /** @type {?} */
                var configSet = configFacetItem.sets.find((/**
                 * @param {?} set
                 * @return {?}
                 */
                function (set) { return bucketLabel === set.label; }));
                if (configSet) {
                    filterQuery = this.buildIntervalQuery(configFacetItem.field, configSet);
                }
            }
            else {
                filterQuery = configFacetItem.field + ":\"" + bucketLabel + "\"";
            }
        }
        return filterQuery;
    };
    /**
     * @private
     * @param {?} fieldName
     * @param {?} interval
     * @return {?}
     */
    SearchFilterComponent.prototype.buildIntervalQuery = /**
     * @private
     * @param {?} fieldName
     * @param {?} interval
     * @return {?}
     */
    function (fieldName, interval) {
        /** @type {?} */
        var start = interval.start;
        /** @type {?} */
        var end = interval.end;
        /** @type {?} */
        var startLimit = (interval.startInclusive === undefined || interval.startInclusive === true) ? '[' : '<';
        /** @type {?} */
        var endLimit = (interval.endInclusive === undefined || interval.endInclusive === true) ? ']' : '>';
        return fieldName + ":" + startLimit + "\"" + start + "\" TO \"" + end + "\"" + endLimit;
    };
    /**
     * @private
     * @param {?} context
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.findFacet = /**
     * @private
     * @param {?} context
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    function (context, itemType, fieldLabel) {
        return (context.facets || []).find((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response.type === itemType && response.label === fieldLabel; })) || {};
    };
    /**
     * @private
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.findResponseFacet = /**
     * @private
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    function (itemType, fieldLabel) {
        return (this.responseFacets || []).find((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response.type === itemType && response.label === fieldLabel; }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} responseBuckets
     * @param {?} alreadyExistingField
     * @param {?} alreadyExistingBuckets
     * @return {?}
     */
    SearchFilterComponent.prototype.updateExistingBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} responseBuckets
     * @param {?} alreadyExistingField
     * @param {?} alreadyExistingBuckets
     * @return {?}
     */
    function (responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets) {
        var _this = this;
        /** @type {?} */
        var bucketsToDelete = [];
        alreadyExistingBuckets
            .map((/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            /** @type {?} */
            var responseBucket = ((responseField && responseField.buckets) || []).find((/**
             * @param {?} respBucket
             * @return {?}
             */
            function (respBucket) { return respBucket.label === bucket.label; }));
            if (!responseBucket) {
                bucketsToDelete.push(bucket);
            }
            bucket.count = _this.getCountValue(responseBucket);
            return bucket;
        }));
        /** @type {?} */
        var hasSelection = this.selectedBuckets
            .find((/**
         * @param {?} selBuckets
         * @return {?}
         */
        function (selBuckets) { return alreadyExistingField.label === selBuckets.field.label && alreadyExistingField.type === selBuckets.field.type; }));
        if (!hasSelection && bucketsToDelete.length) {
            bucketsToDelete.forEach((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) {
                alreadyExistingField.buckets.deleteItem(bucket);
            }));
        }
        responseBuckets.forEach((/**
         * @param {?} respBucket
         * @return {?}
         */
        function (respBucket) {
            /** @type {?} */
            var existingBucket = alreadyExistingBuckets.find((/**
             * @param {?} oldBucket
             * @return {?}
             */
            function (oldBucket) { return oldBucket.label === respBucket.label; }));
            if (!existingBucket) {
                alreadyExistingField.buckets.addItem(respBucket);
            }
        }));
    };
    /**
     * @private
     * @param {?} bucketList
     * @return {?}
     */
    SearchFilterComponent.prototype.getBucketFilterFunction = /**
     * @private
     * @param {?} bucketList
     * @return {?}
     */
    function (bucketList) {
        var _this = this;
        return (/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            if (bucket && bucketList.filterText) {
                /** @type {?} */
                var pattern = (bucketList.filterText || '').toLowerCase();
                /** @type {?} */
                var label = (_this.translationService.instant(bucket.display) || _this.translationService.instant(bucket.label)).toLowerCase();
                return _this.queryBuilder.config.filterWithContains ? label.indexOf(pattern) !== -1 : label.startsWith(pattern);
            }
            return true;
        });
    };
    SearchFilterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-search-filter',
                    template: "<mat-accordion multi=\"true\" displayMode=\"flat\">\n\n    <button *ngIf=\"displayResetButton && responseFacets\"\n            mat-button\n            color=\"primary\"\n            matTooltip=\"{{ 'SEARCH.FILTER.BUTTONS.RESET-ALL.TOOLTIP' | translate }}\"\n            matTooltipPosition=\"right\"\n            (click)=\"resetAll()\">\n        {{ 'SEARCH.FILTER.BUTTONS.RESET-ALL.LABEL' | translate }}\n    </button>\n    <mat-expansion-panel\n        *ngFor=\"let category of queryBuilder.categories\"\n        [attr.data-automation-id]=\"'expansion-panel-'+category.name\"\n        [(expanded)]=\"category.expanded\">\n        <mat-expansion-panel-header>\n            <mat-panel-title>\n                {{ category.name | translate }}\n            </mat-panel-title>\n        </mat-expansion-panel-header>\n        <adf-search-widget-container\n            [id]=\"category.id\"\n            [selector]=\"category.component.selector\"\n            [settings]=\"category.component.settings\">\n        </adf-search-widget-container>\n    </mat-expansion-panel>\n\n    <ng-container *ngIf=\"responseFacets\">\n        <mat-expansion-panel [attr.data-automation-id]=\"'expansion-panel-'+field.label\" *ngFor=\"let field of responseFacets\"\n                             [expanded]=\"shouldExpand(field)\">\n            <mat-expansion-panel-header>\n                <mat-panel-title>{{ field.label | translate }}</mat-panel-title>\n            </mat-expansion-panel-header>\n\n            <div class=\"adf-facet-result-filter\">\n                <mat-form-field>\n                    <input\n                        matInput\n                        placeholder=\"{{ 'SEARCH.FILTER.ACTIONS.FILTER-CATEGORY' | translate }}\"\n                        [attr.data-automation-id]=\"'facet-result-filter-'+field.label\"\n                        [(ngModel)]=\"field.buckets.filterText\">\n                    <button *ngIf=\"field.buckets.filterText\"\n                        mat-button matSuffix mat-icon-button\n                        (click)=\"field.buckets.filterText = ''\">\n                        <mat-icon>close</mat-icon>\n                    </button>\n                </mat-form-field>\n            </div>\n\n            <div class=\"adf-checklist\">\n                <mat-checkbox\n                    *ngFor=\"let bucket of field.buckets\"\n                    [checked]=\"bucket.checked\"\n                    [attr.data-automation-id]=\"'checkbox-'+field.label+'-'+(bucket.display || bucket.label)\"\n                    (change)=\"onToggleBucket($event, field, bucket)\">\n                    <div \n                        matTooltip=\"{{ bucket.display || bucket.label | translate }} {{ getBucketCountDisplay(bucket) }}\"\n                        matTooltipPosition=\"right\"\n                        class=\"adf-facet-label\">\n                        {{ bucket.display || bucket.label | translate }} {{ getBucketCountDisplay(bucket) }}\n                    </div>\n                </mat-checkbox>\n            </div>\n\n            <div class=\"adf-facet-buttons\" *ngIf=\"field.buckets.fitsPage\">\n                <button *ngIf=\"canResetSelectedBuckets(field)\"\n                    mat-button\n                    color=\"primary\"\n                    (click)=\"resetSelectedBuckets(field)\">\n                    {{ 'SEARCH.FILTER.ACTIONS.CLEAR-ALL' | translate }}\n                </button>\n            </div>\n\n            <div class=\"adf-facet-buttons\" *ngIf=\"!field.buckets.fitsPage\">\n                <button mat-icon-button\n                    *ngIf=\"canResetSelectedBuckets(field)\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.CLEAR-ALL' | translate }}\"\n                    (click)=\"resetSelectedBuckets(field)\">\n                    <mat-icon>clear</mat-icon>\n                </button>\n                <button mat-icon-button\n                    *ngIf=\"field.buckets.canShowLessItems\"\n                    (click)=\"field.buckets.showLessItems()\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.SHOW-LESS' | translate }}\">\n                    <mat-icon>keyboard_arrow_up</mat-icon>\n                </button>\n                <button mat-icon-button\n                    *ngIf=\"field.buckets.canShowMoreItems\"\n                    (click)=\"field.buckets.showMoreItems()\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.SHOW-MORE' | translate }}\">\n                    <mat-icon>keyboard_arrow_down</mat-icon>\n                </button>\n            </div>\n        </mat-expansion-panel>\n    </ng-container>\n</mat-accordion>\n",
                    encapsulation: ViewEncapsulation.None,
                    host: { class: 'adf-search-filter' },
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SearchFilterComponent.ctorParameters = function () { return [
        { type: SearchQueryBuilderService },
        { type: SearchService },
        { type: TranslationService }
    ]; };
    return SearchFilterComponent;
}());
export { SearchFilterComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.DEFAULT_PAGE_SIZE;
    /** @type {?} */
    SearchFilterComponent.prototype.isAlive;
    /**
     * All facet field items to be displayed in the component. These are updated according to the response.
     *  When a new search is performed, the already existing items are updated with the new bucket count values and
     *  the newly received items are added to the responseFacets.
     * @type {?}
     */
    SearchFilterComponent.prototype.responseFacets;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.facetQueriesPageSize;
    /** @type {?} */
    SearchFilterComponent.prototype.facetQueriesLabel;
    /** @type {?} */
    SearchFilterComponent.prototype.facetExpanded;
    /** @type {?} */
    SearchFilterComponent.prototype.displayResetButton;
    /** @type {?} */
    SearchFilterComponent.prototype.selectedBuckets;
    /** @type {?} */
    SearchFilterComponent.prototype.queryBuilder;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.searchService;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.translationService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJzZWFyY2gvY29tcG9uZW50cy9zZWFyY2gtZmlsdGVyL3NlYXJjaC1maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUVoRixPQUFPLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFHL0UsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzNDO0lBMkJJLCtCQUFtQixZQUF1QyxFQUN0QyxhQUE0QixFQUM1QixrQkFBc0M7UUFGMUQsaUJBcUJDO1FBckJrQixpQkFBWSxHQUFaLFlBQVksQ0FBMkI7UUFDdEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQXBCbEQsc0JBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBRTlCLFlBQU8sR0FBRyxJQUFJLENBQUM7Ozs7OztRQU1mLG1CQUFjLEdBQWlCLElBQUksQ0FBQztRQUU1Qix5QkFBb0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7UUFDdEQsc0JBQWlCLEdBQVcsZUFBZSxDQUFDO1FBQzVDLGtCQUFhLEdBQUc7WUFDWixTQUFTLEVBQUUsS0FBSztTQUNuQixDQUFDO1FBRUYsb0JBQWUsR0FBMkQsRUFBRSxDQUFDO1FBS3pFLElBQUksWUFBWSxDQUFDLE1BQU0sSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLFlBQVksRUFB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QUUsQ0FBQyxDQUFDLFdBQVcsRUFBRTs7b0JBQ3JELEtBQUssR0FBRyxDQUFDLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFO2dCQUM5SCxPQUFPLEtBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ2xIO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQyxFQUFDO0lBQ04sQ0FBQzs7Z0JBN1hKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsbUJBQW1CO29CQUM3QiwyZ0pBQTZDO29CQUU3QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtvQkFDckMsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixFQUFFOztpQkFDdkM7Ozs7Z0JBYlEseUJBQXlCO2dCQUR6QixhQUFhO2dCQUFFLGtCQUFrQjs7SUFzWTFDLDRCQUFDO0NBQUEsQUE5WEQsSUE4WEM7U0F2WFkscUJBQXFCOzs7Ozs7SUFFOUIsa0RBQThCOztJQUU5Qix3Q0FBZTs7Ozs7OztJQU1mLCtDQUFvQzs7Ozs7SUFFcEMscURBQXNEOztJQUN0RCxrREFBNEM7O0lBQzVDLDhDQUVFOztJQUNGLG1EQUE0Qjs7SUFDNUIsZ0RBQTZFOztJQUVqRSw2Q0FBOEM7Ozs7O0lBQzlDLDhDQUFvQzs7Ozs7SUFDcEMsbURBQThDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBWaWV3RW5jYXBzdWxhdGlvbiwgT25Jbml0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdENoZWNrYm94Q2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSwgVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZWFyY2gtcXVlcnktYnVpbGRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGRCdWNrZXQgfSBmcm9tICcuLi8uLi9mYWNldC1maWVsZC1idWNrZXQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGQgfSBmcm9tICcuLi8uLi9mYWNldC1maWVsZC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoRmlsdGVyTGlzdCB9IGZyb20gJy4vbW9kZWxzL3NlYXJjaC1maWx0ZXItbGlzdC5tb2RlbCc7XG5pbXBvcnQgeyB0YWtlV2hpbGUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBSZXN1bHRTZXRQYWdpbmcsIEdlbmVyaWNCdWNrZXQsIEdlbmVyaWNGYWNldFJlc3BvbnNlLCBSZXN1bHRTZXRDb250ZXh0IH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXNlYXJjaC1maWx0ZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtZmlsdGVyLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9zZWFyY2gtZmlsdGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBob3N0OiB7IGNsYXNzOiAnYWRmLXNlYXJjaC1maWx0ZXInIH1cbn0pXG5leHBvcnQgY2xhc3MgU2VhcmNoRmlsdGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgcHJpdmF0ZSBERUZBVUxUX1BBR0VfU0laRSA9IDU7XG5cbiAgICBpc0FsaXZlID0gdHJ1ZTtcblxuICAgIC8qKiBBbGwgZmFjZXQgZmllbGQgaXRlbXMgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBjb21wb25lbnQuIFRoZXNlIGFyZSB1cGRhdGVkIGFjY29yZGluZyB0byB0aGUgcmVzcG9uc2UuXG4gICAgICogIFdoZW4gYSBuZXcgc2VhcmNoIGlzIHBlcmZvcm1lZCwgdGhlIGFscmVhZHkgZXhpc3RpbmcgaXRlbXMgYXJlIHVwZGF0ZWQgd2l0aCB0aGUgbmV3IGJ1Y2tldCBjb3VudCB2YWx1ZXMgYW5kXG4gICAgICogIHRoZSBuZXdseSByZWNlaXZlZCBpdGVtcyBhcmUgYWRkZWQgdG8gdGhlIHJlc3BvbnNlRmFjZXRzLlxuICAgICAqL1xuICAgIHJlc3BvbnNlRmFjZXRzOiBGYWNldEZpZWxkW10gPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBmYWNldFF1ZXJpZXNQYWdlU2l6ZSA9IHRoaXMuREVGQVVMVF9QQUdFX1NJWkU7XG4gICAgZmFjZXRRdWVyaWVzTGFiZWw6IHN0cmluZyA9ICdGYWNldCBRdWVyaWVzJztcbiAgICBmYWNldEV4cGFuZGVkID0ge1xuICAgICAgICAnZGVmYXVsdCc6IGZhbHNlXG4gICAgfTtcbiAgICBkaXNwbGF5UmVzZXRCdXR0b246IGJvb2xlYW47XG4gICAgc2VsZWN0ZWRCdWNrZXRzOiBBcnJheTx7IGZpZWxkOiBGYWNldEZpZWxkLCBidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQgfT4gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBxdWVyeUJ1aWxkZXI6IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgaWYgKHF1ZXJ5QnVpbGRlci5jb25maWcgJiYgcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRRdWVyaWVzTGFiZWwgPSBxdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5sYWJlbCB8fCAnRmFjZXQgUXVlcmllcyc7XG4gICAgICAgICAgICB0aGlzLmZhY2V0UXVlcmllc1BhZ2VTaXplID0gcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMucGFnZVNpemUgfHwgdGhpcy5ERUZBVUxUX1BBR0VfU0laRTtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRFeHBhbmRlZFsncXVlcnknXSA9IHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRRdWVyaWVzLmV4cGFuZGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeUJ1aWxkZXIuY29uZmlnICYmIHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRGaWVsZHMpIHtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRFeHBhbmRlZFsnZmllbGQnXSA9IHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRGaWVsZHMuZXhwYW5kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5QnVpbGRlci5jb25maWcgJiYgcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscykge1xuICAgICAgICAgICAgdGhpcy5mYWNldEV4cGFuZGVkWydpbnRlcnZhbCddID0gcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscy5leHBhbmRlZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3BsYXlSZXNldEJ1dHRvbiA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZyAmJiAhIXRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5yZXNldEJ1dHRvbjtcblxuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGVkLnBpcGUoXG4gICAgICAgICAgICB0YWtlV2hpbGUoKCkgPT4gdGhpcy5pc0FsaXZlKVxuICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5leGVjdXRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBpZiAodGhpcy5xdWVyeUJ1aWxkZXIpIHtcbiAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLmV4ZWN1dGVkLnBpcGUoXG4gICAgICAgICAgICAgICAgdGFrZVdoaWxlKCgpID0+IHRoaXMuaXNBbGl2ZSlcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKChyZXN1bHRTZXRQYWdpbmc6IFJlc3VsdFNldFBhZ2luZykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub25EYXRhTG9hZGVkKHJlc3VsdFNldFBhZ2luZyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLmRhdGFMb2FkZWQubmV4dChyZXN1bHRTZXRQYWdpbmcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5pc0FsaXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZEJ1Y2tldHMoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQnVja2V0cyA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiB0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLmJ1Y2tldHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJ1Y2tldHMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRoaXMucXVlcnlCdWlsZGVyLmdldFVzZXJGYWNldEJ1Y2tldHMoZmllbGQuZmllbGQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoYnVja2V0KSA9PiBidWNrZXQuY2hlY2tlZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChidWNrZXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgZmllbGQsIGJ1Y2tldCB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJ1Y2tldHMgPSBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uVG9nZ2xlQnVja2V0KGV2ZW50OiBNYXRDaGVja2JveENoYW5nZSwgZmllbGQ6IEZhY2V0RmllbGQsIGJ1Y2tldDogRmFjZXRGaWVsZEJ1Y2tldCkge1xuICAgICAgICBpZiAoZXZlbnQgJiYgYnVja2V0KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0RmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudW5zZWxlY3RGYWNldEJ1Y2tldChmaWVsZCwgYnVja2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlbGVjdEZhY2V0QnVja2V0KGZpZWxkOiBGYWNldEZpZWxkLCBidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpIHtcbiAgICAgICAgaWYgKGJ1Y2tldCkge1xuICAgICAgICAgICAgYnVja2V0LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIuYWRkVXNlckZhY2V0QnVja2V0KGZpZWxkLCBidWNrZXQpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZEJ1Y2tldHMoKTtcbiAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdW5zZWxlY3RGYWNldEJ1Y2tldChmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChidWNrZXQpIHtcbiAgICAgICAgICAgIGJ1Y2tldC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZW1vdmVVc2VyRmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQnVja2V0cygpO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjYW5SZXNldFNlbGVjdGVkQnVja2V0cyhmaWVsZDogRmFjZXRGaWVsZCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoZmllbGQgJiYgZmllbGQuYnVja2V0cykge1xuICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmJ1Y2tldHMuaXRlbXMuc29tZSgoYnVja2V0KSA9PiBidWNrZXQuY2hlY2tlZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJlc2V0U2VsZWN0ZWRCdWNrZXRzKGZpZWxkOiBGYWNldEZpZWxkKSB7XG4gICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5idWNrZXRzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJ1Y2tldCBvZiBmaWVsZC5idWNrZXRzLml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgYnVja2V0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZW1vdmVVc2VyRmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQnVja2V0cygpO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXNldEFsbFNlbGVjdGVkQnVja2V0cygpIHtcbiAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZpZWxkICYmIGZpZWxkLmJ1Y2tldHMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGJ1Y2tldCBvZiBmaWVsZC5idWNrZXRzLml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLnJlbW92ZVVzZXJGYWNldEJ1Y2tldChmaWVsZCwgYnVja2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZEJ1Y2tldHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIHJlc2V0QWxsKCkge1xuICAgICAgICB0aGlzLnJlc2V0QWxsU2VsZWN0ZWRCdWNrZXRzKCk7XG4gICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMgPSBudWxsO1xuICAgIH1cblxuICAgIHNob3VsZEV4cGFuZChmaWVsZDogRmFjZXRGaWVsZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5mYWNldEV4cGFuZGVkW2ZpZWxkLnR5cGVdIHx8IHRoaXMuZmFjZXRFeHBhbmRlZFsnZGVmYXVsdCddO1xuICAgIH1cblxuICAgIG9uRGF0YUxvYWRlZChkYXRhOiBhbnkpIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGRhdGEubGlzdC5jb250ZXh0O1xuXG4gICAgICAgIGlmIChjb250ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnBhcnNlRmFjZXRzKGNvbnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRzKGNvbnRleHQ6IFJlc3VsdFNldENvbnRleHQpIHtcbiAgICAgICAgdGhpcy5wYXJzZUZhY2V0RmllbGRzKGNvbnRleHQpO1xuICAgICAgICB0aGlzLnBhcnNlRmFjZXRJbnRlcnZhbHMoY29udGV4dCk7XG4gICAgICAgIHRoaXMucGFyc2VGYWNldFF1ZXJpZXMoY29udGV4dCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwYXJzZUZhY2V0SXRlbXMoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCwgY29uZmlnRmFjZXRGaWVsZHM6IEZhY2V0RmllbGRbXSwgaXRlbVR5cGU6IHN0cmluZykge1xuICAgICAgICBjb25maWdGYWNldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VGaWVsZCA9IHRoaXMuZmluZEZhY2V0KGNvbnRleHQsIGl0ZW1UeXBlLCBmaWVsZC5sYWJlbCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUJ1Y2tldHMgPSB0aGlzLmdldFJlc3BvbnNlQnVja2V0cyhyZXNwb25zZUZpZWxkLCBmaWVsZClcbiAgICAgICAgICAgICAgICAuZmlsdGVyKHRoaXMuZ2V0RmlsdGVyQnlNaW5Db3VudChmaWVsZC5taW5jb3VudCkpO1xuICAgICAgICAgICAgY29uc3QgYWxyZWFkeUV4aXN0aW5nRmllbGQgPSB0aGlzLmZpbmRSZXNwb25zZUZhY2V0KGl0ZW1UeXBlLCBmaWVsZC5sYWJlbCk7XG5cbiAgICAgICAgICAgIGlmIChhbHJlYWR5RXhpc3RpbmdGaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFscmVhZHlFeGlzdGluZ0J1Y2tldHMgPSBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzICYmIGFscmVhZHlFeGlzdGluZ0ZpZWxkLmJ1Y2tldHMuaXRlbXMgfHwgW107XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4aXN0aW5nQnVja2V0cyhyZXNwb25zZUZpZWxkLCByZXNwb25zZUJ1Y2tldHMsIGFscmVhZHlFeGlzdGluZ0ZpZWxkLCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2VGaWVsZCkge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYnVja2V0TGlzdCA9IG5ldyBTZWFyY2hGaWx0ZXJMaXN0PEZhY2V0RmllbGRCdWNrZXQ+KHJlc3BvbnNlQnVja2V0cywgZmllbGQucGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIGJ1Y2tldExpc3QuZmlsdGVyID0gdGhpcy5nZXRCdWNrZXRGaWx0ZXJGdW5jdGlvbihidWNrZXRMaXN0KTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZXNwb25zZUZhY2V0cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMucHVzaCg8RmFjZXRGaWVsZD4ge1xuICAgICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzcG9uc2VGaWVsZC50eXBlIHx8IGl0ZW1UeXBlLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogZmllbGQubGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBmaWVsZC5wYWdlU2l6ZSB8IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlU2l6ZTogZmllbGQucGFnZVNpemUgfCB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgICAgICAgICAgICAgICBidWNrZXRzOiBidWNrZXRMaXN0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFyc2VGYWNldEZpZWxkcyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0ZhY2V0RmllbGRzID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0RmllbGRzICYmIHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEZpZWxkcy5maWVsZHMgfHwgW107XG4gICAgICAgIHRoaXMucGFyc2VGYWNldEl0ZW1zKGNvbnRleHQsIGNvbmZpZ0ZhY2V0RmllbGRzLCAnZmllbGQnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRJbnRlcnZhbHMoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjb25maWdGYWNldEludGVydmFscyA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscyAmJiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRJbnRlcnZhbHMuaW50ZXJ2YWxzIHx8IFtdO1xuICAgICAgICB0aGlzLnBhcnNlRmFjZXRJdGVtcyhjb250ZXh0LCBjb25maWdGYWNldEludGVydmFscywgJ2ludGVydmFsJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwYXJzZUZhY2V0UXVlcmllcyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0ZhY2V0UXVlcmllcyA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMgJiYgdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5xdWVyaWVzIHx8IFtdO1xuICAgICAgICBjb25zdCBjb25maWdHcm91cHMgPSBjb25maWdGYWNldFF1ZXJpZXMucmVkdWNlKChhY2MsIHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IHRoaXMucXVlcnlCdWlsZGVyLmdldFF1ZXJ5R3JvdXAocXVlcnkpO1xuICAgICAgICAgICAgaWYgKGFjY1tncm91cF0pIHtcbiAgICAgICAgICAgICAgICBhY2NbZ3JvdXBdLnB1c2gocXVlcnkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhY2NbZ3JvdXBdID0gW3F1ZXJ5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIFtdKTtcblxuICAgICAgICBjb25zdCBtaW5jb3VudCA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMgJiYgdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5taW5jb3VudDtcbiAgICAgICAgY29uc3QgbWluY291bnRGaWx0ZXIgPSB0aGlzLmdldEZpbHRlckJ5TWluQ291bnQobWluY291bnQpO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKGNvbmZpZ0dyb3VwcykuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRmllbGQgPSB0aGlzLmZpbmRGYWNldChjb250ZXh0LCAncXVlcnknLCBncm91cCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUJ1Y2tldHMgPSB0aGlzLmdldFJlc3BvbnNlUXVlcnlCdWNrZXRzKHJlc3BvbnNlRmllbGQsIGNvbmZpZ0dyb3Vwc1tncm91cF0pXG4gICAgICAgICAgICAgICAgLmZpbHRlcihtaW5jb3VudEZpbHRlcik7XG4gICAgICAgICAgICBjb25zdCBhbHJlYWR5RXhpc3RpbmdGaWVsZCA9IHRoaXMuZmluZFJlc3BvbnNlRmFjZXQoJ3F1ZXJ5JywgZ3JvdXApO1xuXG4gICAgICAgICAgICBpZiAoYWxyZWFkeUV4aXN0aW5nRmllbGQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzID0gYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cyAmJiBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzLml0ZW1zIHx8IFtdO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeGlzdGluZ0J1Y2tldHMocmVzcG9uc2VGaWVsZCwgcmVzcG9uc2VCdWNrZXRzLCBhbHJlYWR5RXhpc3RpbmdGaWVsZCwgYWxyZWFkeUV4aXN0aW5nQnVja2V0cyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlRmllbGQpIHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGJ1Y2tldExpc3QgPSBuZXcgU2VhcmNoRmlsdGVyTGlzdDxGYWNldEZpZWxkQnVja2V0PihyZXNwb25zZUJ1Y2tldHMsIHRoaXMuZmFjZXRRdWVyaWVzUGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIGJ1Y2tldExpc3QuZmlsdGVyID0gdGhpcy5nZXRCdWNrZXRGaWx0ZXJGdW5jdGlvbihidWNrZXRMaXN0KTtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZXNwb25zZUZhY2V0cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMucHVzaCg8RmFjZXRGaWVsZD4ge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogZ3JvdXAsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHJlc3BvbnNlRmllbGQudHlwZSB8fCAncXVlcnknLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogZ3JvdXAsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGFnZVNpemU6IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldHM6IGJ1Y2tldExpc3RcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFJlc3BvbnNlQnVja2V0cyhyZXNwb25zZUZpZWxkOiBHZW5lcmljRmFjZXRSZXNwb25zZSwgY29uZmlnRmllbGQ6IEZhY2V0RmllbGQpOiBGYWNldEZpZWxkQnVja2V0W10ge1xuICAgICAgICByZXR1cm4gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pLm1hcCgocmVzcEJ1Y2tldCkgPT4ge1xuXG4gICAgICAgICAgICByZXNwQnVja2V0Wydjb3VudCddID0gdGhpcy5nZXRDb3VudFZhbHVlKHJlc3BCdWNrZXQpO1xuICAgICAgICAgICAgcmVzcEJ1Y2tldC5maWx0ZXJRdWVyeSA9IHJlc3BCdWNrZXQuZmlsdGVyUXVlcnkgfHwgdGhpcy5nZXRDb3JyZXNwb25kaW5nRmlsdGVyUXVlcnkoY29uZmlnRmllbGQsIHJlc3BCdWNrZXQubGFiZWwpO1xuICAgICAgICAgICAgcmV0dXJuIDxGYWNldEZpZWxkQnVja2V0PiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzcEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBjaGVja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiByZXNwQnVja2V0LmRpc3BsYXksXG4gICAgICAgICAgICAgICAgbGFiZWw6IHJlc3BCdWNrZXQubGFiZWxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVzcG9uc2VRdWVyeUJ1Y2tldHMocmVzcG9uc2VGaWVsZDogR2VuZXJpY0ZhY2V0UmVzcG9uc2UsIGNvbmZpZ0dyb3VwOiBhbnkpOiBGYWNldEZpZWxkQnVja2V0W10ge1xuICAgICAgICByZXR1cm4gKGNvbmZpZ0dyb3VwIHx8IFtdKS5tYXAoKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwQnVja2V0ID0gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pXG4gICAgICAgICAgICAgICAgLmZpbmQoKGJ1Y2tldCkgPT4gYnVja2V0LmxhYmVsID09PSBxdWVyeS5sYWJlbCk7XG5cbiAgICAgICAgICAgIHJlc3BCdWNrZXRbJ2NvdW50J10gPSB0aGlzLmdldENvdW50VmFsdWUocmVzcEJ1Y2tldCk7XG4gICAgICAgICAgICByZXR1cm4gPEZhY2V0RmllbGRCdWNrZXQ+IHtcbiAgICAgICAgICAgICAgICAuLi5yZXNwQnVja2V0LFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHJlc3BCdWNrZXQuZGlzcGxheSxcbiAgICAgICAgICAgICAgICBsYWJlbDogcmVzcEJ1Y2tldC5sYWJlbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb3VudFZhbHVlKGJ1Y2tldDogR2VuZXJpY0J1Y2tldCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiAoISFidWNrZXQgJiYgISFidWNrZXQubWV0cmljcyAmJiBidWNrZXQubWV0cmljc1swXSAmJiBidWNrZXQubWV0cmljc1swXS52YWx1ZSAmJiBidWNrZXQubWV0cmljc1swXS52YWx1ZS5jb3VudClcbiAgICAgICAgICAgIHx8IDA7XG4gICAgfVxuXG4gICAgZ2V0QnVja2V0Q291bnREaXNwbGF5KGJ1Y2tldDogRmFjZXRGaWVsZEJ1Y2tldCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBidWNrZXQuY291bnQgPT09IG51bGwgPyAnJyA6IGAoJHtidWNrZXQuY291bnR9KWA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRGaWx0ZXJCeU1pbkNvdW50KG1pbmNvdW50SW5wdXQ6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gKGJ1Y2tldCkgPT4ge1xuICAgICAgICAgICAgbGV0IG1pbmNvdW50ID0gbWluY291bnRJbnB1dDtcbiAgICAgICAgICAgIGlmIChtaW5jb3VudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbWluY291bnQgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJ1Y2tldC5jb3VudCA+PSBtaW5jb3VudDtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENvcnJlc3BvbmRpbmdGaWx0ZXJRdWVyeSAoY29uZmlnRmFjZXRJdGVtOiBGYWNldEZpZWxkLCBidWNrZXRMYWJlbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZpbHRlclF1ZXJ5ID0gbnVsbDtcblxuICAgICAgICBpZiAoY29uZmlnRmFjZXRJdGVtLmZpZWxkICYmIGJ1Y2tldExhYmVsKSB7XG5cbiAgICAgICAgICAgIGlmIChjb25maWdGYWNldEl0ZW0uc2V0cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1NldCA9IGNvbmZpZ0ZhY2V0SXRlbS5zZXRzLmZpbmQoKHNldCkgPT4gYnVja2V0TGFiZWwgPT09IHNldC5sYWJlbCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnU2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclF1ZXJ5ID0gdGhpcy5idWlsZEludGVydmFsUXVlcnkoY29uZmlnRmFjZXRJdGVtLmZpZWxkLCBjb25maWdTZXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJRdWVyeSA9IGAke2NvbmZpZ0ZhY2V0SXRlbS5maWVsZH06XCIke2J1Y2tldExhYmVsfVwiYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJRdWVyeTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkSW50ZXJ2YWxRdWVyeShmaWVsZE5hbWU6IHN0cmluZywgaW50ZXJ2YWw6IGFueSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gaW50ZXJ2YWwuc3RhcnQ7XG4gICAgICAgIGNvbnN0IGVuZCA9IGludGVydmFsLmVuZDtcbiAgICAgICAgY29uc3Qgc3RhcnRMaW1pdCA9IChpbnRlcnZhbC5zdGFydEluY2x1c2l2ZSA9PT0gdW5kZWZpbmVkIHx8IGludGVydmFsLnN0YXJ0SW5jbHVzaXZlID09PSB0cnVlKSA/ICdbJyA6ICc8JztcbiAgICAgICAgY29uc3QgZW5kTGltaXQgPSAoaW50ZXJ2YWwuZW5kSW5jbHVzaXZlID09PSB1bmRlZmluZWQgfHwgaW50ZXJ2YWwuZW5kSW5jbHVzaXZlID09PSB0cnVlKSA/ICddJyA6ICc+JztcblxuICAgICAgICByZXR1cm4gYCR7ZmllbGROYW1lfToke3N0YXJ0TGltaXR9XCIke3N0YXJ0fVwiIFRPIFwiJHtlbmR9XCIke2VuZExpbWl0fWA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaW5kRmFjZXQoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCwgaXRlbVR5cGU6IHN0cmluZywgZmllbGRMYWJlbDogc3RyaW5nKTogR2VuZXJpY0ZhY2V0UmVzcG9uc2Uge1xuICAgICAgICByZXR1cm4gKGNvbnRleHQuZmFjZXRzIHx8IFtdKS5maW5kKChyZXNwb25zZSkgPT4gcmVzcG9uc2UudHlwZSA9PT0gaXRlbVR5cGUgJiYgcmVzcG9uc2UubGFiZWwgPT09IGZpZWxkTGFiZWwpIHx8IHt9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZmluZFJlc3BvbnNlRmFjZXQoaXRlbVR5cGU6IHN0cmluZywgZmllbGRMYWJlbDogc3RyaW5nKTogRmFjZXRGaWVsZCB7XG4gICAgICAgIHJldHVybiAodGhpcy5yZXNwb25zZUZhY2V0cyB8fCBbXSkuZmluZCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLnR5cGUgPT09IGl0ZW1UeXBlICYmIHJlc3BvbnNlLmxhYmVsID09PSBmaWVsZExhYmVsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZUV4aXN0aW5nQnVja2V0cyhyZXNwb25zZUZpZWxkLCByZXNwb25zZUJ1Y2tldHMsIGFscmVhZHlFeGlzdGluZ0ZpZWxkLCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzKSB7XG4gICAgICAgIGNvbnN0IGJ1Y2tldHNUb0RlbGV0ZSA9IFtdO1xuXG4gICAgICAgIGFscmVhZHlFeGlzdGluZ0J1Y2tldHNcbiAgICAgICAgICAgIC5tYXAoKGJ1Y2tldCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQnVja2V0ID0gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pLmZpbmQoKHJlc3BCdWNrZXQpID0+IHJlc3BCdWNrZXQubGFiZWwgPT09IGJ1Y2tldC5sYWJlbCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlQnVja2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldHNUb0RlbGV0ZS5wdXNoKGJ1Y2tldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ1Y2tldC5jb3VudCA9IHRoaXMuZ2V0Q291bnRWYWx1ZShyZXNwb25zZUJ1Y2tldCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1Y2tldDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGhhc1NlbGVjdGlvbiA9IHRoaXMuc2VsZWN0ZWRCdWNrZXRzXG4gICAgICAgICAgICAuZmluZCgoc2VsQnVja2V0cykgPT4gYWxyZWFkeUV4aXN0aW5nRmllbGQubGFiZWwgPT09IHNlbEJ1Y2tldHMuZmllbGQubGFiZWwgJiYgYWxyZWFkeUV4aXN0aW5nRmllbGQudHlwZSA9PT0gc2VsQnVja2V0cy5maWVsZC50eXBlKTtcblxuICAgICAgICBpZiAoIWhhc1NlbGVjdGlvbiAmJiBidWNrZXRzVG9EZWxldGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBidWNrZXRzVG9EZWxldGUuZm9yRWFjaCgoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cy5kZWxldGVJdGVtKGJ1Y2tldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3BvbnNlQnVja2V0cy5mb3JFYWNoKChyZXNwQnVja2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0J1Y2tldCA9IGFscmVhZHlFeGlzdGluZ0J1Y2tldHMuZmluZCgob2xkQnVja2V0KSA9PiBvbGRCdWNrZXQubGFiZWwgPT09IHJlc3BCdWNrZXQubGFiZWwpO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nQnVja2V0KSB7XG4gICAgICAgICAgICAgICAgYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cy5hZGRJdGVtKHJlc3BCdWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEJ1Y2tldEZpbHRlckZ1bmN0aW9uIChidWNrZXRMaXN0KSB7XG4gICAgICAgIHJldHVybiAoYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KTogYm9vbGVhbiA9PiB7XG4gICAgICAgICAgICBpZiAoYnVja2V0ICYmIGJ1Y2tldExpc3QuZmlsdGVyVGV4dCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSAoYnVja2V0TGlzdC5maWx0ZXJUZXh0IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gKHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoYnVja2V0LmRpc3BsYXkpIHx8IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoYnVja2V0LmxhYmVsKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZpbHRlcldpdGhDb250YWlucyA/IGxhYmVsLmluZGV4T2YocGF0dGVybikgIT09IC0xIDogbGFiZWwuc3RhcnRzV2l0aChwYXR0ZXJuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgIH1cbn1cbiJdfQ==