/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { CardViewTextItemModel, CardViewBoolItemModel, CardViewDateItemModel, CardViewDatetimeItemModel, CardViewIntItemModel, CardViewFloatItemModel, LogService, MultiValuePipe, AppConfigService } from '@alfresco/adf-core';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
/** @type {?} */
var D_TEXT = 'd:text';
/** @type {?} */
var D_MLTEXT = 'd:mltext';
/** @type {?} */
var D_DATE = 'd:date';
/** @type {?} */
var D_DATETIME = 'd:datetime';
/** @type {?} */
var D_INT = 'd:int';
/** @type {?} */
var D_LONG = 'd:long';
/** @type {?} */
var D_FLOAT = 'd:float';
/** @type {?} */
var D_DOUBLE = 'd:double';
/** @type {?} */
var D_BOOLEAN = 'd:boolean';
var PropertyGroupTranslatorService = /** @class */ (function () {
    function PropertyGroupTranslatorService(logService, multiValuePipe, appConfig) {
        this.logService = logService;
        this.multiValuePipe = multiValuePipe;
        this.appConfig = appConfig;
        this.valueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator');
    }
    /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translateToCardViewGroups = /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    function (propertyGroups, propertyValues) {
        var _this = this;
        return propertyGroups.map((/**
         * @param {?} propertyGroup
         * @return {?}
         */
        function (propertyGroup) {
            /** @type {?} */
            var translatedPropertyGroup = Object.assign({}, propertyGroup);
            translatedPropertyGroup.properties = _this.translateArray(propertyGroup.properties, propertyValues);
            return translatedPropertyGroup;
        }));
    };
    /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translateArray = /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    function (properties, propertyValues) {
        var _this = this;
        return properties.map((/**
         * @param {?} property
         * @return {?}
         */
        function (property) {
            return _this.translate(property, propertyValues);
        }));
    };
    /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translate = /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    function (property, propertyValues) {
        /** @type {?} */
        var propertyValue;
        if (propertyValues && propertyValues[property.name]) {
            propertyValue = propertyValues[property.name];
        }
        this.checkECMTypeValidity(property.dataType);
        /** @type {?} */
        var prefix = 'properties.';
        /** @type {?} */
        var propertyDefinition = {
            label: property.title || property.name,
            value: propertyValue,
            key: "" + prefix + property.name,
            default: property.defaultValue,
            editable: true
        };
        /** @type {?} */
        var cardViewItemProperty;
        switch (property.dataType) {
            case D_MLTEXT:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multiline: true
                }));
                break;
            case D_INT:
            case D_LONG:
                cardViewItemProperty = new CardViewIntItemModel(propertyDefinition);
                break;
            case D_FLOAT:
            case D_DOUBLE:
                cardViewItemProperty = new CardViewFloatItemModel(propertyDefinition);
                break;
            case D_DATE:
                cardViewItemProperty = new CardViewDateItemModel(propertyDefinition);
                break;
            case D_DATETIME:
                cardViewItemProperty = new CardViewDatetimeItemModel(propertyDefinition);
                break;
            case D_BOOLEAN:
                cardViewItemProperty = new CardViewBoolItemModel(propertyDefinition);
                break;
            case D_TEXT:
            default:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multivalued: property.multiValued,
                    multiline: property.multiValued,
                    pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                }));
        }
        return cardViewItemProperty;
    };
    /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.checkECMTypeValidity = /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    function (ecmPropertyType) {
        if (PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES.indexOf(ecmPropertyType) === -1) {
            this.logService.error("Unknown type for mapping: " + ecmPropertyType);
        }
    };
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES = [D_TEXT, D_MLTEXT, D_DATE, D_DATETIME, D_INT, D_LONG, D_FLOAT, D_DOUBLE, D_BOOLEAN];
    PropertyGroupTranslatorService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    PropertyGroupTranslatorService.ctorParameters = function () { return [
        { type: LogService },
        { type: MultiValuePipe },
        { type: AppConfigService }
    ]; };
    /** @nocollapse */ PropertyGroupTranslatorService.ngInjectableDef = i0.defineInjectable({ factory: function PropertyGroupTranslatorService_Factory() { return new PropertyGroupTranslatorService(i0.inject(i1.LogService), i0.inject(i1.MultiValuePipe), i0.inject(i1.AppConfigService)); }, token: PropertyGroupTranslatorService, providedIn: "root" });
    return PropertyGroupTranslatorService;
}());
export { PropertyGroupTranslatorService };
if (false) {
    /** @type {?} */
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES;
    /** @type {?} */
    PropertyGroupTranslatorService.prototype.valueSeparator;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.multiValuePipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImNvbnRlbnQtbWV0YWRhdGEvc2VydmljZXMvcHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFHSCxxQkFBcUIsRUFDckIscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix5QkFBeUIsRUFDekIsb0JBQW9CLEVBQ3BCLHNCQUFzQixFQUN0QixVQUFVLEVBQ1YsY0FBYyxFQUNkLGdCQUFnQixFQUNuQixNQUFNLG9CQUFvQixDQUFDOzs7O0lBR3RCLE1BQU0sR0FBRyxRQUFROztJQUNqQixRQUFRLEdBQUcsVUFBVTs7SUFDckIsTUFBTSxHQUFHLFFBQVE7O0lBQ2pCLFVBQVUsR0FBRyxZQUFZOztJQUN6QixLQUFLLEdBQUcsT0FBTzs7SUFDZixNQUFNLEdBQUcsUUFBUTs7SUFDakIsT0FBTyxHQUFHLFNBQVM7O0lBQ25CLFFBQVEsR0FBRyxVQUFVOztJQUNyQixTQUFTLEdBQUcsV0FBVztBQUU3QjtJQVNJLHdDQUFvQixVQUFzQixFQUN0QixjQUE4QixFQUM5QixTQUEyQjtRQUYzQixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUMzQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFTLDZDQUE2QyxDQUFDLENBQUM7SUFDcEcsQ0FBQzs7Ozs7O0lBRU0sa0VBQXlCOzs7OztJQUFoQyxVQUFpQyxjQUF3QyxFQUFFLGNBQWM7UUFBekYsaUJBTUM7UUFMRyxPQUFP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Q0FBQzs7Ozs7O0lBRU8sNkRBQW9COzs7OztJQUE1QixVQUE2QixlQUFlO1FBQ3hDLElBQUksOEJBQThCLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ3JGLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLCtCQUE2QixlQUFpQixDQUFDLENBQUM7U0FDekU7SUFDTCxDQUFDO0lBekZlLG1EQUFvQixHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQzs7Z0JBTDlILFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7Ozs7Z0JBbEJHLFVBQVU7Z0JBQ1YsY0FBYztnQkFDZCxnQkFBZ0I7Ozt5Q0E3QnBCO0NBMElDLEFBL0ZELElBK0ZDO1NBNUZZLDhCQUE4Qjs7O0lBRXZDLG9EQUEySDs7SUFFM0gsd0RBQXVCOzs7OztJQUVYLG9EQUE4Qjs7Ozs7SUFDOUIsd0RBQXNDOzs7OztJQUN0QyxtREFBbUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIENhcmRWaWV3SXRlbVByb3BlcnRpZXMsXG4gICAgQ2FyZFZpZXdJdGVtLFxuICAgIENhcmRWaWV3VGV4dEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0Jvb2xJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsLFxuICAgIENhcmRWaWV3RGF0ZXRpbWVJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdJbnRJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdGbG9hdEl0ZW1Nb2RlbCxcbiAgICBMb2dTZXJ2aWNlLFxuICAgIE11bHRpVmFsdWVQaXBlLFxuICAgIEFwcENvbmZpZ1NlcnZpY2Vcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFByb3BlcnR5LCBDYXJkVmlld0dyb3VwLCBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jb250ZW50LW1ldGFkYXRhLmludGVyZmFjZXMnO1xuXG5jb25zdCBEX1RFWFQgPSAnZDp0ZXh0JztcbmNvbnN0IERfTUxURVhUID0gJ2Q6bWx0ZXh0JztcbmNvbnN0IERfREFURSA9ICdkOmRhdGUnO1xuY29uc3QgRF9EQVRFVElNRSA9ICdkOmRhdGV0aW1lJztcbmNvbnN0IERfSU5UID0gJ2Q6aW50JztcbmNvbnN0IERfTE9ORyA9ICdkOmxvbmcnO1xuY29uc3QgRF9GTE9BVCA9ICdkOmZsb2F0JztcbmNvbnN0IERfRE9VQkxFID0gJ2Q6ZG91YmxlJztcbmNvbnN0IERfQk9PTEVBTiA9ICdkOmJvb2xlYW4nO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFByb3BlcnR5R3JvdXBUcmFuc2xhdG9yU2VydmljZSB7XG5cbiAgICBzdGF0aWMgcmVhZG9ubHkgUkVDT0dOSVNFRF9FQ01fVFlQRVMgPSBbRF9URVhULCBEX01MVEVYVCwgRF9EQVRFLCBEX0RBVEVUSU1FLCBEX0lOVCwgRF9MT05HLCBEX0ZMT0FULCBEX0RPVUJMRSwgRF9CT09MRUFOXTtcblxuICAgIHZhbHVlU2VwYXJhdG9yOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBtdWx0aVZhbHVlUGlwZTogTXVsdGlWYWx1ZVBpcGUsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy52YWx1ZVNlcGFyYXRvciA9IHRoaXMuYXBwQ29uZmlnLmdldDxzdHJpbmc+KCdjb250ZW50LW1ldGFkYXRhLm11bHRpLXZhbHVlLXBpcGUtc2VwYXJhdG9yJyk7XG4gICAgfVxuXG4gICAgcHVibGljIHRyYW5zbGF0ZVRvQ2FyZFZpZXdHcm91cHMocHJvcGVydHlHcm91cHM6IE9yZ2FuaXNlZFByb3BlcnR5R3JvdXBbXSwgcHJvcGVydHlWYWx1ZXMpOiBDYXJkVmlld0dyb3VwW10ge1xuICAgICAgICByZXR1cm4gcHJvcGVydHlHcm91cHMubWFwKChwcm9wZXJ0eUdyb3VwKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkUHJvcGVydHlHcm91cDogYW55ID0gT2JqZWN0LmFzc2lnbih7fSwgcHJvcGVydHlHcm91cCk7XG4gICAgICAgICAgICB0cmFuc2xhdGVkUHJvcGVydHlHcm91cC5wcm9wZXJ0aWVzID0gdGhpcy50cmFuc2xhdGVBcnJheShwcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXMsIHByb3BlcnR5VmFsdWVzKTtcbiAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGVkUHJvcGVydHlHcm91cDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGVBcnJheShwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdLCBwcm9wZXJ0eVZhbHVlczogYW55KTogQ2FyZFZpZXdJdGVtW10ge1xuICAgICAgICByZXR1cm4gcHJvcGVydGllcy5tYXAoKHByb3BlcnR5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc2xhdGUocHJvcGVydHksIHByb3BlcnR5VmFsdWVzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGUocHJvcGVydHk6IFByb3BlcnR5LCBwcm9wZXJ0eVZhbHVlczogYW55KTogQ2FyZFZpZXdJdGVtIHtcbiAgICAgICAgbGV0IHByb3BlcnR5VmFsdWU7XG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlcyAmJiBwcm9wZXJ0eVZhbHVlc1twcm9wZXJ0eS5uYW1lXSkge1xuICAgICAgICAgICAgcHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5VmFsdWVzW3Byb3BlcnR5Lm5hbWVdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jaGVja0VDTVR5cGVWYWxpZGl0eShwcm9wZXJ0eS5kYXRhVHlwZSk7XG5cbiAgICAgICAgY29uc3QgcHJlZml4ID0gJ3Byb3BlcnRpZXMuJztcblxuICAgICAgICBjb25zdCBwcm9wZXJ0eURlZmluaXRpb246IENhcmRWaWV3SXRlbVByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICBsYWJlbDogcHJvcGVydHkudGl0bGUgfHwgcHJvcGVydHkubmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0eVZhbHVlLFxuICAgICAgICAgICAga2V5OiBgJHtwcmVmaXh9JHtwcm9wZXJ0eS5uYW1lfWAsXG4gICAgICAgICAgICBkZWZhdWx0OiBwcm9wZXJ0eS5kZWZhdWx0VmFsdWUsXG4gICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICBsZXQgY2FyZFZpZXdJdGVtUHJvcGVydHk7XG5cbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eS5kYXRhVHlwZSkge1xuXG4gICAgICAgICAgICBjYXNlIERfTUxURVhUOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9JTlQ6XG4gICAgICAgICAgICBjYXNlIERfTE9ORzpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0ludEl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfRkxPQVQ6XG4gICAgICAgICAgICBjYXNlIERfRE9VQkxFOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3RmxvYXRJdGVtTW9kZWwocHJvcGVydHlEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0RBVEU6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9EQVRFVElNRTpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0RhdGV0aW1lSXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9CT09MRUFOOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3Qm9vbEl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfVEVYVDpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKE9iamVjdC5hc3NpZ24ocHJvcGVydHlEZWZpbml0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpdmFsdWVkOiBwcm9wZXJ0eS5tdWx0aVZhbHVlZCxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lOiBwcm9wZXJ0eS5tdWx0aVZhbHVlZCxcbiAgICAgICAgICAgICAgICAgICAgcGlwZXM6IFt7IHBpcGU6IHRoaXMubXVsdGlWYWx1ZVBpcGUsIHBhcmFtczogW3RoaXMudmFsdWVTZXBhcmF0b3JdfV1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2FyZFZpZXdJdGVtUHJvcGVydHk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0VDTVR5cGVWYWxpZGl0eShlY21Qcm9wZXJ0eVR5cGUpIHtcbiAgICAgICAgaWYgKFByb3BlcnR5R3JvdXBUcmFuc2xhdG9yU2VydmljZS5SRUNPR05JU0VEX0VDTV9UWVBFUy5pbmRleE9mKGVjbVByb3BlcnR5VHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoYFVua25vd24gdHlwZSBmb3IgbWFwcGluZzogJHtlY21Qcm9wZXJ0eVR5cGV9YCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=