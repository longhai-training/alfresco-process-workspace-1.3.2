/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { CardViewTextItemModel, CardViewBoolItemModel, CardViewDateItemModel, CardViewDatetimeItemModel, CardViewIntItemModel, CardViewFloatItemModel, LogService, MultiValuePipe, AppConfigService } from '@alfresco/adf-core';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
/** @type {?} */
const D_TEXT = 'd:text';
/** @type {?} */
const D_MLTEXT = 'd:mltext';
/** @type {?} */
const D_DATE = 'd:date';
/** @type {?} */
const D_DATETIME = 'd:datetime';
/** @type {?} */
const D_INT = 'd:int';
/** @type {?} */
const D_LONG = 'd:long';
/** @type {?} */
const D_FLOAT = 'd:float';
/** @type {?} */
const D_DOUBLE = 'd:double';
/** @type {?} */
const D_BOOLEAN = 'd:boolean';
export class PropertyGroupTranslatorService {
    /**
     * @param {?} logService
     * @param {?} multiValuePipe
     * @param {?} appConfig
     */
    constructor(logService, multiValuePipe, appConfig) {
        this.logService = logService;
        this.multiValuePipe = multiValuePipe;
        this.appConfig = appConfig;
        this.valueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator');
    }
    /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    translateToCardViewGroups(propertyGroups, propertyValues) {
        return propertyGroups.map((/**
         * @param {?} propertyGroup
         * @return {?}
         */
        (propertyGroup) => {
            /** @type {?} */
            const translatedPropertyGroup = Object.assign({}, propertyGroup);
            translatedPropertyGroup.properties = this.translateArray(propertyGroup.properties, propertyValues);
            return translatedPropertyGroup;
        }));
    }
    /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    translateArray(properties, propertyValues) {
        return properties.map((/**
         * @param {?} property
         * @return {?}
         */
        (property) => {
            return this.translate(property, propertyValues);
        }));
    }
    /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    translate(property, propertyValues) {
        /** @type {?} */
        let propertyValue;
        if (propertyValues && propertyValues[property.name]) {
            propertyValue = propertyValues[property.name];
        }
        this.checkECMTypeValidity(property.dataType);
        /** @type {?} */
        const prefix = 'properties.';
        /** @type {?} */
        const propertyDefinition = {
            label: property.title || property.name,
            value: propertyValue,
            key: `${prefix}${property.name}`,
            default: property.defaultValue,
            editable: true
        };
        /** @type {?} */
        let cardViewItemProperty;
        switch (property.dataType) {
            case D_MLTEXT:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multiline: true
                }));
                break;
            case D_INT:
            case D_LONG:
                cardViewItemProperty = new CardViewIntItemModel(propertyDefinition);
                break;
            case D_FLOAT:
            case D_DOUBLE:
                cardViewItemProperty = new CardViewFloatItemModel(propertyDefinition);
                break;
            case D_DATE:
                cardViewItemProperty = new CardViewDateItemModel(propertyDefinition);
                break;
            case D_DATETIME:
                cardViewItemProperty = new CardViewDatetimeItemModel(propertyDefinition);
                break;
            case D_BOOLEAN:
                cardViewItemProperty = new CardViewBoolItemModel(propertyDefinition);
                break;
            case D_TEXT:
            default:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multivalued: property.multiValued,
                    multiline: property.multiValued,
                    pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                }));
        }
        return cardViewItemProperty;
    }
    /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    checkECMTypeValidity(ecmPropertyType) {
        if (PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES.indexOf(ecmPropertyType) === -1) {
            this.logService.error(`Unknown type for mapping: ${ecmPropertyType}`);
        }
    }
}
PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES = [D_TEXT, D_MLTEXT, D_DATE, D_DATETIME, D_INT, D_LONG, D_FLOAT, D_DOUBLE, D_BOOLEAN];
PropertyGroupTranslatorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
PropertyGroupTranslatorService.ctorParameters = () => [
    { type: LogService },
    { type: MultiValuePipe },
    { type: AppConfigService }
];
/** @nocollapse */ PropertyGroupTranslatorService.ngInjectableDef = i0.defineInjectable({ factory: function PropertyGroupTranslatorService_Factory() { return new PropertyGroupTranslatorService(i0.inject(i1.LogService), i0.inject(i1.MultiValuePipe), i0.inject(i1.AppConfigService)); }, token: PropertyGroupTranslatorService, providedIn: "root" });
if (false) {
    /** @type {?} */
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES;
    /** @type {?} */
    PropertyGroupTranslatorService.prototype.valueSeparator;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.multiValuePipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImNvbnRlbnQtbWV0YWRhdGEvc2VydmljZXMvcHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFHSCxxQkFBcUIsRUFDckIscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix5QkFBeUIsRUFDekIsb0JBQW9CLEVBQ3BCLHNCQUFzQixFQUN0QixVQUFVLEVBQ1YsY0FBYyxFQUNkLGdCQUFnQixFQUNuQixNQUFNLG9CQUFvQixDQUFDOzs7O01BR3RCLE1BQU0sR0FBRyxRQUFROztNQUNqQixRQUFRLEdBQUcsVUFBVTs7TUFDckIsTUFBTSxHQUFHLFFBQVE7O01BQ2pCLFVBQVUsR0FBRyxZQUFZOztNQUN6QixLQUFLLEdBQUcsT0FBTzs7TUFDZixNQUFNLEdBQUcsUUFBUTs7TUFDakIsT0FBTyxHQUFHLFNBQVM7O01BQ25CLFFBQVEsR0FBRyxVQUFVOztNQUNyQixTQUFTLEdBQUcsV0FBVztBQUs3QixNQUFNLE9BQU8sOEJBQThCOzs7Ozs7SUFNdkMsWUFBb0IsVUFBc0IsRUFDdEIsY0FBOEIsRUFDOUIsU0FBMkI7UUFGM0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBUyw2Q0FBNkMsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7Ozs7OztJQUVNLHlCQUF5QixDQUFDLGNBQXdDLEVBQUUsY0FBYztRQUNyRixPQUFPLGNBQWMsQ0FBQyxHQUFHOzs7O1FBQUMsQ0FBQyxhQUFhLEVBQUUsRUFBRTs7a0JBQ2xDLHVCQUF1QixHQUFRLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLGFBQWEsQ0FBQztZQUNyRSx1QkFBdUIsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1lBQ25HLE9BQU8sdUJBQXVCLENBQUM7UUFDbkMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7O0lBRU8sY0FBYyxDQUFDLFVBQXNCLEVBQUUsY0FBbUI7UUFDOUQsT0FBTyxVQUFVLENBQUMsR0FBRzs7OztRQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDL0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUNwRCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7Ozs7SUFFTyxTQUFTLENBQUMsUUFBa0IsRUFBRSxjQUFtQjs7WUFDakQsYUFBYTtRQUNqQixJQUFJLGNBQWMsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ2pELGFBQWEsR0FBRyxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2pEO1FBRUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7Y0FFdkMsTUFBTSxHQUFHLGFBQWE7O2NBRXRCLGtCQUFrQixHQUEyQjtZQUMvQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsSUFBSTtZQUN0QyxLQUFLLEVBQUUsYUFBYTtZQUNwQixHQUFHLEVBQUUsR0FBRyxNQUFNLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRTtZQUNoQyxPQUFPLEVBQUUsUUFBUSxDQUFDLFlBQVk7WUFDOUIsUUFBUSxFQUFFLElBQUk7U0FDakI7O1lBQ0csb0JBQW9CO1FBRXhCLFFBQVEsUUFBUSxDQUFDLFFBQVEsRUFBRTtZQUV2QixLQUFLLFFBQVE7Z0JBQ1Qsb0JBQW9CLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFO29CQUMvRSxTQUFTLEVBQUUsSUFBSTtpQkFDbEIsQ0FBQyxDQUFDLENBQUM7Z0JBQ0osTUFBTTtZQUVWLEtBQUssS0FBSyxDQUFDO1lBQ1gsS0FBSyxNQUFNO2dCQUNQLG9CQUFvQixHQUFHLElBQUksb0JBQW9CLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDcEUsTUFBTTtZQUVWLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxRQUFRO2dCQUNULG9CQUFvQixHQUFHLElBQUksc0JBQXNCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDdEUsTUFBTTtZQUVWLEtBQUssTUFBTTtnQkFDUCxvQkFBb0IsR0FBRyxJQUFJLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ3JFLE1BQU07WUFFVixLQUFLLFVBQVU7Z0JBQ1gsb0JBQW9CLEdBQUcsSUFBSSx5QkFBeUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO2dCQUN6RSxNQUFNO1lBRVYsS0FBSyxTQUFTO2dCQUNWLG9CQUFvQixHQUFHLElBQUkscUJBQXFCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDckUsTUFBTTtZQUVWLEtBQUssTUFBTSxDQUFDO1lBQ1o7Z0JBQ0ksb0JBQW9CLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFO29CQUMvRSxXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7b0JBQ2pDLFNBQVMsRUFBRSxRQUFRLENBQUMsV0FBVztvQkFDL0IsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUMsQ0FBQztpQkFDdkUsQ0FBQyxDQUFDLENBQUM7U0FDWDtRQUVELE9BQU8sb0JBQW9CLENBQUM7SUFDaEMsQ0FBQzs7Ozs7O0lBRU8sb0JBQW9CLENBQUMsZUFBZTtRQUN4QyxJQUFJLDhCQUE4QixDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNyRixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsZUFBZSxFQUFFLENBQUMsQ0FBQztTQUN6RTtJQUNMLENBQUM7O0FBekZlLG1EQUFvQixHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQzs7WUFMOUgsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7O1lBbEJHLFVBQVU7WUFDVixjQUFjO1lBQ2QsZ0JBQWdCOzs7OztJQW1CaEIsb0RBQTJIOztJQUUzSCx3REFBdUI7Ozs7O0lBRVgsb0RBQThCOzs7OztJQUM5Qix3REFBc0M7Ozs7O0lBQ3RDLG1EQUFtQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQ2FyZFZpZXdJdGVtUHJvcGVydGllcyxcbiAgICBDYXJkVmlld0l0ZW0sXG4gICAgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsLFxuICAgIENhcmRWaWV3Qm9vbEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0RhdGVJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0ludEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0Zsb2F0SXRlbU1vZGVsLFxuICAgIExvZ1NlcnZpY2UsXG4gICAgTXVsdGlWYWx1ZVBpcGUsXG4gICAgQXBwQ29uZmlnU2VydmljZVxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgUHJvcGVydHksIENhcmRWaWV3R3JvdXAsIE9yZ2FuaXNlZFByb3BlcnR5R3JvdXAgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2NvbnRlbnQtbWV0YWRhdGEuaW50ZXJmYWNlcyc7XG5cbmNvbnN0IERfVEVYVCA9ICdkOnRleHQnO1xuY29uc3QgRF9NTFRFWFQgPSAnZDptbHRleHQnO1xuY29uc3QgRF9EQVRFID0gJ2Q6ZGF0ZSc7XG5jb25zdCBEX0RBVEVUSU1FID0gJ2Q6ZGF0ZXRpbWUnO1xuY29uc3QgRF9JTlQgPSAnZDppbnQnO1xuY29uc3QgRF9MT05HID0gJ2Q6bG9uZyc7XG5jb25zdCBEX0ZMT0FUID0gJ2Q6ZmxvYXQnO1xuY29uc3QgRF9ET1VCTEUgPSAnZDpkb3VibGUnO1xuY29uc3QgRF9CT09MRUFOID0gJ2Q6Ym9vbGVhbic7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUHJvcGVydHlHcm91cFRyYW5zbGF0b3JTZXJ2aWNlIHtcblxuICAgIHN0YXRpYyByZWFkb25seSBSRUNPR05JU0VEX0VDTV9UWVBFUyA9IFtEX1RFWFQsIERfTUxURVhULCBEX0RBVEUsIERfREFURVRJTUUsIERfSU5ULCBEX0xPTkcsIERfRkxPQVQsIERfRE9VQkxFLCBEX0JPT0xFQU5dO1xuXG4gICAgdmFsdWVTZXBhcmF0b3I6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIG11bHRpVmFsdWVQaXBlOiBNdWx0aVZhbHVlUGlwZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSkge1xuICAgICAgICB0aGlzLnZhbHVlU2VwYXJhdG9yID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oJ2NvbnRlbnQtbWV0YWRhdGEubXVsdGktdmFsdWUtcGlwZS1zZXBhcmF0b3InKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhbnNsYXRlVG9DYXJkVmlld0dyb3Vwcyhwcm9wZXJ0eUdyb3VwczogT3JnYW5pc2VkUHJvcGVydHlHcm91cFtdLCBwcm9wZXJ0eVZhbHVlcyk6IENhcmRWaWV3R3JvdXBbXSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3Vwcy5tYXAoKHByb3BlcnR5R3JvdXApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwOiBhbnkgPSBPYmplY3QuYXNzaWduKHt9LCBwcm9wZXJ0eUdyb3VwKTtcbiAgICAgICAgICAgIHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXMgPSB0aGlzLnRyYW5zbGF0ZUFycmF5KHByb3BlcnR5R3JvdXAucHJvcGVydGllcywgcHJvcGVydHlWYWx1ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYW5zbGF0ZUFycmF5KHByb3BlcnRpZXM6IFByb3BlcnR5W10sIHByb3BlcnR5VmFsdWVzOiBhbnkpOiBDYXJkVmlld0l0ZW1bXSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0aWVzLm1hcCgocHJvcGVydHkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZShwcm9wZXJ0eSwgcHJvcGVydHlWYWx1ZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYW5zbGF0ZShwcm9wZXJ0eTogUHJvcGVydHksIHByb3BlcnR5VmFsdWVzOiBhbnkpOiBDYXJkVmlld0l0ZW0ge1xuICAgICAgICBsZXQgcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWVzICYmIHByb3BlcnR5VmFsdWVzW3Byb3BlcnR5Lm5hbWVdKSB7XG4gICAgICAgICAgICBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZXNbcHJvcGVydHkubmFtZV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNoZWNrRUNNVHlwZVZhbGlkaXR5KHByb3BlcnR5LmRhdGFUeXBlKTtcblxuICAgICAgICBjb25zdCBwcmVmaXggPSAncHJvcGVydGllcy4nO1xuXG4gICAgICAgIGNvbnN0IHByb3BlcnR5RGVmaW5pdGlvbjogQ2FyZFZpZXdJdGVtUHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIGxhYmVsOiBwcm9wZXJ0eS50aXRsZSB8fCBwcm9wZXJ0eS5uYW1lLFxuICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWUsXG4gICAgICAgICAgICBrZXk6IGAke3ByZWZpeH0ke3Byb3BlcnR5Lm5hbWV9YCxcbiAgICAgICAgICAgIGRlZmF1bHQ6IHByb3BlcnR5LmRlZmF1bHRWYWx1ZSxcbiAgICAgICAgICAgIGVkaXRhYmxlOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGxldCBjYXJkVmlld0l0ZW1Qcm9wZXJ0eTtcblxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5LmRhdGFUeXBlKSB7XG5cbiAgICAgICAgICAgIGNhc2UgRF9NTFRFWFQ6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKE9iamVjdC5hc3NpZ24ocHJvcGVydHlEZWZpbml0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpbGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0lOVDpcbiAgICAgICAgICAgIGNhc2UgRF9MT05HOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3SW50SXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9GTE9BVDpcbiAgICAgICAgICAgIGNhc2UgRF9ET1VCTEU6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdGbG9hdEl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfREFURTpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0RhdGVJdGVtTW9kZWwocHJvcGVydHlEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0RBVEVUSU1FOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3RGF0ZXRpbWVJdGVtTW9kZWwocHJvcGVydHlEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0JPT0xFQU46XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdCb29sSXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9URVhUOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHtcbiAgICAgICAgICAgICAgICAgICAgbXVsdGl2YWx1ZWQ6IHByb3BlcnR5Lm11bHRpVmFsdWVkLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU6IHByb3BlcnR5Lm11bHRpVmFsdWVkLFxuICAgICAgICAgICAgICAgICAgICBwaXBlczogW3sgcGlwZTogdGhpcy5tdWx0aVZhbHVlUGlwZSwgcGFyYW1zOiBbdGhpcy52YWx1ZVNlcGFyYXRvcl19XVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjYXJkVmlld0l0ZW1Qcm9wZXJ0eTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrRUNNVHlwZVZhbGlkaXR5KGVjbVByb3BlcnR5VHlwZSkge1xuICAgICAgICBpZiAoUHJvcGVydHlHcm91cFRyYW5zbGF0b3JTZXJ2aWNlLlJFQ09HTklTRURfRUNNX1RZUEVTLmluZGV4T2YoZWNtUHJvcGVydHlUeXBlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihgVW5rbm93biB0eXBlIGZvciBtYXBwaW5nOiAke2VjbVByb3BlcnR5VHlwZX1gKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==