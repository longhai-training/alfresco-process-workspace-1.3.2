/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { getProperty } from './property-group-reader';
export class LayoutOrientedConfigService {
    /**
     * @param {?} config
     */
    constructor(config) {
        this.config = config;
    }
    /**
     * @param {?} groupName
     * @return {?}
     */
    isGroupAllowed(groupName) {
        if (this.isIncludeAllEnabled()) {
            return true;
        }
        return this.getMatchingGroups(groupName).length > 0;
    }
    /**
     * @param {?} propertyGroups
     * @return {?}
     */
    reorganiseByConfig(propertyGroups) {
        /** @type {?} */
        const layoutBlocks = this.config.filter((/**
         * @param {?} itemsGroup
         * @return {?}
         */
        (itemsGroup) => itemsGroup.items));
        /** @type {?} */
        const organisedPropertyGroup = layoutBlocks.map((/**
         * @param {?} layoutBlock
         * @return {?}
         */
        (layoutBlock) => {
            /** @type {?} */
            const flattenedItems = this.flattenItems(layoutBlock.items);
            /** @type {?} */
            const properties = flattenedItems.reduce((/**
             * @param {?} props
             * @param {?} explodedItem
             * @return {?}
             */
            (props, explodedItem) => {
                /** @type {?} */
                const property = getProperty(propertyGroups, explodedItem.groupName, explodedItem.propertyName) || [];
                return props.concat(property);
            }), []);
            return {
                title: layoutBlock.title,
                properties
            };
        }));
        return organisedPropertyGroup;
    }
    /**
     * @param {?} propertyGroups
     * @return {?}
     */
    appendAllPreset(propertyGroups) {
        return Object.keys(propertyGroups)
            .map((/**
         * @param {?} groupName
         * @return {?}
         */
        (groupName) => {
            /** @type {?} */
            const propertyGroup = propertyGroups[groupName];
            /** @type {?} */
            const properties = propertyGroup.properties;
            return Object.assign({}, propertyGroup, {
                properties: Object.keys(properties).map((/**
                 * @param {?} propertyName
                 * @return {?}
                 */
                (propertyName) => properties[propertyName]))
            });
        }));
    }
    /**
     * @param {?} propertyGroups
     * @return {?}
     */
    filterExcludedPreset(propertyGroups) {
        /** @type {?} */
        let excludedConfig = this.config
            .map((/**
         * @param {?} config
         * @return {?}
         */
        (config) => config.exclude))
            .find((/**
         * @param {?} exclude
         * @return {?}
         */
        (exclude) => exclude !== undefined));
        if (excludedConfig === undefined) {
            excludedConfig = [];
        }
        else if (typeof excludedConfig === 'string') {
            excludedConfig = [excludedConfig];
        }
        return propertyGroups.filter((/**
         * @param {?} props
         * @return {?}
         */
        (props) => {
            return !excludedConfig.includes(props.name);
        }));
    }
    /**
     * @return {?}
     */
    isIncludeAllEnabled() {
        /** @type {?} */
        const includeAllProperty = this.config
            .map((/**
         * @param {?} config
         * @return {?}
         */
        (config) => config.includeAll))
            .find((/**
         * @param {?} includeAll
         * @return {?}
         */
        (includeAll) => includeAll !== undefined));
        return includeAllProperty !== undefined ? includeAllProperty : false;
    }
    /**
     * @private
     * @param {?} items
     * @return {?}
     */
    flattenItems(items) {
        return items.reduce((/**
         * @param {?} accumulator
         * @param {?} item
         * @return {?}
         */
        (accumulator, item) => {
            /** @type {?} */
            const properties = Array.isArray(item.properties) ? item.properties : [item.properties];
            /** @type {?} */
            const flattenedProperties = properties.map((/**
             * @param {?} propertyName
             * @return {?}
             */
            (propertyName) => {
                return {
                    groupName: item.aspect || item.type,
                    propertyName
                };
            }));
            return accumulator.concat(flattenedProperties);
        }), []);
    }
    /**
     * @private
     * @param {?} groupName
     * @return {?}
     */
    getMatchingGroups(groupName) {
        return this.config
            .map((/**
         * @param {?} layoutBlock
         * @return {?}
         */
        (layoutBlock) => layoutBlock.items))
            .reduce((/**
         * @param {?} accumulator
         * @param {?} items
         * @return {?}
         */
        (accumulator, items) => accumulator.concat(items)), [])
            .filter((/**
         * @param {?} item
         * @return {?}
         */
        (item) => item.aspect === groupName || item.type === groupName));
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    LayoutOrientedConfigService.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5b3V0LW9yaWVudGVkLWNvbmZpZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1jb250ZW50LXNlcnZpY2VzLyIsInNvdXJjZXMiOlsiY29udGVudC1tZXRhZGF0YS9zZXJ2aWNlcy9jb25maWcvbGF5b3V0LW9yaWVudGVkLWNvbmZpZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUJBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUV0RCxNQUFNLE9BQU8sMkJBQTJCOzs7O0lBRXBDLFlBQW9CLE1BQVc7UUFBWCxXQUFNLEdBQU4sTUFBTSxDQUFLO0lBQUksQ0FBQzs7Ozs7SUFFN0IsY0FBYyxDQUFDLFNBQWlCO1FBQ25DLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFLEVBQUU7WUFDNUIsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDeEQsQ0FBQzs7Ozs7SUFFTSxrQkFBa0IsQ0FBQyxjQUFzQzs7Y0FDdEQsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTs7OztRQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFDOztjQUVuRSxzQkFBc0IsR0FBRyxZQUFZLENBQUMsR0FBRzs7OztRQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7O2tCQUN0RCxjQUFjLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDOztrQkFDdkQsVUFBVSxHQUFHLGNBQWMsQ0FBQyxNQUFNOzs7OztZQUFDLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxFQUFFOztzQkFDakQsUUFBUSxHQUFHLFdBQVcsQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLFNBQVMsRUFBRSxZQUFZLENB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Ozs7OztJQUVPLGlCQUFpQixDQUFDLFNBQWlCO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDLE1BQU07YUFDYixHQUFHOzs7O1FBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUM7YUFDdkMsTUFBTTs7Ozs7UUFBQyxDQUFDLFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUUsRUFBRSxDQUFDO2FBQzdELE1BQU07Ozs7UUFBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLEVBQUMsQ0FBQztJQUNoRixDQUFDO0NBQ0o7Ozs7OztJQXBGZSw2Q0FBbUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIENvbnRlbnRNZXRhZGF0YUNvbmZpZyxcbiAgICBMYXlvdXRPcmllbnRlZENvbmZpZ0l0ZW0sXG4gICAgT3JnYW5pc2VkUHJvcGVydHlHcm91cCxcbiAgICBQcm9wZXJ0eUdyb3VwQ29udGFpbmVyXG59IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvY29udGVudC1tZXRhZGF0YS5pbnRlcmZhY2VzJztcbmltcG9ydCB7IGdldFByb3BlcnR5IH0gZnJvbSAnLi9wcm9wZXJ0eS1ncm91cC1yZWFkZXInO1xuXG5leHBvcnQgY2xhc3MgTGF5b3V0T3JpZW50ZWRDb25maWdTZXJ2aWNlIGltcGxlbWVudHMgQ29udGVudE1ldGFkYXRhQ29uZmlnIHtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlnOiBhbnkpIHsgfVxuXG4gICAgcHVibGljIGlzR3JvdXBBbGxvd2VkKGdyb3VwTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmlzSW5jbHVkZUFsbEVuYWJsZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWF0Y2hpbmdHcm91cHMoZ3JvdXBOYW1lKS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW9yZ2FuaXNlQnlDb25maWcocHJvcGVydHlHcm91cHM6IFByb3BlcnR5R3JvdXBDb250YWluZXIpOiBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwW10ge1xuICAgICAgICBjb25zdCBsYXlvdXRCbG9ja3MgPSB0aGlzLmNvbmZpZy5maWx0ZXIoKGl0ZW1zR3JvdXApID0+IGl0ZW1zR3JvdXAuaXRlbXMpO1xuXG4gICAgICAgIGNvbnN0IG9yZ2FuaXNlZFByb3BlcnR5R3JvdXAgPSBsYXlvdXRCbG9ja3MubWFwKChsYXlvdXRCbG9jaykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmxhdHRlbmVkSXRlbXMgPSB0aGlzLmZsYXR0ZW5JdGVtcyhsYXlvdXRCbG9jay5pdGVtcyksXG4gICAgICAgICAgICAgICAgcHJvcGVydGllcyA9IGZsYXR0ZW5lZEl0ZW1zLnJlZHVjZSgocHJvcHMsIGV4cGxvZGVkSXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IGdldFByb3BlcnR5KHByb3BlcnR5R3JvdXBzLCBleHBsb2RlZEl0ZW0uZ3JvdXBOYW1lLCBleHBsb2RlZEl0ZW0ucHJvcGVydHlOYW1lKSB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3BzLmNvbmNhdChwcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgfSwgW10pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBsYXlvdXRCbG9jay50aXRsZSxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gb3JnYW5pc2VkUHJvcGVydHlHcm91cDtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXBwZW5kQWxsUHJlc2V0KHByb3BlcnR5R3JvdXBzOiBQcm9wZXJ0eUdyb3VwQ29udGFpbmVyKTogT3JnYW5pc2VkUHJvcGVydHlHcm91cFtdIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHByb3BlcnR5R3JvdXBzKVxuICAgICAgICAgICAgLm1hcCgoZ3JvdXBOYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlHcm91cCA9IHByb3BlcnR5R3JvdXBzW2dyb3VwTmFtZV0sXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXM7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgcHJvcGVydHlHcm91cCwge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5tYXAoKHByb3BlcnR5TmFtZSkgPT4gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGZpbHRlckV4Y2x1ZGVkUHJlc2V0KHByb3BlcnR5R3JvdXBzOiBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwW10pOiBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwW10ge1xuICAgICAgICBsZXQgZXhjbHVkZWRDb25maWcgPSB0aGlzLmNvbmZpZ1xuICAgICAgICAgICAgLm1hcCgoY29uZmlnKSA9PiBjb25maWcuZXhjbHVkZSlcbiAgICAgICAgICAgIC5maW5kKChleGNsdWRlKSA9PiBleGNsdWRlICE9PSB1bmRlZmluZWQpO1xuXG4gICAgICAgIGlmIChleGNsdWRlZENvbmZpZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBleGNsdWRlZENvbmZpZyA9IFtdO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBleGNsdWRlZENvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGV4Y2x1ZGVkQ29uZmlnID0gW2V4Y2x1ZGVkQ29uZmlnXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3Vwcy5maWx0ZXIoKHByb3BzKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIWV4Y2x1ZGVkQ29uZmlnLmluY2x1ZGVzKHByb3BzLm5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNJbmNsdWRlQWxsRW5hYmxlZCgpIHtcbiAgICAgICAgY29uc3QgaW5jbHVkZUFsbFByb3BlcnR5ID0gdGhpcy5jb25maWdcbiAgICAgICAgICAgIC5tYXAoKGNvbmZpZykgPT4gY29uZmlnLmluY2x1ZGVBbGwpXG4gICAgICAgICAgICAuZmluZCgoaW5jbHVkZUFsbCkgPT4gaW5jbHVkZUFsbCAhPT0gdW5kZWZpbmVkKTtcblxuICAgICAgICByZXR1cm4gaW5jbHVkZUFsbFByb3BlcnR5ICE9PSB1bmRlZmluZWQgPyBpbmNsdWRlQWxsUHJvcGVydHkgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZsYXR0ZW5JdGVtcyhpdGVtcykge1xuICAgICAgICByZXR1cm4gaXRlbXMucmVkdWNlKChhY2N1bXVsYXRvciwgaXRlbSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IEFycmF5LmlzQXJyYXkoaXRlbS5wcm9wZXJ0aWVzKSA/IGl0ZW0ucHJvcGVydGllcyA6IFtpdGVtLnByb3BlcnRpZXNdO1xuICAgICAgICAgICAgY29uc3QgZmxhdHRlbmVkUHJvcGVydGllcyA9IHByb3BlcnRpZXMubWFwKChwcm9wZXJ0eU5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBncm91cE5hbWU6IGl0ZW0uYXNwZWN0IHx8IGl0ZW0udHlwZSxcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3IuY29uY2F0KGZsYXR0ZW5lZFByb3BlcnRpZXMpO1xuICAgICAgICB9LCBbXSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRNYXRjaGluZ0dyb3Vwcyhncm91cE5hbWU6IHN0cmluZyk6IExheW91dE9yaWVudGVkQ29uZmlnSXRlbVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnXG4gICAgICAgICAgICAubWFwKChsYXlvdXRCbG9jaykgPT4gbGF5b3V0QmxvY2suaXRlbXMpXG4gICAgICAgICAgICAucmVkdWNlKChhY2N1bXVsYXRvciwgaXRlbXMpID0+IGFjY3VtdWxhdG9yLmNvbmNhdChpdGVtcyksIFtdKVxuICAgICAgICAgICAgLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5hc3BlY3QgPT09IGdyb3VwTmFtZSB8fCBpdGVtLnR5cGUgPT09IGdyb3VwTmFtZSk7XG4gICAgfVxufVxuIl19